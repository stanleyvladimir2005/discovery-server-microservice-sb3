{"version":3,"file":"836.js?_cache=3565bf1138434de8b2c8","mappings":"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","sources":["webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/EventFiltersChanged.ts","webpack://grafana-metricsdrilldown-app/./utils/utils.variables.ts","webpack://grafana-metricsdrilldown-app/./UserPreferences/pref-keys.ts","webpack://grafana-metricsdrilldown-app/./services/levels.ts","webpack://grafana-metricsdrilldown-app/./services/sorting.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/EventMetricsVariableActivated.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/SectionTitle.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/helpers/areArraysEqual.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/withLifecycleEvents.ts","webpack://grafana-metricsdrilldown-app/./App/useCatchExceptions.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/QuickSearch/EventQuickSearchChanged.ts","webpack://grafana-metricsdrilldown-app/./MetricsDrilldownDataSourceVariable.ts","webpack://grafana-metricsdrilldown-app/./PluginInfo/PluginLogo.tsx","webpack://grafana-metricsdrilldown-app/./PluginInfo/PluginInfo.tsx","webpack://grafana-metricsdrilldown-app/./DataTrailSettings.tsx","webpack://grafana-metricsdrilldown-app/./DataTrail.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ShowMoreButton.tsx","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/buildQueryExpression.ts","webpack://grafana-metricsdrilldown-app/./shared.ts","webpack://grafana-metricsdrilldown-app/./TrailStore/TrailStore.ts","webpack://grafana-metricsdrilldown-app/./TrailStore/utils.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/GroupByVariable.tsx","webpack://grafana-metricsdrilldown-app/./services/variables.ts","webpack://grafana-metricsdrilldown-app/./constants/ui.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/GmdVizPanelVariantSelector.tsx","webpack://grafana-metricsdrilldown-app/./Menu/AddToExplorationsButton.tsx","webpack://grafana-metricsdrilldown-app/./Menu/PanelMenu.tsx","webpack://grafana-metricsdrilldown-app/./MetricGraphScene.tsx","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/PrefixFilterDropdown.tsx","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/RelatedListControls.tsx","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/RelatedMetricsScene.tsx","webpack://grafana-metricsdrilldown-app/./ShareTrailButton.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/events/EventTimeseriesDataReceived.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/events/EventForceSyncYAxis.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/events/EventResetSyncYAxis.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/behaviors/syncYAxis.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/units/getUnit.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/SelectLabelAction.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/behaviors/publishTimeseriesData.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/transformations/addRefId.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/transformations/sliceSeries.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/LabelVizPanel.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/MetricLabelsList.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/AddToFiltersGraphAction.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/getLabelValueFromDataFrame.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/SortBySelector.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/SceneByFrameRepeater.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/LabelValuesCountProvider.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/LabelValueVizPanel.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelValuesList/MetricLabelValuesList.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/LabelBreakdownScene.tsx","webpack://grafana-metricsdrilldown-app/./MetricActionBar.tsx","webpack://grafana-metricsdrilldown-app/./TrailStore/useBookmarkState.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/queryGenerators/baseQuery.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/graphBuilders.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/queryGenerators/common.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/queryGenerators/default.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/queryGenerators/histogram.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/queryGenerators/summary.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/getAutoQueriesForMetric.ts","webpack://grafana-metricsdrilldown-app/./Integrations/logs/labelsCrossReference.ts","webpack://grafana-metricsdrilldown-app/./Integrations/logs/lokiRecordingRules.ts","webpack://grafana-metricsdrilldown-app/./RelatedLogs/RelatedLogsOrchestrator.ts","webpack://grafana-metricsdrilldown-app/./RelatedLogs/NoRelatedLogsFound.tsx","webpack://grafana-metricsdrilldown-app/./RelatedLogs/OpenInLogsDrilldownButton.tsx","webpack://grafana-metricsdrilldown-app/./RelatedLogs/RelatedLogsScene.tsx","webpack://grafana-metricsdrilldown-app/./MetricScene.tsx","webpack://grafana-metricsdrilldown-app/./App/useTrail.tsx","webpack://grafana-metricsdrilldown-app/./App/ErrorView.tsx","webpack://grafana-metricsdrilldown-app/./autoQuery/buildPrometheusQuery.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/panels/buildStatusHistoryPanel.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/behaviors/ExtremeValueFilterBehavior.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/MetricVizPanel.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/panels/buildHeatmapPanel.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/panels/buildTimeseriesPanel.ts","webpack://grafana-metricsdrilldown-app/./interactions.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/QuickSearch/CountsProvider/CountsProvider.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/displayStatus.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/UsageData.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/WithUsageDataPreviewPanel.tsx","webpack://grafana-metricsdrilldown-app/./utils/utils.scopes.ts","webpack://grafana-metricsdrilldown-app/./utils.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/localCompare.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/fetchers/fetchAlertingMetrics.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/fetchers/fetchDashboardMetrics.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/MetricUsageFetcher.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter.tsx","webpack://grafana-metricsdrilldown-app/./types/language-provider/versionCheck.ts","webpack://grafana-metricsdrilldown-app/./types/language-provider/v11-6-x.ts","webpack://grafana-metricsdrilldown-app/./types/language-provider/v12-0-0.ts","webpack://grafana-metricsdrilldown-app/./types/language-provider/v12-1-0-plus.ts","webpack://grafana-metricsdrilldown-app/./helpers/MetricDatasourceHelper.ts","webpack://grafana-metricsdrilldown-app/./DataTrailCard.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/BookmarksList.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/MetricsVariable.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsList/MetricsList.tsx","webpack://grafana-metricsdrilldown-app/./UserPreferences/userPreferences.ts","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/sortRelatedMetrics.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/MetricsVariableSortEngine.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/heatmap/buildHeatmapPanel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/heatmap/getHeatmapQueryRunnerParams.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/percentiles/buildPercentilesPanel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/percentiles/getPercentilesQueryRunnerParams.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/statushistory/buildStatushistoryPanel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/statushistory/getStatushistoryQueryRunnerParams.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/timeseries/buildTimeseriesPanel.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/GmdVizPanel.tsx","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/statushistory/isUpDownMetric.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/heatmap/isHistogramMetric.ts","webpack://grafana-metricsdrilldown-app/./App/InlineBanner.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/EventMetricsVariableDeactivated.ts","webpack://grafana-metricsdrilldown-app/./utils/utils.styles.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/QuickSearch/QuickSearch.tsx","webpack://grafana-metricsdrilldown-app/./utils/utils.queries.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/EventMetricsVariableLoaded.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/units.ts","webpack://grafana-metricsdrilldown-app/./utils/utils.datasource.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/EventPanelTypeChanged.ts","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/timeseries/isRateQuery.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/transformations/addUnspecifiedLabel.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/LayoutSwitcher.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/events/EventSortByChanged.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/Labels/LabelsDataSource.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/Labels/LabelValuesVariable.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/Labels/LabelsVariable.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/custom-icons/GroupsIcon.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsWithLabelValue/MetricsWithLabelValueDataSource.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/isPrometheusRule.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsWithLabelValue/MetricsWithLabelValueVariable.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsGroupByRow.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsGroupByList.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/ListControls.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/actions/EventApplyFunction.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/actions/ApplyAction.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/actions/EventConfigureFunction.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/actions/ConfigureAction.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SceneDrawer.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/metricLabels.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/EventSectionValueChanged.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/CheckboxWithCount.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/CheckBoxList.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/MetricsFilterSection.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/computeMetricSuffixGroups.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/computeRulesGroups.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/LabelsBrowser/LabelsList.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/LabelsBrowser/LabelsBrowser.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/Settings.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/SideBarButton.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/custom-icons/RulesIcon.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/SideBar.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsReducer.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/registerRuntimeDataSources.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/actions/SelectAction.tsx","webpack://grafana-metricsdrilldown-app/./GmdVizPanel/timeseries/getTimeseriesQueryRunnerParams.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/computeMetricPrefixGroups.ts","webpack://grafana-metricsdrilldown-app/./App/Routes.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/FilteredMetricsVariable.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/QuickSearch/CountsProvider/MetricVariableCountsProvider.ts"],"sourcesContent":["import { BusEventWithPayload } from '@grafana/data';\n\nimport { type MetricFilters } from 'WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine';\n\nexport interface EventFiltersChangedPayload {\n  type: keyof MetricFilters;\n  filters: string[];\n}\n\nexport class EventFiltersChanged extends BusEventWithPayload<EventFiltersChangedPayload> {\n  public static readonly type = 'filters-changed';\n}\n","import {\n  type AdHocFiltersVariable,\n  type ConstantVariable,\n  type CustomVariable,\n  type QueryVariable,\n  type SceneVariable,\n} from '@grafana/scenes';\n\ntype MaybeVariable = SceneVariable | null | undefined;\n\nexport function isConstantVariable(variable: MaybeVariable): variable is ConstantVariable {\n  return variable !== null && variable?.state.type === 'constant';\n}\n\nexport function isAdHocFiltersVariable(variable: MaybeVariable): variable is AdHocFiltersVariable {\n  return variable !== null && variable?.state.type === 'adhoc';\n}\n\nexport function isCustomVariable(variable: MaybeVariable): variable is CustomVariable {\n  return variable !== null && variable?.state.type === 'custom';\n}\n\nexport function isQueryVariable(variable: MaybeVariable): variable is QueryVariable {\n  return variable !== null && variable?.state.type === 'query';\n}\n","export const PREF_KEYS = {\n  DATASOURCE: 'datasource',\n  BOOKMARKS: 'bookmarks',\n  RECENT_METRICS: 'recent-metrics',\n  BREAKDOWN_SORTBY: 'breakdown.sortby',\n};\n","import { type DataFrame } from '@grafana/data';\n\nexport function getLabelValueFromDataFrame(frame: DataFrame) {\n  const labels = frame.fields[1]?.labels;\n\n  if (!labels) {\n    return null;\n  }\n\n  const keys = Object.keys(labels);\n  if (keys.length === 0) {\n    return null;\n  }\n\n  return labels[keys[0]];\n}\n","import { OutlierDetector, type OutlierOutput } from '@bsull/augurs/outlier';\nimport {\n  doStandardCalcs,\n  fieldReducers,\n  FieldType,\n  outerJoinDataFrames,\n  ReducerID,\n  type DataFrame,\n} from '@grafana/data';\nimport { memoize } from 'lodash';\n\nimport { displayWarning } from 'WingmanDataTrail/helpers/displayStatus';\nimport { localeCompare } from 'WingmanDataTrail/helpers/localCompare';\n\nimport { reportExploreMetrics } from '../interactions';\nimport { getLabelValueFromDataFrame } from './levels';\n\nexport type SortSeriesByOption = 'alphabetical' | 'alphabetical-reversed' | 'outliers' | ReducerID.stdDev;\nexport type SortSeriesDirection = 'asc' | 'desc';\n\n// Alphabetical sort\nconst sortAlphabetical = (series: DataFrame[], direction: SortSeriesDirection = 'asc') => {\n  const compareFn: (a: string, b: string) => number =\n    direction === 'asc' ? (a, b) => localeCompare(a, b) : (a, b) => localeCompare(b, a);\n\n  return series.sort((a, b) => {\n    const labelA = getLabelValueFromDataFrame(a);\n    if (!labelA) {\n      return 0;\n    }\n\n    const labelB = getLabelValueFromDataFrame(b);\n    if (!labelB) {\n      return 0;\n    }\n\n    return compareFn(labelA, labelB);\n  });\n};\n\n// Field reducer sort\nconst sortByFieldReducer = (series: DataFrame[], sortBy: string, direction: SortSeriesDirection = 'asc') => {\n  const fieldReducer = fieldReducers.get(sortBy);\n\n  const seriesCalcs = series.map((dataFrame) => {\n    const field = dataFrame.fields[1];\n    if (!field) {\n      return {\n        value: 0,\n        dataFrame,\n      };\n    }\n\n    const value = fieldReducer.reduce?.(field, true, true) ?? doStandardCalcs(field, true, true);\n    return {\n      value: value[sortBy] ?? 0,\n      dataFrame,\n    };\n  });\n\n  seriesCalcs.sort(direction === 'asc' ? (a, b) => a.value - b.value : (a, b) => b.value - a.value);\n\n  return seriesCalcs.map(({ dataFrame }) => dataFrame);\n};\n\n// Outlier sort\nconst sortByOutliers = (series: DataFrame[], direction: 'asc' | 'desc' = 'asc') => {\n  if (!wasmSupported()) {\n    throw new Error('WASM not supported');\n  }\n\n  const outliers = getOutliers(series);\n\n  const seriesCalcs = series.map((dataFrame, index) => ({\n    value: calculateOutlierValue(outliers, index),\n    dataFrame: dataFrame,\n  }));\n\n  seriesCalcs.sort(direction === 'asc' ? (a, b) => a.value - b.value : (a, b) => b.value - a.value);\n\n  return seriesCalcs.map(({ dataFrame }) => dataFrame);\n};\n\nconst getOutliers = (series: DataFrame[]): OutlierOutput => {\n  // Combine all frames into one by joining on time.\n  const joined = outerJoinDataFrames({ frames: series });\n  if (!joined) {\n    throw new Error('Error while joining frames into a single one');\n  }\n\n  // Get number fields: these are our series.\n  const joinedSeries = joined.fields.filter((f) => f.type === FieldType.number);\n  const points = joinedSeries.map((series) => new Float64Array(series.values));\n\n  return OutlierDetector.dbscan({ sensitivity: 0.9 }).detect(points);\n};\n\nconst calculateOutlierValue = (outliers: OutlierOutput, index: number): number => {\n  if (outliers.seriesResults[index].isOutlier) {\n    return -outliers.seriesResults[index].outlierIntervals.length;\n  }\n  return 0;\n};\n\nexport const sortSeries = memoize(\n  (origSeries: DataFrame[], sortBy: SortSeriesByOption, direction: SortSeriesDirection = 'asc') => {\n    if (!origSeries.length) {\n      return [];\n    }\n\n    const series = [...origSeries];\n\n    // Alphabetical sorting\n    if (sortBy === 'alphabetical') {\n      return sortAlphabetical(series, 'asc');\n    }\n\n    if (sortBy === 'alphabetical-reversed') {\n      return sortAlphabetical(series, 'desc');\n    }\n\n    // Outlier detection sorting\n    if (sortBy === 'outliers') {\n      try {\n        return sortByOutliers(series, direction);\n      } catch (e) {\n        const msg = `Error while sorting by outlying series: \"${(e as Error).toString()}\"!`;\n        displayWarning([msg, 'Falling back to standard deviation to identify the most variable series.']);\n\n        return sortByFieldReducer(series, ReducerID.stdDev, direction);\n      }\n    }\n\n    // Field reducer sorting (default case)\n    return sortByFieldReducer(series, sortBy, direction);\n  },\n  (series: DataFrame[], sortBy: string, direction: SortSeriesDirection = 'asc') => {\n    const firstTimestamp = seriesIsNotEmpty(series) ? series[0].fields[0].values[0] : 0;\n    const lastTimestamp = seriesIsNotEmpty(series)\n      ? series[series.length - 1].fields[0].values[series[series.length - 1].fields[0].values.length - 1]\n      : 0;\n\n    const firstValue = series.length > 0 ? getLabelValueFromDataFrame(series[0]) : '';\n    const lastValue = series.length > 0 ? getLabelValueFromDataFrame(series[series.length - 1]) : '';\n\n    const key = `${firstValue}_${lastValue}_${firstTimestamp}_${lastTimestamp}_${series.length}_${sortBy}_${direction}`;\n\n    return key;\n  }\n);\n\nfunction seriesIsNotEmpty(series: DataFrame[]) {\n  return series.length > 0 && series[0].fields.length > 0 && series[0].fields[0].values.length > 0;\n}\n\nexport const wasmSupported = () => {\n  const support = typeof WebAssembly === 'object';\n\n  if (!support) {\n    reportExploreMetrics('wasm_not_supported', {});\n  }\n\n  return support;\n};\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventMetricsVariableActivatedPayload {\n  key: string;\n}\n\nexport class EventMetricsVariableActivated extends BusEventWithPayload<EventMetricsVariableActivatedPayload> {\n  public static readonly type = 'metrics-variable-activated';\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\ntype SectionTitleProps = {\n  title: string;\n  description: string;\n};\n\nexport function SectionTitle({ title, description }: Readonly<SectionTitleProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <h6 className={styles.title}>\n      <span>{title}</span>\n      <Tooltip content={description} placement=\"top\">\n        <Icon name=\"info-circle\" size=\"sm\" className={styles.infoIcon} />\n      </Tooltip>\n    </h6>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    title: css({\n      fontSize: '15px',\n      fontWeight: theme.typography.fontWeightLight,\n      borderBottom: `1px solid ${theme.colors.border.weak}`,\n      paddingBottom: theme.spacing(0.5),\n    }),\n    infoIcon: css({\n      marginLeft: theme.spacing(1),\n      cursor: 'pointer',\n      color: theme.colors.text.secondary,\n      position: 'relative',\n      top: '-4px',\n    }),\n  };\n}\n","import { isEqual } from 'lodash';\n\nexport const areArraysEqual = (array1: any[], array2: any[]) =>\n  array1.length === array2.length && isEqual(array1, array2);\n","import { type MultiValueVariable, type MultiValueVariableState } from '@grafana/scenes';\n\nimport { EventMetricsVariableActivated } from './EventMetricsVariableActivated';\nimport { EventMetricsVariableDeactivated } from './EventMetricsVariableDeactivated';\nimport { EventMetricsVariableLoaded } from './EventMetricsVariableLoaded';\n\n/**\n * Adds the publication of lifecycle events to a metrics variable:\n *\n * - `EventMetricsVariableActivated`\n * - `EventMetricsVariableDeactivated`\n * - `EventMetricsVariableLoaded`\n *\n * This is particularly useful for filtering and sorting the variable options, while keeping the\n * different pieces of code decoupled.\n *\n * The filtering and sorting logic is centralized in the `MetricsReducer` class.\n */\nexport function withLifecycleEvents<T extends MultiValueVariable>(variable: T): T {\n  const key = variable.state.key as string;\n\n  if (!key) {\n    throw new TypeError(\n      `Variable \"${variable.state.name}\" has no key. Please provide a key in order to publish its lifecycle events.`\n    );\n  }\n\n  variable.addActivationHandler(() => {\n    variable.publishEvent(new EventMetricsVariableActivated({ key }), true);\n\n    // We make sure filtering and sorting work in a scenario where the user goes from the MetricsReducer to the MetricScene and back.\n    // Indeed, sometimes, the variable already has its options and does not load new ones (issue reported in a dev env).\n    if (!variable.state.loading && variable.state.options.length) {\n      variable.publishEvent(new EventMetricsVariableLoaded({ key, options: variable.state.options }), true);\n    }\n\n    variable.subscribeToState((newState: MultiValueVariableState, prevState: MultiValueVariableState) => {\n      if (!newState.loading && prevState.loading) {\n        variable.publishEvent(new EventMetricsVariableLoaded({ key, options: newState.options }), true);\n      }\n    });\n\n    return () => {\n      variable.publishEvent(new EventMetricsVariableDeactivated({ key }), true);\n    };\n  });\n\n  return variable;\n}\n","import { useEffect, useState } from 'react';\n\nimport { logger } from '../tracking/logger/logger';\n\nfunction ensureErrorObject(error: any, defaultMessage: string): Error {\n  if (error instanceof Error) {\n    return error;\n  }\n  if (typeof error === 'string') {\n    return new Error(error);\n  }\n  if (typeof error.message === 'string') {\n    return new Error(error.message);\n  }\n  return new Error(defaultMessage);\n}\n\n/**\n * Determines if an error should be treated as an application-breaking error.\n * Filters out known non-critical errors like browser extension errors and ResizeObserver warnings.\n */\nfunction shouldTreatAsApplicationError(errorEvent: ErrorEvent): boolean {\n  // Check if error is from a browser extension\n  if (errorEvent.filename) {\n    const protocol = new URL(errorEvent.filename).protocol;\n\n    if (protocol.endsWith('extension:')) {\n      logger.error(new Error(`Browser extension error: ${errorEvent.message}`), {\n        filename: errorEvent.filename,\n        lineno: errorEvent.lineno?.toString(),\n        colno: errorEvent.colno?.toString(),\n      });\n      return false;\n    }\n  }\n\n  // Check for null error with message (like ResizeObserver warnings)\n  if (errorEvent.error === null && errorEvent.message) {\n    logger.error(new Error(`Non-critical error: ${errorEvent.message}`), {\n      filename: errorEvent.filename,\n      lineno: errorEvent.lineno?.toString(),\n      colno: errorEvent.colno?.toString(),\n    });\n    return false;\n  }\n\n  return true;\n}\n\nexport function useCatchExceptions(): [Error | undefined, React.Dispatch<React.SetStateAction<Error | undefined>>] {\n  const [error, setError] = useState<Error>();\n\n  // even though we wrap the app in an ErrorBoundary, some errors are not caught,\n  // so we have to set global handlers to catch these (e.g. error thrown from some click handlers)\n  useEffect(() => {\n    const onError = (errorEvent: ErrorEvent) => {\n      if (!shouldTreatAsApplicationError(errorEvent)) {\n        return;\n      }\n\n      setError(ensureErrorObject(errorEvent.error, 'Uncaught exception!'));\n    };\n\n    const onUnHandledRejection = (event: PromiseRejectionEvent) => {\n      // TODO: remove me when we remove MetricSelectScene\n      // indeed, it seems there's always  a cancelled request when landing on the view :man_shrug:\n      // Ideally, the code in DataTrail should handle the cancellation but we do it here because it's easier\n      if (event.reason.type === 'cancelled') {\n        setError(undefined);\n        return;\n      }\n\n      setError(ensureErrorObject(event.reason, 'Unhandled rejection!'));\n    };\n\n    window.addEventListener('error', onError);\n    window.addEventListener('unhandledrejection', onUnHandledRejection);\n    return () => {\n      window.removeEventListener('unhandledrejection', onUnHandledRejection);\n      window.removeEventListener('error', onError);\n    };\n  }, []);\n\n  return [error, setError];\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventQuickSearchChangedPayload {\n  searchText: string;\n}\n\nexport class EventQuickSearchChanged extends BusEventWithPayload<EventQuickSearchChangedPayload> {\n  public static readonly type = 'quick-search-changed';\n}\n","import { config } from '@grafana/runtime';\nimport { DataSourceVariable } from '@grafana/scenes';\n\nimport { VAR_DATASOURCE } from 'shared';\nimport { logger } from 'tracking/logger/logger';\nimport { isPrometheusDataSource } from 'utils/utils.datasource';\n\nimport { PREF_KEYS } from './UserPreferences/pref-keys';\nimport { userPreferences } from './UserPreferences/userPreferences';\n\nexport class MetricsDrilldownDataSourceVariable extends DataSourceVariable {\n  constructor({ initialDS }: { initialDS?: string }) {\n    super({\n      key: VAR_DATASOURCE,\n      name: VAR_DATASOURCE,\n      pluginId: 'prometheus',\n      label: 'Data source',\n      description: 'Only prometheus data sources are supported',\n      // if no initialDS is passed to the constructor, we bypass Scenes native behaviour by determining the data source ourselves (see getCurrentDataSource())...\n      skipUrlSync: !initialDS,\n      // ... by doing this, we make sure that we'll always have a data source when the \"var-ds\" URL search param is missing, incorrect, etc.\n      value: initialDS || MetricsDrilldownDataSourceVariable.getCurrentDataSource(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.setState({ skipUrlSync: false }); // restore URL sync\n\n    this.subscribeToState((newState, prevState) => {\n      if (newState.value && newState.value !== prevState.value) {\n        // store the new value for future visits\n        userPreferences.setItem(PREF_KEYS.DATASOURCE, newState.value as string);\n      }\n    });\n  }\n\n  private static getCurrentDataSource(): string {\n    const prometheusDataSources = Object.values(config.datasources).filter((ds) => isPrometheusDataSource(ds));\n\n    const uidFromUrl = new URL(window.location.href).searchParams.get(`var-${VAR_DATASOURCE}`);\n    const uidFromLocalStorage = userPreferences.getItem(PREF_KEYS.DATASOURCE);\n\n    const currentDataSource =\n      prometheusDataSources.find((ds) => ds.uid === uidFromUrl) ||\n      prometheusDataSources.find((ds) => ds.uid === uidFromLocalStorage) ||\n      prometheusDataSources.find((ds) => ds.isDefault) ||\n      prometheusDataSources[0];\n\n    if (!currentDataSource) {\n      logger.warn('Cannot find any Prometheus data source!');\n      return 'no-data-source-configured';\n    }\n\n    return currentDataSource.uid;\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { memo } from 'react';\n\ntype PluginLogoProps = {\n  size: 'small' | 'large';\n};\n\nexport const PluginLogo = memo(function PluginLogoComponent({ size }: PluginLogoProps) {\n  const styles = useStyles2(getStyles);\n  return <img className={cx(styles.logo, size)} src=\"public/plugins/grafana-metricsdrilldown-app/img/logo.svg\" />;\n});\n\nconst getStyles = () => ({\n  logo: css`\n    &.small {\n      width: 24px;\n      height: 24px;\n      margin-right: 4px;\n      position: relative;\n      top: -2px;\n    }\n\n    &.large {\n      width: 40px;\n      height: 40px;\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { usePluginContext, type GrafanaTheme2 } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { Button, Dropdown, Menu, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { PluginLogo } from './PluginLogo';\nimport { GIT_COMMIT } from '../version';\n\nconst pluginCommitSha: string = GIT_COMMIT;\nconst pluginCommitURL = `https://github.com/grafana/metrics-drilldown/commit/${pluginCommitSha}`;\n\nconst { buildInfo: grafanaBuildInfo } = config;\n\nfunction InfoMenuHeader() {\n  const styles = useStyles2(getStyles);\n\n  const {\n    meta: {\n      info: { version, updated },\n    },\n  } = usePluginContext() || { meta: { info: { version: '?.?.?', updated: '?' } } };\n\n  return (\n    <div className={styles.menuHeader}>\n      <h5>\n        <PluginLogo size=\"small\" />\n        Grafana Metrics Drilldown v{version}\n      </h5>\n      <div className={styles.subTitle}>Last update: {updated}</div>\n    </div>\n  );\n}\n\nfunction InfoMenu() {\n  const isDev = pluginCommitSha === 'dev';\n  const shortCommitSha = isDev ? pluginCommitSha : pluginCommitSha.slice(0, 8);\n\n  return (\n    <Menu header={<InfoMenuHeader />}>\n      <Menu.Item\n        label={`Commit SHA: ${shortCommitSha}`}\n        icon=\"github\"\n        onClick={() => window.open(pluginCommitURL)}\n        disabled={isDev}\n      />\n      <Menu.Item\n        label=\"Changelog\"\n        icon=\"list-ul\"\n        onClick={() =>\n          window.open(\n            'https://github.com/grafana/metrics-drilldown/blob/main/CHANGELOG.md',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Item\n        label=\"Contribute\"\n        icon=\"external-link-alt\"\n        onClick={() =>\n          window.open(\n            'https://github.com/grafana/metrics-drilldown/blob/main/docs/contributing.md',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Item\n        label=\"Documentation\"\n        icon=\"document-info\"\n        onClick={() =>\n          window.open(\n            'https://grafana.com/docs/grafana/latest/explore/simplified-exploration/metrics',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Item\n        label=\"Report an issue\"\n        icon=\"bug\"\n        onClick={() =>\n          window.open(\n            'https://github.com/grafana/metrics-drilldown/issues/new?template=bug_report.md',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Divider />\n      <Menu.Item\n        label={`Grafana ${grafanaBuildInfo.edition} v${grafanaBuildInfo.version} (${grafanaBuildInfo.env})`}\n        icon=\"grafana\"\n        onClick={() =>\n          window.open(\n            `https://github.com/grafana/grafana/commit/${grafanaBuildInfo.commit}`,\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n    </Menu>\n  );\n}\n\nexport function PluginInfo() {\n  return (\n    <Dropdown overlay={() => <InfoMenu />} placement=\"bottom-end\">\n      <Button\n        icon=\"info-circle\"\n        variant=\"secondary\"\n        tooltip=\"Plugin info\"\n        tooltipPlacement=\"top\"\n        title=\"Plugin info\"\n        data-testid=\"plugin-info-button\"\n      />\n    </Dropdown>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  button: css`\n    position: relative;\n    display: flex;\n    align-items: center;\n    width: 32px;\n    height: 32px;\n    line-height: 30px;\n    border: 1px solid ${theme.colors.border.weak};\n    border-radius: 2px;\n    border-left: 0;\n    color: ${theme.colors.text.primary};\n    background: ${theme.colors.background.secondary};\n\n    &:hover {\n      border-color: ${theme.colors.border.medium};\n      background-color: ${theme.colors.background.canvas};\n    }\n  `,\n  menuHeader: css`\n    padding: ${theme.spacing(0.5, 1)};\n    white-space: nowrap;\n  `,\n  subTitle: css`\n    color: ${theme.colors.text.secondary};\n    font-size: ${theme.typography.bodySmall.fontSize};\n  `,\n});\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Dropdown, Switch, ToolbarButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from './interactions';\nimport { MetricScene } from './MetricScene';\nimport { getTrailFor } from './utils';\n\nexport interface DataTrailSettingsState extends SceneObjectState {\n  stickyMainGraph?: boolean;\n  isOpen?: boolean;\n}\n\nexport class DataTrailSettings extends SceneObjectBase<DataTrailSettingsState> {\n  constructor(state: Partial<DataTrailSettingsState>) {\n    super({\n      stickyMainGraph: state.stickyMainGraph ?? false,\n      isOpen: state.isOpen ?? false,\n    });\n  }\n\n  public onToggleStickyMainGraph = () => {\n    const stickyMainGraph = !this.state.stickyMainGraph;\n    reportExploreMetrics('settings_changed', { stickyMainGraph });\n    this.setState({ stickyMainGraph });\n  };\n\n  public onToggleOpen = (isOpen: boolean) => {\n    this.setState({ isOpen });\n  };\n\n  static readonly Component = ({ model }: SceneComponentProps<DataTrailSettings>) => {\n    const { stickyMainGraph, isOpen } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const trail = getTrailFor(model);\n    const { topScene } = trail.useState();\n\n    const isButtonVisible = topScene instanceof MetricScene;\n\n    if (!isButtonVisible) {\n      return null;\n    }\n\n    const renderPopover = () => {\n      return (\n        <div className={styles.popover} onClick={(evt) => evt.stopPropagation()}>\n          <div className={styles.heading}>Settings</div>\n          {topScene instanceof MetricScene && (\n            <div className={styles.options}>\n              <div>Always keep selected metric graph in-view</div>\n              <Switch value={stickyMainGraph} onChange={model.onToggleStickyMainGraph} />\n            </div>\n          )}\n        </div>\n      );\n    };\n\n    return (\n      <Dropdown overlay={renderPopover} placement=\"bottom\" onVisibleChange={model.onToggleOpen}>\n        <ToolbarButton icon=\"cog\" variant=\"canvas\" isOpen={isOpen} data-testid=\"settings-button\" />\n      </Dropdown>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    popover: css({\n      display: 'flex',\n      padding: theme.spacing(2),\n      flexDirection: 'column',\n      background: theme.colors.background.primary,\n      boxShadow: theme.shadows.z3,\n      borderRadius: theme.shape.radius.default,\n      border: `1px solid ${theme.colors.border.weak}`,\n      zIndex: 1,\n      marginRight: theme.spacing(2),\n    }),\n    heading: css({\n      fontWeight: theme.typography.fontWeightMedium,\n      paddingBottom: theme.spacing(2),\n    }),\n    options: css({\n      display: 'grid',\n      gridTemplateColumns: '1fr 50px',\n      rowGap: theme.spacing(1),\n      columnGap: theme.spacing(2),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { VariableHide, type AdHocVariableFilter, type GrafanaTheme2 } from '@grafana/data';\nimport { utf8Support, type PromQuery } from '@grafana/prometheus';\nimport { config, useChromeHeaderHeight } from '@grafana/runtime';\nimport {\n  AdHocFiltersVariable,\n  SceneControlsSpacer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  SceneReactObject,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  SceneVariableSet,\n  ScopesVariable,\n  UrlSyncContextProvider,\n  VariableDependencyConfig,\n  VariableValueSelectors,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n  type SceneObjectWithUrlSync,\n  type SceneQueryRunner,\n  type SceneVariable,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { useEffect } from 'react';\n\nimport { MetricsDrilldownDataSourceVariable } from 'MetricsDrilldownDataSourceVariable';\nimport { PluginInfo } from 'PluginInfo/PluginInfo';\nimport { displayWarning } from 'WingmanDataTrail/helpers/displayStatus';\nimport { MetricsReducer } from 'WingmanDataTrail/MetricsReducer';\n\nimport { DataTrailSettings } from './DataTrailSettings';\nimport { MetricDatasourceHelper } from './helpers/MetricDatasourceHelper';\nimport { reportChangeInLabelFilters } from './interactions';\nimport { MetricScene } from './MetricScene';\nimport { MetricSelectedEvent, trailDS, VAR_DATASOURCE, VAR_FILTERS } from './shared';\nimport { getTrailStore } from './TrailStore/TrailStore';\nimport { limitAdhocProviders } from './utils';\nimport { isSceneQueryRunner } from './utils/utils.queries';\nimport { getAppBackgroundColor } from './utils/utils.styles';\nimport { isAdHocFiltersVariable } from './utils/utils.variables';\n\nexport interface DataTrailState extends SceneObjectState {\n  topScene?: SceneObject;\n  embedded?: boolean;\n  controls: SceneObject[];\n  settings: DataTrailSettings;\n  pluginInfo: SceneReactObject;\n  createdAt: number;\n\n  // wingman\n  dashboardMetrics?: Record<string, number>;\n  alertingMetrics?: Record<string, number>;\n\n  // just for the starting data source\n  initialDS?: string;\n  initialFilters?: AdHocVariableFilter[];\n\n  // Synced with url\n  metric?: string;\n  metricSearch?: string;\n\n  histogramsLoadP: Promise<void> | null;\n  histogramsLoaded: boolean;\n  nativeHistograms: string[];\n  nativeHistogramMetric: string;\n\n  trailActivated: boolean; // this indicates that the trail has been updated by metric or filter selected\n  urlNamespace?: string; // optional namespace for url params, to avoid conflicts with other plugins in embedded mode\n}\n\nexport class DataTrail extends SceneObjectBase<DataTrailState> implements SceneObjectWithUrlSync {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: ['metric', 'metricSearch', 'nativeHistogramMetric'],\n  });\n\n  public constructor(state: Partial<DataTrailState>) {\n    super({\n      $timeRange: state.$timeRange ?? new SceneTimeRange({}),\n      $variables: state.$variables ?? getVariableSet(state.initialDS, state.metric, state.initialFilters),\n      controls: state.controls ?? [\n        new VariableValueSelectors({ layout: 'vertical' }),\n        new SceneControlsSpacer(),\n        new SceneTimePicker({}),\n        new SceneRefreshPicker({}),\n      ],\n      settings: state.settings ?? new DataTrailSettings({}),\n      pluginInfo: new SceneReactObject({ component: PluginInfo }),\n      createdAt: state.createdAt ?? new Date().getTime(),\n      dashboardMetrics: {},\n      alertingMetrics: {},\n      nativeHistograms: state.nativeHistograms ?? [],\n      histogramsLoadP: state.histogramsLoadP ?? null,\n      histogramsLoaded: state.histogramsLoaded ?? false,\n      nativeHistogramMetric: state.nativeHistogramMetric ?? '',\n      trailActivated: state.trailActivated ?? false,\n      ...state,\n    });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  public _onActivate() {\n    this.setState({ trailActivated: true });\n\n    if (!this.state.topScene) {\n      this.setState({ topScene: getTopSceneFor(this.state.metric) });\n    }\n\n    // Some scene elements publish this\n    this.subscribeToEvent(MetricSelectedEvent, this._handleMetricSelectedEvent.bind(this));\n\n    const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n\n    if (isAdHocFiltersVariable(filtersVariable)) {\n      this._subs.add(\n        filtersVariable?.subscribeToState((newState, prevState) => {\n          if (!this._addingFilterWithoutReportingInteraction) {\n            reportChangeInLabelFilters(newState.filters, prevState.filters);\n          }\n        })\n      );\n\n      // we ensure that, in the MetricsReducer, the Ad Hoc filters will display all the label names and values and\n      // we ensure that, in the MetricScene, the queries in the Scene graph will be considered and used as a filter\n      // to fetch label names and values\n      filtersVariable?.setState({\n        useQueriesAsFilterForOptions: Boolean(this.state.metric),\n      });\n\n      this.subscribeToState((newState, prevState) => {\n        if (newState.metric !== prevState.metric) {\n          filtersVariable?.setState({\n            useQueriesAsFilterForOptions: Boolean(newState.metric),\n          });\n        }\n      });\n    }\n\n    // Save the current trail as a recent (if the browser closes or reloads) if user selects a metric OR applies filters to metric select view\n    const saveRecentTrail = () => {\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n      const hasFilters = isAdHocFiltersVariable(filtersVariable) && filtersVariable.state.filters.length > 0;\n      if (this.state.metric || hasFilters) {\n        getTrailStore().setRecentTrail(this);\n      }\n    };\n    window.addEventListener('unload', saveRecentTrail);\n\n    return () => {\n      if (!this.state.embedded) {\n        saveRecentTrail();\n      }\n      window.removeEventListener('unload', saveRecentTrail);\n    };\n  }\n\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_DATASOURCE],\n    onReferencedVariableValueChanged: async (variable: SceneVariable) => {\n      const { name } = variable.state;\n\n      if (name === VAR_DATASOURCE) {\n        this.datasourceHelper.reset();\n\n        // reset native histograms\n        this.resetNativeHistograms();\n      }\n    },\n  });\n\n  /**\n   * Assuming that the change in filter was already reported with a cause other than `'adhoc_filter'`,\n   * this will modify the adhoc filter variable and prevent the automatic reporting which would\n   * normally occur through the call to `reportChangeInLabelFilters`.\n   */\n  public addFilterWithoutReportingInteraction(filter: AdHocVariableFilter) {\n    const variable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n    if (!isAdHocFiltersVariable(variable)) {\n      return;\n    }\n\n    this._addingFilterWithoutReportingInteraction = true;\n    variable.setState({ filters: [...variable.state.filters, filter] });\n    this._addingFilterWithoutReportingInteraction = false;\n  }\n\n  private _addingFilterWithoutReportingInteraction = false;\n  private datasourceHelper = new MetricDatasourceHelper(this);\n\n  public getMetricMetadata(metric?: string) {\n    return this.datasourceHelper.getMetadataForMetric(metric);\n  }\n\n  public isNativeHistogram(metric: string) {\n    return this.datasourceHelper.isNativeHistogram(metric);\n  }\n\n  // use this to initialize histograms in all scenes\n  public async initializeHistograms() {\n    if (this.state.histogramsLoadP) {\n      return this.state.histogramsLoadP;\n    }\n\n    if (!this.state.histogramsLoaded) {\n      try {\n        const histogramsLoadP = this.datasourceHelper.initializeHistograms();\n        this.setState({ histogramsLoadP });\n        await histogramsLoadP;\n      } catch (e) {\n        displayWarning(['Error while initializing histograms!', (e as Error).toString()]);\n      }\n\n      this.setState({\n        nativeHistograms: this.listNativeHistograms(),\n        histogramsLoadP: null,\n        histogramsLoaded: true,\n      });\n    }\n  }\n\n  public listNativeHistograms() {\n    return this.datasourceHelper.listNativeHistograms() ?? [];\n  }\n\n  private resetNativeHistograms() {\n    this.setState({\n      histogramsLoaded: false,\n      nativeHistograms: [],\n    });\n  }\n\n  public getCurrentMetricMetadata() {\n    return this.getMetricMetadata(this.state.metric);\n  }\n\n  private async _handleMetricSelectedEvent(evt: MetricSelectedEvent) {\n    const metric = evt.payload ?? '';\n\n    // from the metric preview panel we have the info loaded to determine that a metric is a native histogram\n    let nativeHistogramMetric = false;\n    if (this.isNativeHistogram(metric)) {\n      nativeHistogramMetric = true;\n    }\n\n    this._urlSync.performBrowserHistoryAction(() => {\n      this.setState(this.getSceneUpdatesForNewMetricValue(metric, nativeHistogramMetric));\n    });\n\n    // Add metric to adhoc filters baseFilter\n    const filterVar = sceneGraph.lookupVariable(VAR_FILTERS, this);\n    if (isAdHocFiltersVariable(filterVar)) {\n      filterVar.setState({\n        baseFilters: getBaseFiltersForMetric(evt.payload),\n      });\n    }\n  }\n\n  private getSceneUpdatesForNewMetricValue(metric: string | undefined, nativeHistogramMetric?: boolean) {\n    const stateUpdate: Partial<DataTrailState> = {};\n    stateUpdate.metric = metric;\n    // refactoring opportunity? Or do we pass metric knowledge all the way down?\n    // must pass this native histogram prometheus knowledge deep into\n    // the topscene set on the trail > MetricScene > getAutoQueriesForMetric() > createHistogramMetricQueryDefs();\n    stateUpdate.nativeHistogramMetric = nativeHistogramMetric ? '1' : '';\n    stateUpdate.topScene = getTopSceneFor(metric, nativeHistogramMetric);\n\n    return stateUpdate;\n  }\n\n  getUrlState(): SceneObjectUrlValues {\n    const { metric, metricSearch, nativeHistogramMetric } = this.state;\n    return {\n      metric,\n      metricSearch,\n      // store the native histogram knowledge in url for the metric scene\n      nativeHistogramMetric,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<DataTrailState> = {};\n\n    if (typeof values.metric === 'string') {\n      if (this.state.metric !== values.metric) {\n        // if we have a metric and we have stored in the url that it is a native histogram\n        // we can pass that info into the metric scene to generate the appropriate queries\n        let nativeHistogramMetric = false;\n        if (values.nativeHistogramMetric === '1') {\n          nativeHistogramMetric = true;\n        }\n\n        Object.assign(stateUpdate, this.getSceneUpdatesForNewMetricValue(values.metric, nativeHistogramMetric));\n      }\n    } else if (values.metric == null && !this.state.embedded) {\n      stateUpdate.metric = undefined;\n      stateUpdate.topScene = new MetricsReducer();\n    }\n\n    if (typeof values.metricSearch === 'string') {\n      stateUpdate.metricSearch = values.metricSearch;\n    } else if (values.metric == null) {\n      stateUpdate.metricSearch = undefined;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  public getQueries(): PromQuery[] {\n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    const sqrs = sceneGraph.findAllObjects(this, (b) => isSceneQueryRunner(b)) as SceneQueryRunner[];\n\n    return sqrs.reduce<PromQuery[]>((acc, sqr) => {\n      acc.push(\n        ...sqr.state.queries.map((q) => ({\n          ...q,\n          expr: sceneGraph.interpolate(sqr, q.expr),\n        }))\n      );\n\n      return acc;\n    }, []);\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<DataTrail>) => {\n    const { controls, topScene, settings, pluginInfo, embedded } = model.useState();\n\n    const chromeHeaderHeight = useChromeHeaderHeight() ?? 0;\n    const headerHeight = embedded ? 0 : chromeHeaderHeight;\n    const styles = useStyles2(getStyles, headerHeight, model);\n\n    // need to initialize this here and not on activate because it requires the data source helper to be fully initialized first\n    useEffect(() => {\n      model.initializeHistograms();\n    }, [model]);\n\n    useEffect(() => {\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, model);\n      const datasourceHelper = model.datasourceHelper;\n      limitAdhocProviders(model, filtersVariable, datasourceHelper);\n    }, [model]);\n\n    // Set CSS custom property for app-controls height in embedded mode\n    useEffect(() => {\n      // Update on mount and when controls change\n      updateAppControlsHeight();\n\n      // Use ResizeObserver to watch for height changes\n      const appControls = document.querySelector('[data-testid=\"app-controls\"]');\n\n      if (!appControls) {\n        return;\n      }\n\n      const resizeObserver = new ResizeObserver(updateAppControlsHeight);\n      resizeObserver.observe(appControls);\n\n      return () => {\n        // Clean up\n        resizeObserver.disconnect();\n        document.documentElement.style.removeProperty('--app-controls-height');\n      };\n    }, [embedded, controls]);\n\n    return (\n      <div className={styles.container}>\n        {controls && (\n          <div className={styles.controls} data-testid=\"app-controls\">\n            {controls.map((control) => (\n              <control.Component key={control.state.key} model={control} />\n            ))}\n            <div className={styles.settingsInfo}>\n              <settings.Component model={settings} />\n              <pluginInfo.Component model={pluginInfo} />\n            </div>\n          </div>\n        )}\n        {topScene && (\n          <UrlSyncContextProvider\n            scene={topScene}\n            createBrowserHistorySteps={true}\n            updateUrlOnInit={true}\n            namespace={model.state.urlNamespace}\n          >\n            <div className={styles.body}>{topScene && <topScene.Component model={topScene} />}</div>\n          </UrlSyncContextProvider>\n        )}\n      </div>\n    );\n  };\n}\n\nexport function getTopSceneFor(metric?: string, nativeHistogram = false) {\n  if (metric) {\n    return new MetricScene({ metric, nativeHistogram });\n  } else {\n    return new MetricsReducer();\n  }\n}\n\nfunction getVariableSet(initialDS?: string, metric?: string, initialFilters?: AdHocVariableFilter[]) {\n  let variables: SceneVariable[] = [\n    new MetricsDrilldownDataSourceVariable({ initialDS }),\n    new AdHocFiltersVariable({\n      key: VAR_FILTERS,\n      name: VAR_FILTERS,\n      label: 'Filters',\n      addFilterButtonText: 'Add label',\n      datasource: trailDS,\n      hide: VariableHide.dontHide,\n      layout: 'combobox',\n      filters: initialFilters ?? [],\n      baseFilters: getBaseFiltersForMetric(metric),\n      applyMode: 'manual',\n      allowCustomValue: true,\n      useQueriesAsFilterForOptions: false,\n      expressionBuilder: (filters: AdHocVariableFilter[]) => {\n        // remove any filters that include __name__ key in the expression\n        // to prevent the metric name from being set twice in the query and causing an error.\n        // also escapes equal signs to prevent invalid queries\n        // TODO: proper escaping as Scene does in https://github.com/grafana/scenes/blob/main/packages/scenes/src/variables/utils.ts#L45-L67\n        return (\n          filters\n            .filter((filter) => filter.key !== '__name__')\n            // eslint-disable-next-line sonarjs/no-nested-template-literals\n            .map((filter) => `${utf8Support(filter.key)}${filter.operator}\"${filter.value.replaceAll('=', `\\=`)}\"`)\n            .join(',')\n        );\n      },\n    }),\n  ];\n\n  if (isScopesSupported()) {\n    variables.unshift(new ScopesVariable({ enable: true }));\n  }\n\n  return new SceneVariableSet({\n    variables,\n  });\n}\n\nfunction getStyles(theme: GrafanaTheme2, headerHeight: number, trail: DataTrail) {\n  const background = getAppBackgroundColor(theme, trail);\n\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      gap: theme.spacing(1),\n      flexDirection: 'column',\n      padding: theme.spacing(1, 2),\n      position: 'relative',\n      background,\n    }),\n    body: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n      minHeight: 0, // Allow body to shrink below its content size\n    }),\n    controls: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n      padding: theme.spacing(1, 0),\n      alignItems: 'flex-end',\n      flexWrap: 'wrap',\n      position: 'sticky',\n      background,\n      zIndex: theme.zIndex.navbarFixed,\n      top: headerHeight,\n      borderBottom: `1px solid ${theme.colors.border.weak}`,\n    }),\n    settingsInfo: css({\n      display: 'flex',\n      gap: theme.spacing(0.5),\n    }),\n  };\n}\n\nfunction getBaseFiltersForMetric(metric?: string): AdHocVariableFilter[] {\n  if (metric) {\n    return [{ key: '__name__', operator: '=', value: metric }];\n  }\n  return [];\n}\n\nfunction updateAppControlsHeight() {\n  const appControls = document.querySelector('[data-testid=\"app-controls\"]');\n\n  if (!appControls) {\n    return;\n  }\n\n  const { height } = appControls.getBoundingClientRect();\n  document.documentElement.style.setProperty('--app-controls-height', `${height}px`);\n}\n\nfunction isScopesSupported(): boolean {\n  return Boolean(\n    config.featureToggles.scopeFilters &&\n      config.featureToggles.enableScopesInMetricsExplore &&\n      // Scopes support in Grafana appears to begin with Grafana 12.0.0. We can remove\n      // the version check once the `dependencies.grafanaDependency` is updated to 12.0.0 or higher.\n      !config.buildInfo.version.startsWith('11.')\n  );\n}\n","import { Button } from '@grafana/ui';\nimport React, { type MouseEventHandler } from 'react';\n\ntype ShowMoreButtonProps = {\n  label: string;\n  batchSizes: {\n    increment: number;\n    current: number;\n    total: number;\n  };\n  onClick: MouseEventHandler<HTMLButtonElement>;\n  tooltip?: string;\n};\n\nexport function ShowMoreButton({ label, batchSizes, onClick, tooltip }: Readonly<ShowMoreButtonProps>) {\n  return (\n    <Button variant=\"secondary\" fill=\"outline\" onClick={onClick} tooltip={tooltip} tooltipPlacement=\"top\">\n      Show {batchSizes.increment} more {batchSizes.increment === 1 ? label : `${label}s`} ({batchSizes.current}/\n      {batchSizes.total})\n    </Button>\n  );\n}\n","import { isValidLegacyName, utf8Support } from '@grafana/prometheus';\nimport { Expression, MatchingOperator } from 'tsqtsq';\n\nimport { VAR_FILTERS_EXPR } from 'shared';\n\nexport type LabelMatcher = {\n  key: string;\n  operator: string;\n  value: string;\n};\n\nexport function expressionToString(expression: Expression) {\n  // see hacks in buildQueryExpression() below\n  return expression.toString().replaceAll('=\"__REMOVE__\"', '');\n}\n\ntype Options = {\n  metric: string;\n  matchers: LabelMatcher[];\n  addIgnoreUsageFilter: boolean;\n};\n\nexport function buildQueryExpression(options: Options): Expression {\n  const { metric, matchers, addIgnoreUsageFilter } = options;\n\n  const defaultSelectors = matchers.map((m) => ({\n    label: utf8Support(m.key),\n    operator: m.operator as MatchingOperator,\n    value: m.value,\n  }));\n\n  if (addIgnoreUsageFilter) {\n    defaultSelectors.push({ label: '__ignore_usage__', operator: MatchingOperator.equal, value: '' });\n  }\n\n  const isUtf8Metric = !isValidLegacyName(metric);\n  if (isUtf8Metric) {\n    // hack to have the UTF-8 metric name in braces alongside labels\n    // but without extra quotes associated with an empty label value\n    defaultSelectors.push({ label: utf8Support(metric), operator: MatchingOperator.equal, value: '__REMOVE__' });\n  }\n\n  // hack for Scenes to interpolate the VAR_FILTERS variable\n  // added last so that, if filters are empty, the query is still valid\n  defaultSelectors.push({ label: VAR_FILTERS_EXPR, operator: MatchingOperator.equal, value: '__REMOVE__' });\n\n  return new Expression({\n    metric,\n    values: {},\n    defaultOperator: MatchingOperator.equal,\n    defaultSelectors,\n  });\n}\n","import { BusEventBase, BusEventWithPayload } from '@grafana/data';\nimport { ConstantVariable } from '@grafana/scenes';\nimport { VariableHide } from '@grafana/schema';\n\nexport const TRAILS_ROUTE = '/explore/metrics/trail';\nexport const HOME_ROUTE = '/explore/metrics';\n\nexport const VAR_FILTERS = 'filters';\nexport const VAR_FILTERS_EXPR = '${filters}';\nexport const VAR_METRIC = 'metric';\nexport const VAR_METRIC_EXPR = '${metric}';\nexport const VAR_GROUP_BY = 'groupby';\nexport const VAR_GROUP_BY_EXP = '${groupby}';\nexport const VAR_DATASOURCE = 'ds';\nexport const VAR_DATASOURCE_EXPR = '${ds}';\nexport const VAR_LOGS_DATASOURCE = 'logsDs';\nexport const VAR_LOGS_DATASOURCE_EXPR = '${logsDs}';\nexport const VAR_OTHER_METRIC_FILTERS = 'other_metric_filters';\n\nexport const LOGS_METRIC = '$__logs__';\nexport const KEY_SQR_METRIC_VIZ_QUERY = 'sqr-metric-viz-query';\n\nexport const trailDS = { uid: VAR_DATASOURCE_EXPR };\n\nexport const MDP_METRIC_PREVIEW = 250;\nexport const MDP_METRIC_OVERVIEW = 500;\n\nexport type MakeOptional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\n\nexport function getVariablesWithMetricConstant(metric: string) {\n  return [\n    new ConstantVariable({\n      name: VAR_METRIC,\n      value: metric,\n      hide: VariableHide.hideVariable,\n    }),\n  ];\n}\n\nexport class MetricSelectedEvent extends BusEventWithPayload<string | undefined> {\n  public static readonly type = 'metric-selected-event';\n}\n\nexport class RefreshMetricsEvent extends BusEventBase {\n  public static readonly type = 'refresh-metrics-event';\n}\n","import { urlUtil } from '@grafana/data';\nimport { sceneUtils, type SceneObject, type SceneObjectRef, type SceneObjectUrlValues } from '@grafana/scenes';\nimport { debounce, isEqual } from 'lodash';\n\nimport { createBookmarkSavedNotification } from './utils';\nimport { DataTrail } from '../DataTrail';\nimport { PREF_KEYS } from '../UserPreferences/pref-keys';\nimport { userPreferences } from '../UserPreferences/userPreferences';\nimport { newMetricsTrail } from '../utils';\n\nexport const RECENT_TRAILS_KEY = 'grafana.trails.recent';\nconst MAX_RECENT_TRAILS = 20;\n\n// Added when removing history to replace serialized trail history with only URL values\nexport interface UrlSerializedTrail {\n  urlValues: SceneObjectUrlValues;\n}\n\n// used in the migration for old history format\nexport interface SerializedTrail {\n  history: SerializedTrailHistory[];\n  currentStep?: number; // Assume last step in history if not specified\n  createdAt?: number;\n}\n\n// used in the migration for old history format\nexport interface SerializedTrailHistory {\n  urlValues: SceneObjectUrlValues;\n  description: string;\n}\n\nexport interface DataTrailBookmark {\n  urlValues: SceneObjectUrlValues;\n  createdAt: number;\n}\n\nexport class TrailStore {\n  private _recent: Array<SceneObjectRef<DataTrail>> = [];\n  private _bookmarks: DataTrailBookmark[] = [];\n  private _save: () => void;\n  private _lastModified: number;\n\n  constructor() {\n    this.load();\n    this._lastModified = Date.now();\n    const doSave = () => {\n      const serializedRecent = this._recent\n        .slice(0, MAX_RECENT_TRAILS)\n        .map((trail) => this._serializeTrail(trail.resolve()));\n      userPreferences.setItem(RECENT_TRAILS_KEY, serializedRecent);\n      userPreferences.setItem(PREF_KEYS.BOOKMARKS, this._bookmarks);\n      this._lastModified = Date.now();\n    };\n\n    this._save = debounce(doSave, 1000);\n\n    window.addEventListener('beforeunload', () => {\n      // Before closing or reloading the page, we want to remove the debounce from `_save` so that\n      // any calls to is on event `unload` are actualized. Debouncing would cause a delay until after the page has been unloaded.\n      this._save = doSave;\n    });\n  }\n\n  private _loadRecentTrailsFromStorage() {\n    const list: Array<SceneObjectRef<DataTrail>> = [];\n    const serializedTrails: SerializedTrail[] = userPreferences.getItem(RECENT_TRAILS_KEY) || [];\n    for (const t of serializedTrails) {\n      const trail = this._deserializeTrail(t);\n      list.push(trail.getRef());\n    }\n    return list;\n  }\n\n  private _loadBookmarksFromStorage() {\n    const list: Array<DataTrailBookmark | SerializedTrail> = userPreferences.getItem(PREF_KEYS.BOOKMARKS) || [];\n\n    return list.map((item) => {\n      if (isSerializedTrail(item)) {\n        // Take the legacy SerializedTrail implementation of bookmark storage, and extract a DataTrailBookmark\n        const step = item.currentStep != null ? item.currentStep : item.history.length - 1;\n        const bookmark: DataTrailBookmark = {\n          urlValues: item.history[step].urlValues,\n          createdAt: item.createdAt || Date.now(),\n        };\n        return bookmark;\n      }\n      return item;\n    });\n  }\n\n  private _deserializeTrail(t: SerializedTrail | UrlSerializedTrail): DataTrail {\n    // reconstruct the trail based on the serialized history\n    const trail = new DataTrail({});\n\n    const isSerializedTrail = 'history' in t;\n    const urlSerializedTrail = 'urlValues' in t;\n    if (isSerializedTrail) {\n      t.history.forEach((step) => {\n        // will go through all steps until the last one and load the most recent one\n        this._loadFromUrl(trail, step.urlValues);\n      });\n    } else if (urlSerializedTrail) {\n      this._loadFromUrl(trail, t.urlValues);\n    }\n    trail.setState(sceneUtils.cloneSceneObjectState(trail.state, {}));\n\n    return trail;\n  }\n\n  private _serializeTrail(trail: DataTrail): UrlSerializedTrail {\n    const urlValues = sceneUtils.getUrlState(trail);\n    return { urlValues };\n  }\n\n  public getTrailForBookmarkIndex(index: number) {\n    const bookmark = this._bookmarks[index];\n    if (!bookmark) {\n      // Create a blank trail\n      return newMetricsTrail();\n    }\n    return this.getTrailForBookmark(bookmark);\n  }\n\n  public getTrailForBookmark(bookmark: DataTrailBookmark) {\n    const key = getBookmarkKey(bookmark);\n    // Match for recent trails that have the exact same state as the current step\n    for (const recent of this._recent) {\n      const trail = recent.resolve();\n      if (getBookmarkKey(trail) === key) {\n        return trail;\n      }\n    }\n    // Just create a new trail with that state\n    const trail = new DataTrail({});\n    this._loadFromUrl(trail, bookmark.urlValues);\n    return trail;\n  }\n\n  private _loadFromUrl(node: SceneObject, urlValues: SceneObjectUrlValues) {\n    const urlState = urlUtil.renderUrl('', urlValues);\n    sceneUtils.syncStateFromSearchParams(node, new URLSearchParams(urlState));\n  }\n\n  // Recent Trails\n  get recent() {\n    return this._recent;\n  }\n\n  // Last updated metric\n  get lastModified() {\n    return this._lastModified;\n  }\n\n  load() {\n    this._recent = this._loadRecentTrailsFromStorage();\n    this._bookmarks = this._loadBookmarksFromStorage();\n    this._refreshBookmarkIndexMap();\n    this._lastModified = Date.now();\n  }\n\n  setRecentTrail(recentTrail: DataTrail) {\n    const notActivated = !recentTrail.state.trailActivated;\n\n    if (notActivated) {\n      // We do not set an uninitialized trail, or a RECENT single node \"start\" trail\n      return;\n    }\n\n    // Remove the `recentTrail` from the list if it already exists there\n    this._recent = this._recent.filter((t) => t !== recentTrail.getRef());\n\n    // Check if any existing \"recent\" entries have equivalent urlState to the new recentTrail\n    const recentUrlState = getUrlStateForComparison(recentTrail);\n\n    this._recent = this._recent.filter((t) => {\n      // Use the current step urlValues to filter out equivalent states\n      const urlState = getUrlStateForComparison(t.resolve());\n      // Only keep trails with sufficiently unique urlValues on their current step\n      return !isEqual(recentUrlState, urlState);\n    });\n\n    this._recent.unshift(recentTrail.getRef());\n    this._save();\n  }\n\n  // Bookmarked Trails\n  get bookmarks() {\n    return this._bookmarks;\n  }\n\n  addBookmark(trail: DataTrail) {\n    const urlState = sceneUtils.getUrlState(trail);\n\n    const bookmarkState: DataTrailBookmark = {\n      urlValues: urlState,\n      createdAt: Date.now(),\n    };\n\n    this._bookmarks.unshift(bookmarkState);\n    this._refreshBookmarkIndexMap();\n    this._save();\n    createBookmarkSavedNotification();\n  }\n\n  removeBookmark(index: number) {\n    if (index < this._bookmarks.length) {\n      this._bookmarks.splice(index, 1);\n      this._refreshBookmarkIndexMap();\n      this._save();\n    }\n  }\n\n  getBookmarkIndex(trail: DataTrail) {\n    const bookmarkKey = getBookmarkKey(trail);\n    const bookmarkIndex = this._bookmarkIndexMap.get(bookmarkKey);\n    return bookmarkIndex;\n  }\n\n  private _bookmarkIndexMap = new Map<string, number>();\n\n  private _refreshBookmarkIndexMap() {\n    this._bookmarkIndexMap.clear();\n    this._bookmarks.forEach((bookmarked, index) => {\n      const key = getBookmarkKey(bookmarked);\n      // If there are duplicate bookmarks, the latest index will be kept\n      this._bookmarkIndexMap.set(key, index);\n    });\n  }\n}\n\nfunction getUrlStateForComparison(trail: DataTrail) {\n  const urlState = sceneUtils.getUrlState(trail);\n  // Make a few corrections\n  correctUrlStateForComparison(urlState);\n\n  return urlState;\n}\n\nfunction correctUrlStateForComparison(urlState: SceneObjectUrlValues) {\n  // Omit some URL parameters that are not useful for state comparison,\n  // as they can change in the URL without creating new steps\n  delete urlState.actionView;\n  delete urlState.layout;\n  delete urlState.metricSearch;\n  delete urlState.refresh;\n\n  // Populate defaults\n  if (urlState['var-groupby'] === '' || urlState['var-groupby'] === undefined) {\n    urlState['var-groupby'] = '$__all';\n  }\n\n  if (typeof urlState['var-filters'] !== 'string') {\n    urlState['var-filters'] = urlState['var-filters']?.filter((filter) => filter !== '');\n  }\n\n  return urlState;\n}\n\nexport function getBookmarkKey(trail: DataTrail | DataTrailBookmark) {\n  if (trail instanceof DataTrail) {\n    return JSON.stringify(getUrlStateForComparison(trail));\n  }\n  return JSON.stringify(correctUrlStateForComparison({ ...trail.urlValues }));\n}\n\nlet store: TrailStore | undefined;\nexport function getTrailStore(): TrailStore {\n  if (!store) {\n    store = new TrailStore();\n  }\n\n  return store;\n}\n\nfunction isSerializedTrail(serialized: unknown): serialized is SerializedTrail {\n  return serialized != null && typeof serialized === 'object' && 'history' in serialized;\n}\n","import { AppEvents } from '@grafana/data';\nimport { getAppEvents } from '@grafana/runtime';\nimport { LinkButton, Stack } from '@grafana/ui';\nimport React from 'react';\n\nimport { ROUTES } from '../constants';\nimport { HOME_ROUTE } from '../shared';\nimport { currentPathIncludes } from '../utils';\n\nexport function createBookmarkSavedNotification() {\n  const appEvents = getAppEvents();\n  const isSidebarView = currentPathIncludes(ROUTES.Drilldown);\n\n  const infoText = !isSidebarView ? <i>Drilldown &gt; Metrics</i> : <i>the Metrics Reducer sidebar</i>;\n\n  appEvents.publish({\n    type: AppEvents.alertSuccess.name,\n    payload: [\n      'Bookmark created',\n      <Stack gap={2} direction=\"row\" key=\"bookmark-notification\">\n        <div>You can view bookmarks under {infoText}</div>\n        {!isSidebarView && (\n          <LinkButton fill=\"solid\" variant=\"secondary\" href={HOME_ROUTE}>\n            View bookmarks\n          </LinkButton>\n        )}\n      </Stack>,\n    ],\n  });\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { QueryVariable, sceneGraph, type MultiValueVariable, type SceneComponentProps } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from 'interactions';\nimport { ALL_VARIABLE_VALUE } from 'services/variables';\nimport { trailDS, VAR_FILTERS, VAR_GROUP_BY, VAR_METRIC_EXPR } from 'shared';\nimport { isAdHocFiltersVariable } from 'utils/utils.variables';\n\nexport class GroupByVariable extends QueryVariable {\n  constructor() {\n    super({\n      name: VAR_GROUP_BY,\n      label: 'Group by',\n      datasource: trailDS,\n      includeAll: true,\n      defaultToAll: true,\n      query: `label_names(${VAR_METRIC_EXPR})`,\n      value: '',\n      text: '',\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToState((newState, prevState) => {\n      if (newState.value && newState.value !== prevState.value) {\n        reportExploreMetrics('groupby_label_changed', { label: String(newState.value) });\n      }\n    });\n\n    const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n\n    if (isAdHocFiltersVariable(filtersVariable)) {\n      filtersVariable.subscribeToState((newState, prevState) => {\n        if (newState.filterExpression !== prevState.filterExpression) {\n          this.changeValueTo(ALL_VARIABLE_VALUE);\n        }\n      });\n    }\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MultiValueVariable>) => {\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.select} data-testid=\"breakdown-label-selector\">\n        <QueryVariable.Component model={model} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    select: css`\n      width: ${theme.spacing(16)};\n      & > div {\n        width: 100%;\n      }\n    `,\n  };\n}\n","export const ALL_VARIABLE_VALUE = '$__all';\n","export const UI_TEXT = {\n  SEARCH: {\n    TITLE: 'Search metrics',\n  },\n  METRIC_SELECT_SCENE: {\n    OPEN_EXPLORE_LABEL: 'Open in explore',\n    COPY_URL_LABEL: 'Copy url',\n    BOOKMARK_LABEL: 'Bookmark',\n    SELECT_NEW_METRIC_TOOLTIP: 'Remove existing metric and choose a new metric',\n  },\n};\n","import { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventPanelTypeChanged } from './EventPanelTypeChanged';\nimport { PANEL_TYPE } from './GmdVizPanel';\n\ninterface GmdVizPanelVariantSelectorState extends SceneObjectState {\n  metric: string;\n  panelType: PANEL_TYPE;\n  options: Array<{\n    label: string;\n    value: PANEL_TYPE;\n  }>;\n  currentPanelType: PANEL_TYPE;\n}\n\nexport class GmdVizPanelVariantSelector extends SceneObjectBase<GmdVizPanelVariantSelectorState> {\n  constructor({\n    metric,\n    panelType,\n  }: {\n    metric: GmdVizPanelVariantSelectorState['metric'];\n    panelType: GmdVizPanelVariantSelectorState['panelType'];\n  }) {\n    super({\n      metric,\n      panelType,\n      options: GmdVizPanelVariantSelector.getOptions(metric, panelType),\n      currentPanelType: panelType,\n    });\n  }\n\n  private static getOptions(metric: string, panelType: PANEL_TYPE) {\n    if ([PANEL_TYPE.HEATMAP, PANEL_TYPE.PERCENTILES].includes(panelType)) {\n      return [\n        { value: PANEL_TYPE.PERCENTILES, label: 'percentiles' },\n        { value: PANEL_TYPE.HEATMAP, label: 'heatmap' },\n      ];\n    }\n    return [];\n  }\n\n  private onChange = (newPanelType: PANEL_TYPE) => {\n    this.publishEvent(new EventPanelTypeChanged({ panelType: newPanelType }), true);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<GmdVizPanelVariantSelector>) => {\n    const { options, currentPanelType } = model.useState();\n\n    if (!options.length) {\n      return null;\n    }\n\n    return <RadioButtonGroup size=\"sm\" options={options} value={currentPanelType} onChange={model.onChange} />;\n  };\n}\n","import { type DataFrame, type FieldConfig, type FieldConfigSource, type TimeRange } from '@grafana/data';\nimport { usePluginLinks } from '@grafana/runtime';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  VizPanel,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { type DataQuery, type DataSourceRef } from '@grafana/schema';\nimport { IconButton } from '@grafana/ui';\nimport React from 'react';\n\nimport MimirLogo from 'img/logo.svg';\nimport { findObjectOfType } from 'utils';\n\nimport pluginJson from '../plugin.json';\nimport { VAR_DATASOURCE_EXPR } from '../shared';\nimport { isSceneQueryRunner } from '../utils/utils.queries';\n\nexport const investigationsPluginId = 'grafana-investigations-app';\nexport const extensionPointId = `${pluginJson.id}/investigation/v1`;\nexport const addToExplorationsButtonLabel = 'add panel to exploration';\n\nexport interface AddToExplorationButtonState extends SceneObjectState {\n  frame?: DataFrame;\n  dsUid?: string;\n  labelName?: string;\n  fieldName?: string;\n  context?: ExtensionContext;\n\n  queries: DataQuery[];\n  fieldConfig?: FieldConfigSource;\n}\n\ninterface ExtensionContext {\n  timeRange: TimeRange;\n  queries: DataQuery[];\n  datasource: DataSourceRef;\n  origin: string;\n  url: string;\n  type: string;\n  title: string;\n  id: string;\n  logoPath: string;\n  note?: string;\n  drillDownLabel?: string;\n}\n\nexport class AddToExplorationButton extends SceneObjectBase<AddToExplorationButtonState> {\n  constructor(state: Omit<AddToExplorationButtonState, 'queries'>) {\n    super({ ...state, queries: [] });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _onActivate = () => {\n    this._subs.add(\n      this.subscribeToState(() => {\n        this.getQueries();\n        this.getContext();\n      })\n    );\n\n    const datasourceUid = sceneGraph.interpolate(this, VAR_DATASOURCE_EXPR);\n    this.setState({ dsUid: datasourceUid });\n  };\n\n  private readonly getQueries = () => {\n    const data = sceneGraph.getData(this);\n    const queryRunner = sceneGraph.findObject(data, isSceneQueryRunner);\n\n    if (isSceneQueryRunner(queryRunner)) {\n      const filter = this.state.frame ? getFilter(this.state.frame) : null;\n      const queries = queryRunner.state.queries.map((q) => ({\n        ...q,\n        expr: sceneGraph.interpolate(queryRunner, q.expr),\n        legendFormat: filter?.name ? `{{ ${filter.name} }}` : sceneGraph.interpolate(queryRunner, q.legendFormat),\n      }));\n\n      if (JSON.stringify(queries) !== JSON.stringify(this.state.queries)) {\n        this.setState({ queries });\n      }\n    }\n  };\n\n  private getPanelConfigAndDataFrames() {\n    const panel = findObjectOfType(this, (o) => o instanceof VizPanel, VizPanel);\n    const data = sceneGraph.getData(this);\n\n    return {\n      fieldConfig: panel?.state.fieldConfig,\n      frames: data?.state.data?.series,\n    };\n  }\n\n  private readonly updateFieldConfigOverrides = () => {\n    const { fieldConfig, frames } = this.getPanelConfigAndDataFrames();\n\n    if (!fieldConfig || !frames?.length) {\n      return undefined;\n    }\n\n    for (const frame of frames) {\n      for (const field of frame.fields) {\n        const configKeys = Object.keys(field.config);\n        const properties = configKeys.map((key) => ({\n          id: key,\n          value: field.config[key as keyof FieldConfig],\n        }));\n\n        // check if the override already exists\n        const existingOverride = fieldConfig.overrides.find(\n          (o) =>\n            o.matcher.options === (field.config.displayNameFromDS ?? field.config.displayName ?? field.name) &&\n            o.matcher.id === 'byName'\n        );\n\n        if (!existingOverride) {\n          // add as first override\n          fieldConfig.overrides.unshift({\n            matcher: {\n              id: 'byName',\n              options: field.config.displayNameFromDS ?? field.config.displayName ?? field.name,\n            },\n            properties,\n          });\n        }\n\n        if (existingOverride && JSON.stringify(existingOverride.properties) !== JSON.stringify(properties)) {\n          existingOverride.properties = properties;\n        }\n      }\n    }\n\n    return fieldConfig;\n  };\n\n  private readonly getContext = () => {\n    const fieldConfig = this.updateFieldConfigOverrides();\n    const { queries, dsUid, labelName, fieldName } = this.state;\n    const timeRange = sceneGraph.getTimeRange(this);\n\n    if (!timeRange || !queries || !dsUid) {\n      return;\n    }\n    const ctx = {\n      origin: 'Metrics Drilldown',\n      type: 'timeseries',\n      queries,\n      timeRange: { ...timeRange.state.value },\n      datasource: { uid: dsUid },\n      url: window.location.href,\n      id: `${JSON.stringify(queries)}${labelName}${fieldName}`,\n      title: labelName + (fieldName ? ` > ${fieldName}` : ''),\n      logoPath: MimirLogo,\n      drillDownLabel: fieldName,\n      fieldConfig,\n    };\n    if (JSON.stringify(ctx) !== JSON.stringify(this.state.context)) {\n      this.setState({ context: ctx });\n    }\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<AddToExplorationButton>) => {\n    const { context } = model.useState();\n    const { links } = usePluginLinks({ extensionPointId, context, limitPerPlugin: 1 });\n    const link = links.find((link) => link.pluginId === investigationsPluginId);\n\n    if (!link) {\n      return null;\n    }\n\n    return (\n      <IconButton\n        tooltip={link.description}\n        aria-label={addToExplorationsButtonLabel} // this is overriden by the `tooltip`\n        key={link.id}\n        name={link.icon ?? 'panel-add'}\n        onClick={(e) => {\n          if (link.onClick) {\n            link.onClick(e);\n          }\n        }}\n      />\n    );\n  };\n}\n\nconst getFilter = (frame: DataFrame) => {\n  const filterNameAndValueObj = frame.fields[1]?.labels ?? {};\n  const keys = Object.keys(filterNameAndValueObj);\n  if (keys.length !== 1) {\n    return;\n  }\n  const name = keys[0];\n  return { name, value: filterNameAndValueObj[name] };\n};\n","import { type DataFrame, type PanelMenuItem, type PluginExtensionLink } from '@grafana/data';\nimport { config, getObservablePluginLinks } from '@grafana/runtime';\nimport {\n  getExploreURL,\n  sceneGraph,\n  SceneObjectBase,\n  VizPanel,\n  VizPanelMenu,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport React from 'react';\nimport { firstValueFrom } from 'rxjs';\n\nimport { logger } from 'tracking/logger/logger';\n\nimport { AddToExplorationButton, extensionPointId } from './AddToExplorationsButton';\nimport { getQueryRunnerFor } from '../utils/utils.queries';\n\nconst ADD_TO_INVESTIGATION_MENU_TEXT = 'Add to investigation';\nconst ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT = 'investigations_divider'; // Text won't be visible\nconst ADD_TO_INVESTIGATION_MENU_GROUP_TEXT = 'Investigations';\n\ninterface PanelMenuState extends SceneObjectState {\n  body?: VizPanelMenu;\n  frame?: DataFrame;\n  labelName?: string;\n  fieldName?: string;\n  addExplorationsLink?: boolean;\n  explorationsButton?: AddToExplorationButton;\n}\n\n/**\n * @todo the VizPanelMenu interface is overly restrictive, doesn't allow any member functions on this class, so everything is currently inlined\n */\nexport class PanelMenu extends SceneObjectBase<PanelMenuState> implements VizPanelMenu, SceneObject {\n  constructor(state: Partial<PanelMenuState>) {\n    super({ ...state, addExplorationsLink: state.addExplorationsLink ?? true });\n    this.addActivationHandler(() => {\n      let exploreUrl: Promise<string | undefined> | undefined;\n      try {\n        const viz = sceneGraph.getAncestor(this, VizPanel);\n        const panelData = sceneGraph.getData(viz).state.data;\n        if (!panelData) {\n          throw new Error('Cannot get link to explore, no panel data found');\n        }\n        const queryRunner = getQueryRunnerFor(viz);\n        const queries = queryRunner?.state.queries ?? [];\n        queries.forEach((query) => {\n          // removing legendFormat to get verbose legend in Explore\n          delete query.legendFormat;\n        });\n        // 'this' scene object contain the variable for the metric name which is correctly interpolated into the explore url\n        // when used in the metric select scene case,\n        // this will get the explore url with interpolated variables and include the labels __ignore_usage__, this is a known issue\n        // in the metric scene we do not get use the __ignore_usage__ labels in the explore url\n        exploreUrl = getExploreURL(panelData, this, panelData.timeRange, (query) => {\n          // remove __ignore_usage__=\"\" from the query\n          if ('expr' in query && typeof query.expr === 'string' && query.expr.includes('__ignore_usage__')) {\n            return {\n              ...query,\n              expr: query.expr.replace(/,?__ignore_usage__=\"\",?/, ''), // also remove leading/trailing comma if present\n            };\n          }\n\n          return query;\n        });\n      } catch {}\n\n      // Navigation options (all panels)\n      const items: PanelMenuItem[] = [\n        {\n          text: 'Navigation',\n          type: 'group',\n        },\n        {\n          text: 'Explore',\n          iconClassName: 'compass',\n          onClick: () => exploreUrl?.then((url) => url && window.open(url, '_blank')),\n          shortcut: 'p x',\n        },\n      ];\n\n      this.setState({\n        body: new VizPanelMenu({\n          items,\n        }),\n      });\n\n      const addToExplorationsButton = new AddToExplorationButton({\n        labelName: this.state.labelName,\n        fieldName: this.state.fieldName,\n        frame: this.state.frame,\n      });\n      this._subs.add(\n        addToExplorationsButton?.subscribeToState(async () => {\n          await subscribeToAddToExploration(this);\n        })\n      );\n      this.setState({\n        explorationsButton: addToExplorationsButton,\n      });\n\n      if (this.state.addExplorationsLink) {\n        this.state.explorationsButton?.activate();\n      }\n    });\n  }\n\n  addItem(item: PanelMenuItem): void {\n    if (this.state.body) {\n      this.state.body.addItem(item);\n    }\n  }\n\n  setItems(items: PanelMenuItem[]): void {\n    if (this.state.body) {\n      this.state.body.setItems(items);\n    }\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<PanelMenu>) => {\n    const { body } = model.useState();\n\n    if (body) {\n      return <body.Component model={body} />;\n    }\n\n    return <></>;\n  };\n}\n\nconst getInvestigationLink = async (addToExplorations: AddToExplorationButton) => {\n  const context = addToExplorations.state.context;\n\n  // Check if we're running on Grafana v11\n  if (config.buildInfo.version.startsWith('11.')) {\n    try {\n      const runtime = await import('@grafana/runtime');\n      const getPluginLinkExtensions = (runtime as any).getPluginLinkExtensions;\n      if (getPluginLinkExtensions !== undefined) {\n        const links = getPluginLinkExtensions({\n          extensionPointId,\n          context,\n        });\n\n        return links.extensions[0];\n      }\n    } catch (e) {\n      // Ignore import error and fall through to v12 implementation\n      logger.error(e as Error, { message: 'Error importing getPluginLinkExtensions' });\n    }\n  }\n\n  // `getObservablePluginLinks` is introduced in Grafana v12\n  if (typeof getObservablePluginLinks === 'function') {\n    const links: PluginExtensionLink[] = await firstValueFrom(\n      getObservablePluginLinks({\n        extensionPointId,\n        context,\n      })\n    );\n\n    return links[0];\n  }\n\n  return undefined;\n};\n\nasync function subscribeToAddToExploration(menu: PanelMenu) {\n  const addToExplorationButton = menu.state.explorationsButton;\n  if (addToExplorationButton) {\n    const link = await getInvestigationLink(addToExplorationButton);\n\n    const existingMenuItems = menu.state.body?.state.items ?? [];\n\n    const existingAddToExplorationLink = existingMenuItems.find((item) => item.text === ADD_TO_INVESTIGATION_MENU_TEXT);\n\n    if (link) {\n      if (!existingAddToExplorationLink) {\n        menu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT,\n          type: 'divider',\n        });\n        menu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_GROUP_TEXT,\n          type: 'group',\n        });\n        menu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_TEXT,\n          iconClassName: 'plus-square',\n          onClick: (e) => link.onClick && link.onClick(e),\n        });\n      } else {\n        if (existingAddToExplorationLink) {\n          menu.state.body?.setItems(\n            existingMenuItems.filter(\n              (item) =>\n                [\n                  ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT,\n                  ADD_TO_INVESTIGATION_MENU_GROUP_TEXT,\n                  ADD_TO_INVESTIGATION_MENU_TEXT,\n                ].includes(item.text) === false\n            )\n          );\n        }\n      }\n    }\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport { useChromeHeaderHeight } from '@grafana/runtime';\nimport {\n  behaviors,\n  SceneFlexItem,\n  SceneFlexLayout,\n  SceneObjectBase,\n  SceneReactObject,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { GmdVizPanel, PANEL_HEIGHT, QUERY_RESOLUTION } from 'GmdVizPanel/GmdVizPanel';\nimport { GmdVizPanelVariantSelector } from 'GmdVizPanel/GmdVizPanelVariantSelector';\nimport { getMetricDescription } from 'helpers/MetricDatasourceHelper';\nimport { PanelMenu } from 'Menu/PanelMenu';\nimport { MetricActionBar } from 'MetricActionBar';\n\nimport { type DataTrail } from './DataTrail';\nimport { getTrailFor, getTrailSettings } from './utils';\nimport { getAppBackgroundColor } from './utils/utils.styles';\n\nconst MAIN_PANEL_MIN_HEIGHT = GmdVizPanel.getPanelHeightInPixels(PANEL_HEIGHT.XL);\nconst MAIN_PANEL_MAX_HEIGHT = '40%';\nexport const TOPVIEW_KEY = 'topview';\n\nexport interface MetricGraphSceneState extends SceneObjectState {\n  metric: string;\n  topView: SceneFlexLayout;\n  selectedTab?: SceneObject;\n}\n\nexport class MetricGraphScene extends SceneObjectBase<MetricGraphSceneState> {\n  public constructor(state: { metric: MetricGraphSceneState['metric'] }) {\n    super({\n      metric: state.metric,\n      topView: new SceneFlexLayout({\n        direction: 'column',\n        $behaviors: [new behaviors.CursorSync({ key: 'metricCrosshairSync', sync: DashboardCursorSync.Crosshair })],\n        children: [\n          // prevent height flicker when landing\n          new SceneFlexItem({\n            minHeight: MAIN_PANEL_MIN_HEIGHT,\n            maxHeight: MAIN_PANEL_MAX_HEIGHT,\n            body: new SceneReactObject({ reactNode: <div /> }),\n          }),\n        ],\n      }),\n      selectedTab: undefined,\n    });\n\n    this.addActivationHandler(() => {\n      this.onActivate();\n    });\n  }\n\n  private async onActivate() {\n    const { metric, topView } = this.state;\n    const trail = getTrailFor(this);\n    const metadata = await trail.getMetricMetadata(metric);\n    const description = getMetricDescription(metadata);\n\n    topView.setState({\n      children: [\n        new SceneFlexItem({\n          key: TOPVIEW_KEY,\n          minHeight: MAIN_PANEL_MIN_HEIGHT,\n          maxHeight: MAIN_PANEL_MAX_HEIGHT,\n          body: new GmdVizPanel({\n            metric,\n            description,\n            height: PANEL_HEIGHT.XL,\n            headerActions: ({ panelType }) => [new GmdVizPanelVariantSelector({ metric, panelType })],\n            menu: new PanelMenu({ labelName: metric }),\n            queryResolution: QUERY_RESOLUTION.HIGH,\n          }),\n        }),\n        new SceneFlexItem({\n          ySizing: 'content',\n          body: new MetricActionBar({}),\n        }),\n      ],\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricGraphScene>) => {\n    const { topView, selectedTab } = model.useState();\n    const { stickyMainGraph } = getTrailSettings(model).useState();\n    const chromeHeaderHeight = useChromeHeaderHeight();\n    const trail = getTrailFor(model);\n    const styles = useStyles2(getStyles, trail.state.embedded ? 0 : chromeHeaderHeight ?? 0, trail);\n\n    return (\n      <div className={styles.container}>\n        <div\n          className={stickyMainGraph ? cx(styles.topView, styles.sticky) : cx(styles.topView, styles.nonSticky)}\n          data-testid=\"top-view\"\n        >\n          <topView.Component model={topView} />\n        </div>\n        {selectedTab && (\n          <div data-testid=\"tab-content\">\n            <selectedTab.Component model={selectedTab} />\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2, headerHeight: number, trail: DataTrail) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      position: 'relative',\n      flexGrow: 1,\n    }),\n    topView: css({}),\n    sticky: css({\n      display: 'flex',\n      flexDirection: 'row',\n      background: getAppBackgroundColor(theme, trail),\n      position: 'sticky',\n      paddingTop: theme.spacing(1),\n      marginTop: `-${theme.spacing(1)}`,\n      zIndex: 10,\n      // --app-controls-height is set dynamically by DataTrail component via ResizeObserver\n      // This ensures the main graph sticks below the app-controls in embedded mode\n      top: `calc(var(--app-controls-height, 0px) + ${headerHeight}px)`,\n    }),\n    nonSticky: css({\n      display: 'flex',\n      flexDirection: 'row',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  VariableDependencyConfig,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { Combobox, Icon, InlineField, InlineLabel, Tooltip, useStyles2, type ComboboxOption } from '@grafana/ui';\nimport React from 'react';\n\nimport { computeMetricPrefixGroups } from 'WingmanDataTrail/MetricsVariables/computeMetricPrefixGroups';\nimport { VAR_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\nimport { getMultiVariableValues } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { EventFiltersChanged } from 'WingmanDataTrail/SideBar/sections/MetricsFilterSection/EventFiltersChanged';\n\ninterface PrefixFilterDropdownState extends SceneObjectState {\n  loading: boolean;\n  error: Error | null;\n  options: ComboboxOption[];\n  value: string;\n}\n\nconst METRIC_PREFIX_ALL_OPTION = {\n  label: 'All metric names',\n  value: 'all',\n};\n\nexport class PrefixFilterDropdown extends SceneObjectBase<PrefixFilterDropdownState> {\n  protected _variableDependency: VariableDependencyConfig<PrefixFilterDropdownState> = new VariableDependencyConfig(\n    this,\n    {\n      variableNames: [VAR_METRICS_VARIABLE],\n      onVariableUpdateCompleted: () => this.parseMetricPrefixes(),\n    }\n  );\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['metricPrefix'] });\n\n  getUrlState() {\n    return { metricPrefix: this.state.value };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    if (typeof values.metricPrefix === 'string') {\n      if (this.state.value !== values.metricPrefix) {\n        this.setState({ value: values.metricPrefix });\n      }\n      return;\n    }\n\n    this.setState({ value: METRIC_PREFIX_ALL_OPTION.value });\n  }\n\n  constructor(state: Partial<PrefixFilterDropdownState>) {\n    super({\n      ...state,\n      key: 'related-prefix-filter',\n      loading: true,\n      error: null,\n      options: [METRIC_PREFIX_ALL_OPTION],\n      value: METRIC_PREFIX_ALL_OPTION.value,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.parseMetricPrefixes();\n  }\n\n  private parseMetricPrefixes() {\n    if (this._variableDependency.hasDependencyInLoadingState()) {\n      this.setState({ error: undefined, loading: true });\n      return;\n    }\n\n    const filteredMetricsVariable = sceneGraph.lookupVariable(VAR_METRICS_VARIABLE, this) as MultiValueVariable;\n\n    if (filteredMetricsVariable.state.error) {\n      this.setState({\n        error: filteredMetricsVariable.state.error,\n        loading: false,\n        options: [],\n      });\n      return;\n    }\n\n    const prefixGroups = computeMetricPrefixGroups(\n      getMultiVariableValues(filteredMetricsVariable) as Array<{ label: string; value: string }>\n    );\n\n    const newOptions = [\n      METRIC_PREFIX_ALL_OPTION,\n      ...prefixGroups.map((g) => ({\n        value: g.value,\n        label: `${g.label} (${g.count})`,\n      })),\n    ];\n\n    const { value } = this.state;\n    const newValue = newOptions.find((o) => o.value === value) ? (value as string) : METRIC_PREFIX_ALL_OPTION.value;\n\n    this.setState({\n      error: null,\n      loading: false,\n      options: newOptions,\n    });\n\n    this.selectOption({ value: newValue, label: newValue });\n  }\n\n  private selectOption = (option: ComboboxOption | null) => {\n    const value = option === null ? METRIC_PREFIX_ALL_OPTION.value : option.value;\n\n    this.setState({ value });\n\n    this.publishEvent(\n      new EventFiltersChanged({\n        type: 'prefixes',\n        filters: value === METRIC_PREFIX_ALL_OPTION.value ? [] : [value],\n      }),\n      true\n    );\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<PrefixFilterDropdown>) => {\n    const styles = useStyles2(getStyles);\n    const { loading, options, value, error } = model.useState();\n\n    return (\n      <div className={styles.container} data-testid=\"prefix-filter-selector\">\n        <InlineField\n          disabled={loading}\n          error={error && error.toString()}\n          label={\n            <InlineLabel width=\"auto\" className={styles.label}>\n              <span>View by</span>\n              <Tooltip\n                content=\"View by the metric prefix. A metric prefix is a single word at the beginning of the metric name, relevant to the domain the metric belongs to.\"\n                placement=\"top\"\n              >\n                <Icon className={styles.tooltipIcon} name=\"info-circle\" size=\"sm\" />\n              </Tooltip>\n            </InlineLabel>\n          }\n        >\n          <Combobox value={value} onChange={model.selectOption} options={options} />\n        </InlineField>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css`\n      display: flex;\n\n      & > div {\n        margin: 0;\n      }\n    `,\n\n    label: css`\n      margin-right: 0;\n      background-color: ${theme.colors.background.primary};\n      border: 1px solid ${theme.colors.border.medium};\n      border-right: 0 none;\n      border-top-right-radius: 0;\n      border-bottom-right-radius: 0;\n    `,\n    tooltipIcon: css`\n      margin-left: ${theme.spacing(0.5)};\n    `,\n  };\n}\n","import { css } from '@emotion/css';\nimport { type SelectableValue } from '@grafana/data';\nimport {\n  EmbeddedScene,\n  SceneFlexItem,\n  SceneFlexLayout,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneReactObject,\n  type SceneVariableSet,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { LayoutSwitcher } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { type CountsProvider } from 'WingmanDataTrail/ListControls/QuickSearch/CountsProvider/CountsProvider';\nimport { MetricVariableCountsProvider } from 'WingmanDataTrail/ListControls/QuickSearch/CountsProvider/MetricVariableCountsProvider';\nimport { QuickSearch } from 'WingmanDataTrail/ListControls/QuickSearch/QuickSearch';\n\nimport { PrefixFilterDropdown } from './PrefixFilterDropdown';\n\ninterface RelatedListControlsState extends SceneObjectState {\n  $variables?: SceneVariableSet;\n  inputControls?: SceneReactObject;\n  onChange?: (value: SelectableValue<string>) => void; // Keeping for backward compatibility\n}\n\nexport class RelatedListControls extends EmbeddedScene {\n  constructor(state: Partial<RelatedListControlsState>) {\n    super({\n      ...state,\n      key: 'related-list-controls',\n      body: new SceneFlexLayout({\n        direction: 'row',\n        width: '100%',\n        maxHeight: '32px',\n        children: [\n          new SceneFlexItem({\n            width: 'auto',\n            body: new PrefixFilterDropdown({}),\n          }),\n          new SceneFlexItem({\n            body: new QuickSearch({\n              urlSearchParamName: 'gmd-relatedSearchText',\n              targetName: 'related metric',\n              countsProvider: new MetricVariableCountsProvider() as unknown as CountsProvider,\n              displayCounts: true,\n            }),\n          }),\n          new SceneFlexItem({\n            width: 'auto',\n            body: new LayoutSwitcher({}),\n          }),\n        ],\n      }),\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<RelatedListControls>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n\n    return (\n      <div className={styles.headerWrapper} data-testid=\"related-list-controls\">\n        <body.Component model={body} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles() {\n  return {\n    headerWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n      '& > div': {\n        display: 'flex',\n        alignItems: 'center',\n        '& > div': {\n          display: 'flex',\n          alignItems: 'center',\n        },\n      },\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n  type QueryVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventQuickSearchChanged } from 'WingmanDataTrail/ListControls/QuickSearch/EventQuickSearchChanged';\nimport { QuickSearch } from 'WingmanDataTrail/ListControls/QuickSearch/QuickSearch';\nimport { MetricsList } from 'WingmanDataTrail/MetricsList/MetricsList';\nimport { EventMetricsVariableActivated } from 'WingmanDataTrail/MetricsVariables/EventMetricsVariableActivated';\nimport { EventMetricsVariableDeactivated } from 'WingmanDataTrail/MetricsVariables/EventMetricsVariableDeactivated';\nimport { EventMetricsVariableLoaded } from 'WingmanDataTrail/MetricsVariables/EventMetricsVariableLoaded';\nimport {\n  FilteredMetricsVariable,\n  VAR_FILTERED_METRICS_VARIABLE,\n} from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport { MetricsVariable } from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\nimport {\n  MetricsVariableFilterEngine,\n  type MetricFilters,\n} from 'WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine';\nimport { MetricsVariableSortEngine } from 'WingmanDataTrail/MetricsVariables/MetricsVariableSortEngine';\nimport { EventFiltersChanged } from 'WingmanDataTrail/SideBar/sections/MetricsFilterSection/EventFiltersChanged';\n\nimport { RelatedListControls } from './RelatedListControls';\n\ninterface RelatedMetricsSceneState extends SceneObjectState {\n  metric: string;\n  body: MetricsList;\n  listControls: RelatedListControls;\n}\n\nexport class RelatedMetricsScene extends SceneObjectBase<RelatedMetricsSceneState> {\n  constructor({ metric }: { metric: RelatedMetricsSceneState['metric'] }) {\n    super({\n      metric,\n      $variables: new SceneVariableSet({\n        variables: [new MetricsVariable(), new FilteredMetricsVariable()],\n      }),\n      key: 'RelatedMetricsScene',\n      body: new MetricsList({ variableName: VAR_FILTERED_METRICS_VARIABLE }),\n      listControls: new RelatedListControls({}),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToEvents();\n  }\n\n  private subscribeToEvents() {\n    this.initVariablesFilteringAndSorting();\n  }\n\n  /**\n   * The centralized filtering mechanism implemented here is decoupled via the usage of events.\n   * In order to work, the variables to be filtered/sorted must emit lifecycle events.\n   * This is done via the `withLifecycleEvents` decorator function.\n   *\n   * For example, check the `FilteredMetricsVariable` class.\n   */\n  private initVariablesFilteringAndSorting() {\n    const { metric } = this.state;\n\n    const enginesMap = new Map<\n      string,\n      { filterEngine: MetricsVariableFilterEngine; sortEngine: MetricsVariableSortEngine }\n    >();\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableActivated, (event) => {\n        // register engines\n        const { key } = event.payload;\n        const filteredMetricsVariable = sceneGraph.findByKey(this, key) as QueryVariable;\n\n        enginesMap.set(key, {\n          filterEngine: new MetricsVariableFilterEngine(filteredMetricsVariable),\n          sortEngine: new MetricsVariableSortEngine(filteredMetricsVariable),\n        });\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableDeactivated, (event) => {\n        // unregister engines\n        enginesMap.delete(event.payload.key);\n      })\n    );\n\n    const quickSearch = sceneGraph.findByKeyAndType(this, 'quick-search', QuickSearch);\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableLoaded, (event) => {\n        // filter  on initial load\n        const { key, options } = event.payload;\n        const { filterEngine, sortEngine } = enginesMap.get(key)!;\n\n        filterEngine.setInitOptions(options);\n\n        const filters: Partial<MetricFilters> = {\n          names: quickSearch.state.value ? [quickSearch.state.value] : [],\n        };\n\n        filterEngine.applyFilters(filters, { forceUpdate: true, notify: false });\n        sortEngine.sort('related', { metric });\n      })\n    );\n\n    /* Filters */\n\n    this._subs.add(\n      this.subscribeToEvent(EventQuickSearchChanged, (event) => {\n        const { searchText } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of enginesMap) {\n          filterEngine.applyFilters({ names: searchText ? [searchText] : [] });\n          sortEngine.sort('related', { metric });\n        }\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventFiltersChanged, (event) => {\n        const { type, filters } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of enginesMap) {\n          filterEngine.applyFilters({ [type]: filters });\n          sortEngine.sort('related', { metric });\n        }\n      })\n    );\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<RelatedMetricsScene>) => {\n    const styles = useStyles2(getStyles);\n    const { $variables, body, listControls } = model.useState();\n\n    return (\n      <>\n        <div className={styles.listControls}>\n          <listControls.Component model={listControls} />\n        </div>\n        <div className={styles.body}>\n          <div className={styles.list} data-testid=\"panels-list\">\n            <body.Component model={body} />\n          </div>\n        </div>\n        <div className={styles.variables}>\n          {$variables?.state.variables.map((variable) => (\n            <variable.Component key={variable.state.name} model={variable} />\n          ))}\n        </div>\n      </>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    body: css({}),\n    list: css({}),\n    listControls: css({\n      margin: theme.spacing(1, 0, 1.5, 0),\n    }),\n    variables: css({\n      display: 'none',\n    }),\n  };\n}\n","import { config } from '@grafana/runtime';\nimport { ToolbarButton } from '@grafana/ui';\nimport React, { useState } from 'react';\n\nimport { PLUGIN_BASE_URL } from './constants';\nimport { UI_TEXT } from './constants/ui';\nimport { type DataTrail } from './DataTrail';\nimport { reportExploreMetrics } from './interactions';\nimport { getUrlForTrail } from './utils';\n\ninterface ShareTrailButtonState {\n  trail: DataTrail;\n}\n\nconst COPY_LABEL = UI_TEXT.METRIC_SELECT_SCENE.COPY_URL_LABEL;\n\nexport const ShareTrailButton = ({ trail }: ShareTrailButtonState) => {\n  const [tooltip, setTooltip] = useState(COPY_LABEL);\n\n  const onShare = () => {\n    if (navigator.clipboard) {\n      reportExploreMetrics('selected_metric_action_clicked', { action: 'share_url' });\n      const appUrl = config.appUrl.endsWith('/') ? config.appUrl.slice(0, -1) : config.appUrl;\n      const url = `${appUrl}${PLUGIN_BASE_URL}/${getUrlForTrail(trail)}`;\n      navigator.clipboard.writeText(url);\n      setTooltip('Copied!');\n      setTimeout(() => {\n        setTooltip(COPY_LABEL);\n      }, 2000);\n    }\n  };\n\n  return <ToolbarButton variant={'canvas'} icon={'share-alt'} tooltip={tooltip} onClick={onShare} />;\n};\n","import { BusEventWithPayload, type DataFrame } from '@grafana/data';\n\ninterface EventTimeseriesDataReceivedPayload {\n  series?: DataFrame[];\n}\n\nexport class EventTimeseriesDataReceived extends BusEventWithPayload<EventTimeseriesDataReceivedPayload> {\n  public static readonly type = 'timeseries-data-received';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\ninterface EventForceSyncYAxisPayload {}\n\nexport class EventForceSyncYAxis extends BusEventWithPayload<EventForceSyncYAxisPayload> {\n  public static readonly type = 'force-sync-y-axis';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\ninterface EventResetSyncYAxisPayload {}\n\nexport class EventResetSyncYAxis extends BusEventWithPayload<EventResetSyncYAxisPayload> {\n  public static readonly type = 'reset-sync-y-axis';\n}\n","import { type DataFrame } from '@grafana/data';\nimport { sceneGraph, VizPanel, type SceneObject, type SceneObjectState } from '@grafana/scenes';\nimport { cloneDeep, merge } from 'lodash';\n\nimport { EventTimeseriesDataReceived } from 'Breakdown/MetricLabelsList/events/EventTimeseriesDataReceived';\n\nimport { EventForceSyncYAxis } from '../events/EventForceSyncYAxis';\nimport { EventResetSyncYAxis } from '../events/EventResetSyncYAxis';\n\n/**\n * Synchronizes the Y-axis ranges across children timeseries panels by listening to data updates from publishTimeseriesData.\n * When new data arrives, it calculates the global min/max values and updates all children panels to use the same scale.\n */\nexport function syncYAxis() {\n  return (vizPanelsParent: SceneObject<SceneObjectState>) => {\n    let max = Number.NEGATIVE_INFINITY;\n    let min = Number.POSITIVE_INFINITY;\n\n    // reset after timerange changes\n    const timeRangeSub = sceneGraph.getTimeRange(vizPanelsParent).subscribeToState(() => {\n      max = Number.NEGATIVE_INFINITY;\n      min = Number.POSITIVE_INFINITY;\n    });\n\n    // reset after receiving the EventResetSyncYAxis event (see SceneByFrameRepeater when filtering/sorting)\n    const resetSub = vizPanelsParent.subscribeToEvent(EventResetSyncYAxis, () => {\n      max = Number.NEGATIVE_INFINITY;\n      min = Number.POSITIVE_INFINITY;\n    });\n\n    // force new panels update after receiving the EventForceSyncYAxis event (see SceneByFrameRepeater when paginating)\n    const forceSub = vizPanelsParent.subscribeToEvent(EventForceSyncYAxis, () => {\n      let [newMax, newMin] = [max, min];\n\n      const nonSyncedPanels = findTimeseriesPanels(vizPanelsParent).filter((t) => {\n        const { fieldConfig, $data } = t.state;\n\n        if ('min' in fieldConfig.defaults && 'max' in fieldConfig.defaults) {\n          return false; // we assume it's already synced (see updateTimeseriesAxis below)\n        }\n\n        [newMax, newMin] = findNewMaxMin($data?.state.data?.series || [], newMax, newMin);\n        return true;\n      });\n\n      if (newMax === max && newMin === min) {\n        updateTimeseriesAxis(vizPanelsParent, max, min, nonSyncedPanels);\n      } else {\n        [max, min] = [newMax, newMin];\n        updateTimeseriesAxis(vizPanelsParent, newMax, newMin);\n      }\n    });\n\n    // new data coming...\n    const dataReceivedSub = vizPanelsParent.subscribeToEvent(EventTimeseriesDataReceived, (event) => {\n      const [newMax, newMin] = findNewMaxMin(event.payload.series || [], max, min);\n\n      if (\n        newMax !== newMin &&\n        newMax !== Number.NEGATIVE_INFINITY &&\n        newMin !== Number.POSITIVE_INFINITY &&\n        (newMax !== max || newMin !== min)\n      ) {\n        [max, min] = [newMax, newMin];\n        updateTimeseriesAxis(vizPanelsParent, newMax, newMin);\n      }\n    });\n\n    return () => {\n      dataReceivedSub.unsubscribe();\n      forceSub.unsubscribe();\n      resetSub.unsubscribe();\n      timeRangeSub.unsubscribe();\n    };\n  };\n}\n\nfunction findNewMaxMin(series: DataFrame[], max: number, min: number) {\n  let [newMax, newMin] = [max, min];\n\n  for (const s of series || []) {\n    const values = s.fields[1]?.values.filter(Boolean);\n\n    if (values) {\n      newMax = Math.max(newMax, ...values);\n      newMin = Math.min(newMin, ...values);\n    }\n  }\n\n  return [newMax, newMin];\n}\n\nfunction findTimeseriesPanels(vizPanelsParent: SceneObject) {\n  // findAllObjects searches down the full scene graph\n  return sceneGraph.findAllObjects(\n    vizPanelsParent,\n    (o) => o instanceof VizPanel && o.state.pluginId === 'timeseries'\n  ) as VizPanel[];\n}\n\nfunction updateTimeseriesAxis(vizPanelsParent: SceneObject, max: number, min: number, panels?: VizPanel[]) {\n  for (const t of panels || findTimeseriesPanels(vizPanelsParent)) {\n    t.clearFieldConfigCache(); // required for the fieldConfig update below\n\n    t.setState({\n      fieldConfig: merge(cloneDeep(t.state.fieldConfig), { defaults: { min, max } }),\n    });\n  }\n}\n","export const DEFAULT_UNIT = 'none';\nexport const DEFAULT_RATE_UNIT = 'cps'; // Count per second\n\n// Unit constants\nexport const UNIT_BYTES = 'bytes';\nexport const UNIT_SECONDS = 'seconds';\nexport const UNIT_PERCENT = 'percent';\nexport const UNIT_COUNT = 'count';\n\n// Rate unit constants\nexport const RATE_BYTES_PER_SECOND = 'Bps';\nexport const RATE_BITS_PER_SECOND = 'bps';\n\nconst UNIT_MAP: Record<string, string> = {\n  [UNIT_BYTES]: UNIT_BYTES,\n  [UNIT_SECONDS]: 's',\n  [UNIT_PERCENT]: UNIT_PERCENT,\n  [UNIT_COUNT]: DEFAULT_UNIT,\n};\n\nconst UNIT_LIST = Object.keys(UNIT_MAP); // used to check if a metric name contains any of the supported units\n\nconst RATE_UNIT_MAP: Record<string, string> = {\n  [UNIT_BYTES]: RATE_BYTES_PER_SECOND,\n  // seconds per second is unitless\n  [UNIT_SECONDS]: DEFAULT_UNIT,\n  [UNIT_COUNT]: DEFAULT_RATE_UNIT,\n  [UNIT_PERCENT]: UNIT_PERCENT,\n};\n\n// Get unit from metric name (e.g. \"go_gc_duration_seconds\" -> \"seconds\")\nexport function getUnitFromMetric(metric: string) {\n  // Get last two parts of the metric name and check if they are valid units\n  const metricParts = metric.toLowerCase().split('_').slice(-2);\n  for (let i = metricParts.length - 1; i >= Math.max(0, metricParts.length - 2); i--) {\n    const part = metricParts[i];\n    if (UNIT_LIST.includes(part)) {\n      return part;\n    }\n  }\n\n  return null;\n}\n\n// Get Grafana unit for a panel (e.g. \"go_gc_duration_seconds\" -> \"s\")\nexport function getUnit(metricName: string) {\n  const metricPart = getUnitFromMetric(metricName);\n  return (metricPart && UNIT_MAP[metricPart.toLowerCase()]) || DEFAULT_UNIT;\n}\n\nexport function getPerSecondRateUnit(metricName: string) {\n  const metricPart = getUnitFromMetric(metricName);\n  return (metricPart && RATE_UNIT_MAP[metricPart]) || DEFAULT_RATE_UNIT;\n}\n","import { sceneGraph, SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button } from '@grafana/ui';\nimport React from 'react';\n\nimport { VAR_GROUP_BY } from 'shared';\nimport { isQueryVariable } from 'utils/utils.variables';\n\nimport { reportExploreMetrics } from '../../interactions';\n\ninterface SelectLabelActionState extends SceneObjectState {\n  label: string;\n}\n\nexport class SelectLabelAction extends SceneObjectBase<SelectLabelActionState> {\n  public onClick = () => {\n    const { label } = this.state;\n\n    reportExploreMetrics('breakdown_panel_selected', { label });\n\n    const groupByVariable = sceneGraph.lookupVariable(VAR_GROUP_BY, this)!;\n    if (!isQueryVariable(groupByVariable)) {\n      throw new Error('Group by variable not found');\n    }\n    groupByVariable.changeValueTo(label);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<SelectLabelAction>) => {\n    return (\n      <Button variant=\"secondary\" size=\"sm\" fill=\"outline\" onClick={model.onClick}>\n        Select\n      </Button>\n    );\n  };\n}\n","import { LoadingState } from '@grafana/data';\nimport { type SceneDataProvider, type VizPanel } from '@grafana/scenes';\n\nimport { EventTimeseriesDataReceived } from '../events/EventTimeseriesDataReceived';\n\n/**\n * Publishes timeseries data events when new data arrives from the VizPanel data provider.\n * These events are used by other behaviors like syncYAxis to coordinate updates across multiple panels.\n */\nexport function publishTimeseriesData() {\n  return (vizPanel: VizPanel) => {\n    const data = vizPanel.state.$data?.state.data;\n\n    if (data?.state === LoadingState.Done) {\n      vizPanel.publishEvent(new EventTimeseriesDataReceived({ series: data.series }), true);\n    }\n\n    (vizPanel.state.$data as SceneDataProvider).subscribeToState((newState, prevState) => {\n      if (newState.data?.state === LoadingState.Done && newState.data?.series !== prevState.data?.series) {\n        vizPanel.publishEvent(new EventTimeseriesDataReceived({ series: newState.data.series }), true);\n      }\n    });\n  };\n}\n","import { type DataFrame } from '@grafana/data';\nimport { map, type Observable } from 'rxjs';\n\nexport const addRefId = () => (source: Observable<DataFrame[]>) =>\n  source.pipe(\n    map((data: DataFrame[]) =>\n      data?.map((d, i) => {\n        d.refId = `${d.refId}-${i}`;\n        return d;\n      })\n    )\n  );\n","import { type DataFrame } from '@grafana/data';\nimport { map, type Observable } from 'rxjs';\n\nexport const SERIES_COUNT_STATS_NAME = 'seriesCount';\n\nexport const sliceSeries = (start: number, end: number) => () => (source: Observable<DataFrame[]>) =>\n  source.pipe(\n    map((data: DataFrame[]) =>\n      // eslint-disable-next-line sonarjs/no-nested-functions\n      data?.slice(start, end).map((d) => {\n        d.meta = { ...d.meta };\n        d.meta.stats ||= [];\n        d.meta.stats.unshift({ displayName: SERIES_COUNT_STATS_NAME, value: data.length });\n        return d;\n      })\n    )\n  );\n","import { css } from '@emotion/css';\nimport { FieldMatcherID, LoadingState, type DataFrame } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneDataTransformer,\n  SceneObjectBase,\n  SceneQueryRunner,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type VizPanel,\n} from '@grafana/scenes';\nimport { SortOrder } from '@grafana/schema';\nimport { TooltipDisplayMode, useStyles2 } from '@grafana/ui';\nimport { merge } from 'lodash';\nimport React from 'react';\n\nimport { SelectLabelAction } from 'Breakdown/MetricLabelsList/SelectLabelAction';\nimport { GmdVizPanel, PANEL_HEIGHT } from 'GmdVizPanel/GmdVizPanel';\nimport { PanelMenu } from 'Menu/PanelMenu';\nimport { MDP_METRIC_PREVIEW, trailDS } from 'shared';\nimport { getColorByIndex } from 'utils';\n\nimport { publishTimeseriesData } from './behaviors/publishTimeseriesData';\nimport { addRefId } from './transformations/addRefId';\nimport { addUnspecifiedLabel } from './transformations/addUnspecifiedLabel';\nimport { SERIES_COUNT_STATS_NAME, sliceSeries } from './transformations/sliceSeries';\n\ninterface LabelVizPanelState extends SceneObjectState {\n  metric: string;\n  label: string;\n  query: string;\n  unit: string;\n  startColorIndex: number;\n  body: VizPanel;\n}\n\nconst MAX_SERIES_TO_RENDER = 20;\nexport const LABELS_VIZ_PANEL_HEIGHT = `${GmdVizPanel.getPanelHeightInPixels(PANEL_HEIGHT.M)}px`;\n\nexport class LabelVizPanel extends SceneObjectBase<LabelVizPanelState> {\n  constructor({\n    metric,\n    label,\n    query,\n    unit,\n    startColorIndex,\n  }: {\n    metric: LabelVizPanelState['label'];\n    label: LabelVizPanelState['label'];\n    query: LabelVizPanelState['query'];\n    unit: LabelVizPanelState['unit'];\n    startColorIndex: LabelVizPanelState['startColorIndex'];\n  }) {\n    super({\n      key: `label-viz-panel-${label}`,\n      metric,\n      label,\n      query,\n      unit,\n      startColorIndex,\n      body: LabelVizPanel.buildVizPanel({ metric, label, query, unit }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private static buildVizPanel({\n    metric,\n    label,\n    query,\n    unit,\n  }: {\n    metric: LabelVizPanelState['label'];\n    label: LabelVizPanelState['label'];\n    query: LabelVizPanelState['query'];\n    unit: LabelVizPanelState['unit'];\n  }) {\n    const data = new SceneDataTransformer({\n      $data: new SceneQueryRunner({\n        datasource: trailDS,\n        maxDataPoints: MDP_METRIC_PREVIEW,\n        queries: [\n          {\n            refId: `${metric}-${label}`,\n            expr: query,\n            legendFormat: `{{${label}}}`,\n            fromExploreMetrics: true,\n          },\n        ],\n      }),\n      // addRefId is required for setting the overrides below\n      transformations: [sliceSeries(0, MAX_SERIES_TO_RENDER), addUnspecifiedLabel(label), addRefId],\n    });\n\n    const vizPanel = PanelBuilders.timeseries()\n      .setTitle(label)\n      .setUnit(unit)\n      .setData(data)\n      .setBehaviors([publishTimeseriesData()]) // publishTimeseriesData is required for the syncYAxis behavior (e.g. see MetricLabelsList)\n      .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n      .setHeaderActions([new SelectLabelAction({ label })])\n      .setMenu(new PanelMenu({ labelName: label }))\n      .setShowMenuAlways(true)\n      .build();\n\n    return vizPanel;\n  }\n\n  private onActivate() {\n    const { body, label } = this.state;\n\n    this._subs.add(\n      (body.state.$data as SceneQueryRunner).subscribeToState((newState) => {\n        if (newState.data?.state !== LoadingState.Done) {\n          return;\n        }\n\n        const { series } = newState.data;\n\n        if (!series?.length) {\n          return;\n        }\n\n        const hasNoData = series.every((s) => !s.length);\n        const headerActions = hasNoData ? null : [new SelectLabelAction({ label })];\n        const config = this.getAllValuesConfig(series);\n\n        body.setState(merge({}, body.state, { headerActions }, config));\n      })\n    );\n  }\n\n  getAllValuesConfig(series: DataFrame[]) {\n    const { label } = this.state;\n\n    const seriesCountStats = series[0].meta?.stats?.find((s) => s.displayName === SERIES_COUNT_STATS_NAME);\n    const seriesCount = seriesCountStats ? seriesCountStats.value : series.length;\n    const description =\n      series.length < seriesCount\n        ? `Showing only ${series.length} series out of ${seriesCount} to keep the data easy to read. Click on \"Select\" on this panel to view a breakdown of all the label's values.`\n        : '';\n\n    return {\n      title: `${label} (${seriesCount})`,\n      description,\n      fieldConfig: {\n        overrides: this.getOverrides(series),\n      },\n    };\n  }\n\n  getOverrides(series: DataFrame[]) {\n    const { startColorIndex } = this.state;\n\n    return series.map((s, i) => {\n      return {\n        matcher: { id: FieldMatcherID.byFrameRefID, options: s.refId },\n        properties: [\n          {\n            id: 'color',\n            value: { mode: 'fixed', fixedColor: getColorByIndex(startColorIndex + i) },\n          },\n        ],\n      };\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<LabelVizPanel>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container}>\n        <body.Component model={body} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles() {\n  return {\n    container: css({\n      height: LABELS_VIZ_PANEL_HEIGHT,\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneReactObject,\n  sceneUtils,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Field, Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { syncYAxis } from 'Breakdown/MetricLabelsList/behaviors/syncYAxis';\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/GmdVizPanel';\nimport { getTimeseriesQueryRunnerParams } from 'GmdVizPanel/timeseries/getTimeseriesQueryRunnerParams';\nimport { isRateQuery } from 'GmdVizPanel/timeseries/isRateQuery';\nimport { getPerSecondRateUnit, getUnit } from 'GmdVizPanel/units/getUnit';\nimport { VAR_GROUP_BY } from 'shared';\nimport { LayoutSwitcher, LayoutType, type LayoutSwitcherState } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { GRID_TEMPLATE_COLUMNS, GRID_TEMPLATE_ROWS } from 'WingmanDataTrail/MetricsList/MetricsList';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\n\nimport { LABELS_VIZ_PANEL_HEIGHT, LabelVizPanel } from './LabelVizPanel';\n\ninterface MetricLabelsListState extends SceneObjectState {\n  metric: string;\n  layoutSwitcher: LayoutSwitcher;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricLabelsList extends SceneObjectBase<MetricLabelsListState> {\n  constructor({ metric }: { metric: MetricLabelsListState['metric'] }) {\n    const unit = isRateQuery(metric) ? getPerSecondRateUnit(metric) : getUnit(metric);\n\n    super({\n      key: 'metric-labels-list',\n      metric,\n      layoutSwitcher: new LayoutSwitcher({}),\n      body: new SceneByVariableRepeater({\n        variableName: VAR_GROUP_BY,\n        initialPageSize: 60,\n        pageSizeIncrement: 9,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: GRID_TEMPLATE_COLUMNS,\n          autoRows: LABELS_VIZ_PANEL_HEIGHT,\n          $behaviors: [\n            new behaviors.CursorSync({\n              key: 'metricCrosshairSync',\n              sync: DashboardCursorSync.Crosshair,\n            }),\n            syncYAxis(),\n          ],\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No labels found for the current filters and time range.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: <InlineBanner severity=\"error\" title=\"Error while loading labels!\" error={error} />,\n          }),\n        getLayoutChild: (option, startColorIndex) => {\n          const { queries } = getTimeseriesQueryRunnerParams({\n            metric,\n            matchers: [],\n            groupBy: option.value as string,\n            queryResolution: QUERY_RESOLUTION.MEDIUM,\n            addIgnoreUsageFilter: true,\n          });\n\n          return new SceneCSSGridItem({\n            body: new LabelVizPanel({\n              metric,\n              label: option.value as string,\n              query: queries[0].expr,\n              unit,\n              startColorIndex,\n            }),\n          });\n        },\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToLayoutChange();\n  }\n\n  private subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', LayoutSwitcher);\n    const body = this.state.body.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: LayoutSwitcherState, prevState?: LayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: newState.layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n        });\n      }\n    };\n\n    // We ensure the proper layout when landing on the page:\n    // because MetricLabelsList is created dynamically when LabelBreakdownScene updates its body,\n    // LayoutSwitcher is not properly connected to the URL synchronization system\n    sceneUtils.syncStateFromSearchParams(layoutSwitcher, new URLSearchParams(window.location.search));\n    onChangeState(layoutSwitcher.state);\n\n    this._subs.add(layoutSwitcher.subscribeToState(onChangeState));\n  }\n\n  public Controls({ model }: { model: MetricLabelsList }) {\n    const { layoutSwitcher } = model.useState();\n    return (\n      <Field label=\"View\">\n        <layoutSwitcher.Component model={layoutSwitcher} />\n      </Field>\n    );\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricLabelsList>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const variable = sceneGraph.lookupVariable(VAR_GROUP_BY, model) as MultiValueVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    return (\n      <div data-testid=\"labels-list\">\n        <div className={styles.container}>\n          <body.Component model={body} />\n        </div>\n        {shouldDisplayShowMoreButton && (\n          <div className={styles.footer}>\n            <ShowMoreButton label=\"label\" batchSizes={batchSizes} onClick={onClickShowMore} />\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({ width: '100%' }),\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginTop: theme.spacing(4),\n\n      '& button': {\n        height: '40px',\n        borderRadius: '8px',\n      },\n    }),\n  };\n}\n","import { sceneGraph, SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from 'interactions';\nimport { VAR_FILTERS } from 'shared';\nimport { getTrailFor } from 'utils';\nimport { isAdHocFiltersVariable } from 'utils/utils.variables';\n\nexport interface AddToFiltersGraphActionState extends SceneObjectState {\n  labelName: string;\n  labelValue: string;\n}\n\nexport class AddToFiltersGraphAction extends SceneObjectBase<AddToFiltersGraphActionState> {\n  public onClick = () => {\n    const variable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n    if (!isAdHocFiltersVariable(variable)) {\n      return;\n    }\n\n    const { labelName, labelValue } = this.state;\n\n    reportExploreMetrics('label_filter_changed', { label: labelName, action: 'added', cause: 'breakdown' });\n\n    getTrailFor(this).addFilterWithoutReportingInteraction({\n      key: labelName,\n      operator: '=',\n      value: labelValue,\n    });\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<AddToFiltersGraphAction>) => {\n    return (\n      <Button variant=\"secondary\" size=\"sm\" fill=\"outline\" onClick={model.onClick}>\n        Add to filters\n      </Button>\n    );\n  };\n}\n","import { type DataFrame } from '@grafana/data';\n\nexport function getLabelValueFromDataFrame(frame: DataFrame) {\n  const labels = frame.fields[1]?.labels || {};\n\n  const keys = Object.keys(labels);\n  if (keys.length === 0) {\n    return '<unspecified>';\n  }\n\n  return labels[keys[0]];\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Combobox, Field, IconButton, useStyles2, type ComboboxOption } from '@grafana/ui';\nimport React from 'react';\n\nimport { type SortSeriesByOption } from 'services/sorting';\n\nimport { PREF_KEYS } from '../../UserPreferences/pref-keys';\nimport { userPreferences } from '../../UserPreferences/userPreferences';\n\nexport interface SortBySelectorState extends SceneObjectState {\n  target: 'fields' | 'labels';\n  options: Array<ComboboxOption<SortSeriesByOption>>;\n  value: ComboboxOption<SortSeriesByOption>;\n}\n\nexport class SortBySelector extends SceneObjectBase<SortBySelectorState> {\n  static readonly DEFAULT_OPTIONS = [\n    {\n      value: 'outliers' as SortSeriesByOption,\n      label: 'Outlying series',\n      description: 'Prioritizes values that show distinct behavior from others within the same label',\n    },\n    {\n      value: 'alphabetical' as SortSeriesByOption,\n      label: 'Name [A-Z]',\n      description: 'Alphabetical order',\n    },\n    {\n      value: 'alphabetical-reversed' as SortSeriesByOption,\n      label: 'Name [Z-A]',\n      description: 'Reversed alphabetical order',\n    },\n  ];\n\n  constructor(state: Pick<SortBySelectorState, 'target'>) {\n    const sortBy = userPreferences.getItem(PREF_KEYS.BREAKDOWN_SORTBY);\n\n    super({\n      key: 'breakdown-sort-by',\n      target: state.target,\n      options: SortBySelector.DEFAULT_OPTIONS,\n      value:\n        (sortBy && SortBySelector.DEFAULT_OPTIONS.find((o) => o.value === sortBy)) || SortBySelector.DEFAULT_OPTIONS[0],\n    });\n  }\n\n  private onChange = (option: ComboboxOption<SortSeriesByOption>) => {\n    this.setState({ value: option });\n    userPreferences.setItem(PREF_KEYS.BREAKDOWN_SORTBY, option.value);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<SortBySelector>) => {\n    const styles = useStyles2(getStyles);\n    const { value, options } = model.useState();\n\n    return (\n      <Field\n        data-testid=\"sort-by-select\"\n        htmlFor=\"sort-by-criteria\"\n        label={\n          <div className={styles.sortByTooltip}>\n            Sort by\n            <IconButton\n              name={'info-circle'}\n              size=\"sm\"\n              variant={'secondary'}\n              tooltip=\"Sorts values using standard or smart time series calculations.\"\n            />\n          </div>\n        }\n      >\n        <Combobox\n          id=\"sort-by-criteria\"\n          placeholder=\"Choose criteria\"\n          width={20}\n          options={options}\n          value={value}\n          onChange={model.onChange}\n          isClearable={false}\n        />\n      </Field>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    sortByTooltip: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n    }),\n  };\n}\n","import { LoadingState, type DataFrame, type PanelData } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  type SceneComponentProps,\n  type SceneDataProvider,\n  type SceneLayout,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneStatelessBehavior,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { EventForceSyncYAxis } from 'Breakdown/MetricLabelsList/events/EventForceSyncYAxis';\nimport { EventResetSyncYAxis } from 'Breakdown/MetricLabelsList/events/EventResetSyncYAxis';\nimport { sortSeries, type SortSeriesByOption } from 'services/sorting';\nimport { type CountsData } from 'WingmanDataTrail/ListControls/QuickSearch/CountsProvider/CountsProvider';\nimport { QuickSearch } from 'WingmanDataTrail/ListControls/QuickSearch/QuickSearch';\n\nimport { getLabelValueFromDataFrame } from './getLabelValueFromDataFrame';\nimport { SortBySelector } from './SortBySelector';\n\n/**\n * Same idea as in our custom SceneByVariableRepeater.tsx, we create a Scene object with more capabilities than the official Scene object.\n * Specifically, we're adding:\n *\n * 1. Support for pagination\n * 2. Support for filtering and sorting (we may consider externalizing this to a separate class in the future)\n * 3. Support for $behaviors, that is used to reset the y axis sync after filtering and/or sorting\n */\ninterface SceneByFrameRepeaterState extends SceneObjectState {\n  $behaviors: Array<SceneObject | SceneStatelessBehavior>;\n  body: SceneLayout;\n  getLayoutChild(data: PanelData, frame: DataFrame, frameIndex: number): SceneObject | null;\n  getLayoutLoading?: () => SceneObject;\n  getLayoutError?: (data: PanelData) => SceneObject;\n  getLayoutEmpty?: () => SceneObject;\n  currentBatchSize: number;\n  initialPageSize: number;\n  pageSizeIncrement: number;\n  loadingLayout?: SceneObject;\n  errorLayout?: SceneObject;\n  emptyLayout?: SceneObject;\n  counts: CountsData;\n  $data?: SceneDataProvider;\n}\n\nconst DEFAULT_INITIAL_PAGE_SIZE = 120;\nconst DEFAULT_PAGE_SIZE_INCREMENT = 9;\n\nexport class SceneByFrameRepeater extends SceneObjectBase<SceneByFrameRepeaterState> {\n  private searchText = '';\n  private sortBy?: SortSeriesByOption;\n\n  public constructor({\n    $behaviors,\n    body,\n    getLayoutChild,\n    getLayoutLoading,\n    getLayoutError,\n    getLayoutEmpty,\n    initialPageSize,\n    pageSizeIncrement,\n    $data,\n  }: {\n    $behaviors: SceneByFrameRepeaterState['$behaviors'];\n    body: SceneByFrameRepeaterState['body'];\n    getLayoutChild: SceneByFrameRepeaterState['getLayoutChild'];\n    getLayoutLoading?: SceneByFrameRepeaterState['getLayoutLoading'];\n    getLayoutError?: SceneByFrameRepeaterState['getLayoutError'];\n    getLayoutEmpty?: SceneByFrameRepeaterState['getLayoutEmpty'];\n    initialPageSize?: SceneByFrameRepeaterState['initialPageSize'];\n    pageSizeIncrement?: SceneByFrameRepeaterState['pageSizeIncrement'];\n    $data?: SceneByFrameRepeaterState['$data'];\n  }) {\n    super({\n      key: 'breakdown-by-frame-repeater',\n      $behaviors,\n      body,\n      getLayoutChild,\n      getLayoutLoading,\n      getLayoutError,\n      getLayoutEmpty,\n      currentBatchSize: 0,\n      initialPageSize: initialPageSize || DEFAULT_INITIAL_PAGE_SIZE,\n      pageSizeIncrement: pageSizeIncrement || DEFAULT_PAGE_SIZE_INCREMENT,\n      loadingLayout: undefined,\n      errorLayout: undefined,\n      emptyLayout: undefined,\n      counts: { current: 0, total: 0 },\n      $data,\n    });\n\n    this.addActivationHandler(() => {\n      const dataProvider = sceneGraph.getData(this);\n      if (!dataProvider) {\n        throw new Error('No data provider found!');\n      }\n\n      this.initFilterAndSort();\n\n      this._subs.add(\n        dataProvider.subscribeToState((newState) => {\n          if (newState.data) {\n            this.performRepeat(newState.data);\n          }\n        })\n      );\n\n      if (dataProvider.state.data) {\n        this.performRepeat(dataProvider.state.data);\n      }\n    });\n  }\n\n  private performRepeat(data: PanelData) {\n    if (data.state === LoadingState.Loading) {\n      this.setState({\n        loadingLayout: this.state.getLayoutLoading?.(),\n        errorLayout: undefined,\n        emptyLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    if (data.state === LoadingState.Error) {\n      this.setState({\n        errorLayout: this.state.getLayoutError?.(data),\n        loadingLayout: undefined,\n        emptyLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    const filteredSeries = this.filterAndSort(data.series);\n\n    if (!filteredSeries.length) {\n      this.setState({\n        emptyLayout: this.state.getLayoutEmpty?.(),\n        errorLayout: undefined,\n        loadingLayout: undefined,\n        currentBatchSize: 0,\n        counts: { current: 0, total: data.series.length },\n      });\n      return;\n    }\n\n    this.setState({\n      loadingLayout: undefined,\n      errorLayout: undefined,\n      emptyLayout: undefined,\n      currentBatchSize: this.state.initialPageSize,\n      counts: { current: filteredSeries.length, total: data.series.length },\n    });\n\n    const newChildren: SceneObject[] = filteredSeries\n      .slice(0, this.state.initialPageSize)\n      .map((s, i) => this.state.getLayoutChild(data, s, i))\n      .filter(Boolean) as SceneObject[];\n\n    this.state.body.setState({ children: newChildren });\n  }\n\n  private initFilterAndSort() {\n    this.searchText = sceneGraph.findByKeyAndType(this, 'quick-search', QuickSearch).state.value;\n    this.sortBy = sceneGraph.findByKeyAndType(this, 'breakdown-sort-by', SortBySelector).state.value.value;\n  }\n\n  private filterAndSort(series: PanelData['series']) {\n    let filteredSeries: DataFrame[] = [];\n\n    if (!this.searchText) {\n      filteredSeries = series;\n    } else {\n      const regexes = this.searchText\n        .split(',')\n        .map((p) => p.trim())\n        .filter(Boolean)\n        .map((r) => {\n          try {\n            return new RegExp(r);\n          } catch {\n            return null;\n          }\n        })\n        .filter(Boolean) as RegExp[];\n\n      for (let i = 0; i < series.length; i += 1) {\n        const s = series[i];\n\n        if (regexes.some((regex) => regex.test(getLabelValueFromDataFrame(s)))) {\n          filteredSeries.push(s);\n        }\n      }\n    }\n\n    if (this.sortBy) {\n      filteredSeries = sortSeries(filteredSeries, this.sortBy);\n    }\n\n    return filteredSeries;\n  }\n\n  public filter(searchText: string) {\n    this.searchText = searchText;\n\n    const { data } = sceneGraph.getData(this).state;\n    if (data) {\n      this.publishEvent(new EventResetSyncYAxis({}), true);\n      this.performRepeat(data);\n    }\n  }\n\n  public sort(sortBy: SortSeriesByOption) {\n    this.sortBy = sortBy;\n\n    const { data } = sceneGraph.getData(this).state;\n    if (data) {\n      this.publishEvent(new EventResetSyncYAxis({}), true);\n      this.performRepeat(data);\n    }\n  }\n\n  public increaseBatchSize() {\n    const { data } = sceneGraph.getData(this).state;\n    if (!data) {\n      return;\n    }\n\n    const newBatchSize = this.state.currentBatchSize + this.state.pageSizeIncrement;\n\n    const newChildren: SceneObject[] = this.filterAndSort(data.series)\n      .slice(this.state.currentBatchSize, newBatchSize)\n      .map((s, i) => this.state.getLayoutChild(data, s, i))\n      .filter(Boolean) as SceneObject[];\n\n    this.state.body.setState({\n      children: [...this.state.body.state.children, ...newChildren],\n    });\n\n    this.setState({\n      currentBatchSize: newBatchSize,\n    });\n\n    this.publishEvent(new EventForceSyncYAxis({}), true);\n  }\n\n  public useSizes() {\n    const { currentBatchSize, pageSizeIncrement } = this.useState();\n    const { data } = sceneGraph.getData(this).state;\n    const total = data ? this.filterAndSort(data.series).length : 0;\n    const remaining = total - currentBatchSize;\n    const increment = remaining < pageSizeIncrement ? remaining : pageSizeIncrement;\n\n    return {\n      increment,\n      current: currentBatchSize,\n      total,\n    };\n  }\n\n  public getCounts() {\n    const { data } = sceneGraph.getData(this).state;\n    return {\n      current: 0,\n      total: data ? data.series.length : 0,\n    };\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<SceneByFrameRepeater>) => {\n    const { body, loadingLayout, errorLayout, emptyLayout } = model.useState();\n\n    if (loadingLayout) {\n      return <loadingLayout.Component model={loadingLayout} />;\n    }\n\n    if (errorLayout) {\n      return <errorLayout.Component model={errorLayout} />;\n    }\n\n    if (emptyLayout) {\n      return <emptyLayout.Component model={emptyLayout} />;\n    }\n\n    return <body.Component model={body} />;\n  };\n}\n","import { sceneGraph } from '@grafana/scenes';\n\nimport { CountsProvider } from 'WingmanDataTrail/ListControls/QuickSearch/CountsProvider/CountsProvider';\n\nimport { SceneByFrameRepeater } from './SceneByFrameRepeater';\n\nexport class LabelValuesCountsProvider extends CountsProvider {\n  constructor() {\n    super({ key: 'LabelValuesCountsProvider' });\n\n    this.addActivationHandler(() => {\n      const byFrameRepeater = sceneGraph.findByKeyAndType(this, 'breakdown-by-frame-repeater', SceneByFrameRepeater);\n\n      byFrameRepeater.subscribeToState((newState, prevState) => {\n        if (newState.counts !== prevState.counts) {\n          this.setState({ counts: newState.counts });\n        }\n      });\n    });\n  }\n}\n","import {\n  PanelBuilders,\n  SceneObjectBase,\n  type SceneComponentProps,\n  type SceneDataNode,\n  type SceneObjectState,\n  type VizPanel,\n  type VizPanelState,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { GmdVizPanel, PANEL_HEIGHT } from 'GmdVizPanel/GmdVizPanel';\nimport { type PanelMenu } from 'Menu/PanelMenu';\n\nimport { publishTimeseriesData } from '../MetricLabelsList/behaviors/publishTimeseriesData';\n\ninterface LabelValueVizPanelState extends SceneObjectState {\n  labelValue: string;\n  unit: string;\n  fixedColor: string;\n  body: VizPanel;\n}\n\nexport const LABEL_VALUE_VIZ_PANEL_HEIGHT = `${GmdVizPanel.getPanelHeightInPixels(PANEL_HEIGHT.M)}px`;\n\nexport class LabelValueVizPanel extends SceneObjectBase<LabelValueVizPanelState> {\n  constructor({\n    labelValue,\n    data,\n    unit,\n    fixedColor,\n    headerActions,\n    menu,\n  }: {\n    labelValue: LabelValueVizPanelState['labelValue'];\n    data: SceneDataNode;\n    unit: LabelValueVizPanelState['unit'];\n    fixedColor: LabelValueVizPanelState['fixedColor'];\n    headerActions: VizPanelState['headerActions'];\n    menu: PanelMenu;\n  }) {\n    super({\n      key: `label-value-viz-panel-${labelValue}`,\n      labelValue,\n      unit,\n      fixedColor,\n      body: LabelValueVizPanel.buildVizPanel({\n        labelValue,\n        data,\n        unit,\n        fixedColor,\n        headerActions,\n        menu,\n      }),\n    });\n  }\n\n  private static buildVizPanel({\n    labelValue,\n    data,\n    unit,\n    fixedColor,\n    headerActions,\n    menu,\n  }: {\n    labelValue: LabelValueVizPanelState['labelValue'];\n    data: SceneDataNode;\n    unit: LabelValueVizPanelState['unit'];\n    fixedColor: LabelValueVizPanelState['fixedColor'];\n    headerActions: VizPanelState['headerActions'];\n    menu: PanelMenu;\n  }) {\n    return PanelBuilders.timeseries()\n      .setTitle(labelValue)\n      .setBehaviors([publishTimeseriesData()]) // publishTimeseriesData is required for the syncYAxis behavior\n      .setData(data)\n      .setUnit(unit)\n      .setColor({ mode: 'fixed', fixedColor })\n      .setCustomFieldConfig('fillOpacity', 9)\n      .setHeaderActions(headerActions)\n      .setOption('legend', { showLegend: false })\n      .setShowMenuAlways(true)\n      .setMenu(menu)\n      .build();\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<LabelValueVizPanel>) => {\n    const { body } = model.useState();\n    return <body.Component model={body} />;\n  };\n}\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, LoadingState, type DataFrame, type GrafanaTheme2, type PanelData } from '@grafana/data';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneDataNode,\n  SceneDataTransformer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneQueryRunner,\n  SceneReactObject,\n  sceneUtils,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Field, Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { getPerSecondRateUnit, getUnit } from 'autoQuery/units';\nimport { syncYAxis } from 'Breakdown/MetricLabelsList/behaviors/syncYAxis';\nimport { addUnspecifiedLabel } from 'Breakdown/MetricLabelsList/transformations/addUnspecifiedLabel';\nimport { GmdVizPanel, PANEL_HEIGHT, PANEL_TYPE, QUERY_RESOLUTION } from 'GmdVizPanel/GmdVizPanel';\nimport { getTimeseriesQueryRunnerParams } from 'GmdVizPanel/timeseries/getTimeseriesQueryRunnerParams';\nimport { PanelMenu } from 'Menu/PanelMenu';\nimport { trailDS } from 'shared';\nimport { getColorByIndex } from 'utils';\nimport { LayoutSwitcher, LayoutType, type LayoutSwitcherState } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { EventQuickSearchChanged } from 'WingmanDataTrail/ListControls/QuickSearch/EventQuickSearchChanged';\nimport { QuickSearch } from 'WingmanDataTrail/ListControls/QuickSearch/QuickSearch';\nimport { GRID_TEMPLATE_COLUMNS, GRID_TEMPLATE_ROWS } from 'WingmanDataTrail/MetricsList/MetricsList';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\n\nimport { AddToFiltersGraphAction } from './AddToFiltersGraphAction';\nimport { getLabelValueFromDataFrame } from './getLabelValueFromDataFrame';\nimport { LabelValuesCountsProvider } from './LabelValuesCountProvider';\nimport { LABEL_VALUE_VIZ_PANEL_HEIGHT, LabelValueVizPanel } from './LabelValueVizPanel';\nimport { SceneByFrameRepeater } from './SceneByFrameRepeater';\nimport { SortBySelector, type SortBySelectorState } from './SortBySelector';\n\ninterface MetricLabelsValuesListState extends SceneObjectState {\n  metric: string;\n  label: string;\n  layoutSwitcher: LayoutSwitcher;\n  quickSearch: QuickSearch;\n  sortBySelector: SortBySelector;\n  body?: SceneByFrameRepeater | GmdVizPanel;\n}\n\nexport class MetricLabelValuesList extends SceneObjectBase<MetricLabelsValuesListState> {\n  constructor({\n    metric,\n    label,\n  }: {\n    metric: MetricLabelsValuesListState['metric'];\n    label: MetricLabelsValuesListState['label'];\n  }) {\n    super({\n      key: 'metric-label-values-list',\n      metric,\n      label,\n      layoutSwitcher: new LayoutSwitcher({\n        urlSearchParamName: 'breakdownLayout',\n        options: [\n          { label: 'Single', value: LayoutType.SINGLE },\n          { label: 'Grid', value: LayoutType.GRID },\n          { label: 'Rows', value: LayoutType.ROWS },\n        ],\n      }),\n      quickSearch: new QuickSearch({\n        urlSearchParamName: 'breakdownSearchText',\n        targetName: 'label value',\n        countsProvider: new LabelValuesCountsProvider(),\n        displayCounts: true,\n      }),\n      sortBySelector: new SortBySelector({ target: 'labels' }),\n      body: undefined,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToLayoutChange();\n  }\n\n  private subscribeToQuickSearchChange() {\n    // We ensure the proper quick search value when landing on the page:\n    // because MetricLabelValuesList is created dynamically when LabelBreakdownScene updates its body,\n    // QuickSearch is not properly connected to the URL synchronization system\n    sceneUtils.syncStateFromSearchParams(this.state.quickSearch, new URLSearchParams(window.location.search));\n\n    this._subs.add(\n      this.subscribeToEvent(EventQuickSearchChanged, (event) => {\n        const byFrameRepeater = sceneGraph.findDescendents(this, SceneByFrameRepeater)[0];\n        if (byFrameRepeater) {\n          byFrameRepeater.filter(event.payload.searchText);\n        }\n      })\n    );\n  }\n\n  private subscribeToSortByChange() {\n    const { sortBySelector } = this.state;\n\n    this._subs.add(\n      sortBySelector.subscribeToState((newState: SortBySelectorState, prevState?: SortBySelectorState) => {\n        if (newState.value.value !== prevState?.value.value) {\n          const byFrameRepeater = sceneGraph.findDescendents(this, SceneByFrameRepeater)[0];\n          if (byFrameRepeater) {\n            byFrameRepeater.sort(newState.value.value);\n          }\n        }\n      })\n    );\n  }\n\n  private subscribeToLayoutChange() {\n    const { layoutSwitcher } = this.state;\n\n    // We ensure the proper layout when landing on the page:\n    // because MetricLabelValuesList is created dynamically when LabelBreakdownScene updates its body,\n    // LayoutSwitcher is not properly connected to the URL synchronization system\n    sceneUtils.syncStateFromSearchParams(layoutSwitcher, new URLSearchParams(window.location.search));\n\n    const onChangeState = (newState: LayoutSwitcherState, prevState?: LayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        this.updateBody(newState.layout);\n      }\n    };\n\n    onChangeState(layoutSwitcher.state);\n\n    this._subs.add(layoutSwitcher.subscribeToState(onChangeState));\n  }\n\n  private updateBody(layout: LayoutType) {\n    if (layout === LayoutType.SINGLE) {\n      this.setState({ body: this.buildSinglePanel() });\n      return;\n    }\n\n    const existingByFrameRepeater = sceneGraph.findDescendents(this, SceneByFrameRepeater)[0];\n    const byFrameRepeater = existingByFrameRepeater || this.buildByFrameRepeater();\n\n    (byFrameRepeater.state.body as SceneCSSGridLayout).setState({\n      templateColumns: layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n    });\n\n    this.setState({ body: byFrameRepeater });\n\n    if (!existingByFrameRepeater) {\n      // we have to re-subscribe every time we build a new SceneByFrameRepeater instance because these controls (QuickSerach and SortBy) are not rendered when switching to the \"Single\" layout\n      this.subscribeToQuickSearchChange();\n      this.subscribeToSortByChange();\n    }\n  }\n\n  private buildSinglePanel() {\n    const { metric, label } = this.state;\n\n    return new GmdVizPanel({\n      metric,\n      panelType: PANEL_TYPE.TIMESERIES,\n      height: PANEL_HEIGHT.XL,\n      headerActions: () => [],\n      groupBy: label,\n    });\n  }\n\n  private buildByFrameRepeater() {\n    const { metric, label } = this.state;\n    const queryParams = getTimeseriesQueryRunnerParams({\n      metric,\n      matchers: [],\n      groupBy: label,\n      queryResolution: QUERY_RESOLUTION.MEDIUM,\n      addIgnoreUsageFilter: true,\n    });\n    const unit = queryParams.isRateQuery ? getPerSecondRateUnit(metric) : getUnit(metric);\n\n    return new SceneByFrameRepeater({\n      $data: new SceneDataTransformer({\n        $data: new SceneQueryRunner({\n          datasource: trailDS,\n          maxDataPoints: queryParams.maxDataPoints,\n          queries: queryParams.queries,\n        }),\n        transformations: [addUnspecifiedLabel(label)],\n      }),\n      // we set the syncYAxis behavior here to ensure that the EventResetSyncYAxis events that are published by SceneByFrameRepeater can be received\n      $behaviors: [\n        syncYAxis(),\n        new behaviors.CursorSync({\n          key: 'metricCrosshairSync',\n          sync: DashboardCursorSync.Crosshair,\n        }),\n      ],\n      body: new SceneCSSGridLayout({\n        children: [],\n        isLazy: true,\n        templateColumns: GRID_TEMPLATE_COLUMNS,\n        autoRows: LABEL_VALUE_VIZ_PANEL_HEIGHT,\n      }),\n      getLayoutLoading: () =>\n        new SceneReactObject({\n          reactNode: <Spinner inline />,\n        }),\n      getLayoutEmpty: () =>\n        new SceneReactObject({\n          reactNode: (\n            <InlineBanner title=\"\" severity=\"info\">\n              No label values found for the current filters and time range.\n            </InlineBanner>\n          ),\n        }),\n      getLayoutError: (data: PanelData) =>\n        new SceneReactObject({\n          reactNode: (\n            <InlineBanner severity=\"error\" title=\"Error while loading metrics!\" error={data.errors![0] as Error} />\n          ),\n        }),\n      getLayoutChild: (data: PanelData, frame: DataFrame, frameIndex: number) => {\n        // hide frames that have less than 2 points\n        if (frame.length < 2) {\n          return null;\n        }\n\n        const labelValue = getLabelValueFromDataFrame(frame);\n        const canAddToFilters = !labelValue.startsWith('<unspecified'); // see the \"addUnspecifiedLabel\" data transformation\n        const headerActions = canAddToFilters ? [new AddToFiltersGraphAction({ labelName: label, labelValue })] : [];\n\n        const vizPanel = new LabelValueVizPanel({\n          labelValue,\n          data: new SceneDataNode({ data: { ...data, series: [frame] } }),\n          unit,\n          fixedColor: getColorByIndex(frameIndex),\n          headerActions,\n          menu: new PanelMenu({ labelName: labelValue }),\n        });\n\n        return new SceneCSSGridItem({ body: vizPanel });\n      },\n    });\n  }\n\n  public Controls({ model }: { model: MetricLabelValuesList }) {\n    const styles = useStyles2(getStyles); // eslint-disable-line react-hooks/rules-of-hooks\n    const { body, quickSearch, layoutSwitcher, sortBySelector } = model.useState();\n\n    return (\n      <>\n        {body instanceof SceneByFrameRepeater && (\n          <>\n            <Field className={styles.quickSearchField} label=\"Search\">\n              <quickSearch.Component model={quickSearch} />\n            </Field>\n            <sortBySelector.Component model={sortBySelector} />\n          </>\n        )}\n        <Field label=\"View\">\n          <layoutSwitcher.Component model={layoutSwitcher} />\n        </Field>\n      </>\n    );\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricLabelValuesList>) => {\n    const { body } = model.useState();\n\n    return (\n      <>\n        {body instanceof GmdVizPanel && <MetricLabelValuesList.SingleMetricPanelComponent model={model} />}\n        {body instanceof SceneByFrameRepeater && <MetricLabelValuesList.ByFrameRepeaterComponent model={model} />}\n      </>\n    );\n  };\n\n  private static readonly SingleMetricPanelComponent = ({ model }: SceneComponentProps<MetricLabelValuesList>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n\n    return (\n      <div data-testid=\"single-metric-panel\">\n        <div className={styles.singlePanelContainer}>\n          {body instanceof GmdVizPanel && <body.Component model={body} />}\n        </div>\n      </div>\n    );\n  };\n\n  private static readonly ByFrameRepeaterComponent = ({ model }: SceneComponentProps<MetricLabelValuesList>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n\n    const dataProvider = sceneGraph.getData(model);\n    const { state, errors } = dataProvider.useState().data || {};\n\n    const byFrameRepeater = body as SceneByFrameRepeater;\n\n    const batchSizes = byFrameRepeater.useSizes();\n    const shouldDisplayShowMoreButton =\n      state !== LoadingState.Loading &&\n      !errors?.length &&\n      batchSizes.total > 0 &&\n      batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      byFrameRepeater.increaseBatchSize();\n    };\n\n    return (\n      <div data-testid=\"label-values-list\">\n        <div className={styles.listContainer}>\n          {body instanceof SceneByFrameRepeater && <body.Component model={body} />}\n        </div>\n        {shouldDisplayShowMoreButton && (\n          <div className={styles.listFooter}>\n            <ShowMoreButton label=\"label value\" batchSizes={batchSizes} onClick={onClickShowMore} />\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    singlePanelContainer: css({\n      width: '100%',\n      height: '300px',\n    }),\n    listContainer: css({ width: '100%' }),\n    listFooter: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginTop: theme.spacing(4),\n\n      '& button': {\n        height: '40px',\n        borderRadius: '8px',\n      },\n    }),\n    quickSearchField: css({\n      flexGrow: 1,\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  type QueryVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Field, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { RefreshMetricsEvent, VAR_GROUP_BY } from '../shared';\nimport { isQueryVariable } from '../utils/utils.variables';\nimport { MetricLabelsList } from './MetricLabelsList/MetricLabelsList';\nimport { MetricLabelValuesList } from './MetricLabelValuesList/MetricLabelValuesList';\n\nexport interface LabelBreakdownSceneState extends SceneObjectState {\n  metric: string;\n  body?: MetricLabelsList | MetricLabelValuesList;\n}\n\nexport class LabelBreakdownScene extends SceneObjectBase<LabelBreakdownSceneState> {\n  constructor({ metric }: { metric: LabelBreakdownSceneState['metric'] }) {\n    super({\n      metric,\n      body: undefined,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const groupByVariable = this.getVariable();\n\n    groupByVariable.subscribeToState((newState, oldState) => {\n      if (newState.value !== oldState.value) {\n        this.updateBody(groupByVariable);\n      }\n    });\n\n    if (config.featureToggles.enableScopesInMetricsExplore) {\n      this._subs.add(\n        this.subscribeToEvent(RefreshMetricsEvent, () => {\n          this.updateBody(groupByVariable);\n        })\n      );\n    }\n\n    this.updateBody(groupByVariable);\n  }\n\n  private getVariable(): QueryVariable {\n    const groupByVariable = sceneGraph.lookupVariable(VAR_GROUP_BY, this)!;\n    if (!isQueryVariable(groupByVariable)) {\n      throw new Error('Group by variable not found');\n    }\n    return groupByVariable;\n  }\n\n  private updateBody(groupByVariable: QueryVariable) {\n    const { metric } = this.state;\n\n    this.setState({\n      body: groupByVariable.hasAllValue()\n        ? new MetricLabelsList({ metric })\n        : new MetricLabelValuesList({ metric, label: groupByVariable.state.value as string }),\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<LabelBreakdownScene>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n    const groupByVariable = model.getVariable();\n\n    return (\n      <div className={styles.container}>\n        <div className={styles.controls}>\n          <Field label=\"By label\">\n            <groupByVariable.Component model={groupByVariable} />\n          </Field>\n          {body instanceof MetricLabelsList && <body.Controls model={body} />}\n          {body instanceof MetricLabelValuesList && <body.Controls model={body} />}\n        </div>\n        <div data-testid=\"panels-list\">\n          {body instanceof MetricLabelsList && <body.Component model={body} />}\n          {body instanceof MetricLabelValuesList && <body.Component model={body} />}\n        </div>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n      paddingTop: theme.spacing(1),\n    }),\n    controls: css({\n      flexGrow: 0,\n      display: 'flex',\n      gap: theme.spacing(2),\n      height: '70px',\n      justifyContent: 'space-between',\n      alignItems: 'end',\n    }),\n    searchField: css({\n      flexGrow: 1,\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  getExploreURL,\n  sceneGraph,\n  SceneObjectBase,\n  SceneQueryRunner,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Box, Icon, LinkButton, Stack, Tab, TabsBar, ToolbarButton, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { UI_TEXT } from 'constants/ui';\nimport { createAppUrl } from 'extensions/links';\nimport { GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { reportExploreMetrics } from 'interactions';\nimport { TOPVIEW_KEY } from 'MetricGraphScene';\nimport { MetricScene } from 'MetricScene';\nimport { RelatedMetricsScene } from 'RelatedMetricsScene/RelatedMetricsScene';\nimport { MetricSelectedEvent } from 'shared';\nimport { ShareTrailButton } from 'ShareTrailButton';\nimport { useBookmarkState } from 'TrailStore/useBookmarkState';\nimport { getTrailFor, getUrlForTrail } from 'utils';\n\nimport { LabelBreakdownScene } from './Breakdown/LabelBreakdownScene';\n\nexport const actionViews = {\n  breakdown: 'breakdown',\n  related: 'related',\n  relatedLogs: 'logs',\n} as const;\n\nexport type ActionViewType = (typeof actionViews)[keyof typeof actionViews];\n\ninterface ActionViewDefinition {\n  displayName: string;\n  value: ActionViewType;\n  description?: string;\n  getScene: (metricScene: MetricScene) => SceneObject<SceneObjectState>;\n}\n\nexport const actionViewsDefinitions: ActionViewDefinition[] = [\n  {\n    displayName: 'Breakdown',\n    value: actionViews.breakdown,\n    getScene: (metricScene: MetricScene) => new LabelBreakdownScene({ metric: metricScene.state.metric }),\n  },\n  {\n    displayName: 'Related metrics',\n    value: actionViews.related,\n    getScene: (metricScene: MetricScene) => new RelatedMetricsScene({ metric: metricScene.state.metric }),\n    description: 'Relevant metrics based on current label filters',\n  },\n  {\n    displayName: 'Related logs',\n    value: actionViews.relatedLogs,\n    getScene: (metricScene: MetricScene) => metricScene.createRelatedLogsScene(),\n    description: 'Relevant logs based on current label filters and time range',\n  },\n];\n\ninterface MetricActionBarState extends SceneObjectState {}\n\nexport class MetricActionBar extends SceneObjectBase<MetricActionBarState> {\n  public getLinkToExplore = async () => {\n    const topView = sceneGraph.findByKey(this, TOPVIEW_KEY);\n    const vizPanel = sceneGraph.findDescendents(topView, GmdVizPanel)[0];\n    const queryRunner = sceneGraph.findDescendents(vizPanel, SceneQueryRunner)[0];\n    const panelData = queryRunner.state.data;\n\n    if (!panelData) {\n      throw new Error('Cannot get link to explore, no panel data found');\n    }\n\n    const metricScene = sceneGraph.getAncestor(this, MetricScene);\n    return getExploreURL(panelData, metricScene, panelData.timeRange);\n  };\n\n  public openExploreLink = async () => {\n    reportExploreMetrics('selected_metric_action_clicked', { action: 'open_in_explore' });\n    this.getLinkToExplore().then((link) => {\n      // We use window.open instead of a Link or <a> because we want to compute the explore link when clicking,\n      // if we precompute it we have to keep track of a lot of dependencies\n      window.open(link, '_blank');\n    });\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricActionBar>) => {\n    const metricScene = sceneGraph.getAncestor(model, MetricScene);\n    const styles = useStyles2(getStyles);\n    const trail = getTrailFor(model);\n    const [isBookmarked, toggleBookmark] = useBookmarkState(trail);\n    const { actionView } = metricScene.useState();\n\n    return (\n      <Box paddingY={1} data-testid=\"action-bar\">\n        <div className={styles.actions}>\n          <Stack gap={1}>\n            {trail.state.embedded ? (\n              <LinkButton\n                href={createAppUrl(getUrlForTrail(trail))}\n                variant={'secondary'}\n                icon=\"arrow-right\"\n                tooltip=\"Open in Metrics Drilldown\"\n                onClick={() => reportExploreMetrics('selected_metric_action_clicked', { action: 'open_from_embedded' })}\n              >\n                Metrics Drilldown\n              </LinkButton>\n            ) : (\n              <ToolbarButton\n                variant={'canvas'}\n                tooltip={UI_TEXT.METRIC_SELECT_SCENE.SELECT_NEW_METRIC_TOOLTIP}\n                onClick={() => {\n                  reportExploreMetrics('selected_metric_action_clicked', { action: 'unselect' });\n                  trail.publishEvent(new MetricSelectedEvent(undefined));\n                }}\n              >\n                Select new metric\n              </ToolbarButton>\n            )}\n            <ToolbarButton\n              variant={'canvas'}\n              icon=\"compass\"\n              tooltip={UI_TEXT.METRIC_SELECT_SCENE.OPEN_EXPLORE_LABEL}\n              onClick={model.openExploreLink}\n            />\n            <ShareTrailButton trail={trail} />\n            <ToolbarButton\n              variant={'canvas'}\n              icon={\n                isBookmarked ? (\n                  <Icon name={'favorite'} type={'mono'} size={'lg'} />\n                ) : (\n                  <Icon name={'star'} type={'default'} size={'lg'} />\n                )\n              }\n              tooltip={UI_TEXT.METRIC_SELECT_SCENE.BOOKMARK_LABEL}\n              onClick={toggleBookmark}\n            />\n          </Stack>\n        </div>\n\n        <TabsBar className={styles.customTabsBar}>\n          {actionViewsDefinitions.map((tab, index) => {\n            const label = tab.displayName;\n            const counter = tab.value === actionViews.relatedLogs ? metricScene.state.relatedLogsCount : undefined;\n            const isActive = actionView === tab.value;\n\n            const tabRender = (\n              <Tab\n                key={index}\n                label={label}\n                counter={counter}\n                active={isActive}\n                onChangeTab={() => {\n                  if (isActive) {\n                    return;\n                  }\n\n                  reportExploreMetrics('metric_action_view_changed', {\n                    view: tab.value,\n                    related_logs_count: metricScene.relatedLogsOrchestrator.checkConditionsMetForRelatedLogs()\n                      ? counter\n                      : undefined,\n                  });\n\n                  metricScene.setActionView(tab.value);\n                }}\n              />\n            );\n\n            if (tab.description) {\n              return (\n                <Tooltip key={index} content={tab.description} placement=\"top\" theme=\"info\">\n                  {tabRender}\n                </Tooltip>\n              );\n            }\n            return tabRender;\n          })}\n        </TabsBar>\n      </Box>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    actions: css({\n      [theme.breakpoints.up(theme.breakpoints.values.md)]: {\n        position: 'absolute',\n        right: 0,\n        top: 16,\n        zIndex: 2,\n      },\n    }),\n    customTabsBar: css({\n      paddingBottom: theme.spacing(1),\n    }),\n  };\n}\n","import { SceneObjectStateChangedEvent } from '@grafana/scenes';\nimport { useEffect, useState } from 'react';\n\nimport { type DataTrail } from '../DataTrail';\nimport { reportExploreMetrics } from '../interactions';\nimport { getTrailStore } from './TrailStore';\n\nexport function useBookmarkState(trail: DataTrail) {\n  // Note that trail object may stay the same, but the state used by `getBookmarkIndex` result may\n  // differ for each re-render of this hook\n  const getBookmarkIndex = () => getTrailStore().getBookmarkIndex(trail);\n\n  const indexOnRender = getBookmarkIndex();\n\n  const [bookmarkIndex, setBookmarkIndex] = useState(indexOnRender);\n\n  useEffect(() => {\n    const sub = trail.subscribeToEvent(SceneObjectStateChangedEvent, () => {\n      setBookmarkIndex(getTrailStore().getBookmarkIndex(trail));\n    });\n    return () => sub.unsubscribe();\n  }, [trail]);\n\n  // Check if index changed and force a re-render\n  if (indexOnRender !== bookmarkIndex) {\n    setBookmarkIndex(indexOnRender);\n  }\n\n  const isBookmarked = bookmarkIndex != null;\n\n  const toggleBookmark = () => {\n    reportExploreMetrics('bookmark_changed', { action: isBookmarked ? 'toggled_off' : 'toggled_on' });\n    if (isBookmarked) {\n      let indexToRemove = getBookmarkIndex();\n      while (indexToRemove != null) {\n        // This loop will remove all indices that have an equivalent bookmark key\n        getTrailStore().removeBookmark(indexToRemove);\n        indexToRemove = getBookmarkIndex();\n      }\n    } else {\n      getTrailStore().addBookmark(trail);\n    }\n    setBookmarkIndex(getBookmarkIndex());\n  };\n\n  const result: [typeof isBookmarked, typeof toggleBookmark] = [isBookmarked, toggleBookmark];\n  return result;\n}\n","import { VAR_FILTERS_EXPR, VAR_METRIC_EXPR } from '../../shared';\n\n// For usual non-utf8-metrics we use filters in the curly braces\n// metric_name{filter_label=\"filter_value\"}\nconst BASE_QUERY_TEMPLATE = `${VAR_METRIC_EXPR}{${VAR_FILTERS_EXPR}}`;\nconst RATE_BASE_QUERY_TEMPLATE = `rate(${BASE_QUERY_TEMPLATE}[$__rate_interval])`;\n\n// For utf8 metrics we need to put the metric name inside curly braces with filters\n// {\"utf8.metric\", filter_label=\"filter_val\"}\nconst BASE_QUERY_UTF8_METRIC_TEMPLATE = `{\"${VAR_METRIC_EXPR}\", ${VAR_FILTERS_EXPR}}`;\nconst RATE_BASE_QUERY_UTF8_METRIC_TEMPLATE = `rate(${BASE_QUERY_UTF8_METRIC_TEMPLATE}[$__rate_interval])`;\n\nexport function generateBaseQuery({\n  isRateQuery = false,\n  groupings = [],\n  isUtf8Metric = false,\n}: {\n  isRateQuery?: boolean;\n  groupings?: string[];\n  isUtf8Metric?: boolean;\n}): string {\n  // Determine base query template\n  let baseQuery;\n\n  if (isUtf8Metric) {\n    baseQuery = isRateQuery ? RATE_BASE_QUERY_UTF8_METRIC_TEMPLATE : BASE_QUERY_UTF8_METRIC_TEMPLATE;\n  } else {\n    baseQuery = isRateQuery ? RATE_BASE_QUERY_TEMPLATE : BASE_QUERY_TEMPLATE;\n  }\n\n  // Apply groupings (e.g., `sum by(le, instance)`)\n  if (groupings.length > 0) {\n    return `sum by(${groupings.join(', ')}) (${baseQuery})`;\n  }\n\n  return `${baseQuery}`;\n}\n","import { PanelBuilders } from '@grafana/scenes';\nimport { SortOrder, TooltipDisplayMode } from '@grafana/schema';\nimport { HeatmapColorMode } from '@grafana/schema/dist/esm/raw/composable/heatmap/panelcfg/x/HeatmapPanelCfg_types.gen';\n\nexport type CommonVizParams = {\n  title: string;\n  unit: string;\n};\n\nexport function simpleGraphBuilder({ title, unit }: CommonVizParams) {\n  return PanelBuilders.timeseries() //\n    .setTitle(title)\n    .setUnit(unit)\n    .setOption('legend', { showLegend: false })\n    .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n    .setCustomFieldConfig('fillOpacity', 9);\n}\n\nexport function heatmapGraphBuilder({ title, unit }: CommonVizParams) {\n  return PanelBuilders.heatmap() //\n    .setTitle(title)\n    .setUnit(unit)\n    .setOption('calculate', false)\n    .setOption('color', {\n      mode: HeatmapColorMode.Scheme,\n      exponent: 0.5,\n      scheme: 'Spectral',\n      steps: 32,\n      reverse: false,\n    });\n}\n\nexport function percentilesGraphBuilder({ title, unit }: CommonVizParams) {\n  return PanelBuilders.timeseries()\n    .setTitle(title)\n    .setUnit(unit)\n    .setCustomFieldConfig('fillOpacity', 9)\n    .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n    .setOption('legend', { showLegend: false });\n}\n","import { VAR_GROUP_BY_EXP, VAR_METRIC_EXPR } from '../../shared';\nimport { simpleGraphBuilder } from '../graphBuilders';\nimport { type AutoQueryInfo } from '../types';\n\nexport type CommonQueryInfoParams = {\n  description: string;\n  mainQueryExpr: string;\n  breakdownQueryExpr: string;\n  unit: string;\n};\n\nexport function generateCommonAutoQueryInfo({\n  description,\n  mainQueryExpr,\n  breakdownQueryExpr,\n  unit,\n}: CommonQueryInfoParams): AutoQueryInfo {\n  const common = {\n    title: VAR_METRIC_EXPR,\n    unit,\n  };\n\n  const mainQuery = {\n    refId: 'A',\n    expr: mainQueryExpr,\n    legendFormat: description,\n    fromExploreMetrics: true,\n  };\n\n  const main = {\n    ...common,\n    title: description,\n    queries: [mainQuery],\n    variant: 'main',\n    vizBuilder: () => simpleGraphBuilder({ ...main }),\n  };\n\n  const preview = {\n    ...common,\n    queries: [{ ...mainQuery, legendFormat: description }],\n    vizBuilder: () => simpleGraphBuilder(preview),\n    variant: 'preview',\n  };\n\n  const breakdown = {\n    ...common,\n    queries: [\n      {\n        refId: 'A',\n        expr: breakdownQueryExpr,\n        legendFormat: `{{${VAR_GROUP_BY_EXP}}}`,\n        fromExploreMetrics: true,\n      },\n    ],\n    vizBuilder: () => simpleGraphBuilder(breakdown),\n    variant: 'breakdown',\n  };\n\n  return { preview, main, breakdown, variants: [] };\n}\n","import { VAR_GROUP_BY_EXP, VAR_METRIC_EXPR } from '../../shared';\nimport { type AutoQueryContext, type AutoQueryInfo } from '../types';\nimport { getPerSecondRateUnit, getUnit } from '../units';\nimport { generateBaseQuery } from './baseQuery';\nimport { generateCommonAutoQueryInfo } from './common';\n\nconst RATE_SUFFIXES = new Set(['count', 'total']);\nconst SPECIFIC_AGGREGATIONS_FOR_SUFFIX: Record<string, string> = {\n  count: 'sum',\n  total: 'sum',\n};\nconst aggLabels: Record<string, string> = {\n  avg: 'average',\n  sum: 'overall',\n};\n\nfunction getAggLabel(agg: string): string {\n  return aggLabels[agg] || agg;\n}\n\nexport function createDefaultMetricQueryDefs(context: AutoQueryContext): AutoQueryInfo {\n  const { metricParts, suffix, isUtf8Metric } = context;\n  const unitSuffix = suffix === 'total' ? metricParts.at(-2) : suffix;\n\n  // Determine query type and unit\n  const isRateQuery = RATE_SUFFIXES.has(suffix);\n  const aggregation = SPECIFIC_AGGREGATIONS_FOR_SUFFIX[suffix] || 'avg';\n  const unit = isRateQuery ? getPerSecondRateUnit(unitSuffix) : getUnit(unitSuffix);\n\n  // Generate base query and descriptions\n  const baseQuery = generateBaseQuery({ isRateQuery, isUtf8Metric });\n  const aggregationDescription = `${getAggLabel(aggregation)}${isRateQuery ? ' per-second rate' : ''}`;\n  const description = `${VAR_METRIC_EXPR} (${aggregationDescription})`;\n\n  // Create query expressions\n  const mainQueryExpr = `${aggregation}(${baseQuery})`;\n  const breakdownQueryExpr = `${aggregation}(${baseQuery})by(${VAR_GROUP_BY_EXP})`;\n\n  return generateCommonAutoQueryInfo({\n    description,\n    mainQueryExpr,\n    breakdownQueryExpr,\n    unit,\n  });\n}\n","import { VAR_GROUP_BY_EXP, VAR_METRIC_EXPR } from '../../shared';\nimport { heatmapGraphBuilder, percentilesGraphBuilder, simpleGraphBuilder } from '../graphBuilders';\nimport { type AutoQueryContext, type AutoQueryDef } from '../types';\nimport { generateBaseQuery } from './baseQuery';\n\nexport function createHistogramMetricQueryDefs(context: AutoQueryContext) {\n  const { unit, nativeHistogram } = context;\n\n  const common = {\n    title: VAR_METRIC_EXPR,\n    unit,\n  };\n\n  const p50: AutoQueryDef = {\n    ...common,\n    variant: 'p50',\n    queries: [percentileQuery(context, 50)],\n    vizBuilder: () => simpleGraphBuilder(p50),\n  };\n\n  const breakdown: AutoQueryDef = {\n    ...common,\n    variant: 'p50',\n    queries: [percentileQuery(context, 50, [VAR_GROUP_BY_EXP])],\n    vizBuilder: () => simpleGraphBuilder(breakdown),\n  };\n\n  const percentiles: AutoQueryDef = {\n    ...common,\n    variant: 'percentiles',\n    queries: [99, 90, 50].map((p) => percentileQuery(context, p)),\n    vizBuilder: () => percentilesGraphBuilder(percentiles),\n  };\n\n  const heatmap: AutoQueryDef = {\n    ...common,\n    variant: 'heatmap',\n    queries: [\n      {\n        refId: 'Heatmap',\n        expr: generateBaseQuery({\n          isRateQuery: true,\n          isUtf8Metric: context.isUtf8Metric,\n          groupings: nativeHistogram ? [] : ['le'],\n        }),\n        fromExploreMetrics: true,\n        format: 'heatmap',\n      },\n    ],\n    vizBuilder: () => heatmapGraphBuilder(heatmap),\n  };\n\n  return { preview: heatmap, main: heatmap, variants: [percentiles, heatmap], breakdown: breakdown };\n}\n\nfunction percentileQuery(context: AutoQueryContext, percentile: number, groupings: string[] = []) {\n  const percent = percentile / 100;\n\n  let legendFormat = `${percentile}th Percentile`;\n\n  // For the breakdown view, show the label value variable we are grouping by\n  if (groupings[0]) {\n    legendFormat = `{{${groupings[0]}}}`;\n  }\n\n  const query = generateBaseQuery({\n    isRateQuery: true,\n    isUtf8Metric: context.isUtf8Metric,\n    groupings: context.nativeHistogram ? [...groupings] : ['le', ...groupings],\n  });\n\n  return {\n    refId: `Percentile${percentile}`,\n    expr: `histogram_quantile(${percent}, ${query})`,\n    legendFormat,\n    fromExploreMetrics: true,\n  };\n}\n","import { VAR_GROUP_BY_EXP, VAR_METRIC_EXPR } from '../../shared';\nimport { type AutoQueryContext, type AutoQueryInfo } from '../types';\nimport { generateBaseQuery } from './baseQuery';\nimport { generateCommonAutoQueryInfo } from './common';\n\nexport function createSummaryMetricQueryDefs(context: AutoQueryContext): AutoQueryInfo {\n  const { metricParts, isUtf8Metric, unit } = context;\n  const subMetric = metricParts.slice(0, -1).join('_');\n  const description = `${subMetric} (average)`;\n  const baseQuery = generateBaseQuery({ isRateQuery: true, isUtf8Metric });\n  const mainQueryExpr = createMeanExpr(`sum(${baseQuery})`, subMetric);\n  const breakdownQueryExpr = createMeanExpr(`sum(${baseQuery})by(${VAR_GROUP_BY_EXP})`, subMetric);\n\n  return generateCommonAutoQueryInfo({\n    description,\n    mainQueryExpr,\n    breakdownQueryExpr,\n    unit,\n  });\n}\n\nfunction createMeanExpr(expr: string, subMetric: string): string {\n  const numerator = expr.replace(VAR_METRIC_EXPR, `${subMetric}_sum`);\n  const denominator = expr.replace(VAR_METRIC_EXPR, `${subMetric}_count`);\n  return `${numerator}/${denominator}`;\n}\n","import { isValidLegacyName } from '@grafana/prometheus';\n\nimport { createDefaultMetricQueryDefs } from './queryGenerators/default';\nimport { createHistogramMetricQueryDefs } from './queryGenerators/histogram';\nimport { createSummaryMetricQueryDefs } from './queryGenerators/summary';\nimport { type AutoQueryContext, type AutoQueryInfo } from './types';\nimport { getUnit } from './units';\n\nexport function getAutoQueriesForMetric(metric: string, nativeHistogram?: boolean): AutoQueryInfo {\n  const isUtf8Metric = !isValidLegacyName(metric);\n  const metricParts = metric.split('_');\n  const suffix = metricParts.at(-1);\n\n  // If the suffix is null or is in the set of unsupported suffixes, throw an error because the metric should be delegated to a different generator (summary or histogram)\n  if (suffix == null) {\n    throw new Error(`This function does not support a metric suffix of \"${suffix}\"`);\n  }\n\n  const unitSuffix = metricParts.at(-2);\n  const unit = getUnit(unitSuffix);\n  const ctx: AutoQueryContext = {\n    metricParts,\n    isUtf8Metric,\n    suffix,\n    unitSuffix,\n    unit,\n    nativeHistogram,\n  };\n\n  if (suffix === 'sum') {\n    return createSummaryMetricQueryDefs(ctx);\n  }\n\n  if (suffix === 'bucket' || nativeHistogram) {\n    return createHistogramMetricQueryDefs(ctx);\n  }\n\n  return createDefaultMetricQueryDefs(ctx);\n}\n","import { type AdHocVariableFilter, type TimeRange } from '@grafana/data';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { sceneGraph, type SceneObject } from '@grafana/scenes';\n\nimport { createMetricsLogsConnector, type FoundLokiDataSource } from './base';\nimport { VAR_FILTERS } from '../../shared';\nimport { getTrailFor } from '../../utils';\nimport { getDataSourceFetcher } from '../../utils/utils.datasource';\nimport { isAdHocFiltersVariable } from '../../utils/utils.variables';\n\nconst knownLabelNameDiscrepancies = {\n  job: 'service_name', // `service.name` is `job` in Mimir and `service_name` in Loki\n  instance: 'service_instance_id', // `service.instance.id` is `instance` in Mimir and `service_instance_id` in Loki\n} as const;\n\nfunction isLabelNameThatShouldBeReplaced(x: string): x is keyof typeof knownLabelNameDiscrepancies {\n  return x in knownLabelNameDiscrepancies;\n}\n\nfunction replaceKnownLabelNames(labelName: string): string {\n  if (isLabelNameThatShouldBeReplaced(labelName)) {\n    return knownLabelNameDiscrepancies[labelName];\n  }\n\n  return labelName;\n}\n\n/**\n * Checks if a Loki data source has labels matching the current filters\n */\nasync function hasMatchingLabels(datasourceUid: string, filters: AdHocVariableFilter[], timeRange?: TimeRange) {\n  const ds = await getDataSourceSrv().get(datasourceUid);\n\n  // Get all available label keys for this data source\n  const labelKeys = await ds.getTagKeys?.({\n    timeRange,\n    filters: filters.map(({ key, operator, value }) => ({\n      key: replaceKnownLabelNames(key),\n      operator,\n      value,\n    })),\n  });\n\n  if (!Array.isArray(labelKeys)) {\n    return false;\n  }\n\n  const availableLabels = new Set(labelKeys.map((key) => key.text));\n\n  // Early return if none of our filter labels exist in this data source\n  const mappedFilterLabels = filters.map((f) => replaceKnownLabelNames(f.key));\n  const hasRequiredLabels = mappedFilterLabels.every((label) => availableLabels.has(label));\n  if (!hasRequiredLabels) {\n    return false;\n  }\n\n  // Check if each filter's value exists for its label\n  const results = await Promise.all(\n    filters.map(async (filter) => {\n      const lokiLabelName = replaceKnownLabelNames(filter.key);\n      const values = await ds.getTagValues?.({\n        key: lokiLabelName,\n        timeRange,\n        filters,\n      });\n\n      if (!Array.isArray(values)) {\n        return false;\n      }\n\n      return values.some((v) => v.text === filter.value);\n    })\n  );\n\n  // If any of the filters have no matching values, return false\n  return results.every(Boolean);\n}\n\nexport const createLabelsCrossReferenceConnector = (scene: SceneObject) => {\n  // In this connector, conditions have been met for related logs when label filters have been applied\n  let conditionsMetForRelatedLogs = false;\n\n  return createMetricsLogsConnector({\n    name: 'labelsCrossReference',\n    checkConditionsMetForRelatedLogs: () => conditionsMetForRelatedLogs,\n    async getDataSources(): Promise<FoundLokiDataSource[]> {\n      const trail = getTrailFor(scene);\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, trail);\n\n      if (!isAdHocFiltersVariable(filtersVariable) || !filtersVariable.state.filters.length) {\n        conditionsMetForRelatedLogs = false;\n        return [];\n      }\n\n      conditionsMetForRelatedLogs = true;\n      const filters = filtersVariable.state.filters.map(({ key, operator, value }) => ({ key, operator, value }));\n\n      // Get current time range if available\n      const timeRange = scene.state.$timeRange?.state.value;\n\n      const lokiDataSources = await getDataSourceFetcher().getHealthyDataSources('loki');\n      const results = await Promise.all(\n        lokiDataSources.map(async ({ uid, name }) => {\n          const hasLabels = await hasMatchingLabels(uid, filters, timeRange);\n          return hasLabels ? { uid, name } : null;\n        })\n      );\n\n      return results.filter((ds): ds is FoundLokiDataSource => ds !== null);\n    },\n    getLokiQueryExpr(): string {\n      const trail = getTrailFor(scene);\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, trail);\n\n      if (!isAdHocFiltersVariable(filtersVariable) || !filtersVariable.state.filters.length) {\n        return '';\n      }\n\n      const labelValuePairs = filtersVariable.state.filters.map(\n        (filter) => `${replaceKnownLabelNames(filter.key)}${filter.operator}\"${filter.value}\"`\n      );\n\n      return `{${labelValuePairs.join(',')}}`; // e.g. `{environment=\"dev\",region=\"us-west-1\"}`\n    },\n  });\n};\n","import { type DataSourceInstanceSettings, type DataSourceJsonData } from '@grafana/data';\nimport { MetricExpr, parser, PipelineExpr, Selector } from '@grafana/lezer-logql';\nimport { getBackendSrv, type BackendSrvRequest, type FetchResponse } from '@grafana/runtime';\nimport { type SyntaxNode } from '@lezer/common';\nimport { lastValueFrom } from 'rxjs';\n\nimport { createMetricsLogsConnector, type FoundLokiDataSource } from './base';\nimport { logger } from '../../tracking/logger/logger';\nimport { getDataSourceFetcher } from '../../utils/utils.datasource';\n\nexport interface RecordingRuleGroup {\n  name: string;\n  rules: RecordingRule[];\n}\n\nexport interface RecordingRule {\n  name: string;\n  query: string;\n  type: 'recording' | 'alerting' | string;\n  labels?: Record<string, string>;\n}\n\nexport interface ExtractedRecordingRule extends RecordingRule {\n  datasource: FoundLokiDataSource;\n  hasMultipleOccurrences?: boolean;\n}\n\nexport interface ExtractedRecordingRules {\n  [dataSourceUID: string]: ExtractedRecordingRule[];\n}\n\n/**\n * Fetch Loki recording rule groups from the specified datasource.\n *\n * @param datasourceSettings - The settings of the datasource instance.\n * @returns A promise that resolves to an array of recording rule groups.\n */\nasync function fetchRecordingRuleGroups(datasourceSettings: DataSourceInstanceSettings<DataSourceJsonData>) {\n  const recordingRuleUrl = `api/prometheus/${datasourceSettings.uid}/api/v1/rules`;\n  const recordingRules: BackendSrvRequest = { url: recordingRuleUrl, showErrorAlert: false, showSuccessAlert: false };\n  const res = await lastValueFrom<\n    FetchResponse<{\n      data: { groups: RecordingRuleGroup[] };\n    }>\n  >(getBackendSrv().fetch(recordingRules));\n\n  if (!res.ok) {\n    logger.warn(`Failed to fetch recording rules from Loki data source: ${datasourceSettings.name}`);\n    return [];\n  }\n\n  return res.data.data.groups;\n}\n\n/**\n * Extract recording rules from the provided rule groups and associate them with the given data source.\n *\n * @param ruleGroups - An array of recording rule groups to extract rules from.\n * @param ds - The data source instance settings to associate with the extracted rules.\n * @returns An array of extracted recording rules, each associated with the provided data source.\n */\nexport function extractRecordingRulesFromRuleGroups(\n  ruleGroups: RecordingRuleGroup[],\n  ds: DataSourceInstanceSettings<DataSourceJsonData>\n): ExtractedRecordingRule[] {\n  if (ruleGroups.length === 0) {\n    return [];\n  }\n\n  // We only want to return the first matching rule when there are multiple rules with same name\n  const extractedRules = new Map<string, ExtractedRecordingRule>();\n  ruleGroups.forEach((rg) => {\n    rg.rules\n      .filter((r) => r.type === 'recording')\n      .forEach(({ type, name, query }) => {\n        const isExist = extractedRules.has(name);\n        if (isExist) {\n          // We already have the rule.\n          const existingRule = extractedRules.get(name);\n          if (existingRule) {\n            existingRule.hasMultipleOccurrences = true;\n            extractedRules.set(name, existingRule);\n          }\n        } else {\n          extractedRules.set(name, {\n            type,\n            name,\n            query,\n            datasource: {\n              name: ds.name,\n              uid: ds.uid,\n            },\n            hasMultipleOccurrences: false,\n          });\n        }\n      });\n  });\n\n  return Array.from(extractedRules.values());\n}\n\n/**\n * Retrieve an array of Loki data sources that contain recording rules with the specified metric name.\n *\n * @param metricName - The name of the metric to search for within the recording rules.\n * @param extractedRecordingRules - An object containing extracted recording rules, where each key is a string and the value is an array of recording rules.\n * @returns An array of `FoundLokiDataSource` objects that contain recording rules with the specified metric name.\n */\nexport function getDataSourcesWithRecordingRulesContainingMetric(\n  metricName: string,\n  extractedRecordingRules: ExtractedRecordingRules\n): FoundLokiDataSource[] {\n  const foundLokiDataSources: FoundLokiDataSource[] = [];\n  Object.values(extractedRecordingRules).forEach((recRules) => {\n    recRules\n      .filter((rr) => rr.name === metricName)\n      .forEach((rr) => {\n        foundLokiDataSources.push(rr.datasource);\n      });\n  });\n\n  return foundLokiDataSources;\n}\n\n/**\n * Generate a Loki query string for a related metric based on the provided metric name, data source ID,\n * and extracted recording rules.\n *\n * @param metricName - The name of the metric for which to generate the Loki query.\n * @param dataSourceUid - The UID of the data source containing the recording rules.\n * @param extractedRecordingRules - An object containing recording rules, indexed by data source UID.\n * @returns The generated Loki query string, or an empty string if the data source UID or metric name is not found.\n */\nexport function getLokiQueryForRelatedMetric(\n  metricName: string,\n  dataSourceUid: string,\n  extractedRecordingRules: ExtractedRecordingRules\n): string {\n  if (!dataSourceUid || !extractedRecordingRules[dataSourceUid]) {\n    return '';\n  }\n  const targetRule = extractedRecordingRules[dataSourceUid].find((rule) => rule.name === metricName);\n  if (!targetRule) {\n    return '';\n  }\n  const lokiQuery = getLogQueryFromMetricsQuery(targetRule.query);\n\n  return lokiQuery;\n}\n\n/**\n * Fetch and extract Loki recording rules from all Loki data sources.\n *\n * @returns {Promise<ExtractedRecordingRules>} A promise that resolves to an object containing\n * the extracted recording rules, keyed by data source UID.\n *\n * @throws Will log a warning if fetching or extracting rules fails for any data source.\n */\nexport async function fetchAndExtractLokiRecordingRules() {\n  const lokiDataSources = await getDataSourceFetcher().getHealthyDataSources('loki');\n  const extractedRecordingRules: ExtractedRecordingRules = {};\n  await Promise.all(\n    lokiDataSources.map(async (dataSource) => {\n      try {\n        const ruleGroups: RecordingRuleGroup[] = await fetchRecordingRuleGroups(dataSource);\n        const extractedRules = extractRecordingRulesFromRuleGroups(ruleGroups, dataSource);\n        extractedRecordingRules[dataSource.uid] = extractedRules;\n      } catch (err) {\n        logger.warn(err);\n      }\n    })\n  );\n\n  return extractedRecordingRules;\n}\n\nexport const createLokiRecordingRulesConnector = () => {\n  let lokiRecordingRules: ExtractedRecordingRules = {};\n\n  // In this connector, conditions have been met for related logs\n  // when we find at least one data source with recording rules\n  // containing the selected metric\n  let conditionsMetForRelatedLogs = false;\n\n  return createMetricsLogsConnector({\n    name: 'lokiRecordingRules',\n    checkConditionsMetForRelatedLogs: () => conditionsMetForRelatedLogs,\n    async getDataSources(selectedMetric: string): Promise<FoundLokiDataSource[]> {\n      lokiRecordingRules = await fetchAndExtractLokiRecordingRules();\n      const lokiDataSources = getDataSourcesWithRecordingRulesContainingMetric(selectedMetric, lokiRecordingRules);\n      conditionsMetForRelatedLogs = Boolean(lokiDataSources.length);\n\n      return lokiDataSources;\n    },\n    getLokiQueryExpr(selectedMetric: string, datasourceUid: string): string {\n      return getLokiQueryForRelatedMetric(selectedMetric, datasourceUid, lokiRecordingRules);\n    },\n  });\n};\n\n/**\n * Returns whether the given query is a logs query (not a metrics query)\n * A query that's at least 3 characters long and doesn't contain a MetricExpr node is considered a logs query\n */\nfunction isLogsQuery(query: string): boolean {\n  if (query.trim().length <= 2) {\n    return false;\n  }\n\n  let hasMetricExpr = false;\n  const tree = parser.parse(query);\n\n  tree.iterate({\n    enter: ({ type }): false | void => {\n      if (type.id === MetricExpr) {\n        hasMetricExpr = true;\n        return false;\n      }\n    },\n  });\n\n  return !hasMetricExpr;\n}\n\n/**\n * Gets a node of the specified type from a LogQL query string\n * Returns undefined if no node of that type is found\n */\nfunction getNodeFromQuery(query: string, nodeType: number): SyntaxNode | undefined {\n  let foundNode: SyntaxNode | undefined;\n  const tree = parser.parse(query);\n\n  tree.iterate({\n    enter: (node): false | void => {\n      if (node.type.id === nodeType) {\n        foundNode = node.node;\n        return false;\n      }\n    },\n  });\n\n  return foundNode;\n}\n\n/**\n * Extracts the underlying log query from a metrics query\n * For metrics queries, it returns the selector and pipeline parts\n * For logs queries, it returns the original query unchanged\n * Returns an empty string if no valid query can be extracted\n *\n * @example\n * // Returns '{foo=\"bar\"} |= \"error\"'\n * getLogQueryFromMetricsQuery('rate({foo=\"bar\"} |= \"error\"[5m])')\n *\n * // Returns '{foo=\"bar\"}'\n * getLogQueryFromMetricsQuery('sum(rate({foo=\"bar\"}[5m]))')\n *\n * // Returns original query unchanged\n * getLogQueryFromMetricsQuery('{foo=\"bar\"} |= \"error\"')\n */\nexport function getLogQueryFromMetricsQuery(query: string): string {\n  // If it's already a logs query, return as-is\n  if (isLogsQuery(query)) {\n    return query;\n  }\n\n  // Get the selector node which contains the log query matchers\n  const selectorNode = getNodeFromQuery(query, Selector);\n  if (!selectorNode) {\n    return '';\n  }\n\n  const selector = query.substring(selectorNode.from, selectorNode.to);\n\n  // Get the pipeline expression node if it exists (contains filters, parsers etc.)\n  const pipelineExprNode = getNodeFromQuery(query, PipelineExpr);\n  const pipelineExpr = pipelineExprNode ? query.substring(pipelineExprNode.from, pipelineExprNode.to) : '';\n\n  // Combine selector with pipeline expression if it exists\n  return `${selector} ${pipelineExpr}`.trim();\n}\n","import { LoadingState } from '@grafana/data';\nimport { SceneQueryRunner, type QueryRunnerState } from '@grafana/scenes';\n\nimport { type MetricsLogsConnector } from '../Integrations/logs/base';\nimport { createLabelsCrossReferenceConnector } from '../Integrations/logs/labelsCrossReference';\nimport { createLokiRecordingRulesConnector } from '../Integrations/logs/lokiRecordingRules';\nimport { type MetricScene } from '../MetricScene';\nimport pluginJson from '../plugin.json';\nimport { getDataSourceFetcher, type DataSource } from '../utils/utils.datasource';\n\n/**\n * Manager class that handles the orchestration of related logs functionality.\n * This centralizes logs-related logic that was previously spread across multiple components.\n */\nexport class RelatedLogsOrchestrator {\n  private readonly _logsConnectors: MetricsLogsConnector[];\n  private readonly _metricScene: MetricScene;\n  private readonly _dataSourceFetcher = getDataSourceFetcher();\n  private readonly _changeHandlers = {\n    lokiDataSources: [] as Array<(dataSources: DataSource[]) => void>,\n    relatedLogsCount: [] as Array<(count: number) => void>,\n  };\n  /**\n   * Internal state that powers public properties defined by getters and setters.\n   */\n  private readonly _internalState = {\n    relatedLogsCount: 0,\n    lokiDataSources: [] as DataSource[],\n  };\n\n  constructor(metricScene: MetricScene) {\n    this._metricScene = metricScene;\n    this._logsConnectors = [createLokiRecordingRulesConnector(), createLabelsCrossReferenceConnector(metricScene)];\n  }\n\n  get lokiDataSources() {\n    return this._internalState.lokiDataSources;\n  }\n\n  set lokiDataSources(dataSources: DataSource[]) {\n    const currentDataSourcesSignature = this._internalState.lokiDataSources.map((ds) => ds.uid).join(',');\n    const newDataSourcesSignature = dataSources.map((ds) => ds.uid).join(',');\n\n    if (currentDataSourcesSignature && currentDataSourcesSignature === newDataSourcesSignature) {\n      return;\n    }\n\n    this._internalState.lokiDataSources = dataSources;\n    this._changeHandlers.lokiDataSources.forEach((handler) => handler(this._internalState.lokiDataSources));\n  }\n\n  set relatedLogsCount(count: number) {\n    this._internalState.relatedLogsCount = count;\n    this._changeHandlers.relatedLogsCount.forEach((handler) => handler(this._internalState.relatedLogsCount));\n  }\n\n  /**\n   * Add a listener that will be called when the lokiDataSources change.\n   */\n  addLokiDataSourcesChangeHandler(handler: (dataSources: DataSource[]) => void) {\n    this._changeHandlers.lokiDataSources.push(handler);\n  }\n\n  /**\n   * Add a listener that will be called when the relatedLogsCount changes.\n   */\n  addRelatedLogsCountChangeHandler(handler: (count: number) => void) {\n    this._changeHandlers.relatedLogsCount.push(handler);\n  }\n\n  /**\n   * Called when filters change to re-check for logs in datasources.\n   */\n  public handleFiltersChange(): void {\n    if (!this.lokiDataSources) {\n      return;\n    }\n\n    // When filters change, we need to reset our state to trigger updates in listeners\n    // Setting to empty array (vs undefined) signals we're actively checking\n    this.lokiDataSources = [];\n    this.relatedLogsCount = 0;\n\n    // Check all available datasources for logs after filter changes\n    this.findAndCheckAllDatasources();\n  }\n\n  /**\n   * Find all available datasources and check them for logs.\n   * This is used when filters change to ensure we're checking all possible datasources.\n   */\n  public async findAndCheckAllDatasources(): Promise<void> {\n    // Get all available Loki datasources\n    const allLokiDatasources = await this._dataSourceFetcher.getHealthyDataSources('loki');\n\n    // Check all datasources for logs\n    if (allLokiDatasources.length > 0) {\n      this.checkLogsInDataSources(allLokiDatasources);\n    } else {\n      // No datasources available\n      this.lokiDataSources = [];\n      this.relatedLogsCount = 0;\n    }\n  }\n\n  /**\n   * Get the Loki queries for a given datasource.\n   */\n  public getLokiQueries(\n    datasourceUid: string,\n    maxLines = 100\n  ): Array<{ refId: string; expr: string; maxLines: number }> {\n    const { metric } = this._metricScene.state;\n    const queriesByConnector = this._logsConnectors.reduce<Record<string, string>>((acc, connector, idx) => {\n      const lokiExpr = connector.getLokiQueryExpr(metric, datasourceUid);\n      if (lokiExpr) {\n        acc[connector.name ?? `connector-${idx}`] = lokiExpr;\n      }\n      return acc;\n    }, {});\n\n    const queries = Object.keys(queriesByConnector).map((connectorName) => ({\n      refId: `RelatedLogs-${connectorName}`,\n      expr: queriesByConnector[connectorName],\n      maxLines,\n      supportingQueryType: pluginJson.id,\n    }));\n\n    return queries;\n  }\n\n  /**\n   * Check each datasource for logs, then update the datasources and relatedLogsCount accordingly.\n   */\n  private checkLogsInDataSources(datasources: DataSource[]): void {\n    // Check each datasource for logs\n    const datasourcesWithLogs: DataSource[] = [];\n    let totalLogsCount = 0;\n    let totalChecked = 0;\n\n    // If no datasources to check, update immediately\n    if (datasources.length === 0) {\n      this.lokiDataSources = [];\n      this.relatedLogsCount = 0;\n      return;\n    }\n\n    // Check each datasource for logs\n    datasources.forEach((datasource) => {\n      const queryRunner = new SceneQueryRunner({\n        datasource: { uid: datasource.uid },\n        queries: [],\n        key: `related_logs_check_${datasource.uid}`,\n      });\n\n      // Build and set queries\n      queryRunner.setState({\n        queries: this.getLokiQueries(datasource.uid),\n      });\n\n      // Subscribe to results\n      queryRunner.subscribeToState((state) => {\n        if (state.data?.state === LoadingState.Done) {\n          totalChecked++;\n\n          // Check if we found logs in this datasource\n          if (state.data?.series) {\n            const rowCount = this.countLogsLines(state);\n            if (rowCount > 0) {\n              // This datasource has logs\n              datasourcesWithLogs.push(datasource);\n              totalLogsCount += rowCount;\n            }\n          }\n\n          // When all datasources have been checked\n          if (totalChecked === datasources.length) {\n            // Update state with our findings\n            this.lokiDataSources = datasourcesWithLogs;\n            this.relatedLogsCount = totalLogsCount;\n          }\n        }\n      });\n\n      // Activate query\n      queryRunner.activate();\n    });\n  }\n\n  /**\n   * Returns true if any of the connectors have conditions met for related logs to be shown.\n   */\n  public checkConditionsMetForRelatedLogs(): boolean {\n    return this._logsConnectors.some((connector) => connector.checkConditionsMetForRelatedLogs());\n  }\n\n  /**\n   * Given the state of a query runner running a Loki query, count the number of log lines.\n   */\n  public countLogsLines(state: QueryRunnerState): number {\n    return state.data?.series.reduce((sum: number, frame) => sum + frame.length, 0) ?? 0;\n  }\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Alert, Stack, Text, TextLink, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nexport function NoRelatedLogs() {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <Stack direction=\"column\" gap={2}>\n      <Alert title=\"No related logs found\" severity=\"info\">\n        We couldn&apos;t find any logs related to the current metric with your selected filters.\n      </Alert>\n      <Text>\n        To find related logs, try the following:\n        <ul className={styles.list}>\n          <li>Adjust your label filters to include labels that exist in both the current metric and your logs</li>\n          <li>\n            Select a metric created by a{' '}\n            <TextLink external href=\"https://grafana.com/docs/loki/latest/alert/#recording-rules\">\n              Loki Recording Rule\n            </TextLink>\n          </li>\n          <li>Broaden the time range to include more data</li>\n        </ul>\n      </Text>\n      <Text variant=\"bodySmall\" color=\"secondary\">\n        Note: Related logs is an experimental feature.\n      </Text>\n    </Stack>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    list: css({\n      paddingLeft: theme.spacing(2),\n      marginTop: theme.spacing(1),\n    }),\n  };\n}\n","import { config, usePluginLinks } from '@grafana/runtime';\nimport { type SceneDataQuery, type SceneTimeRangeState } from '@grafana/scenes';\nimport { LinkButton } from '@grafana/ui';\nimport React, { useMemo } from 'react';\n\nimport { reportExploreMetrics } from '../interactions';\n\nconst extensionPointId = 'grafana-metricsdrilldown-app/open-in-logs-drilldown/v1';\n\nexport interface LogsDrilldownLinkContext {\n  targets: SceneDataQuery[];\n  timeRange?: SceneTimeRangeState;\n}\n\nexport function OpenInLogsDrilldownButton({ context }: Readonly<{ context: LogsDrilldownLinkContext }>) {\n  const memoizedContext = useMemo(() => context, [context]);\n  const { links, isLoading } = usePluginLinks({\n    extensionPointId,\n    limitPerPlugin: 1,\n    context: memoizedContext,\n  });\n  const logsDrilldownLink = useMemo(() => {\n    return links.find(({ pluginId }) => pluginId === 'grafana-lokiexplore-app');\n  }, [links]);\n\n  if (isLoading) {\n    return (\n      <LinkButton variant=\"secondary\" size=\"sm\" disabled>\n        Loading...\n      </LinkButton>\n    );\n  }\n\n  const logsDrilldownLinkExists = typeof logsDrilldownLink !== 'undefined';\n\n  return (\n    <LinkButton\n      href={\n        // We prefix with the appSubUrl for environments that don't host grafana at the root.\n        logsDrilldownLinkExists\n          ? `${config.appSubUrl}${logsDrilldownLink.path}`\n          : `${config.appSubUrl}/a/grafana-lokiexplore-app` // We fall back to the app's landing page if a link can't get generated using the supplied `context`\n      }\n      target=\"_blank\"\n      tooltip={\n        logsDrilldownLinkExists\n          ? 'Use the Logs Drilldown app to explore these logs'\n          : 'Navigate to the Logs Drilldown app'\n      }\n      variant=\"secondary\"\n      size=\"sm\"\n      onClick={() => reportExploreMetrics('related_logs_action_clicked', { action: 'open_logs_drilldown' })}\n    >\n      {logsDrilldownLinkExists ? 'Open in Logs Drilldown' : 'Open Logs Drilldown'}\n    </LinkButton>\n  );\n}\n","import { LoadingState } from '@grafana/data';\nimport {\n  CustomVariable,\n  PanelBuilders,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneQueryRunner,\n  SceneReactObject,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  VariableValueSelectors,\n  type QueryRunnerState,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneVariable,\n} from '@grafana/scenes';\nimport { Spinner, Stack } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from '../interactions';\nimport { VAR_FILTERS, VAR_LOGS_DATASOURCE, VAR_LOGS_DATASOURCE_EXPR } from '../shared';\nimport { NoRelatedLogs } from './NoRelatedLogsFound';\nimport { OpenInLogsDrilldownButton, type LogsDrilldownLinkContext } from './OpenInLogsDrilldownButton';\nimport { type RelatedLogsOrchestrator } from './RelatedLogsOrchestrator';\nimport { isCustomVariable } from '../utils/utils.variables';\n\ninterface RelatedLogsSceneProps {\n  orchestrator: RelatedLogsOrchestrator;\n}\n\nexport interface RelatedLogsSceneState extends SceneObjectState, RelatedLogsSceneProps {\n  loading: boolean;\n  controls: SceneObject[];\n  body: SceneCSSGridLayout;\n  logsDrilldownLinkContext: LogsDrilldownLinkContext;\n}\n\nconst LOGS_PANEL_CONTAINER_KEY = 'related_logs/logs_panel_container';\nconst RELATED_LOGS_QUERY_KEY = 'related_logs/logs_query';\n\nexport class RelatedLogsScene extends SceneObjectBase<RelatedLogsSceneState> {\n  private _queryRunner?: SceneQueryRunner;\n\n  constructor(props: RelatedLogsSceneProps) {\n    super({\n      loading: false,\n      controls: [],\n      body: new SceneCSSGridLayout({\n        templateColumns: '1fr',\n        autoRows: 'minmax(300px, 1fr)',\n        children: [\n          new SceneCSSGridItem({\n            key: LOGS_PANEL_CONTAINER_KEY,\n            body: undefined,\n          }),\n        ],\n      }),\n      orchestrator: props.orchestrator,\n      logsDrilldownLinkContext: {\n        targets: [],\n      },\n    });\n\n    this.addActivationHandler(() => {\n      this._onActivate();\n    });\n  }\n\n  private async _onActivate() {\n    // Register handler for future changes to lokiDataSources\n    this.state.orchestrator.addLokiDataSourcesChangeHandler(() => this.setupLogsPanel());\n\n    // If data sources have already been loaded, we don't need to fetch them again\n    if (!this.state.orchestrator.lokiDataSources.length) {\n      this.setState({ loading: true });\n      await this.state.orchestrator.findAndCheckAllDatasources();\n      this.setState({ loading: false });\n    } else {\n      this.setupLogsPanel();\n    }\n  }\n\n  private showNoLogsFound() {\n    const logsPanelContainer = sceneGraph.findByKeyAndType(this, LOGS_PANEL_CONTAINER_KEY, SceneCSSGridItem);\n    logsPanelContainer.setState({\n      body: new SceneReactObject({ component: NoRelatedLogs }),\n    });\n    this.setState({\n      controls: undefined,\n    });\n    this.state.orchestrator.relatedLogsCount = 0;\n  }\n\n  private _buildQueryRunner(): void {\n    this._queryRunner = new SceneQueryRunner({\n      datasource: { uid: VAR_LOGS_DATASOURCE_EXPR },\n      queries: [],\n      key: RELATED_LOGS_QUERY_KEY,\n    });\n    this._constructLogsDrilldownLinkContext(this._queryRunner.state);\n\n    // Set up subscription to query results\n    this._subs.add(\n      this._queryRunner.subscribeToState((state) => {\n        if (state.data?.state !== LoadingState.Done) {\n          // Only process completed query results\n          return;\n        }\n\n        const logLinesCount = this.state.orchestrator.countLogsLines(state);\n\n        if (logLinesCount === 0) {\n          // Show NoRelatedLogs if no logs found\n          this.showNoLogsFound();\n        }\n\n        this._constructLogsDrilldownLinkContext(state);\n      })\n    );\n  }\n\n  private setupLogsPanel(): void {\n    // Initialize query runner\n    this._buildQueryRunner();\n\n    // If no datasources can provide related logs given the current conditions, show the NoRelatedLogsScene\n    if (!this.state.orchestrator.lokiDataSources.length) {\n      this.showNoLogsFound();\n      return;\n    }\n\n    // Set up UI for logs panel\n    const logsPanelContainer = sceneGraph.findByKeyAndType(this, LOGS_PANEL_CONTAINER_KEY, SceneCSSGridItem);\n    logsPanelContainer.setState({\n      body: PanelBuilders.logs().setTitle('Logs').setData(this._queryRunner).build(),\n    });\n\n    // Set up variables for datasource selection\n    const logsDataSourceVariable = new CustomVariable({\n      name: VAR_LOGS_DATASOURCE,\n      label: 'Logs data source',\n      query: this.state.orchestrator.lokiDataSources.map((ds) => `${ds.name} : ${ds.uid}`).join(','),\n    });\n    this.setState({\n      $variables: new SceneVariableSet({ variables: [logsDataSourceVariable] }),\n      controls: [new VariableValueSelectors({ layout: 'vertical' })],\n    });\n    this._subs.add(\n      logsDataSourceVariable.subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          reportExploreMetrics('related_logs_action_clicked', { action: 'logs_data_source_changed' });\n        }\n      })\n    );\n\n    // Update Loki query\n    this.updateLokiQuery();\n  }\n\n  /**\n   * Construct the Logs Drilldown link context based on the query runner state\n   * @param state - The query runner state.\n   */\n  private _constructLogsDrilldownLinkContext(state: QueryRunnerState) {\n    const dsUid = (sceneGraph.lookupVariable(VAR_LOGS_DATASOURCE, this)?.getValue() ?? '') as string;\n    const queries = state.queries;\n    const targets: LogsDrilldownLinkContext['targets'] = [];\n\n    if (dsUid && queries.length) {\n      queries.forEach((query) => {\n        targets.push({\n          ...query,\n          datasource: {\n            uid: dsUid,\n            type: 'loki',\n          },\n        });\n      });\n    }\n\n    this.setState({\n      logsDrilldownLinkContext: { targets, timeRange: sceneGraph.getTimeRange(this).state },\n    });\n  }\n\n  /**\n   * Updates the Loki query based on the configured connectors, selected datasource, and current filters.\n   * This function is called when the selected datasource or filters change.\n   */\n  private updateLokiQuery() {\n    if (!this._queryRunner) {\n      return;\n    }\n\n    const selectedDatasourceVar = sceneGraph.lookupVariable(VAR_LOGS_DATASOURCE, this);\n\n    let selectedDatasourceUid: string | undefined = undefined;\n\n    if (isCustomVariable(selectedDatasourceVar)) {\n      selectedDatasourceUid = selectedDatasourceVar.getValue() as string;\n    }\n\n    if (!selectedDatasourceUid) {\n      return;\n    }\n\n    const queries = this.state.orchestrator.getLokiQueries(selectedDatasourceUid);\n\n    // If no queries were generated, show the NoRelatedLogsScene\n    if (queries.length === 0) {\n      this.showNoLogsFound();\n      return;\n    }\n\n    // Update queries - this will trigger the query runner to fetch new data\n    // The query results will be processed in the subscription handler\n    this._queryRunner.setState({ queries });\n  }\n\n  // Handle variable changes\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_LOGS_DATASOURCE, VAR_FILTERS],\n    onReferencedVariableValueChanged: (variable: SceneVariable) => {\n      if (variable.state.name === VAR_FILTERS) {\n        this.state.orchestrator.handleFiltersChange();\n      } else if (variable.state.name === VAR_LOGS_DATASOURCE) {\n        this.updateLokiQuery();\n      }\n    },\n  });\n\n  static readonly Component = ({ model }: SceneComponentProps<RelatedLogsScene>) => {\n    const { controls, body, logsDrilldownLinkContext, loading } = model.useState();\n\n    if (loading) {\n      return <Spinner />;\n    }\n\n    return (\n      <Stack gap={1} direction={'column'} grow={1}>\n        <Stack gap={1} direction={'row'} justifyContent={'space-between'} alignItems={'start'}>\n          <Stack gap={1}>\n            {controls?.map((control) => (\n              <control.Component key={control.state.key} model={control} />\n            ))}\n          </Stack>\n          <OpenInLogsDrilldownButton context={logsDrilldownLinkContext} />\n        </Stack>\n        <body.Component model={body} />\n      </Stack>\n    );\n  };\n}\n","import { css } from '@emotion/css';\nimport { config } from '@grafana/runtime';\nimport {\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { GroupByVariable } from 'Breakdown/GroupByVariable';\nimport { actionViews, actionViewsDefinitions, type ActionViewType } from 'MetricActionBar';\n\nimport { getAutoQueriesForMetric } from './autoQuery/getAutoQueriesForMetric';\nimport { type AutoQueryDef, type AutoQueryInfo } from './autoQuery/types';\nimport { MetricGraphScene } from './MetricGraphScene';\nimport { RelatedLogsOrchestrator } from './RelatedLogs/RelatedLogsOrchestrator';\nimport { RelatedLogsScene } from './RelatedLogs/RelatedLogsScene';\nimport { getVariablesWithMetricConstant, RefreshMetricsEvent, VAR_FILTERS, type MakeOptional } from './shared';\n\nexport interface MetricSceneState extends SceneObjectState {\n  body: MetricGraphScene;\n  metric: string;\n  autoQuery: AutoQueryInfo;\n  nativeHistogram?: boolean;\n  actionView?: ActionViewType;\n  queryDef?: AutoQueryDef;\n  relatedLogsCount?: number;\n}\n\nexport class MetricScene extends SceneObjectBase<MetricSceneState> {\n  public readonly relatedLogsOrchestrator = new RelatedLogsOrchestrator(this);\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['actionView'] });\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_FILTERS],\n    onReferencedVariableValueChanged: () => {\n      // When filters change, we need to re-check for related logs\n\n      this.relatedLogsOrchestrator.handleFiltersChange();\n    },\n  });\n\n  public constructor(state: MakeOptional<MetricSceneState, 'body' | 'autoQuery'>) {\n    const autoQuery = state.autoQuery ?? getAutoQueriesForMetric(state.metric, state.nativeHistogram);\n    super({\n      $variables: state.$variables ?? getVariableSet(state.metric),\n      body: state.body ?? new MetricGraphScene({ metric: state.metric }),\n      autoQuery,\n      queryDef: state.queryDef ?? autoQuery.main,\n      ...state,\n    });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _onActivate() {\n    if (this.state.actionView === undefined) {\n      this.setActionView(actionViews.breakdown);\n    }\n\n    this.relatedLogsOrchestrator.findAndCheckAllDatasources();\n    this.relatedLogsOrchestrator.addRelatedLogsCountChangeHandler((count) => {\n      this.setState({ relatedLogsCount: count });\n    });\n\n    if (config.featureToggles.enableScopesInMetricsExplore) {\n      // Push the scopes change event to the tabs\n      // The event is not propagated because the tabs are not part of the scene graph\n      this._subs.add(\n        this.subscribeToEvent(RefreshMetricsEvent, (event) => {\n          this.state.body.state.selectedTab?.publishEvent(event);\n        })\n      );\n    }\n  }\n\n  getUrlState() {\n    return { actionView: this.state.actionView };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    if (typeof values.actionView === 'string') {\n      if (this.state.actionView !== values.actionView) {\n        const actionViewDef = actionViewsDefinitions.find((v) => v.value === values.actionView);\n        if (actionViewDef) {\n          this.setActionView(actionViewDef.value);\n        }\n      }\n    } else if (values.actionView === null) {\n      this.setActionView(null);\n    }\n  }\n\n  public setActionView(actionViewType: ActionViewType | null) {\n    const { body } = this.state;\n    const actionViewDef = actionViewType ? actionViewsDefinitions.find((v) => v.value === actionViewType) : null;\n\n    if (actionViewDef && actionViewDef.value !== this.state.actionView) {\n      body.setState({ selectedTab: actionViewDef.getScene(this) });\n      this.setState({ actionView: actionViewDef.value });\n    } else {\n      body.setState({ selectedTab: undefined });\n      this.setState({ actionView: undefined });\n    }\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<MetricScene>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container} data-testid=\"metric-scene\">\n        <body.Component model={body} />\n      </div>\n    );\n  };\n\n  public createRelatedLogsScene(): SceneObject<SceneObjectState> {\n    return new RelatedLogsScene({\n      orchestrator: this.relatedLogsOrchestrator,\n    });\n  }\n}\n\nfunction getVariableSet(metric: string) {\n  return new SceneVariableSet({\n    variables: [...getVariablesWithMetricConstant(metric), new GroupByVariable()],\n  });\n}\n\nconst getStyles = () => ({\n  container: css({\n    position: 'relative',\n    height: '100%',\n    width: '100%',\n    // Ensure proper flex behavior for sticky positioning\n    display: 'flex',\n    flexDirection: 'column',\n  }),\n});\n","import { locationService } from '@grafana/runtime';\nimport { createContext, useEffect, useState } from 'react';\n\nimport { type DataTrail } from 'DataTrail';\nimport { getUrlForTrail, newMetricsTrail } from 'utils';\n\nimport { navigationEvents } from '../WingmanDataTrail/SideBar/sections/BookmarksList';\n\ninterface MetricsAppContext {\n  trail: DataTrail;\n  goToUrlForTrail: (trail: DataTrail) => void;\n}\n\nexport const MetricsContext = createContext<MetricsAppContext>({\n  trail: newMetricsTrail(),\n  goToUrlForTrail: () => {},\n});\n\nexport function useTrail() {\n  const [trail, setTrail] = useState<DataTrail>(newMetricsTrail());\n\n  const goToUrlForTrail = (trail: DataTrail) => {\n    locationService.push(getUrlForTrail(trail));\n    setTrail(trail);\n  };\n\n  // Subscribe to navigation events from BookmarksList\n  useEffect(() => {\n    const handleNavigation = (trail: DataTrail) => {\n      goToUrlForTrail(trail);\n    };\n\n    // Subscribe to navigation events\n    const unsubscribe = navigationEvents.subscribe(handleNavigation);\n\n    // Clean up subscription\n    return () => unsubscribe();\n  }, []);\n\n  return { trail, goToUrlForTrail };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Collapse, TextLink, useStyles2 } from '@grafana/ui';\nimport React, { useCallback, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\nimport { InlineBanner } from './InlineBanner';\n\ntype ErrorViewProps = { error: Error };\n\nexport function ErrorView({ error }: Readonly<ErrorViewProps>) {\n  const styles = useStyles2(getStyles);\n\n  const navigate = useNavigate();\n  const { pathname, search } = useLocation();\n\n  const onClickReload = useCallback(() => {\n    const searchParams = new URLSearchParams(search);\n    const newSearchParams = new URLSearchParams();\n\n    // these are safe keys to keep\n    ['from', 'to', 'timezone']\n      .filter((key) => searchParams.has(key))\n      .forEach((key) => newSearchParams.set(key, searchParams.get(key)!));\n\n    navigate({ pathname, search: newSearchParams.toString() });\n    window.location.reload();\n  }, [navigate, pathname, search]);\n\n  const [isCollapseOpen, setIsCollapseOpen] = useState(false);\n\n  return (\n    <div className={styles.container}>\n      <InlineBanner\n        severity=\"error\"\n        title=\"Fatal error!\"\n        error={error}\n        errorContext={{ handheldBy: 'React error boundary' }}\n        message={\n          <>\n            <p className={styles.message}>\n              Please{' '}\n              <TextLink href=\"#\" onClick={onClickReload}>\n                try reloading the page\n              </TextLink>{' '}\n              or, if the problem persists, contact your organization admin. Sorry for the inconvenience.\n            </p>\n            <p>\n              <Collapse\n                className={styles.callStack}\n                collapsible\n                label=\"View stack trace\"\n                isOpen={isCollapseOpen}\n                onToggle={() => setIsCollapseOpen(!isCollapseOpen)}\n              >\n                <pre>\n                  <code>{error.stack}</code>\n                </pre>\n              </Collapse>\n            </p>\n          </>\n        }\n      />\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      margin: theme.spacing(2),\n    }),\n    message: css({\n      margin: theme.spacing(2, 0, 1, 0),\n    }),\n    callStack: css({\n      backgroundColor: 'transparent',\n      border: '0 none',\n\n      '& button': css({\n        paddingLeft: theme.spacing(1.5),\n      }),\n\n      '& button:focus': css({\n        outline: 'none',\n        boxShadow: 'none',\n      }),\n\n      '& button > svg': css({\n        marginLeft: theme.spacing(-2),\n        marginRight: theme.spacing(0.5),\n      }),\n\n      '& [class$=\"collapse__loader\"]': css({\n        display: 'none',\n      }),\n    }),\n  };\n}\n","import { type AdHocVariableFilter } from '@grafana/data';\nimport { isValidLegacyName, utf8Support } from '@grafana/prometheus';\nimport { Expression, MatchingOperator, promql } from 'tsqtsq';\n\nconst nonRateQueryFunctions = new Set(['avg', 'min', 'max'] as const);\nexport type NonRateQueryFunction = typeof nonRateQueryFunctions extends Set<infer T> ? T : never;\nexport const isNonRateQueryFunction = (value: string): value is NonRateQueryFunction =>\n  nonRateQueryFunctions.has(value as NonRateQueryFunction);\nexport const DEFAULT_NON_RATE_QUERY_FUNCTION: NonRateQueryFunction = 'avg';\n\nexport interface BuildPrometheusQueryParams {\n  metric: string;\n  filters: AdHocVariableFilter[];\n  isRateQuery: boolean;\n  groupings?: string[];\n  ignoreUsage?: boolean;\n  nonRateQueryFunction?: NonRateQueryFunction;\n  filterExtremeValues?: boolean;\n}\n\nexport function getPromqlFunction(\n  isRateQuery: boolean,\n  nonRateQueryFunction: NonRateQueryFunction = DEFAULT_NON_RATE_QUERY_FUNCTION\n): NonRateQueryFunction | 'sum' {\n  return isRateQuery ? 'sum' : nonRateQueryFunction; // eslint-disable-line sonarjs/no-selector-parameter\n}\n\nexport function buildPrometheusQuery({\n  metric,\n  filters,\n  isRateQuery,\n  groupings,\n  ignoreUsage = false,\n  nonRateQueryFunction = DEFAULT_NON_RATE_QUERY_FUNCTION,\n  filterExtremeValues = false,\n}: BuildPrometheusQueryParams): string {\n  // Check if metric name contains UTF-8 characters\n  const isUtf8Metric = !isValidLegacyName(metric);\n\n  const expr = new Expression({\n    metric: isUtf8Metric ? '' : metric,\n    values: {},\n    defaultOperator: MatchingOperator.equal,\n    defaultSelectors: [\n      ...(isUtf8Metric ? [{ label: utf8Support(metric), operator: MatchingOperator.equal, value: '__REMOVE__' }] : []),\n      ...(ignoreUsage ? [{ label: '__ignore_usage__', operator: MatchingOperator.equal, value: '' }] : []),\n      ...filters\n        .filter((filter) => filter.key !== '__name__')\n        .map(({ key, value, operator }) => ({\n          label: utf8Support(key),\n          operator: operator as MatchingOperator,\n          value,\n        })),\n    ],\n  });\n\n  let metricPartString = expr.toString();\n\n  // Hack to have the UTF-8 metric name in braces alongside labels,\n  // but without extra quotes associated with an empty label value\n  if (isUtf8Metric) {\n    metricPartString = metricPartString.replace('=\"__REMOVE__\"', '');\n  }\n\n  if (filterExtremeValues) {\n    // Create a filter expression that excludes extreme values\n    const extremeValueFilter = promql.and({\n      left: metricPartString,\n      right: `${metricPartString} > -Inf`,\n    });\n    metricPartString = extremeValueFilter;\n  }\n\n  // Add rate if needed\n  if (isRateQuery) {\n    metricPartString = promql.rate({ expr: metricPartString, interval: '$__rate_interval' });\n  }\n\n  // Build final query using tsqtsq\n  // native histograms will not get `sum by (le)` here because they are not identified as rate queries in `determineProperties` function because they don't have the suffix bucket. The `rate` function is defined much earlier for them in `MetricVizPanel.buildQueryRunner` and is passed here as the `nonRateQueryFunction`.\n  return promql[getPromqlFunction(isRateQuery, nonRateQueryFunction)]({\n    expr: metricPartString,\n    ...(groupings?.length ? { by: groupings } : {}),\n  });\n}\n","import { type ValueMapping } from '@grafana/data';\nimport { PanelBuilders, type SceneObject, type SceneQueryRunner } from '@grafana/scenes';\nimport { MappingType, VisibilityMode } from '@grafana/schema';\n\ninterface PanelProps {\n  panelTitle: string;\n  headerActions: SceneObject[];\n  queryRunner: SceneQueryRunner;\n}\n\nconst mappings: ValueMapping[] = [\n  {\n    type: MappingType.ValueToText,\n    options: {\n      '0': {\n        color: 'red',\n        text: 'down',\n      },\n      '1': {\n        color: 'green',\n        text: 'up',\n      },\n    },\n  },\n];\n\nexport function buildStatusHistoryPanel({ panelTitle, headerActions, queryRunner }: PanelProps) {\n  queryRunner.setState({ maxDataPoints: 100 });\n\n  return (\n    PanelBuilders.statushistory()\n      .setTitle(panelTitle)\n      // we clone to prevent Scenes warnings \"SceneObject already has a parent set that is different from the new parent. You cannot share the same SceneObject instance in multiple scenes or in multiple different places of the same scene graph. Use SceneObject.clone() to duplicate a SceneObject or store a state key reference and use sceneGraph.findObject to locate it.\"\n      .setHeaderActions(headerActions.map((action) => action.clone()))\n      .setData(queryRunner)\n      // Use value mappings for both color and text display\n      .setColor({ mode: 'palette-classic' })\n      .setMappings(mappings)\n      .setOption('legend', { showLegend: true })\n      .setOption('perPage', 0)\n      .setOption('showValue', VisibilityMode.Never)\n      .setDisplayName('status') // TODO: it's not applied by Scenes (tested ok when creating manually a dashboard), find out why\n  );\n}\n","import { css } from '@emotion/css';\nimport { LoadingState, type AdHocVariableFilter, type DataFrame, type Field, type GrafanaTheme2 } from '@grafana/data';\nimport { sceneGraph, SceneQueryRunner, type CancelActivationHandler, type VizPanel } from '@grafana/scenes';\nimport { Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport { parser } from '@prometheus-io/lezer-promql';\nimport React from 'react';\nimport { type Unsubscribable } from 'rxjs';\n\nimport { reportExploreMetrics } from 'interactions';\n\nimport { VAR_FILTERS_EXPR, VAR_METRIC_EXPR } from '../../shared';\nimport { logger } from '../../tracking/logger/logger';\nimport { processLabelMatcher } from '../../utils/utils.promql';\nimport { buildPrometheusQuery, isNonRateQueryFunction, type NonRateQueryFunction } from '../buildPrometheusQuery';\n\n/**\n * A stateless function that detects when all data in a query result is NaN\n * and attempts to re-run the query with extreme value filtering.\n *\n * This addresses the issue where Prometheus metrics with extremely small values\n * (e.g., 9e-129) cause arithmetic operations during averaging to underflow\n * or become undefined, resulting in NaN for queries like `avg(some_metric_with_extreme_values)`.\n *\n * @remarks\n * Implementing this as a behavior allows us to apply the extreme values filtering\n * to only the queries that are affected by the extreme values, rather than all queries in the scene.\n * That way, we can keep queries simpler by default, and only apply the extreme values filtering\n * when it's necessary.\n */\nexport function extremeValueFilterBehavior(panel: VizPanel): CancelActivationHandler | void {\n  const [queryRunner] = sceneGraph.findDescendents(panel, SceneQueryRunner);\n\n  // When the query runner's state changes, check if the data is all NaN.\n  // If it is, remove the extreme values from the query.\n  const queryRunnerSub = queryRunner?.subscribeToState((state) => {\n    if (state.data?.state === LoadingState.Done && state.data?.series) {\n      const { series } = state.data;\n\n      if (series.length === 0 || !isAllDataNaN(series)) {\n        return;\n      }\n\n      reportExploreMetrics('extreme_value_filter_behavior_triggered', {\n        expression: sceneGraph.interpolate(queryRunner, queryRunner.state.queries[0].expr),\n      });\n      const extremeValueRemoval = removeExtremeValues(queryRunner, panel, queryRunnerSub);\n\n      if (!extremeValueRemoval.success) {\n        panel.setState({\n          titleItems: (\n            <VizPanelExtremeValuesMessage\n              level=\"warning\"\n              message=\"Extreme values detected, but could not re-run the query with extreme value filtering\"\n            />\n          ),\n        });\n        logger.warn('ExtremeValueFilterBehavior: Failed to remove extreme values:', extremeValueRemoval.issue);\n      }\n    }\n  });\n\n  // Return cleanup function\n  return () => {\n    if (queryRunnerSub) {\n      queryRunnerSub.unsubscribe();\n    }\n  };\n}\n\n/**\n * Checks if all data in the series contains only NaN values,\n * short-circuiting if any frame contains non-NaN values.\n */\nfunction isAllDataNaN(series: DataFrame[]): boolean {\n  return series.every((frame) => isDataFrameAllNaN(frame));\n}\n\ninterface FieldWithEntitiesNaN extends Field<any> {\n  entities: {\n    NaN: number[];\n  };\n}\n\nfunction isFieldWithEntitiesNaN(field: Field): field is FieldWithEntitiesNaN {\n  return 'entities' in field && Array.isArray((field as FieldWithEntitiesNaN).entities?.NaN);\n}\n\n/**\n * Checks if all the values in the DataFrame are NaN\n */\nfunction isDataFrameAllNaN(frame: DataFrame): boolean {\n  const valuesField = frame.fields.find((field) => field.name === 'Value');\n\n  if (!valuesField || !isFieldWithEntitiesNaN(valuesField)) {\n    return false;\n  }\n\n  return valuesField.entities.NaN.length === frame.length;\n}\n\ntype RemoveExtremeValuesMeta = { success: true } | { success: false; issue: string };\n\n/**\n * Re-run the query with extreme value filtering enabled\n */\nfunction removeExtremeValues(\n  queryRunner: SceneQueryRunner,\n  panel: VizPanel,\n  queryRunnerSub: Unsubscribable\n): RemoveExtremeValuesMeta {\n  const queries = queryRunner.state.queries;\n  if (!queries || queries.length === 0) {\n    return { success: false, issue: 'No queries found in query runner' };\n  }\n\n  // Parse the original query to extract the metric, filters, groupings, etc.\n  const queryParsing = parseQueryForRebuild(queries[0].expr, queryRunner);\n\n  if (!queryParsing.success) {\n    return { success: false, issue: queryParsing.issue };\n  }\n\n  // Rebuild the query with extreme value filtering\n  const filteredQuery = buildPrometheusQuery({\n    ...queryParsing.queryParts,\n    filterExtremeValues: true,\n  });\n\n  // Unsubscribe from the original query runner before replacing it\n  if (queryRunnerSub) {\n    queryRunnerSub.unsubscribe();\n  }\n\n  // Create a new query runner with the filtered query\n  const newQueryRunner = queryRunner.clone({\n    queries: [\n      {\n        ...queries[0],\n        expr: filteredQuery,\n      },\n    ],\n  });\n\n  panel.setState({\n    $data: newQueryRunner,\n    titleItems: (\n      <VizPanelExtremeValuesMessage\n        level=\"info\"\n        message=\"Panel data was re-fetched with a more complex query to handle extremely small values in the series\"\n      />\n    ),\n  });\n\n  newQueryRunner.runQueries();\n\n  return { success: true };\n}\n\ninterface QueryParts {\n  metric: string;\n  filters: AdHocVariableFilter[];\n  isRateQuery: boolean;\n  nonRateQueryFunction?: NonRateQueryFunction;\n  groupings?: string[];\n}\n\ntype ParseQueryForRebuildResult = { success: true; queryParts: QueryParts } | { success: false; issue: string };\n\n/**\n * Parses a PromQL query to extract parameters for rebuilding with filtering\n */\nexport function parseQueryForRebuild(query: string, queryRunner: SceneQueryRunner): ParseQueryForRebuildResult {\n  let queryExpression = query;\n  const hasTemplateVariables = query.includes(VAR_METRIC_EXPR) || query.includes(VAR_FILTERS_EXPR);\n\n  if (hasTemplateVariables) {\n    queryExpression = sceneGraph.interpolate(queryRunner, query);\n  }\n\n  try {\n    const tree = parser.parse(queryExpression);\n    let metric = '';\n    const labels: AdHocVariableFilter[] = [];\n    let isRateQuery = false;\n    let groupings: string[] | undefined;\n    let nonRateQueryFunction: NonRateQueryFunction | undefined;\n\n    // Use tree.iterate() for simpler traversal\n    tree.iterate({\n      enter: (node) => {\n        // Check for rate function\n        if (node.name === 'FunctionCall') {\n          // Find the function name (first child should be the identifier)\n          let functionName = '';\n          for (let child = node.node.firstChild; child; child = child.nextSibling) {\n            if (child.type.name === 'Identifier') {\n              functionName = queryExpression.slice(child.from, child.to);\n              break;\n            }\n          }\n\n          if (functionName === 'rate') {\n            isRateQuery = true;\n          } else if (isNonRateQueryFunction(functionName)) {\n            nonRateQueryFunction = functionName;\n            isRateQuery = false;\n          }\n        }\n\n        // Get the first metric name from any VectorSelector > Identifier\n        if (!metric && node.name === 'Identifier' && node.node.parent?.type.name === 'VectorSelector') {\n          metric = queryExpression.slice(node.from, node.to);\n        }\n\n        // Extract label matchers\n        const labelData = processLabelMatcher(node, queryExpression);\n        if (labelData) {\n          labels.push({\n            key: labelData.label,\n            operator: labelData.op,\n            value: labelData.value,\n          });\n        }\n\n        // Extract groupings from by clause\n        if (node.name === 'GroupingLabels' && nonRateQueryFunction) {\n          groupings = extractGroupings(node, queryExpression);\n        }\n      },\n    });\n\n    if (!metric) {\n      return {\n        success: false,\n        issue: `Could not parse the metric name from the query: ${queryExpression}`,\n      };\n    }\n\n    return {\n      success: true,\n      queryParts: {\n        metric,\n        filters: labels,\n        isRateQuery,\n        groupings,\n        nonRateQueryFunction,\n      },\n    };\n  } catch (error) {\n    return {\n      success: false,\n      issue: `Unexpected error during query parsing to handle extreme values: ${\n        error instanceof Error ? error.message : String(error)\n      }`,\n    };\n  }\n}\n\n/**\n * Extracts groupings from a GroupingLabels node\n */\nfunction extractGroupings(node: any, expr: string): string[] {\n  const groupings: string[] = [];\n\n  // Traverse children to find LabelName nodes\n  for (let child = node.node.firstChild; child; child = child.nextSibling) {\n    if (child.type.name === 'LabelName') {\n      const grouping = expr.slice(child.from, child.to);\n      if (grouping) {\n        groupings.push(grouping);\n      }\n    }\n  }\n\n  return groupings;\n}\n\ninterface VizPanelExtremeValuesMessageProps {\n  message: string;\n  level: 'warning' | 'info';\n}\n\nfunction VizPanelExtremeValuesMessage({ message, level }: Readonly<VizPanelExtremeValuesMessageProps>) {\n  const styles = useStyles2(getStyles, level);\n\n  return (\n    <div className={styles.extremeValuedisclaimer}>\n      <Tooltip content={message}>\n        <span className={styles.warningMessage}>\n          <Icon name={level === 'warning' ? 'exclamation-triangle' : 'info-circle'} aria-hidden=\"true\" />\n        </span>\n      </Tooltip>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2, level: 'warning' | 'info') => ({\n  extremeValuedisclaimer: css({\n    label: 'extreme-value-disclaimer',\n    display: 'flex',\n    alignItems: 'center',\n    gap: theme.spacing(1),\n  }),\n  warningMessage: css({\n    display: 'flex',\n    alignItems: 'center',\n    gap: theme.spacing(0.5),\n    color: level === 'warning' ? theme.colors.warning.main : theme.colors.info.main,\n    fontSize: theme.typography.bodySmall.fontSize,\n  }),\n});\n","import { css, cx } from '@emotion/css';\nimport { FieldMatcherID, LoadingState, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneObjectBase,\n  SceneQueryRunner,\n  type SceneComponentProps,\n  type SceneDataQuery,\n  type SceneObject,\n  type SceneObjectState,\n  type VizPanel,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { buildPrometheusQuery, getPromqlFunction, type NonRateQueryFunction } from 'autoQuery/buildPrometheusQuery';\nimport { getUnit } from 'autoQuery/units';\nimport { trailDS } from 'shared';\n\nimport { type PrometheusFn } from './actions/ConfigureAction';\nimport { SelectAction } from './actions/SelectAction';\nimport { buildHeatmapPanel } from './panels/buildHeatmapPanel';\nimport { buildStatusHistoryPanel } from './panels/buildStatusHistoryPanel';\nimport { buildTimeseriesPanel } from './panels/buildTimeseriesPanel';\nimport { parseMatcher } from './parseMatcher';\n\ninterface MetricVizPanelProps {\n  metricName: string;\n  color: string;\n  isNativeHistogram: boolean;\n  headerActions?: SceneObject[];\n  height?: string;\n  hideLegend?: boolean;\n  highlight?: boolean;\n  matchers?: string[];\n  prometheusFunction?: PrometheusFn;\n  title?: string;\n}\n\ninterface MetricVizPanelState\n  extends SceneObjectState,\n    Pick<\n      Required<MetricVizPanelProps>,\n      'isNativeHistogram' | 'headerActions' | 'height' | 'hideLegend' | 'highlight' | 'prometheusFunction'\n    > {\n  body: VizPanel;\n}\n\nexport const METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW = '260px';\nexport const METRICS_VIZ_PANEL_HEIGHT = '220px';\nexport const METRICS_VIZ_PANEL_HEIGHT_SMALL = '160px';\nconst rateQueryMetricSuffixes = new Set(['count', 'total', 'sum', 'bucket']);\n\nexport class MetricVizPanel extends SceneObjectBase<MetricVizPanelState> {\n  private static readonly MAX_DATA_POINTS = 250;\n\n  constructor(props: MetricVizPanelProps) {\n    const { isRateQuery } = MetricVizPanel.determineQueryProperties(props.metricName, props.isNativeHistogram);\n    const stateWithDefaults = {\n      ...props,\n      prometheusFunction: props.prometheusFunction ?? (getPromqlFunction(isRateQuery) as PrometheusFn),\n      isNativeHistogram: props.isNativeHistogram,\n      matchers: props.matchers || [],\n      title: props.title || props.metricName,\n      height: props.height || METRICS_VIZ_PANEL_HEIGHT,\n      hideLegend: Boolean(props.hideLegend),\n      highlight: Boolean(props.highlight),\n      headerActions: [...(props.headerActions || [new SelectAction({ metricName: props.metricName })])],\n    };\n\n    super({\n      key: `metric-viz-panel-${stateWithDefaults.metricName}`,\n      ...stateWithDefaults,\n      body: MetricVizPanel.buildVizPanel({\n        ...stateWithDefaults,\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const { body, prometheusFunction } = this.state;\n\n    this._subs.add(\n      (body.state.$data as SceneQueryRunner).subscribeToState((newState) => {\n        if (newState.data?.state !== LoadingState.Done) {\n          return;\n        }\n\n        const { series } = newState.data;\n\n        if (series?.length) {\n          body.setState({\n            fieldConfig: {\n              defaults: body.state.fieldConfig.defaults,\n              overrides: [\n                {\n                  matcher: { id: FieldMatcherID.byFrameRefID, options: series[0].refId },\n                  properties: [\n                    {\n                      id: 'displayName',\n                      value: prometheusFunction,\n                    },\n                  ],\n                },\n              ],\n            },\n          });\n        }\n      })\n    );\n  }\n\n  private static buildVizPanel({\n    metricName,\n    title,\n    highlight,\n    color,\n    hideLegend,\n    prometheusFunction,\n    matchers,\n    headerActions,\n    isNativeHistogram = false,\n  }: Required<Omit<MetricVizPanelProps, 'prometheusFunction'>> & {\n    prometheusFunction?: MetricVizPanelProps['prometheusFunction'];\n  }) {\n    const panelTitle = highlight ? `${title} (current)` : title;\n    const unit = getUnit(metricName);\n\n    // check if metric is a histogram (either classic or native)\n    const isHistogram = metricName.endsWith('_bucket') || isNativeHistogram;\n\n    const isUptime = metricName === 'up' || metricName.endsWith('_up');\n    if (isUptime) {\n      // For uptime metrics, use a status history panel which is better for binary states\n      return buildStatusHistoryPanel({\n        panelTitle,\n        headerActions,\n        // TODO: custom uptime query runner to prevent if/else in buildPrometheusQuery() (see below)\n        queryRunner: MetricVizPanel.buildQueryRunner({\n          metricName,\n          matchers,\n          prometheusFunction: 'min',\n          isHistogram,\n        }),\n      })\n        .setUnit(unit) // Set the appropriate unit for status history panel as well\n        .build();\n    }\n\n    if (isHistogram) {\n      return buildHeatmapPanel({\n        panelTitle,\n        headerActions,\n        hideLegend,\n        queryRunner: MetricVizPanel.buildQueryRunner({\n          metricName,\n          matchers,\n          prometheusFunction: 'rate',\n          isHistogram,\n          queryOptions: {\n            format: 'heatmap',\n          },\n        }),\n      })\n        .setUnit(unit)\n        .build();\n    }\n\n    // Default settings for non-uptime metrics - use timeseries\n    return buildTimeseriesPanel({\n      panelTitle,\n      headerActions,\n      color,\n      hideLegend,\n      queryRunner: MetricVizPanel.buildQueryRunner({\n        metricName,\n        matchers,\n        prometheusFunction,\n        isHistogram,\n      }),\n    })\n      .setUnit(unit) // Set the appropriate unit\n      .build();\n  }\n\n  private static buildQueryRunner({\n    metricName,\n    matchers,\n    isHistogram,\n    prometheusFunction,\n    queryOptions = {},\n  }: {\n    metricName: string;\n    matchers: string[];\n    isHistogram: boolean;\n    prometheusFunction?: PrometheusFn;\n    queryOptions?: Partial<SceneDataQuery>;\n  }): SceneQueryRunner {\n    const filters = matchers.map(parseMatcher);\n    const { isRateQuery, groupings } = MetricVizPanel.determineQueryProperties(metricName, isHistogram);\n    const expr = buildPrometheusQuery({\n      metric: metricName,\n      filters,\n      isRateQuery,\n      ignoreUsage: true,\n      groupings,\n      ...(prometheusFunction ? { nonRateQueryFunction: prometheusFunction as NonRateQueryFunction } : {}),\n    });\n\n    return new SceneQueryRunner({\n      datasource: trailDS,\n      maxDataPoints: MetricVizPanel.MAX_DATA_POINTS,\n      queries: [\n        {\n          ...queryOptions,\n          refId: metricName,\n          expr,\n          fromExploreMetrics: true,\n        },\n      ],\n    });\n  }\n\n  static determineQueryProperties(metricName: string, isHistogram: boolean) {\n    const parts = metricName.split('_');\n    const suffix = parts.at(-1);\n\n    // Determine if this is a rate query based on metric suffix\n    const isRateQuery = rateQueryMetricSuffixes.has(suffix || '');\n\n    // Determine groupings based on metric suffix and native histogram status\n    let groupings: string[] | undefined;\n\n    if (isHistogram) {\n      groupings = ['le'];\n    }\n\n    return { isRateQuery, groupings };\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricVizPanel>) => {\n    const { body, height, highlight, isNativeHistogram } = model.useState();\n    const styles = useStyles2(getStyles, height);\n\n    return (\n      <div className={cx(styles.container, highlight && styles.highlight, isNativeHistogram && styles.nativeHistogram)}>\n        {body && <body.Component model={body} />}\n      </div>\n    );\n  };\n}\n\n// TODO: don't export only to use it in PreviewPanel.tsx\n// instead, use only MetricVizPanel across the whole app\nexport const nativeHistogramStyles = (theme: GrafanaTheme2) => {\n  const nativeHistogramBadgeWidth = 116;\n\n  return css({\n    '[class$=\"-panel-header\"]': {\n      position: 'relative',\n      paddingLeft: `${nativeHistogramBadgeWidth + 4}px`,\n    },\n    '[class$=\"-panel-title\"]::before': {\n      content: '\"Native Histogram\"',\n      fontSize: '12px',\n      color: 'rgb(158, 193, 247)',\n      position: 'absolute',\n      left: '8px',\n      top: '7px',\n      display: 'inline-flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      width: `${nativeHistogramBadgeWidth}px`,\n      height: '22px',\n      padding: 0,\n      border: `1px solid ${theme.colors.info.text}`,\n      borderRadius: theme.shape.radius.pill,\n      background: theme.colors.info.transparent,\n      cursor: 'auto',\n    },\n  });\n};\n\nfunction getStyles(theme: GrafanaTheme2, height: string) {\n  return {\n    container: css({\n      height,\n    }),\n    highlight: css({\n      border: `2px solid ${theme.colors.primary.main}`,\n    }),\n    nativeHistogram: nativeHistogramStyles(theme),\n  };\n}\n","import { PanelBuilders, type SceneObject, type SceneQueryRunner } from '@grafana/scenes';\nimport { HeatmapColorMode } from '@grafana/schema/dist/esm/raw/composable/heatmap/panelcfg/x/HeatmapPanelCfg_types.gen';\n\ninterface PanelProps {\n  panelTitle: string;\n  queryRunner: SceneQueryRunner;\n  hideLegend: boolean;\n  headerActions: SceneObject[];\n}\n\nexport function buildHeatmapPanel({ panelTitle, queryRunner, headerActions, hideLegend }: PanelProps) {\n  return (\n    PanelBuilders.heatmap()\n      .setTitle(panelTitle)\n      .setData(queryRunner)\n      .setOption('calculate', false)\n      .setOption('color', {\n        mode: HeatmapColorMode.Scheme,\n        exponent: 0.5,\n        scheme: 'Spectral',\n        steps: 32,\n        reverse: false,\n      })\n      // we clone to prevent Scenes warnings \"SceneObject already has a parent set that is different from the new parent. You cannot share the same SceneObject instance in multiple scenes or in multiple different places of the same scene graph. Use SceneObject.clone() to duplicate a SceneObject or store a state key reference and use sceneGraph.findObject to locate it.\"\n      .setHeaderActions(headerActions.map((action) => action.clone()))\n      .setOption('legend', { show: !hideLegend })\n  );\n}\n","import { PanelBuilders, type SceneObject, type SceneQueryRunner } from '@grafana/scenes';\n\nimport { extremeValueFilterBehavior } from '../../../autoQuery/behaviors/ExtremeValueFilterBehavior';\n\ninterface PanelProps {\n  panelTitle: string;\n  color: string;\n  queryRunner: SceneQueryRunner;\n  hideLegend: boolean;\n  headerActions: SceneObject[];\n}\n\nexport function buildTimeseriesPanel({ panelTitle, queryRunner, color, headerActions, hideLegend }: PanelProps) {\n  return (\n    PanelBuilders.timeseries()\n      .setTitle(panelTitle)\n      .setData(queryRunner)\n      .setColor({ mode: 'fixed', fixedColor: color })\n      .setCustomFieldConfig('fillOpacity', 9)\n      .setCustomFieldConfig('pointSize', 1)\n      // we clone to prevent Scenes warnings \"SceneObject already has a parent set that is different from the new parent. You cannot share the same SceneObject instance in multiple scenes or in multiple different places of the same scene graph. Use SceneObject.clone() to duplicate a SceneObject or store a state key reference and use sceneGraph.findObject to locate it.\"\n      .setHeaderActions(headerActions.map((action) => action.clone()))\n      .setOption('legend', { showLegend: !hideLegend })\n      .setBehaviors([extremeValueFilterBehavior])\n  );\n}\n","import { type AdHocVariableFilter } from '@grafana/data';\nimport { config, reportInteraction } from '@grafana/runtime';\n\nimport { type ExposedComponentName } from 'exposedComponents/components';\nimport { type ActionViewType } from 'MetricActionBar';\nimport { type SortSeriesByOption } from 'services/sorting';\nimport { type SnakeCase } from 'utils/utils.types';\nimport { type LayoutType } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { type SortingOption as MetricsReducerSortByOption } from 'WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter';\n\nimport { PLUGIN_ID } from './constants';\nimport { GIT_COMMIT } from './version';\n\nexport type ViewName = 'metrics-reducer' | 'metric-details';\n\ntype Interactions = {\n  // User selected a label to view its breakdown.\n  groupby_label_changed: {\n    label: string;\n  };\n  breakdown_panel_selected: {\n    label: string;\n  };\n  // User changed a label filter\n  label_filter_changed: {\n    label: string;\n    action: 'added' | 'removed' | 'changed';\n    cause: 'breakdown' | 'adhoc_filter';\n  };\n  // User changed the breakdown layout\n  breakdown_layout_changed: { layout: LayoutType };\n  // A metric exploration has started due to one of the following causes\n  exploration_started: {\n    cause: 'bookmark_clicked';\n  };\n  // A user has changed a bookmark\n  bookmark_changed: {\n    action: // Toggled on or off from the bookmark icon\n    | 'toggled_on'\n      | 'toggled_off'\n      // Deleted from the sidebar bookmarks list\n      | 'deleted';\n  };\n  // User changes metric explore settings\n  settings_changed: { stickyMainGraph?: boolean };\n  // User clicks on tab to change the action view\n  metric_action_view_changed: {\n    view: ActionViewType;\n\n    // The number of related logs\n    related_logs_count?: number;\n  };\n  // User clicks on one of the action buttons associated with a selected metric\n  selected_metric_action_clicked: {\n    action: // Opens the metric queries in Explore\n    | 'open_in_explore'\n      // Clicks on the share URL button\n      | 'share_url'\n      // Deselects the current selected metrics by clicking the \"Select new metric\" button\n      | 'unselect'\n      // When in embedded mode, clicked to open the exploration from the embedded view\n      | 'open_from_embedded';\n  };\n  // User clicks on one of the action buttons associated with related logs\n  related_logs_action_clicked: {\n    action: // Opens Logs Drilldown\n    | 'open_logs_drilldown'\n      // Logs data source changed\n      | 'logs_data_source_changed';\n  };\n  // User selects a metric\n  metric_selected: {\n    from: // By clicking \"Select\" on a metric panel when on the no-metric-selected metrics list view\n    | 'metric_list'\n      // By clicking \"Select\" on a metric panel when on the related metrics tab\n      | 'related_metrics';\n    // The number of search terms activated when the selection was made\n    searchTermCount: number | null;\n  };\n  // User opens/closes the prefix filter dropdown\n  prefix_filter_clicked: {\n    from: // By clicking \"Select\" on a metric panel when on the no-metric-selected metrics list view\n    | 'metric_list'\n      // By clicking \"Select\" on a metric panel when on the related metrics tab\n      | 'related_metrics';\n    action: // Opens the dropdown\n    | 'open'\n      // Closes the dropdown\n      | 'close';\n  };\n  // User types in the quick search bar\n  quick_search_used: {};\n  sorting_changed:\n    | {\n        // By clicking on the sort by variable in the metrics reducer\n        from: 'metrics-reducer';\n        // The sort by option selected\n        sortBy: MetricsReducerSortByOption;\n      }\n    | {\n        // By clicking on the sort by component in the label breakdown\n        from: 'label-breakdown';\n        // The sort by option selected\n        sortBy: SortSeriesByOption;\n      };\n  wasm_not_supported: {};\n  native_histogram_examples_closed: {};\n  native_histogram_example_clicked: {\n    metric: string;\n  };\n  // User toggles the Wingman sidebar\n  metrics_sidebar_toggled: {\n    action: // Opens the sidebar section\n    | 'opened'\n      // Closes the sidebar section\n      | 'closed';\n    section?: string;\n  };\n  // User clicks into the prefix filter section of the sidebar\n  sidebar_prefix_filter_section_clicked: {};\n  // User applies any prefix filter from the sidebar\n  sidebar_prefix_filter_applied: {\n    // Number of prefix filters applied (optional)\n    filter_count?: number;\n  };\n  // User clicks into the suffix filter section of the sidebar\n  sidebar_suffix_filter_section_clicked: {};\n  // User applies any suffix filter from the sidebar\n  sidebar_suffix_filter_applied: {\n    // Number of suffix filters applied (optional)\n    filter_count?: number;\n  };\n  // User selects a rules filter from the Wingman sidebar\n  sidebar_rules_filter_selected: {\n    filter_type: 'non_rules_metrics' | 'recording_rules';\n  };\n  // User applies a label filter from the sidebar\n  sidebar_group_by_label_filter_applied: {\n    label: string;\n  };\n  app_initialized: {\n    view: ViewName;\n    uel_epid: string;\n  };\n  // User took an action to view an exposed component\n  exposed_component_viewed: {\n    component: SnakeCase<ExposedComponentName>;\n  };\n  // App migrated some legacy user prefs (see src/UserPreferences/userPreferences.ts)\n  user_preferences_migrated: {};\n};\n\ntype OtherEvents = {\n  extreme_value_filter_behavior_triggered: {\n    expression: string;\n  };\n};\n\ntype AllEvents = Interactions & OtherEvents;\n\nconst INTERACTION_NAME_PREFIX = 'grafana_explore_metrics_';\n\nexport function reportExploreMetrics<E extends keyof AllEvents, P extends AllEvents[E]>(event: E, payload: P) {\n  reportInteraction(`${INTERACTION_NAME_PREFIX}${event}`, {\n    ...payload,\n    meta: {\n      // same naming as Faro (see src/tracking/faro/faro.ts)\n      appRelease: config.apps[PLUGIN_ID].version,\n      appVersion: GIT_COMMIT,\n    },\n  });\n}\n\n/**\n * Reports a single label filter change event\n */\nfunction reportLabelFilterChange(label: string, action: 'added' | 'removed' | 'changed') {\n  reportExploreMetrics('label_filter_changed', {\n    label,\n    action,\n    cause: 'adhoc_filter',\n  });\n}\n\n/**\n * Detects and reports changes to an existing filter\n */\nfunction detectChangedFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  for (const oldFilter of oldFilters) {\n    for (const newFilter of newFilters) {\n      if (oldFilter.key === newFilter.key && oldFilter.value !== newFilter.value) {\n        reportLabelFilterChange(oldFilter.key, 'changed');\n      }\n    }\n  }\n}\n\n/**\n * Detects and reports removed filters\n */\nfunction detectRemovedFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  for (const oldFilter of oldFilters) {\n    const stillExists = newFilters.some((newFilter) => newFilter.key === oldFilter.key);\n    if (!stillExists) {\n      reportLabelFilterChange(oldFilter.key, 'removed');\n    }\n  }\n}\n\n/**\n * Detects and reports added filters\n */\nfunction detectAddedFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  for (const newFilter of newFilters) {\n    const isNew = !oldFilters.some((oldFilter) => oldFilter.key === newFilter.key);\n    if (isNew) {\n      reportLabelFilterChange(newFilter.key, 'added');\n    }\n  }\n}\n\n/** Detect the single change in filters and report the event, assuming it came from manipulating the adhoc filter */\nexport function reportChangeInLabelFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  if (newFilters.length === oldFilters.length) {\n    // Same number of filters - check for changed values\n    detectChangedFilters(newFilters, oldFilters);\n  } else if (newFilters.length < oldFilters.length) {\n    // Filters were removed\n    detectRemovedFilters(newFilters, oldFilters);\n  } else {\n    // Filters were added\n    detectAddedFilters(newFilters, oldFilters);\n  }\n}\n","import { SceneObjectBase, type SceneObjectState } from '@grafana/scenes';\n\nexport type CountsData = {\n  current: number;\n  total: number;\n};\n\nexport interface CountsProviderState extends SceneObjectState {\n  counts: CountsData;\n}\n\nexport class CountsProvider<T extends CountsProviderState = CountsProviderState> extends SceneObjectBase<T> {\n  constructor(state: Partial<T>) {\n    super({\n      ...state,\n      counts: { current: 0, total: 0 },\n    } as T);\n  }\n\n  public useCounts(): CountsData {\n    return this.useState().counts;\n  }\n}\n","import { AppEvents } from '@grafana/data';\nimport { getAppEvents } from '@grafana/runtime';\n\nimport { logger } from 'tracking/logger/logger';\n\nexport function displayError(error: Error, msgs: string[]) {\n  const context = msgs.reduce((acc, msg, i) => ({ ...acc, [`info${i + 1}`]: msg }), { handheldBy: 'displayError' });\n\n  logger.error(error, context);\n\n  getAppEvents().publish({\n    type: AppEvents.alertError.name,\n    payload: msgs,\n  });\n}\n\nexport function displayWarning(msgs: string[]) {\n  logger.warn(msgs);\n\n  getAppEvents().publish({\n    type: AppEvents.alertWarning.name,\n    payload: msgs,\n  });\n}\n\nexport function displaySuccess(msgs: string[]) {\n  getAppEvents().publish({\n    type: AppEvents.alertSuccess.name,\n    payload: msgs,\n  });\n}\n","import {\n  MultiValueVariable,\n  sceneGraph,\n  SceneObjectBase,\n  VariableDependencyConfig,\n  type SceneComponentProps,\n  type SceneLayout,\n  type SceneObject,\n  type SceneObjectState,\n  type VariableValueOption,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { logger } from 'tracking/logger/logger';\n\n/**\n * This component has been borrowd from Scenes v5,41,1, which is the version Metrics Drilldown currently use.\n *\n * The main purpose of this new component is to create a Scene object that has the capabilities of the original SceneByVariableRepeater and\n * that also to provide:\n *\n *   1. lazy loading/pagination\n *   2. configurable loading/error/empty states\n *   4. minor details (like calling getLayoutChild() and passing an index for multi coloring timeseries)\n *\n *\n */\ninterface SceneByVariableRepeaterState extends SceneObjectState {\n  variableName: string;\n  body: SceneLayout;\n  getLayoutChild(option: VariableValueOption, index: number, options: VariableValueOption[]): SceneObject | null;\n  getLayoutLoading?: () => SceneObject;\n  getLayoutError?: (error: Error) => SceneObject;\n  getLayoutEmpty?: () => SceneObject;\n  currentBatchSize: number;\n  initialPageSize: number;\n  pageSizeIncrement: number;\n  loadingLayout?: SceneObject;\n  errorLayout?: SceneObject;\n  emptyLayout?: SceneObject;\n}\n\nconst DEFAULT_INITIAL_PAGE_SIZE = 6;\nconst DEFAULT_PAGE_SIZE_INCREMENT = 9;\n\nexport class SceneByVariableRepeater extends SceneObjectBase<SceneByVariableRepeaterState> {\n  protected _variableDependency: VariableDependencyConfig<SceneByVariableRepeaterState> = new VariableDependencyConfig(\n    this,\n    {\n      variableNames: [this.state.variableName],\n      onVariableUpdateCompleted: () => this.performRepeat(),\n    }\n  );\n\n  public constructor({\n    variableName,\n    body,\n    getLayoutChild,\n    getLayoutLoading,\n    getLayoutError,\n    getLayoutEmpty,\n    initialPageSize,\n    pageSizeIncrement,\n  }: {\n    variableName: SceneByVariableRepeaterState['variableName'];\n    body: SceneByVariableRepeaterState['body'];\n    getLayoutChild: SceneByVariableRepeaterState['getLayoutChild'];\n    getLayoutLoading?: SceneByVariableRepeaterState['getLayoutLoading'];\n    getLayoutError?: SceneByVariableRepeaterState['getLayoutError'];\n    getLayoutEmpty?: SceneByVariableRepeaterState['getLayoutEmpty'];\n    initialPageSize?: SceneByVariableRepeaterState['initialPageSize'];\n    pageSizeIncrement?: SceneByVariableRepeaterState['pageSizeIncrement'];\n  }) {\n    super({\n      variableName,\n      body,\n      getLayoutChild,\n      getLayoutLoading,\n      getLayoutError,\n      getLayoutEmpty,\n      currentBatchSize: 0,\n      initialPageSize: initialPageSize || DEFAULT_INITIAL_PAGE_SIZE,\n      pageSizeIncrement: pageSizeIncrement || DEFAULT_PAGE_SIZE_INCREMENT,\n      loadingLayout: undefined,\n      errorLayout: undefined,\n      emptyLayout: undefined,\n    });\n\n    this.addActivationHandler(() => this.performRepeat());\n  }\n\n  private performRepeat() {\n    if (this._variableDependency.hasDependencyInLoadingState()) {\n      this.setState({\n        loadingLayout: this.state.getLayoutLoading?.(),\n        errorLayout: undefined,\n        emptyLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this);\n    if (!(variable instanceof MultiValueVariable)) {\n      const error = new Error('SceneByVariableRepeater: variable is not a MultiValueVariable!');\n      logger.error(error);\n      return;\n    }\n\n    if (variable.state.error) {\n      this.setState({\n        errorLayout: this.state.getLayoutError?.(variable.state.error),\n        loadingLayout: undefined,\n        emptyLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    const values = getMultiVariableValues(variable);\n\n    if (!values.length) {\n      this.setState({\n        emptyLayout: this.state.getLayoutEmpty?.(),\n        errorLayout: undefined,\n        loadingLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    this.setState({\n      loadingLayout: undefined,\n      errorLayout: undefined,\n      emptyLayout: undefined,\n      currentBatchSize: this.state.initialPageSize,\n    });\n\n    const newChildren: SceneObject[] = values\n      .slice(0, this.state.initialPageSize)\n      .map((option, index) => this.state.getLayoutChild(option, index, values))\n      .filter(Boolean) as SceneObject[];\n\n    this.state.body.setState({\n      children: newChildren,\n    });\n  }\n\n  public increaseBatchSize() {\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this) as MultiValueVariable;\n    const values = getMultiVariableValues(variable);\n\n    const newBatchSize = this.state.currentBatchSize + this.state.pageSizeIncrement;\n\n    const newChildren: SceneObject[] = values\n      .slice(this.state.currentBatchSize, newBatchSize)\n      .map((option, index) => this.state.getLayoutChild(option, this.state.currentBatchSize + index, values))\n      .filter(Boolean) as SceneObject[];\n\n    this.state.body.setState({\n      children: [...this.state.body.state.children, ...newChildren],\n    });\n\n    this.setState({\n      currentBatchSize: newBatchSize,\n    });\n  }\n\n  public useSizes() {\n    const { currentBatchSize, pageSizeIncrement } = this.useState();\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this);\n    const total = (variable as MultiValueVariable).state.options.length;\n    const remaining = total - currentBatchSize;\n    const increment = remaining < pageSizeIncrement ? remaining : pageSizeIncrement;\n    return {\n      increment,\n      current: currentBatchSize,\n      total,\n    };\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<SceneByVariableRepeater>) => {\n    const { body, loadingLayout, errorLayout, emptyLayout } = model.useState();\n\n    if (loadingLayout) {\n      return <loadingLayout.Component model={loadingLayout} />;\n    }\n\n    if (errorLayout) {\n      return <errorLayout.Component model={errorLayout} />;\n    }\n\n    if (emptyLayout) {\n      return <emptyLayout.Component model={emptyLayout} />;\n    }\n\n    return <body.Component model={body} />;\n  };\n}\n\nexport function getMultiVariableValues(variable: MultiValueVariable): VariableValueOption[] {\n  const { value, text, options } = variable.state;\n\n  if (variable.hasAllValue()) {\n    return options;\n  }\n\n  if (Array.isArray(value) && Array.isArray(text)) {\n    return value.map((v, i) => ({ value: v, label: text[i] as string }));\n  }\n\n  return [{ value: value as string, label: text as string }];\n}\n","import { css, cx } from '@emotion/css';\nimport { type GrafanaTheme2, type IconName } from '@grafana/data';\nimport { Button, Dropdown, Icon, Menu, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { type MetricUsageType } from 'WingmanDataTrail/ListControls/MetricsSorter/MetricUsageFetcher';\n\nimport { type WithUsageDataPreviewPanelState } from './WithUsageDataPreviewPanel';\n\nexport interface UsageSectionProps {\n  usageType: MetricUsageType;\n  usageCount: number;\n  singularUsageType: string;\n  pluralUsageType: string;\n  icon: IconName;\n  dashboardItems: WithUsageDataPreviewPanelState['dashboardItems'];\n}\n\nexport function UsageData({\n  usageType,\n  usageCount,\n  singularUsageType,\n  pluralUsageType,\n  icon,\n  dashboardItems,\n}: Readonly<UsageSectionProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.usageContainer} data-testid=\"usage-data-panel\">\n      {usageType === 'dashboard-usage' ? (\n        <>\n          <Dropdown\n            placement=\"right-start\"\n            overlay={\n              <Menu style={{ maxWidth: '240px', maxHeight: '245px', overflowY: 'auto' }}>\n                {dashboardItems.map((item) => (\n                  <Menu.Item\n                    key={item.id}\n                    label=\"\"\n                    url={item.url}\n                    target=\"_blank\"\n                    className={styles.menuItem}\n                    component={() => (\n                      <Tooltip\n                        content={`Used ${item.count} ${item.count === 1 ? 'time' : 'times'} in ${item.label}`}\n                        placement=\"right\"\n                      >\n                        <div className={styles.menuItemContent}>\n                          <Icon name=\"external-link-alt\" /> {item.label} ({item.count})\n                        </div>\n                      </Tooltip>\n                    )}\n                  />\n                ))}\n              </Menu>\n            }\n          >\n            <Button\n              variant=\"secondary\"\n              size=\"sm\"\n              tooltip={`Metric used ${usageCount} ${\n                usageCount === 1 ? 'time' : 'times'\n              } in dashboard queries. Click to view the dashboards.`}\n              className={cx(styles.usageItem, styles.clickableUsageItem)}\n            >\n              <span data-testid={usageType}>\n                <Icon name={icon} style={{ marginRight: '4px' }} /> {usageCount}\n              </span>\n            </Button>\n          </Dropdown>\n        </>\n      ) : (\n        <Tooltip\n          content={`Metric is used in ${usageCount} ${usageCount === 1 ? singularUsageType : pluralUsageType}`}\n          placement=\"top\"\n        >\n          <span className={styles.usageItem} data-testid={usageType}>\n            <Icon name={icon} /> {usageCount}\n          </span>\n        </Tooltip>\n      )}\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    usageContainer: css({\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'flex-start',\n      gap: '17px',\n      padding: '8px 12px',\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderTopWidth: 0,\n      backgroundColor: theme.colors.background.primary,\n      alignItems: 'center',\n    }),\n    usageItem: css({\n      display: 'flex',\n      alignItems: 'center',\n      gap: '4px',\n      color: theme.colors.text.secondary,\n      opacity: '65%',\n    }),\n    clickableUsageItem: css({\n      backgroundColor: 'transparent',\n      border: 'none',\n    }),\n    menuItem: css({\n      color: theme.colors.text.primary,\n      textDecoration: 'none',\n      '&:hover': {\n        color: theme.colors.text.link,\n      },\n    }),\n    menuItemContent: css({\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      whiteSpace: 'nowrap',\n      color: theme.colors.text.primary,\n      '&:hover': {\n        color: theme.colors.text.link,\n      },\n    }),\n  };\n}\n","import {\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { type IconName } from '@grafana/ui';\nimport React from 'react';\n\nimport { type GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { logger } from 'tracking/logger/logger';\nimport { isCustomVariable } from 'utils/utils.variables';\nimport {\n  MetricsSorter,\n  VAR_WINGMAN_SORT_BY,\n  type SortingOption,\n} from 'WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter';\nimport { MetricsReducer } from 'WingmanDataTrail/MetricsReducer';\nimport { VAR_FILTERED_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport {\n  METRICS_VIZ_PANEL_HEIGHT,\n  METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW,\n} from 'WingmanDataTrail/MetricVizPanel/MetricVizPanel';\n\nimport { UsageData } from './UsageData';\n\ntype SortBy = Exclude<SortingOption, 'related'>;\n\nexport type WithUsageDataPreviewPanelState = SceneObjectState & {\n  vizPanelInGridItem: GmdVizPanel;\n  metric: string;\n  sortBy: SortBy;\n  usageCount: number;\n  singularUsageType: string;\n  pluralUsageType: string;\n  icon: IconName;\n  dashboardItems: Array<{ id: string; label: string; count: number; url: string }>;\n};\n\nexport class WithUsageDataPreviewPanel extends SceneObjectBase<WithUsageDataPreviewPanelState> {\n  constructor(state: Pick<WithUsageDataPreviewPanelState, 'vizPanelInGridItem' | 'metric'>) {\n    super({\n      ...state,\n      sortBy: 'default',\n      usageCount: 0,\n      singularUsageType: '',\n      pluralUsageType: '',\n      icon: '' as IconName,\n      dashboardItems: [],\n    });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _onActivate() {\n    let metricsReducer;\n\n    try {\n      metricsReducer = sceneGraph.getAncestor(this, MetricsReducer);\n    } catch {\n      return;\n    }\n\n    const filteredMetricsEngine = metricsReducer.state.enginesMap.get(VAR_FILTERED_METRICS_VARIABLE);\n    if (!filteredMetricsEngine) {\n      return;\n    }\n\n    const metricsSorter = sceneGraph.findByKeyAndType(this, 'metrics-sorter', MetricsSorter);\n    const sortByVar = sceneGraph.getVariables(metricsSorter).getByName(VAR_WINGMAN_SORT_BY);\n\n    if (isCustomVariable(sortByVar)) {\n      this.updateSortBy(metricsSorter, sortByVar.getValue() as SortBy);\n\n      this._subs.add(\n        sortByVar.subscribeToState(({ value }) => {\n          this.updateSortBy(metricsSorter, value as SortBy);\n        })\n      );\n    }\n  }\n\n  private async updateSortBy(metricsSorter: MetricsSorter, sortBy: SortBy) {\n    this.setState({ sortBy });\n    this.updateLayout(sortBy);\n\n    if (sortBy === 'default') {\n      return;\n    }\n\n    const usage = await metricsSorter.getUsageDetailsForMetric(this.state.metric, sortBy);\n\n    switch (sortBy) {\n      case 'dashboard-usage':\n        // FIXME: we do this only to satisfy TS Lord\n        if (usage.usageType !== 'dashboard-usage') {\n          return;\n        }\n\n        const { dashboards } = usage;\n\n        this.setState({\n          usageCount: usage.count,\n          singularUsageType: 'dashboard panel query',\n          pluralUsageType: 'dashboard panel queries',\n          icon: 'apps',\n          dashboardItems: Object.entries(dashboards)\n            .map(([label, dashboardInfo]) => ({\n              id: dashboardInfo.uid,\n              label,\n              count: dashboardInfo.count,\n              url: dashboardInfo.url,\n            }))\n            .sort((a, b) => b.count - a.count),\n        });\n        break;\n\n      case 'alerting-usage':\n        this.setState({\n          usageCount: usage.count,\n          singularUsageType: 'alert rule',\n          pluralUsageType: 'alert rules',\n          icon: 'bell',\n        });\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  private updateLayout(sortBy: WithUsageDataPreviewPanelState['sortBy']) {\n    const gridLayout = sceneGraph.getAncestor(this, SceneCSSGridLayout);\n    const currentGridLayoutHeight = gridLayout?.state.autoRows;\n\n    const expectedPanelHeight =\n      sortBy === 'default' ? METRICS_VIZ_PANEL_HEIGHT : METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW;\n\n    if (currentGridLayoutHeight !== expectedPanelHeight) {\n      gridLayout.setState({ autoRows: expectedPanelHeight });\n    }\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<WithUsageDataPreviewPanel>) => {\n    const { vizPanelInGridItem, sortBy, usageCount, singularUsageType, pluralUsageType, icon, dashboardItems } =\n      model.useState();\n\n    if (!vizPanelInGridItem) {\n      logger.log('no viz panel');\n      return;\n    }\n\n    return (\n      <div data-testid=\"with-usage-data-preview-panel\">\n        <vizPanelInGridItem.Component model={vizPanelInGridItem} />\n        {sortBy !== 'default' && (\n          <UsageData\n            usageType={sortBy}\n            usageCount={usageCount}\n            singularUsageType={singularUsageType}\n            pluralUsageType={pluralUsageType}\n            icon={icon}\n            dashboardItems={dashboardItems}\n          />\n        )}\n      </div>\n    );\n  };\n}\n","import { type Scope } from '@grafana/data';\nimport { SceneObjectBase, type SceneObjectState } from '@grafana/scenes';\n\nexport function getSelectedScopes(): Scope[] {\n  return [];\n}\n\nexport function getClosestScopesFacade(): ScopesFacade {\n  return new ScopesFacade();\n}\n\ninterface SelectedScope {\n  scope: Scope;\n  path: string[];\n}\n\ninterface ScopesFacadeState extends SceneObjectState {\n  // A callback that will be executed when new scopes are set\n  handler?: (facade: ScopesFacade) => void;\n  // The render count is a workaround to force the URL sync manager to update the URL with the latest scopes\n  // Basically it starts at 0, and it is increased with every scopes value update\n  renderCount?: number;\n}\n\nexport class ScopesFacade extends SceneObjectBase<ScopesFacadeState> {\n  private selectedScopes: SelectedScope[] = [];\n  private onScopesChangeCallbacks: Array<(scopes: SelectedScope[]) => void> = [];\n\n  constructor() {\n    super({});\n  }\n\n  public getSelectedScopes(): SelectedScope[] {\n    return this.selectedScopes;\n  }\n\n  public getSelectedScopesNames(): string[] {\n    return this.selectedScopes.map(({ scope }) => scope.metadata.name);\n  }\n\n  public setSelectedScopes(scopes: SelectedScope[]) {\n    this.selectedScopes = scopes;\n    this.notifySubscribers();\n  }\n\n  public onScopesChange(callback: (scopes: SelectedScope[]) => void) {\n    this.onScopesChangeCallbacks.push(callback);\n    return () => {\n      this.onScopesChangeCallbacks = this.onScopesChangeCallbacks.filter((cb) => cb !== callback);\n    };\n  }\n\n  private notifySubscribers() {\n    for (const callback of this.onScopesChangeCallbacks) {\n      callback(this.selectedScopes);\n    }\n  }\n\n  public get value() {\n    return getSelectedScopes();\n  }\n}\n\nexport function ScopesSelector(): null {\n  return null;\n}\n","import {\n  scopeFilterOperatorMap,\n  urlUtil,\n  type AdHocVariableFilter,\n  type GetTagResponse,\n  type MetricFindValue,\n  type RawTimeRange,\n  type Scope,\n  type ScopeSpecFilter,\n} from '@grafana/data';\nimport { getPrometheusTime } from '@grafana/prometheus';\nimport { config, getBackendSrv, getDataSourceSrv, type FetchResponse } from '@grafana/runtime';\nimport {\n  sceneGraph,\n  SceneTimeRange,\n  sceneUtils,\n  type AdHocFiltersVariable,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneVariable,\n  type SceneVariableState,\n} from '@grafana/scenes';\nimport { lastValueFrom } from 'rxjs';\n\nimport { logger } from 'tracking/logger/logger';\n\nimport { ROUTES } from './constants';\nimport { DataTrail, type DataTrailState } from './DataTrail';\nimport { type DataTrailSettings } from './DataTrailSettings';\nimport { type MetricDatasourceHelper } from './helpers/MetricDatasourceHelper';\nimport { MetricScene } from './MetricScene';\nimport { LOGS_METRIC, VAR_DATASOURCE_EXPR, VAR_FILTERS } from './shared';\nimport { getTrailStore } from './TrailStore/TrailStore';\nimport { getClosestScopesFacade } from './utils/utils.scopes';\nimport { isAdHocFiltersVariable } from './utils/utils.variables';\n\nexport function getTrailFor(model: SceneObject): DataTrail {\n  return sceneGraph.getAncestor(model, DataTrail);\n}\n\nexport function getTrailSettings(model: SceneObject): DataTrailSettings {\n  return sceneGraph.getAncestor(model, DataTrail).state.settings;\n}\n\nexport function newMetricsTrail(state?: Partial<DataTrailState>): DataTrail {\n  return new DataTrail({\n    initialDS: state?.initialDS,\n    $timeRange: state?.$timeRange ?? new SceneTimeRange({ from: 'now-1h', to: 'now' }),\n    embedded: state?.embedded ?? false,\n    ...state,\n  });\n}\n\nexport function getUrlForTrail(trail: DataTrail) {\n  const params = sceneUtils.getUrlState(trail);\n  return urlUtil.renderUrl(ROUTES.Drilldown, params);\n}\n\nexport function getCurrentPath(): Location['pathname'] {\n  return window.location.pathname;\n}\n\nexport function currentPathIncludes(path: string) {\n  return getCurrentPath().includes(path);\n}\n\nexport function getMetricSceneFor(model: SceneObject): MetricScene {\n  if (model instanceof MetricScene) {\n    return model;\n  }\n\n  if (model.parent) {\n    return getMetricSceneFor(model.parent);\n  }\n  const error = new Error('Unable to find graph view for model');\n  logger.error(error, { model: model.toString(), message: 'Unable to find graph view for model' });\n\n  throw error;\n}\n\nexport function getDataSource(trail: DataTrail) {\n  return sceneGraph.interpolate(trail, VAR_DATASOURCE_EXPR);\n}\n\nexport function getDataSourceName(dataSourceUid: string) {\n  return getDataSourceSrv().getInstanceSettings(dataSourceUid)?.name || dataSourceUid;\n}\n\nexport function getMetricName(metric?: string) {\n  if (!metric) {\n    return 'All metrics';\n  }\n\n  if (metric === LOGS_METRIC) {\n    return 'Logs';\n  }\n\n  return metric;\n}\n\nexport function getDatasourceForNewTrail(): string | undefined {\n  const prevTrail = getTrailStore().recent[0];\n  if (prevTrail) {\n    const prevDataSource = sceneGraph.interpolate(prevTrail.resolve(), VAR_DATASOURCE_EXPR);\n    if (prevDataSource.length > 0) {\n      return prevDataSource;\n    }\n  }\n  const promDatasources = getDataSourceSrv().getList({ type: 'prometheus' });\n  if (promDatasources.length > 0) {\n    const defaultDatasource = promDatasources.find((mds) => mds.isDefault);\n\n    return defaultDatasource?.uid ?? promDatasources[0].uid;\n  }\n  return undefined;\n}\n\nexport function getColorByIndex(index: number) {\n  const visTheme = config.theme2.visualization;\n  return visTheme.getColorByName(visTheme.palette[index % 8]);\n}\n\nexport type SceneTimeRangeState = SceneObjectState & {\n  from: string;\n  to: string;\n  timeZone?: string;\n};\n\nexport function getFilters(scene: SceneObject) {\n  const filters = sceneGraph.lookupVariable(VAR_FILTERS, scene);\n  if (isAdHocFiltersVariable(filters)) {\n    return filters.state.filters;\n  }\n  return null;\n}\n\n// frontend hardening limit\nconst MAX_ADHOC_VARIABLE_OPTIONS = 10000;\n\n/**\n * Add custom providers for the adhoc filters variable that limit the responses for labels keys and label values.\n * Currently hard coded to 10000.\n *\n * The current provider functions for adhoc filter variables are the functions getTagKeys and getTagValues in the data source.\n * This function still uses these functions from inside the data source helper.\n *\n * @param dataTrail\n * @param limitedFilterVariable this is the filters variable\n * @param datasourceHelper\n */\nexport function limitAdhocProviders(\n  dataTrail: DataTrail,\n  limitedFilterVariable: SceneVariable<SceneVariableState> | null,\n  datasourceHelper: MetricDatasourceHelper\n) {\n  if (!isAdHocFiltersVariable(limitedFilterVariable)) {\n    return;\n  }\n\n  limitedFilterVariable.setState({\n    getTagKeysProvider: async (): Promise<{\n      replace?: boolean;\n      values: GetTagResponse | MetricFindValue[];\n    }> => {\n      // For the Prometheus label names endpoint, '/api/v1/labels'\n      // get the previously selected filters from the variable\n      // to use in the query to filter the response\n      // using filters, e.g. {previously_selected_label:\"value\"},\n      // as the series match[] parameter in Prometheus labels endpoint\n      const filters = limitedFilterVariable.state.filters;\n      // call getTagKeys and truncate the response\n      // we're passing the queries so we get the labels that adhere to the queries\n      // we're also passing the scopes so we get the labels that adhere to the scopes filters\n\n      const opts = {\n        filters,\n        scopes: getClosestScopesFacade()?.value,\n        queries: limitedFilterVariable.state.useQueriesAsFilterForOptions ? dataTrail.getQueries() : [],\n      };\n\n      // if there are too many queries it takes to much time to process the requests.\n      // In this case we favour responsiveness over reducing the number of options.\n      if (opts.queries.length > 20) {\n        opts.queries = [];\n      }\n\n      let values = (await datasourceHelper.getTagKeys(opts)).slice(0, MAX_ADHOC_VARIABLE_OPTIONS);\n\n      // use replace: true to override the default lookup in adhoc filter variable\n      return { replace: true, values };\n    },\n    getTagValuesProvider: async (\n      _: AdHocFiltersVariable,\n      filter: AdHocVariableFilter\n    ): Promise<{\n      replace?: boolean;\n      values: GetTagResponse | MetricFindValue[];\n    }> => {\n      // For the Prometheus label values endpoint, /api/v1/label/${interpolatedName}/values\n      // get the previously selected filters from the variable\n      // to use in the query to filter the response\n      // using filters, e.g. {previously_selected_label:\"value\"},\n      // as the series match[] parameter in Prometheus label values endpoint\n      const filtersValues = limitedFilterVariable.state.filters;\n      // remove current selected filter if updating a chosen filter\n      const filters = filtersValues.filter((f) => f.key !== filter.key);\n      // call getTagValues and truncate the response\n      // we're passing the queries so we get the label values that adhere to the queries\n      // we're also passing the scopes so we get the label values that adhere to the scopes filters\n\n      const opts = {\n        key: filter.key,\n        filters,\n        scopes: getClosestScopesFacade()?.value,\n        queries: limitedFilterVariable.state.useQueriesAsFilterForOptions ? dataTrail.getQueries() : [],\n      };\n\n      // if there are too many queries it takes to much time to process the requests.\n      // In this case we favour responsiveness over reducing the number of options.\n      if (opts.queries.length > 20) {\n        opts.queries = [];\n      }\n\n      const values = (await datasourceHelper.getTagValues(opts)).slice(0, MAX_ADHOC_VARIABLE_OPTIONS);\n      // use replace: true to override the default lookup in adhoc filter variable\n      return { replace: true, values };\n    },\n  });\n}\n\nexport type SuggestionsResponse = {\n  data: string[];\n  status: 'success' | 'error';\n  error?: 'string';\n  warnings?: string[];\n};\n\n// Suggestions API is an API that receives adhoc filters, scopes and queries and returns the labels or label values that match the provided parameters\n// Under the hood it does exactly what the label and label values API where doing but the processing is done in the BE rather than in the FE\nexport async function callSuggestionsApi(\n  dataSourceUid: string,\n  timeRange: RawTimeRange,\n  scopes: Scope[],\n  adHocVariableFilters: AdHocVariableFilter[],\n  labelName: string | undefined,\n  limit: number | undefined,\n  requestId: string\n): Promise<FetchResponse<SuggestionsResponse>> {\n  return await lastValueFrom(\n    getBackendSrv().fetch<SuggestionsResponse>({\n      url: `/api/datasources/uid/${dataSourceUid}/resources/suggestions`,\n      data: {\n        labelName,\n        queries: [],\n        scopes: scopes.reduce<ScopeSpecFilter[]>((acc, scope) => {\n          acc.push(...scope.spec.filters);\n\n          return acc;\n        }, []),\n        adhocFilters: adHocVariableFilters.map((filter) => ({\n          key: filter.key,\n          operator: scopeFilterOperatorMap[filter.operator],\n          value: filter.value,\n          values: filter.values,\n        })),\n        start: getPrometheusTime(timeRange.from, false).toString(),\n        end: getPrometheusTime(timeRange.to, true).toString(),\n        limit,\n      },\n      requestId,\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    })\n  );\n}\n\ninterface SceneType<T> extends Function {\n  new (...args: never[]): T;\n}\n\nexport function findObjectOfType<T extends SceneObject>(\n  scene: SceneObject,\n  check: (obj: SceneObject) => boolean,\n  returnType: SceneType<T>\n) {\n  const obj = sceneGraph.findObject(scene, check);\n  if (obj instanceof returnType) {\n    return obj;\n  } else if (obj !== null) {\n    logger.warn(`invalid return type: ${returnType.toString()}`);\n  }\n\n  return null;\n}\n","export const localeCompare = new Intl.Collator('en', { sensitivity: 'base' }).compare;\n","import { SceneVariableValueChangedEvent, type QueryVariable, type VariableValueOption } from '@grafana/scenes';\nimport { cloneDeep, isEqual } from 'lodash';\n\nimport { type MetricOptions } from './MetricsVariable';\n\nexport type MetricFilters = {\n  categories: string[];\n  prefixes: string[];\n  suffixes: string[];\n  names: string[];\n};\n\nexport class MetricsVariableFilterEngine {\n  private variable: QueryVariable;\n  private initOptions: VariableValueOption[] = [];\n  private filters: MetricFilters = {\n    categories: [],\n    prefixes: [],\n    suffixes: [],\n    names: [],\n  };\n\n  constructor(variable: QueryVariable) {\n    this.variable = variable;\n  }\n\n  public setInitOptions(options: VariableValueOption[]) {\n    this.initOptions = cloneDeep(options);\n  }\n\n  /**\n   * Get a copy of the current filters\n   */\n  public getFilters(): MetricFilters {\n    return this.filters;\n  }\n\n  /**\n   * Compute options based on filters.\n   * @param options The options to filter\n   * @param filters The filters to apply\n   * @returns Filtered options\n   */\n  public static getFilteredOptions(options: VariableValueOption[], filters: MetricFilters): MetricOptions {\n    let filteredOptions = options as MetricOptions;\n\n    if (filters.categories.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applyCategoryFilters(filteredOptions, filters.categories);\n    }\n\n    if (filters.prefixes.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applyPrefixFilters(filteredOptions, filters.prefixes);\n    }\n\n    if (filters.suffixes.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applySuffixFilters(filteredOptions, filters.suffixes);\n    }\n\n    if (filters.names.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applyNameFilters(filteredOptions, filters.names);\n    }\n\n    return filteredOptions;\n  }\n\n  public applyFilters(filters: Partial<MetricFilters> = this.filters, settings = { forceUpdate: false, notify: true }) {\n    const updatedFilters: MetricFilters = {\n      ...this.filters,\n      ...filters,\n    };\n\n    if (!settings.forceUpdate && isEqual(this.filters, updatedFilters)) {\n      return;\n    }\n\n    if (\n      !updatedFilters.categories.length &&\n      !updatedFilters.prefixes.length &&\n      !updatedFilters.suffixes.length &&\n      !updatedFilters.names.length\n    ) {\n      this.filters = updatedFilters;\n\n      this.variable.setState({ options: this.initOptions });\n\n      if (settings.notify) {\n        this.notifyUpdate();\n      }\n\n      return;\n    }\n\n    this.filters = updatedFilters;\n\n    const filteredOptions = MetricsVariableFilterEngine.getFilteredOptions(this.initOptions, this.filters);\n\n    this.variable.setState({ options: filteredOptions });\n\n    if (settings.notify) {\n      this.notifyUpdate();\n    }\n  }\n\n  private static applyCategoryFilters(options: MetricOptions, categories: string[]): MetricOptions {\n    let filteredOptions: MetricOptions = [];\n\n    for (const category of categories) {\n      const categoryRegex = MetricsVariableFilterEngine.buildRegex(category, 'i'); // see e.g. computeRulesGroups (could apply to other categories in the future)\n      filteredOptions = filteredOptions.concat(options.filter((option) => categoryRegex.test(option.value)));\n    }\n\n    return filteredOptions;\n  }\n\n  private static applyPrefixFilters(options: MetricOptions, prefixes: string[]): MetricOptions {\n    const pattern = prefixes\n      .map((prefix) => {\n        // Multi-value support (see computeMetricPrefixGroups)\n        if (prefix.includes('|')) {\n          return `${prefix\n            .split('|')\n            .map((p) => `^${p}([^a-z0-9]|$)`)\n            .join('|')}`;\n        }\n\n        return `^${prefix}([^a-z0-9]|$)`;\n      })\n      .join('|');\n\n    const prefixesRegex = MetricsVariableFilterEngine.buildRegex(`(${pattern})`);\n\n    const filteredOptions = options.filter((option) => prefixesRegex.test(option.value as string));\n\n    return filteredOptions;\n  }\n\n  private static applySuffixFilters(options: MetricOptions, suffixes: string[]): MetricOptions {\n    const pattern = suffixes\n      .map((suffix) => {\n        // Multi-value support (see computeMetricSuffixGroups)\n        if (suffix.includes('|')) {\n          return `${suffix\n            .split('|')\n            .map((s) => `(^|[^a-z0-9])${s}$`)\n            .join('|')}`;\n        }\n\n        return `(^|[^a-z0-9])${suffix}$`;\n      })\n      .join('|');\n\n    const suffixesRegex = MetricsVariableFilterEngine.buildRegex(`(${pattern})`);\n\n    const filteredOptions = options.filter((option) => suffixesRegex.test(option.value as string));\n\n    return filteredOptions;\n  }\n\n  private static applyNameFilters(options: MetricOptions, names: string[]): MetricOptions {\n    const [namePatterns] = names;\n\n    const regexes = namePatterns\n      .split(',')\n      .map((p) => p.trim())\n      .filter(Boolean)\n      .map((r) => {\n        try {\n          return new RegExp(r);\n        } catch {\n          return null;\n        }\n      })\n      .filter(Boolean) as RegExp[];\n\n    return options.filter((option) => regexes.some((regex) => regex.test(option.value as string)));\n  }\n\n  private static buildRegex(pattern: string, flags?: string) {\n    try {\n      return new RegExp(pattern, flags);\n    } catch {\n      return new RegExp('.*');\n    }\n  }\n\n  private notifyUpdate() {\n    // hack to force SceneByVariableRepeater to re-render\n    this.variable.publishEvent(new SceneVariableValueChangedEvent(this.variable), true);\n  }\n}\n","import { getBackendSrv, type BackendSrvRequest } from '@grafana/runtime';\n\nimport { logger } from '../../../../tracking/logger/logger';\nimport { extractMetricNames } from '../../../../utils/utils.promql';\n\nimport type { MetricUsageDetails } from './fetchDashboardMetrics';\ninterface AlertingRule {\n  id: number;\n  uid: string;\n  title: string;\n  data: Array<{\n    refId: string;\n    queryType: string;\n    datasourceUid: string;\n    model: {\n      expr?: string;\n      expression?: string;\n      type?: string;\n      datasource?: {\n        type: string;\n        uid: string;\n      };\n    };\n  }>;\n}\n\nconst usageRequestOptions: Partial<BackendSrvRequest> = {\n  showSuccessAlert: false,\n  showErrorAlert: false,\n} as const;\n\n// TODO: update parseAlertingRules to do what the dashboards function does\nfunction transformCountsToAlertingUsage(counts: Record<string, number>): Record<string, MetricUsageDetails> {\n  const result: Record<string, MetricUsageDetails> = {};\n  for (const metric in counts) {\n    result[metric] = {\n      usageType: 'alerting-usage',\n      count: counts[metric],\n    };\n  }\n  return result;\n}\n\n/**\n * Fetches metric usage data from alerting rules\n * @returns A record mapping metric names to their occurrence count in alerting rules\n */\nexport async function fetchAlertingMetrics(): Promise<Record<string, MetricUsageDetails>> {\n  try {\n    const alertingRules = await getBackendSrv().get<AlertingRule[]>(\n      '/api/v1/provisioning/alert-rules',\n      undefined,\n      'grafana-metricsdrilldown-app-alert-rule-metric-usage',\n      usageRequestOptions\n    );\n\n    return transformCountsToAlertingUsage(parseAlertingRules(alertingRules));\n  } catch (err) {\n    const error = typeof err === 'string' ? new Error(err) : (err as Error);\n    logger.error(error, {\n      message: 'Failed to fetch alerting rules',\n    });\n    // Return empty object when fetch fails\n    return {};\n  }\n}\n\nfunction parseAlertingRules(alertingRules: AlertingRule[]): Record<string, number> {\n  // Create a map to count metric occurrences\n  const metricCounts: Record<string, number> = {};\n\n  const relevantRules = alertingRules.filter((rule) => rule?.data.length > 0);\n\n  for (const rule of relevantRules) {\n    // Skip non-Prometheus queries or expression queries (like threshold or reduce expressions)\n    const prometheusQueries = rule.data.filter(\n      (query) => typeof query.model?.expr === 'string' && query.datasourceUid !== '__expr__'\n    );\n\n    for (const query of prometheusQueries) {\n      try {\n        // Extract metrics from the PromQL expression\n        const metrics = extractMetricNames(query.model.expr as string);\n\n        // Count each metric occurrence\n        for (const metric of metrics) {\n          metricCounts[metric] = (metricCounts[metric] || 0) + 1;\n        }\n      } catch (error) {\n        // Log parsing errors but continue processing other expressions\n        logger.warn(error, {\n          message: `Failed to parse PromQL expression in alert rule ${rule.title}`,\n        });\n      }\n    }\n  }\n\n  return metricCounts;\n}\n","import { getBackendSrv, type BackendSrvRequest } from '@grafana/runtime';\nimport { type Dashboard, type Panel } from '@grafana/schema';\nimport { limitFunction } from 'p-limit';\n\nimport { logger } from '../../../../tracking/logger/logger';\nimport { isPrometheusDataSource } from '../../../../utils/utils.datasource';\nimport { extractMetricNames } from '../../../../utils/utils.promql';\n\ninterface DashboardSearchItem {\n  id: number;\n  uid: string;\n  title: string;\n  url: string;\n  folderTitle?: string;\n  folderUid?: string;\n  tags: string[];\n  isStarred: boolean;\n}\n\nexport type MetricUsageDetails =\n  | {\n      usageType: 'dashboard-usage';\n      count: number;\n      dashboards: Record<string, { count: number; uid: string; url: string }>;\n    } // e.g., {\"Dashboard A\": { count: 2, uid: \"123\" }}\n  | { usageType: 'alerting-usage'; count: number }; // TODO: implement `alerts: Record<string, number>`\n\ntype MetricUsageMap = Record<string, MetricUsageDetails>;\n\nconst usageRequestOptions: Partial<BackendSrvRequest> = {\n  showSuccessAlert: false,\n  showErrorAlert: false,\n} as const;\n\ntype DashboardWithUrl = Dashboard & { url: string };\n\nconst dashboardRequestMap = new Map<string, Promise<DashboardWithUrl | null>>();\n\nconst getDashboardLimited = limitFunction(\n  async (dashboardUid: string, url, dashboardRequestsFailedCount: number) => {\n    let promise = dashboardRequestMap.get(dashboardUid);\n\n    if (!promise) {\n      promise = getBackendSrv()\n        .get<{ dashboard: Dashboard }>(\n          `/api/dashboards/uid/${dashboardUid}`,\n          undefined,\n          `grafana-metricsdrilldown-app-dashboard-metric-usage-${dashboardUid}`,\n          usageRequestOptions\n        )\n        .then(({ dashboard }) => ({ ...dashboard, url } as DashboardWithUrl))\n        .catch((error) => {\n          // Prevent excessive noise\n          if (dashboardRequestsFailedCount <= 5) {\n            logger.error(error, { dashboardUid });\n          }\n\n          dashboardRequestsFailedCount++;\n          return Promise.resolve(null);\n        })\n        .finally(() => {\n          dashboardRequestMap.delete(dashboardUid);\n        });\n      dashboardRequestMap.set(dashboardUid, promise);\n    }\n\n    return promise;\n  },\n  { concurrency: 50 }\n);\n\n/**\n * Fetches metric usage data from dashboards\n * @returns A record mapping metric names to their dashboard usage data\n */\nexport async function fetchDashboardMetrics(): Promise<Record<string, MetricUsageDetails>> {\n  try {\n    const dashboards = await getBackendSrv().get<DashboardSearchItem[]>(\n      '/api/search',\n      {\n        type: 'dash-db',\n        limit: 500,\n      },\n      'grafana-metricsdrilldown-app-dashboard-search',\n      usageRequestOptions\n    );\n\n    let dashboardRequestsFailedCount = 0;\n\n    const metricCounts = await Promise.all(\n      dashboards.map(({ uid, url }) => getDashboardLimited(uid, url, dashboardRequestsFailedCount))\n    ).then(parseDashboardSearchResponse);\n\n    return metricCounts;\n  } catch (err) {\n    const error = typeof err === 'string' ? new Error(err) : (err as Error);\n    logger.error(error, {\n      message: 'Failed to fetch dashboard metrics',\n    });\n    return {};\n  }\n}\n\nfunction updateMetricUsage(\n  metric: string,\n  dashboardName: string,\n  dashboardUid: string,\n  dashboardUrl: string,\n  dashboardData: Record<string, MetricUsageDetails>\n): void {\n  if (!dashboardData[metric]) {\n    dashboardData[metric] = { usageType: 'dashboard-usage', count: 0, dashboards: {} };\n  }\n\n  dashboardData[metric].count++;\n  if (dashboardData[metric].usageType === 'dashboard-usage') {\n    dashboardData[metric].dashboards[dashboardName] = {\n      count: (dashboardData[metric].dashboards[dashboardName]?.count || 0) + 1,\n      uid: dashboardUid || 'unknown',\n      url: dashboardUrl,\n    };\n  }\n}\n\nfunction parseDashboardSearchResponse(dashboardSearchResponse: Array<DashboardWithUrl | null>): MetricUsageMap {\n  // Create a map to track metric names and their usage details\n  const dashboardData: Record<string, MetricUsageDetails> = {};\n\n  const relevantDashboards = dashboardSearchResponse.filter(\n    (dashboard) => dashboard && dashboard?.panels?.length\n  ) as Array<DashboardWithUrl & { panels: NonNullable<Panel[]> }>;\n  // For each dashboard, for each panel in that dashboard, for each query in that panel, what metrics does that query use\n  for (const dashboard of relevantDashboards) {\n    const dashboardName = dashboard.title || `Dashboard ${dashboard.uid}`;\n    // Skip panels with non-Prometheus data sources\n    const relevantPanels = dashboard.panels.filter(\n      (panel) => isPrometheusDataSource(panel.datasource) && 'targets' in panel && panel.targets?.length\n    ) as Array<Panel & { targets: NonNullable<Panel['targets']> }>;\n\n    for (const panel of relevantPanels) {\n      for (const target of panel.targets) {\n        const expr = typeof target.expr === 'string' ? target.expr : '';\n\n        const metrics = extractMetricNames(expr); // Array of metric names used in the query\n\n        // Count each metric occurrence\n        for (const metric of metrics) {\n          updateMetricUsage(metric, dashboardName, dashboard.uid || 'unknown', dashboard.url, dashboardData);\n        }\n      }\n    }\n  }\n  return dashboardData;\n}\n","import { fetchAlertingMetrics } from './fetchers/fetchAlertingMetrics';\nimport { fetchDashboardMetrics, type MetricUsageDetails } from './fetchers/fetchDashboardMetrics';\n\ninterface MetricsUsageState {\n  metrics: Record<string, MetricUsageDetails>;\n  metricsPromise: Promise<Record<string, MetricUsageDetails>> | undefined;\n  fetcher: () => Promise<Record<string, MetricUsageDetails>>;\n}\n\nexport type MetricUsageType = 'dashboard-usage' | 'alerting-usage';\n// Fetches and stores metric usage data for dashboards and alerting rules\nexport class MetricUsageFetcher {\n  private _usageState: Record<MetricUsageType, MetricsUsageState> = {\n    'dashboard-usage': {\n      metrics: {},\n      metricsPromise: undefined,\n      fetcher: fetchDashboardMetrics,\n    },\n    'alerting-usage': {\n      metrics: {},\n      metricsPromise: undefined,\n      fetcher: fetchAlertingMetrics,\n    },\n  };\n\n  public getUsageMetrics(usageType: MetricUsageType): Promise<Record<string, MetricUsageDetails>> {\n    const hasExistingMetrics =\n      this._usageState[usageType].metrics && Object.keys(this._usageState[usageType].metrics).length > 0;\n\n    if (hasExistingMetrics) {\n      return Promise.resolve(this._usageState[usageType].metrics);\n    }\n\n    if (!this._usageState[usageType].metricsPromise) {\n      this._usageState[usageType].metricsPromise = this._usageState[usageType].fetcher().then((metrics) => {\n        this._usageState[usageType].metrics = metrics;\n        this._usageState[usageType].metricsPromise = undefined;\n        return metrics;\n      });\n    }\n\n    return this._usageState[usageType].metricsPromise;\n  }\n\n  public getUsageForMetric(metricName: string, usageType: MetricUsageType): Promise<number> {\n    return this.getUsageMetrics(usageType).then((metrics) => metrics[metricName]?.count ?? 0);\n  }\n\n  public getUsageDetailsForMetric(metricName: string, usageType: MetricUsageType): Promise<MetricUsageDetails> {\n    return this.getUsageMetrics(usageType).then(\n      (metrics) =>\n        metrics[metricName] ??\n        (usageType === 'dashboard-usage'\n          ? { usageType: 'dashboard-usage', count: 0, dashboards: {} }\n          : { usageType: 'alerting-usage', count: 0 })\n    );\n  }\n}\n","import {\n  CustomVariable,\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n  VariableValueSelectors,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type VariableValueOption,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { localeCompare } from 'WingmanDataTrail/helpers/localCompare';\n\nimport { EventSortByChanged } from './events/EventSortByChanged';\nimport { type MetricUsageDetails } from './fetchers/fetchDashboardMetrics';\nimport { MetricUsageFetcher, type MetricUsageType } from './MetricUsageFetcher';\nimport { logger } from '../../../tracking/logger/logger';\nimport { PREF_KEYS } from '../../../UserPreferences/pref-keys';\nimport { userPreferences } from '../../../UserPreferences/userPreferences';\nexport type SortingOption = 'default' | 'dashboard-usage' | 'alerting-usage';\n\nconst MAX_RECENT_METRICS = 6;\nconst RECENT_METRICS_EXPIRY_DAYS = 30;\n\ninterface RecentMetric {\n  name: string;\n  timestamp: number;\n}\n\n/**\n * Adds a metric to the recent metrics list in localStorage\n * @param metricName The name of the metric to add\n */\nexport function addRecentMetric(metricName: string): void {\n  try {\n    const recentMetrics = getRecentMetrics();\n    const now = Date.now();\n\n    // Remove the metric if it already exists and add it with new timestamp\n    const filteredMetrics = recentMetrics.filter((m) => m.name !== metricName);\n    filteredMetrics.unshift({ name: metricName, timestamp: now });\n\n    // Keep only the most recent metrics\n    const updatedMetrics = filteredMetrics.slice(0, MAX_RECENT_METRICS);\n    userPreferences.setItem(PREF_KEYS.RECENT_METRICS, updatedMetrics);\n  } catch (error) {\n    const errorObject = error instanceof Error ? error : new Error(String(error));\n\n    logger.error(errorObject, {\n      ...(errorObject.cause || {}),\n      metricName,\n    });\n  }\n}\n\n/**\n * Gets the list of recent metrics from localStorage, removing expired ones\n * @returns Array of recent metric names\n */\nexport function getRecentMetrics(): RecentMetric[] {\n  try {\n    const recentMetrics: RecentMetric[] = userPreferences.getItem(PREF_KEYS.RECENT_METRICS) || [];\n    if (!recentMetrics.length) {\n      return [];\n    }\n\n    const now = Date.now();\n    const thirtyDaysAgo = now - RECENT_METRICS_EXPIRY_DAYS * 24 * 60 * 60 * 1000;\n\n    // Filter out expired metrics\n    const validMetrics = recentMetrics.filter((metric) => metric.timestamp > thirtyDaysAgo);\n\n    // If any metrics were removed, update storage\n    if (validMetrics.length !== recentMetrics.length) {\n      userPreferences.setItem(PREF_KEYS.RECENT_METRICS, validMetrics);\n    }\n\n    return validMetrics;\n  } catch (error) {\n    logger.error(error as Error, { message: 'Failed to get recent metrics:' });\n    return [];\n  }\n}\n\ninterface MetricsSorterState extends SceneObjectState {\n  $variables: SceneVariableSet;\n  inputControls: SceneObject;\n}\n\nexport const sortByOptions: VariableValueOption[] = [\n  { label: 'Default', value: 'default' },\n  { label: 'Dashboard Usage', value: 'dashboard-usage' },\n  { label: 'Alerting Usage', value: 'alerting-usage' },\n];\n\nexport const VAR_WINGMAN_SORT_BY = 'metrics-reducer-sort-by';\n\nexport class MetricsSorter extends SceneObjectBase<MetricsSorterState> {\n  initialized = false;\n  supportedSortByOptions = new Set<SortingOption>(['default', 'dashboard-usage', 'alerting-usage']);\n  private usageFetcher = new MetricUsageFetcher();\n\n  constructor(state: Partial<MetricsSorterState>) {\n    super({\n      ...state,\n      key: 'metrics-sorter',\n      $variables: new SceneVariableSet({\n        variables: [\n          new CustomVariable({\n            name: VAR_WINGMAN_SORT_BY,\n            label: 'Sort by',\n            value: 'default',\n            query: sortByOptions.map((option) => `${option.label} : ${option.value}`).join(','),\n            description:\n              'Sort metrics by default (alphabetically, with recently-selected metrics first), by prevalence in dashboard panel queries, or by prevalence in alerting rules',\n          }),\n        ],\n      }),\n      inputControls: new VariableValueSelectors({ layout: 'horizontal' }),\n    });\n\n    this.addActivationHandler(() => this.activationHandler());\n  }\n\n  private activationHandler() {\n    const sortByVar = sceneGraph.getVariables(this).getByName(VAR_WINGMAN_SORT_BY) as CustomVariable;\n\n    if (!this.supportedSortByOptions.has(sortByVar.getValue() as SortingOption)) {\n      // Migration for the old sortBy values\n      sortByVar.changeValueTo('default');\n    }\n\n    this._subs.add(\n      sortByVar.subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          this.publishEvent(new EventSortByChanged({ sortBy: newState.value as SortingOption }), true);\n        }\n      })\n    );\n  }\n\n  public getUsageDetailsForMetric(metricName: string, usageType: MetricUsageType): Promise<MetricUsageDetails> {\n    return this.usageFetcher.getUsageDetailsForMetric(metricName, usageType);\n  }\n\n  // Converts MetricUsageDetails format to simple counts (Record<string, number>) for backward compatibility with sorting logic\n  public getUsageMetrics(usageType: MetricUsageType): Promise<Record<string, number>> {\n    return this.usageFetcher.getUsageMetrics(usageType).then((metrics) => {\n      const metricsToCounts: Record<string, number> = {};\n      for (const metric in metrics) {\n        metricsToCounts[metric] = metrics[metric].count;\n      }\n      return metricsToCounts;\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsSorter>) => {\n    const { inputControls } = model.useState();\n\n    return (\n      <div data-testid=\"sort-by-select\">\n        <inputControls.Component model={inputControls} />\n      </div>\n    );\n  };\n}\n\n/**\n * Sort metrics by an arbitrary count (descending)\n * @param metrics Array of metric names\n * @param counts A record mapping metric names to an arbitrary count\n * @returns Sorted array of metric names\n */\nexport function sortMetricsByCount(metrics: string[], counts: Record<string, number>): string[] {\n  return [...metrics].sort((a, b) => {\n    const scoreA = counts[a] || 0;\n    const scoreB = counts[b] || 0;\n\n    // Primary sort by score (descending)\n    if (scoreB !== scoreA) {\n      return scoreB - scoreA;\n    }\n\n    // Secondary sort alphabetically for metrics with the same score\n    return localeCompare(a, b);\n  });\n}\n\n/**\n * Sort metrics in alphabetical order\n * @param metrics Array of metric names\n * @returns Sorted array of metric names in alphabetical order\n */\nexport function sortMetricsAlphabetically(metrics: string[]): string[] {\n  return [...metrics].sort((a, b) => localeCompare(a, b));\n}\n\n/**\n * Sort metrics with recent metrics first (by recency), then alphabetically\n * @param metrics Array of metric names\n * @returns Sorted array of metric names\n */\nexport function sortMetricsWithRecentFirst(metrics: string[]): string[] {\n  const allRecentMetrics = getRecentMetrics().map((m) => m.name);\n  const allRecentMetricsSet = new Set(allRecentMetrics);\n  const [recent, nonRecent] = metrics.reduce<[string[], string[]]>(\n    ([recent, nonRecent], metric) => {\n      if (allRecentMetricsSet.has(metric)) {\n        recent.push(metric);\n      } else {\n        nonRecent.push(metric);\n      }\n      return [recent, nonRecent];\n    },\n    [[], []]\n  );\n  const sortedNonRecent = sortMetricsAlphabetically(nonRecent);\n  // `recentMetrics` are already sorted by recency, so we just need to filter them\n  const sortedRecent = allRecentMetrics.filter((m) => recent.includes(m));\n\n  return [...sortedRecent, ...sortedNonRecent];\n}\n","import { isPrometheusDatasourceV11_6_x } from './v11-6-x';\nimport { isPrometheusDatasourceV12_0_0 } from './v12-0-0';\nimport { isPrometheusDatasourceV12_1_0Plus } from './v12-1-0-plus';\n\nexport const languageProviderVersionIs = {\n  '11.6.x': isPrometheusDatasourceV11_6_x,\n  '12.0.0': isPrometheusDatasourceV12_0_0,\n  '12.1.0-plus': isPrometheusDatasourceV12_1_0Plus,\n};\n","import {\n  type AbstractQuery,\n  type AdHocVariableFilter,\n  type LanguageProvider,\n  type Scope,\n  type TimeRange,\n} from '@grafana/data';\nimport { type PrometheusDatasource, type PromMetricsMetadata, type PromQuery } from '@grafana/prometheus';\nimport { type BackendSrvRequest } from '@grafana/runtime';\n\nimport { type PrometheusRuntimeDatasource } from '../../helpers/MetricDatasourceHelper';\nimport { type PromQLLabelMatcher } from '../../utils/utils.promql';\n\nexport interface PromQlLanguageProviderElevenDotSix extends LanguageProvider {\n  histogramMetrics: string[];\n  timeRange: TimeRange;\n  metrics: string[];\n  metricsMetadata?: PromMetricsMetadata;\n  startTask: Promise<any>;\n  datasource: PrometheusDatasource;\n  labelKeys: string[];\n  labelFetchTs: number;\n  getDefaultCacheHeaders():\n    | {\n        headers: {\n          'X-Grafana-Cache': string;\n        };\n      }\n    | undefined;\n  cleanText(s: string): string;\n  get syntax(): Prism.Grammar;\n  request: (url: string, defaultValue: any, params?: {}, options?: Partial<BackendSrvRequest>) => Promise<any>;\n  start: (timeRange?: TimeRange) => Promise<any[]>;\n  loadMetricsMetadata(): Promise<void>;\n  getLabelKeys(): string[];\n  importFromAbstractQuery(labelBasedQuery: AbstractQuery): PromQuery;\n  exportToAbstractQuery(query: PromQuery): AbstractQuery;\n  getSeries(selector: string, withName?: boolean): Promise<Record<string, string[]>>;\n  /**\n   * @param key\n   */\n  fetchLabelValues: (key: string) => Promise<string[]>;\n  getLabelValues(key: string): Promise<string[]>;\n  /**\n   * Fetches all label keys\n   */\n  fetchLabels: (timeRange?: TimeRange, queries?: PromQuery[]) => Promise<string[]>;\n  /**\n   * Gets series values\n   * Function to replace old getSeries calls in a way that will provide faster endpoints for new prometheus instances,\n   * while maintaining backward compatability\n   * @param labelName\n   * @param selector\n   */\n  getSeriesValues: (labelName: string, selector: string) => Promise<string[]>;\n  /**\n   * Fetches all values for a label, with optional match[]\n   * @param name\n   * @param match\n   * @param timeRange\n   * @param requestId\n   */\n  fetchSeriesValuesWithMatch: (\n    name: string,\n    match: string,\n    requestId?: string,\n    timeRange?: TimeRange\n  ) => Promise<string[]>;\n  /**\n   * Gets series labels\n   * Function to replace old getSeries calls in a way that will provide faster endpoints for new prometheus instances,\n   * while maintaining backward compatability. The old API call got the labels and the values in a single query,\n   * but with the new query we need two calls, one to get the labels, and another to get the values.\n   *\n   * @param selector\n   * @param otherLabels\n   */\n  getSeriesLabels: (selector: string, otherLabels: PromQLLabelMatcher[]) => Promise<string[]>;\n  /**\n   * Fetch labels using the best endpoint that datasource supports.\n   * This is cached by its args but also by the global timeRange currently selected as they can change over requested time.\n   * @param name\n   * @param withName\n   */\n  fetchLabelsWithMatch: (name: string, withName?: boolean) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch labels for a series using /series endpoint. This is cached by its args but also by the global timeRange currently selected as\n   * they can change over requested time.\n   * @param name\n   * @param withName\n   * @param withLimit\n   */\n  fetchSeriesLabels: (name: string, withName?: boolean, withLimit?: string) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch labels for a series using /labels endpoint.  This is cached by its args but also by the global timeRange currently selected as\n   * they can change over requested time.\n   * @param name\n   * @param withName\n   */\n  fetchSeriesLabelsMatch: (name: string, withName?: boolean) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch series for a selector. Use this for raw results. Use fetchSeriesLabels() to get labels.\n   * @param match\n   */\n  fetchSeries: (match: string) => Promise<Array<Record<string, string>>>;\n  /**\n   * Fetch this only one as we assume this won't change over time. This is cached differently from fetchSeriesLabels\n   * because we can cache more aggressively here and also we do not want to invalidate this cache the same way as in\n   * fetchSeriesLabels.\n   */\n  fetchDefaultSeries: () => Promise<{}>;\n  /**\n   * Fetch labels or values for a label based on the queries, scopes, filters and time range\n   * @param timeRange\n   * @param queries\n   * @param scopes\n   * @param adhocFilters\n   * @param labelName\n   * @param limit\n   * @param requestId\n   */\n  fetchSuggestions: (\n    timeRange?: TimeRange,\n    queries?: PromQuery[],\n    scopes?: Scope[],\n    adhocFilters?: AdHocVariableFilter[],\n    labelName?: string,\n    limit?: number,\n    requestId?: string\n  ) => Promise<string[]>;\n}\n\nexport function isPrometheusDatasourceV11_6_x(ds: PrometheusRuntimeDatasource): ds is PrometheusRuntimeDatasource & {\n  languageProvider: PromQlLanguageProviderElevenDotSix;\n} {\n  const languageProvider = ds.languageProvider as PromQlLanguageProviderElevenDotSix;\n\n  return (\n    // eslint-disable-next-line sonarjs/deprecation\n    typeof languageProvider.fetchLabelValues === 'function' && languageProvider.fetchLabelValues.length === 1\n  );\n}\n","import {\n  type AbstractQuery,\n  type AdHocVariableFilter,\n  type LanguageProvider,\n  type Scope,\n  type TimeRange,\n} from '@grafana/data';\nimport { type PrometheusDatasource, type PromMetricsMetadata, type PromQuery } from '@grafana/prometheus';\nimport { type BackendSrvRequest } from '@grafana/runtime';\n\nimport { type PrometheusRuntimeDatasource } from '../../helpers/MetricDatasourceHelper';\nimport { type PromQLLabelMatcher } from '../../utils/utils.promql';\n\nexport interface PromQlLanguageProviderTwelveDotZero extends LanguageProvider {\n  histogramMetrics: string[];\n  metrics: string[];\n  metricsMetadata?: PromMetricsMetadata;\n  startTask: Promise<any>;\n  datasource: PrometheusDatasource;\n  labelKeys: string[];\n  labelFetchTs: number;\n  getDefaultCacheHeaders():\n    | {\n        headers: {\n          'X-Grafana-Cache': string;\n        };\n      }\n    | undefined;\n  cleanText(s: string): string;\n  get syntax(): Prism.Grammar;\n  request: (url: string, defaultValue: any, params?: {}, options?: Partial<BackendSrvRequest>) => Promise<any>;\n  start: (timeRange?: TimeRange) => Promise<any[]>;\n  loadMetricsMetadata(): Promise<void>;\n  getLabelKeys(): string[];\n  importFromAbstractQuery(labelBasedQuery: AbstractQuery): PromQuery;\n  exportToAbstractQuery(query: PromQuery): AbstractQuery;\n  getSeries(timeRange: TimeRange, selector: string, withName?: boolean): Promise<Record<string, string[]>>;\n  fetchLabelValues: (range: TimeRange, key: string) => Promise<string[]>;\n  getLabelValues(range: TimeRange, key: string): Promise<string[]>;\n  /**\n   * Fetches all label keys\n   */\n  fetchLabels: (timeRange: TimeRange, queries?: PromQuery[]) => Promise<string[]>;\n  /**\n   * Gets series values\n   * Function to replace old getSeries calls in a way that will provide faster endpoints\n   * for new prometheus instances, while maintaining backward compatability\n   */\n  getSeriesValues: (timeRange: TimeRange, labelName: string, selector: string) => Promise<string[]>;\n  /**\n   * Fetches all values for a label, with optional match[]\n   * @param name\n   * @param match\n   * @param timeRange\n   * @param requestId\n   */\n  fetchSeriesValuesWithMatch: (\n    timeRange: TimeRange,\n    name: string,\n    match: string,\n    requestId?: string\n  ) => Promise<string[]>;\n  /**\n   * Gets series labels\n   * Function to replace old getSeries calls in a way that will provide faster endpoints for new prometheus instances,\n   * while maintaining backward compatability. The old API call got the labels and the values in a single query,\n   * but with the new query we need two calls, one to get the labels, and another to get the values.\n   *\n   * @param selector\n   * @param otherLabels\n   */\n  getSeriesLabels: (timeRange: TimeRange, selector: string, otherLabels: PromQLLabelMatcher[]) => Promise<string[]>;\n  /**\n   * Fetch labels using the best endpoint that datasource supports.\n   * This is cached by its args but also by the global timeRange currently selected as they can change over requested time.\n   */\n  fetchLabelsWithMatch: (timeRange: TimeRange, name: string, withName?: boolean) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch labels for a series using /series endpoint. This is cached by its args but also by the global timeRange currently selected as\n   * they can change over requested time.\n   */\n  fetchSeriesLabels: (\n    timeRange: TimeRange,\n    name: string,\n    withName?: boolean,\n    withLimit?: string\n  ) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch labels for a series using /labels endpoint.  This is cached by its args but also by the global timeRange currently selected as\n   * they can change over requested time.\n   */\n  fetchSeriesLabelsMatch: (timeRange: TimeRange, name: string, withName?: boolean) => Promise<Record<string, string[]>>;\n  /**\n   * Fetch series for a selector. Use this for raw results. Use fetchSeriesLabels() to get labels.\n   */\n  fetchSeries: (timeRange: TimeRange, match: string) => Promise<Array<Record<string, string>>>;\n  /**\n   * Fetch this only one as we assume this won't change over time. This is cached differently from fetchSeriesLabels\n   * because we can cache more aggressively here and also we do not want to invalidate this cache the same way as in\n   * fetchSeriesLabels.\n   */\n  fetchDefaultSeries: (timeRange: TimeRange) => Promise<{}>;\n  /**\n   * Fetch labels or values for a label based on the queries, scopes, filters and time range\n   * @param timeRange\n   * @param queries\n   * @param scopes\n   * @param adhocFilters\n   * @param labelName\n   * @param limit\n   * @param requestId\n   */\n  fetchSuggestions: (\n    timeRange?: TimeRange,\n    queries?: PromQuery[],\n    scopes?: Scope[],\n    adhocFilters?: AdHocVariableFilter[],\n    labelName?: string,\n    limit?: number,\n    requestId?: string\n  ) => Promise<string[]>;\n}\n\nexport function isPrometheusDatasourceV12_0_0(ds: PrometheusRuntimeDatasource): ds is PrometheusRuntimeDatasource & {\n  languageProvider: PromQlLanguageProviderTwelveDotZero;\n} {\n  const languageProvider = ds.languageProvider as PromQlLanguageProviderTwelveDotZero;\n\n  // eslint-disable-next-line sonarjs/deprecation\n  return typeof languageProvider.fetchLabelValues === 'function' && languageProvider.fetchLabelValues.length > 1;\n}\n","import { type PrometheusDatasource } from '@grafana/prometheus';\n\nimport { type PrometheusRuntimeDatasource } from 'helpers/MetricDatasourceHelper';\n\nexport function isPrometheusDatasourceV12_1_0Plus(ds: PrometheusRuntimeDatasource): ds is PrometheusDatasource {\n  return typeof (ds.languageProvider as PrometheusDatasource['languageProvider']).queryLabelKeys === 'function';\n}\n","import {\n  type DataSourceGetTagKeysOptions,\n  type DataSourceGetTagValuesOptions,\n  type MetricFindValue,\n  type TimeRange,\n} from '@grafana/data';\nimport {\n  type PrometheusDatasource,\n  type PromMetricsMetadata,\n  type PromMetricsMetadataItem,\n  type PromQuery,\n} from '@grafana/prometheus';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { sceneGraph, type DataSourceVariable, type SceneObject } from '@grafana/scenes';\n\nimport { displayError } from 'WingmanDataTrail/helpers/displayStatus';\n\nimport { type DataTrail } from '../DataTrail';\nimport { VAR_DATASOURCE, VAR_DATASOURCE_EXPR } from '../shared';\nimport { languageProviderVersionIs } from '../types/language-provider/versionCheck';\nimport { isPrometheusDataSource } from '../utils/utils.datasource';\n\n/**\n * When we fetch the Prometheus data source with `@grafana/runtime`, its language provider\n * could be one of multiple flavors that we need to support. We use this type to represent\n * the Prometheus data source before we have checked the version of the language provider.\n * The language provider version is then checked with the `languageProviderVersionIs` helper.\n */\nexport type PrometheusRuntimeDatasource = Omit<PrometheusDatasource, 'languageProvider'> & {\n  languageProvider: unknown;\n};\n\nexport class MetricDatasourceHelper {\n  constructor(trail: DataTrail) {\n    this._trail = trail;\n  }\n\n  public reset() {\n    this._datasource = undefined;\n    this._metricsMetadata = undefined;\n    this._classicHistograms = {};\n    this._nativeHistograms = [];\n  }\n\n  private _trail: DataTrail;\n\n  private _datasource?: PrometheusRuntimeDatasource;\n\n  private async getDatasource() {\n    if (this._datasource) {\n      return this._datasource;\n    }\n\n    const ds = await getDataSourceSrv().get(VAR_DATASOURCE_EXPR, { __sceneObject: { value: this._trail } });\n\n    if (isPrometheusDataSource(ds)) {\n      this._datasource = ds;\n    }\n\n    return this._datasource;\n  }\n\n  // store metadata in a more easily accessible form\n  _metricsMetadata?: PromMetricsMetadata;\n\n  private async _ensureMetricsMetadata(): Promise<void> {\n    if (this._metricsMetadata) {\n      return;\n    }\n\n    await this._getMetricsMetadata();\n  }\n\n  private async _getMetricsMetadata(): Promise<void> {\n    const ds = await this.getDatasource();\n\n    if (!ds) {\n      return;\n    }\n\n    const queryMetadata = getQueryMetricsMetadata(ds);\n    const loadMetadata = getLoadMetricsMetadata(ds, queryMetadata);\n\n    let metadata = await queryMetadata();\n\n    if (!metadata) {\n      metadata = await loadMetadata();\n    }\n\n    this._metricsMetadata = metadata;\n  }\n\n  public async getMetadataForMetric(metric?: string) {\n    if (!metric) {\n      return undefined;\n    }\n    await this._ensureMetricsMetadata();\n\n    return this._metricsMetadata?.[metric];\n  }\n\n  private _classicHistograms: Record<string, number> = {};\n  private _nativeHistograms: string[] = [];\n\n  public listNativeHistograms() {\n    return this._nativeHistograms;\n  }\n\n  /**\n   * Identify native histograms by 2 strategies.\n   * 1. querying classic histograms and all metrics,\n   * then comparing the results and build the collection of native histograms.\n   * 2. querying all metrics and checking if the metric is a histogram type and dies not have the bucket suffix.\n   *\n   * classic histogram = test_metric_bucket\n   * native histogram = test_metric\n   */\n  public async initializeHistograms() {\n    const ds = await this.getDatasource();\n    if (ds && Object.keys(this._classicHistograms).length === 0) {\n      const classicHistogramsCall = ds.metricFindQuery('metrics(.*_bucket)');\n      const allMetricsCall = ds.metricFindQuery('metrics(.+)');\n\n      const [classicHistograms, allMetrics] = await Promise.all([classicHistogramsCall, allMetricsCall]);\n\n      classicHistograms.forEach((m) => {\n        this._classicHistograms[m.text] = 1;\n      });\n\n      await this._ensureMetricsMetadata();\n\n      allMetrics.forEach((m) => {\n        if (this.isNativeHistogram(m.text)) {\n          // Build the collection of native histograms.\n          this.addNativeHistogram(m.text);\n        }\n      });\n    }\n  }\n\n  /**\n   * Identify native histograms by 2 strategies.\n   * 1. querying classic histograms and all metrics,\n   * then comparing the results and build the collection of native histograms.\n   * 2. querying all metrics and checking if the metric is a histogram type and dies not have the bucket suffix.\n   *\n   * classic histogram = test_metric_bucket\n   * native histogram = test_metric\n   *\n   * @param metric\n   * @returns boolean\n   */\n  public isNativeHistogram(metric: string): boolean {\n    if (!metric) {\n      return false;\n    }\n\n    // check when fully migrated, we only have metadata, and there are no more classic histograms\n    const metadata = this._metricsMetadata;\n    // suffix is not 'bucket' and type is histogram\n    const suffix: string = metric.split('_').pop() ?? '';\n    // the string is not equal to bucket\n    const notClassic = suffix !== 'bucket';\n    if (metadata?.[metric]?.type === 'histogram' && notClassic) {\n      return true;\n    }\n\n    // check for comparison when there is overlap between native and classic histograms\n    return this._classicHistograms[`${metric}_bucket`] > 0;\n  }\n\n  private addNativeHistogram(metric: string) {\n    if (!this._nativeHistograms.includes(metric)) {\n      this._nativeHistograms.push(metric);\n    }\n  }\n\n  /**\n   * Used for additional filtering for adhoc vars labels in Metrics Drilldown.\n   * @param options\n   * @returns\n   */\n  public async getTagKeys(options: DataSourceGetTagKeysOptions<PromQuery>): Promise<MetricFindValue[]> {\n    const ds = await this.getDatasource();\n\n    if (!ds) {\n      return [];\n    }\n\n    const keys = await ds.getTagKeys(options);\n    return keys;\n  }\n\n  /**\n   * Used for additional filtering for adhoc vars label values in Metrics Drilldown.\n   * @param options\n   * @returns\n   */\n  public async getTagValues(options: DataSourceGetTagValuesOptions<PromQuery>) {\n    const ds = await this.getDatasource();\n\n    if (!ds) {\n      return [];\n    }\n\n    options.key = unwrapQuotes(options.key);\n    const keys = await ds.getTagValues(options);\n    return keys;\n  }\n\n  /**\n   * Fetches available labels from a Prometheus datasource with version compatibility.\n   *\n   * This method abstracts the complexity of supporting multiple versions of `@grafana/prometheus`\n   * spanning from 11.6.0 up to the latest 12.x versions. It detects which API style the current\n   * datasource supports and calls the appropriate method with the correct signature.\n   * It handles three different `@grafana/prometheus` API styles:\n   *\n   * 1. **(12.1.0+)**: Uses the modern `queryLabelKeys` method\n   * 2. **(12.0.0)**: Uses `fetchLabelsWithMatch` with timeRange parameter\n   * 3. **(11.6.0-11.x)**: Uses `fetchLabelsWithMatch` without timeRange parameter\n   *\n   * @param params - Configuration object containing datasource, time range, and matcher\n   * @param params.ds - The Prometheus datasource instance\n   * @param params.timeRange - Time range for the query\n   * @param params.matcher - PromQL matcher string to filter labels (e.g., '{job=\"prometheus\"}')\n   * @returns Promise that resolves to an array of available label keys\n   *\n   * @example\n   * ```typescript\n   * const labels = await MetricDatasourceHelper.fetchLabels({\n   *   ds: prometheusDatasource,\n   *   timeRange: { from: 'now-1h', to: 'now' },\n   *   matcher: '{job=\"prometheus\"}'\n   * });\n   * ```\n   */\n  public static fetchLabels(params: FetchLabelsOptions): Promise<string[]> {\n    const { timeRange, matcher } = params;\n    const ds = params.ds;\n\n    if (languageProviderVersionIs['12.1.0-plus'](ds)) {\n      return ds.languageProvider.queryLabelKeys(timeRange, matcher);\n    } else if (languageProviderVersionIs['12.0.0'](ds)) {\n      return ds.languageProvider.fetchLabelsWithMatch(timeRange, matcher).then((labels) => Object.keys(labels));\n    } else if (languageProviderVersionIs['11.6.x'](ds)) {\n      return ds.languageProvider.fetchLabelsWithMatch(matcher).then((labels) => Object.keys(labels));\n    }\n\n    throw new Error('Unsupported language provider version');\n  }\n\n  /**\n   * Fetches available values for a specific label from a Prometheus datasource with version compatibility.\n   *\n   * This method abstracts the complexity of supporting multiple versions of `@grafana/prometheus`\n   * spanning from 11.6.0 up to the latest 12.x versions. It detects which API style the current\n   * datasource supports and calls the appropriate method with the correct signature.\n   * It handles three different `@grafana/prometheus` API styles:\n   *\n   * 1. **(12.1.0+)**: Uses the modern `queryLabelValues` method\n   * 2. **(12.0.0)**: Uses `fetchLabelValues` or `fetchSeriesValuesWithMatch` with timeRange parameter\n   * 3. **(11.6.0-11.x)**: Uses `fetchLabelValues` or `fetchSeriesValuesWithMatch` without timeRange parameter\n   *\n   * @param params - Configuration object containing datasource, label name, time range, and optional matcher\n   * @param params.ds - The Prometheus datasource instance\n   * @param params.labelName - The name of the label to fetch values for (e.g., 'job', 'instance')\n   * @param params.timeRange - Time range for the query\n   * @param params.matcher - Optional PromQL matcher string to filter results (e.g., '{job=\"prometheus\"}')\n   * @returns Promise that resolves to an array of available values for the specified label\n   *\n   * @example\n   * ```typescript\n   * const jobValues = await MetricDatasourceHelper.fetchLabelValues({\n   *   ds: prometheusDatasource,\n   *   labelName: 'job',\n   *   timeRange: { from: 'now-1h', to: 'now' },\n   *   matcher: '{__name__=~\".*_total\"}'\n   * });\n   * ```\n   */\n  public static fetchLabelValues(params: FetchLabelValuesOptions) {\n    const { labelName, timeRange, matcher = '' } = params;\n    const ds = params.ds as PrometheusRuntimeDatasource;\n\n    if (languageProviderVersionIs['12.1.0-plus'](ds)) {\n      return ds.languageProvider.queryLabelValues(timeRange, labelName, matcher);\n    }\n\n    if (languageProviderVersionIs['12.0.0'](ds)) {\n      // If a matcher isn't provided, use the simpler `fetchLabelValues` method.\n      const fetchLabelValuesWithOptionalMatcher = matcher\n        ? ds.languageProvider.fetchSeriesValuesWithMatch\n        : ds.languageProvider.fetchLabelValues;\n\n      return fetchLabelValuesWithOptionalMatcher(timeRange, labelName, matcher);\n    }\n\n    if (languageProviderVersionIs['11.6.x'](ds)) {\n      // If a matcher isn't provided, use the simpler `fetchLabelValues` method.\n      const fetchLabelValuesWithOptionalMatcher = matcher\n        ? ds.languageProvider.fetchSeriesValuesWithMatch\n        : ds.languageProvider.fetchLabelValues;\n\n      return fetchLabelValuesWithOptionalMatcher(labelName, matcher);\n    }\n\n    throw new Error('Unsupported language provider version');\n  }\n\n  public static async getPrometheusDataSourceForScene(\n    sceneObject: SceneObject\n  ): Promise<PrometheusDatasource | undefined> {\n    try {\n      const dsVariable = sceneGraph.findByKey(sceneObject, VAR_DATASOURCE) as DataSourceVariable;\n      const uid = (dsVariable?.state.value as string) ?? '';\n      const ds = await getDataSourceSrv().get({ uid });\n\n      return ds as unknown as PrometheusDatasource; // we trust that VAR_DATASOURCE has been set to a Prometheus datasource\n    } catch (error) {\n      displayError(error as Error, ['Error while getting the Prometheus data source!']);\n      return undefined;\n    }\n  }\n}\n\ninterface FetchLabelsOptions {\n  ds: PrometheusRuntimeDatasource;\n  timeRange: TimeRange;\n  matcher: string;\n}\n\ninterface FetchLabelValuesOptions {\n  ds: PrometheusRuntimeDatasource;\n  timeRange: TimeRange;\n  labelName: string;\n  matcher?: string;\n}\n\nexport function getMetricDescription(metadata?: PromMetricsMetadataItem) {\n  if (!metadata) {\n    return undefined;\n  }\n\n  const { type, help, unit } = metadata;\n\n  const lines = [\n    help, //\n    type && `**Type:** *${type}*`,\n    unit && `**Unit:** ${unit}`,\n  ];\n\n  return lines.join('\\n\\n');\n}\n\nfunction unwrapQuotes(value: string): string {\n  if (value === '' || !isWrappedInQuotes(value)) {\n    return value;\n  }\n  return value.slice(1, -1);\n}\n\nfunction isWrappedInQuotes(value: string): boolean {\n  const wrappedInQuotes = /^\".*\"$/;\n  return wrappedInQuotes.test(value);\n}\n\nfunction getQueryMetricsMetadata(ds: PrometheusRuntimeDatasource) {\n  if (languageProviderVersionIs['12.1.0-plus'](ds)) {\n    return ds.languageProvider.queryMetricsMetadata;\n  }\n\n  if (languageProviderVersionIs['12.0.0'](ds) || languageProviderVersionIs['11.6.x'](ds)) {\n    return () => Promise.resolve(ds.languageProvider.metricsMetadata);\n  }\n\n  throw new Error('Unsupported language provider version');\n}\n\nfunction getLoadMetricsMetadata(\n  ds: PrometheusRuntimeDatasource,\n  queryMetadata: () => Promise<PromMetricsMetadata | undefined>\n) {\n  if (languageProviderVersionIs['12.1.0-plus'](ds)) {\n    return ds.languageProvider.retrieveMetricsMetadata;\n  }\n\n  if (languageProviderVersionIs['12.0.0'](ds) || languageProviderVersionIs['11.6.x'](ds)) {\n    return () => (ds.languageProvider.loadMetricsMetadata?.() ?? Promise.resolve()).then(() => queryMetadata());\n  }\n\n  throw new Error('Unsupported language provider version');\n}\n","import { css } from '@emotion/css';\nimport { dateTimeFormat, type GrafanaTheme2 } from '@grafana/data';\nimport { sceneGraph } from '@grafana/scenes';\nimport { Card, IconButton, useStyles2 } from '@grafana/ui';\nimport React, { useMemo } from 'react';\n\nimport { type DataTrail } from './DataTrail';\nimport { VAR_FILTERS } from './shared';\nimport { getTrailStore, type DataTrailBookmark } from './TrailStore/TrailStore';\nimport { getMetricName } from './utils';\nimport { isAdHocFiltersVariable } from './utils/utils.variables';\n\nexport type Props = {\n  trail?: DataTrail;\n  bookmark?: DataTrailBookmark;\n  onSelect: () => void;\n  onDelete?: () => void;\n  wide?: boolean;\n  compactHeight?: boolean;\n};\n\n// Helper function to truncate the value for a single key:value pair\nconst truncateValue = (key: string, value: string, maxLength: number) => {\n  const combinedLength = key.length + 2 + value.length; // 2 for \": \"\n  if (combinedLength > maxLength) {\n    return value.substring(0, maxLength - key.length - 5) + '...'; // 5 for \": \" and \"...\"\n  }\n  return value;\n};\n\nexport function DataTrailCard(props: Readonly<Props>) {\n  const { onSelect, onDelete, bookmark } = props;\n  const styles = useStyles2(getStyles);\n\n  const values = useMemo(() => {\n    let trail = props.trail || (bookmark && getTrailStore().getTrailForBookmark(bookmark));\n\n    if (!trail) {\n      return null;\n    }\n\n    const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, trail)!;\n    if (!isAdHocFiltersVariable(filtersVariable)) {\n      return null;\n    }\n\n    const createdAt = bookmark?.createdAt || trail.state.createdAt;\n\n    return {\n      filters: filtersVariable.state.filters,\n      metric: trail.state.metric,\n      createdAt,\n    };\n  }, [props.trail, bookmark]);\n\n  if (!values) {\n    return null;\n  }\n\n  const { filters, metric, createdAt } = values;\n\n  const heading = truncateValue('', getMetricName(metric), 27);\n  const cardHeightClassName = `${props.compactHeight && filters.length > 0 ? styles.cardTall : ''}`;\n  const cardClassName = `${styles.card} ${props.wide ? styles.cardWide : ''} ${cardHeightClassName}`;\n  return (\n    <article data-testid={`data-trail-card ${heading}`}>\n      <Card onClick={onSelect} className={cardClassName}>\n        <Card.Heading>\n          <div className={styles.metricValue}>{heading}</div>\n        </Card.Heading>\n        <Card.Meta className={styles.meta}>\n          {filters.map((f) => (\n            <span key={f.key}>\n              <div className={styles.secondaryFont}>{f.key}: </div>\n              <div className={styles.primaryFont}>{truncateValue(f.key, f.value, 44)}</div>\n            </span>\n          ))}\n        </Card.Meta>\n        <div className={styles.deleteButton}>\n          {onDelete && (\n            <Card.SecondaryActions>\n              <IconButton\n                key=\"delete\"\n                name=\"trash-alt\"\n                className={styles.secondary}\n                tooltip=\"Remove bookmark\"\n                onClick={onDelete}\n                data-testid=\"deleteButton\"\n              />\n            </Card.SecondaryActions>\n          )}\n        </div>\n      </Card>\n      <div className={styles.date}>\n        <div className={styles.secondaryFont}>Date created: </div>\n        <div className={styles.primaryFont}>{createdAt > 0 && dateTimeFormat(createdAt, { format: 'YYYY-MM-DD' })}</div>\n      </div>\n    </article>\n  );\n}\n\nexport function getStyles(theme: GrafanaTheme2) {\n  return {\n    metricValue: css({\n      display: 'inline',\n      color: theme.colors.text.primary,\n      fontWeight: 500,\n      wordBreak: 'break-all',\n    }),\n    card: css({\n      position: 'relative',\n      width: '318px',\n      padding: `12px ${theme.spacing(2)} ${theme.spacing(1)} ${theme.spacing(2)}`,\n      alignItems: 'start',\n      marginBottom: 0,\n      borderTop: `1px solid ${theme.colors.border.weak}`,\n      borderRight: `1px solid ${theme.colors.border.weak}`,\n      borderLeft: `1px solid ${theme.colors.border.weak}`,\n      borderBottom: 'none', // Remove the bottom border\n      borderRadius: '2px 2px 0 0', // Top-left and top-right corners are 2px, bottom-left and bottom-right are 0; cannot use theme.shape.radius.default because need bottom corners to be 0\n    }),\n    cardWide: css({\n      width: '100%',\n    }),\n    cardTall: css({\n      height: '110px',\n    }),\n    secondary: css({\n      color: theme.colors.text.secondary,\n      fontSize: '12px',\n    }),\n    date: css({\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderRadius: '0 0 2px 2px',\n      padding: `${theme.spacing(1)} ${theme.spacing(2)}`,\n      backgroundColor: theme.colors.background.primary,\n    }),\n    meta: css({\n      flexWrap: 'wrap',\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      maxHeight: '36px', // 2 lines * 18px line-height\n      margin: 0,\n      gridArea: 'Meta',\n      color: theme.colors.text.secondary,\n      whiteSpace: 'nowrap',\n    }),\n    primaryFont: css({\n      display: 'inline',\n      color: theme.colors.text.primary,\n      fontSize: '12px',\n      fontWeight: '500',\n      letterSpacing: '0.018px',\n    }),\n    secondaryFont: css({\n      display: 'inline',\n      color: theme.colors.text.secondary,\n      fontSize: '12px',\n      fontWeight: '400',\n      lineHeight: '18px' /* 150% */,\n      letterSpacing: '0.018px',\n    }),\n    deleteButton: css({\n      position: 'absolute',\n      bottom: theme.spacing(1),\n      right: theme.spacing(1),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { useState } from 'react';\n\nimport { SectionTitle } from './SectionTitle';\nimport { type SideBarSectionState } from './types';\nimport { DataTrailCard } from '../../../DataTrailCard';\nimport { reportExploreMetrics } from '../../../interactions';\nimport { getBookmarkKey, getTrailStore } from '../../../TrailStore/TrailStore';\n\n// Create a simple event-based system to avoid circular dependencies\nexport const navigationEvents = {\n  listeners: new Set<(trail: any) => void>(),\n  emit: function (trail: any) {\n    this.listeners.forEach((listener) => listener(trail));\n  },\n  subscribe: function (listener: (trail: any) => void) {\n    this.listeners.add(listener);\n    return () => {\n      this.listeners.delete(listener);\n      return undefined; // Explicitly return void\n    };\n  },\n};\n\n// Simple function to navigate to a trail without using MetricsContext\nfunction goToUrlForTrail(trail: any) {\n  navigationEvents.emit(trail);\n}\n\nexport interface BookmarksListState extends SideBarSectionState {}\n\nexport class BookmarksList extends SceneObjectBase<BookmarksListState> {\n  constructor({\n    key,\n    title,\n    description,\n    icon,\n    disabled,\n  }: {\n    key: BookmarksListState['key'];\n    title: BookmarksListState['title'];\n    description: BookmarksListState['description'];\n    icon: BookmarksListState['icon'];\n    disabled?: BookmarksListState['disabled'];\n  }) {\n    super({\n      key,\n      title,\n      description,\n      icon,\n      disabled: disabled ?? false,\n      active: false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {}\n\n  public static readonly Component = ({ model }: SceneComponentProps<BookmarksList>) => {\n    const styles = useStyles2(getStyles);\n    const { title, description } = model.useState();\n    const { bookmarks } = getTrailStore();\n    const [, setLastDelete] = useState(Date.now());\n\n    const onSelect = (index: number) => {\n      reportExploreMetrics('exploration_started', { cause: 'bookmark_clicked' });\n      const trail = getTrailStore().getTrailForBookmarkIndex(index);\n      getTrailStore().setRecentTrail(trail);\n      goToUrlForTrail(trail);\n    };\n\n    const onDelete = (index: number) => {\n      reportExploreMetrics('bookmark_changed', { action: 'deleted' });\n      getTrailStore().removeBookmark(index);\n      setLastDelete(Date.now()); // trigger re-render\n    };\n\n    return (\n      <div className={styles.container}>\n        <SectionTitle title={title} description={description} data-testid=\"bookmarks-list-sidebar\" />\n        {bookmarks.length > 0 ? (\n          <div className={styles.bookmarksList}>\n            {bookmarks.map((bookmark, index) => (\n              <DataTrailCard\n                key={getBookmarkKey(bookmark)}\n                bookmark={bookmark}\n                onSelect={() => onSelect(index)}\n                onDelete={() => onDelete(index)}\n                wide={true}\n                compactHeight={true}\n              />\n            ))}\n          </div>\n        ) : (\n          <div className={styles.emptyState}>No bookmarks yet</div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n    }),\n    bookmarksList: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1.5),\n      overflowY: 'auto',\n      paddingRight: theme.spacing(1),\n    }),\n    emptyState: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      height: '100px',\n      color: theme.colors.text.secondary,\n      fontStyle: 'italic',\n    }),\n  };\n}\n","import { VariableHide, VariableRefresh, VariableSort } from '@grafana/data';\nimport { QueryVariable, type SceneObjectState } from '@grafana/scenes';\n\nimport { trailDS, VAR_FILTERS } from 'shared';\n\nexport const VAR_METRICS_VARIABLE = 'metrics-wingman';\n\nexport type MetricOptions = Array<{ label: string; value: string }>;\n\ninterface MetricsVariableState extends SceneObjectState {\n  key: string;\n  name?: string;\n  label?: string;\n}\n\nexport class MetricsVariable extends QueryVariable {\n  constructor(state?: MetricsVariableState) {\n    super({\n      key: VAR_METRICS_VARIABLE,\n      name: VAR_METRICS_VARIABLE,\n      label: 'Metrics',\n      ...state,\n      datasource: trailDS,\n      query: `label_values({$${VAR_FILTERS}}, __name__)`,\n      includeAll: true,\n      value: '$__all',\n      skipUrlSync: true,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      sort: VariableSort.alphabeticalAsc,\n      hide: VariableHide.hideVariable,\n    });\n  }\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneReactObject,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { DashboardCursorSync } from '@grafana/schema';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { getColorByIndex } from 'utils';\nimport { LayoutSwitcher, LayoutType, type LayoutSwitcherState } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { METRICS_VIZ_PANEL_HEIGHT } from 'WingmanDataTrail/MetricVizPanel/MetricVizPanel';\nimport { WithUsageDataPreviewPanel } from 'WingmanDataTrail/MetricVizPanel/WithUsageDataPreviewPanel';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\n\nexport const GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\nexport const GRID_TEMPLATE_ROWS = '1fr';\n\ninterface MetricsListState extends SceneObjectState {\n  variableName: string;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricsList extends SceneObjectBase<MetricsListState> {\n  constructor({ variableName }: { variableName: MetricsListState['variableName'] }) {\n    super({\n      key: 'metrics-list',\n      variableName,\n      body: new SceneByVariableRepeater({\n        variableName,\n        initialPageSize: 120,\n        pageSizeIncrement: 9,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: GRID_TEMPLATE_COLUMNS,\n          autoRows: METRICS_VIZ_PANEL_HEIGHT,\n          $behaviors: [\n            new behaviors.CursorSync({\n              key: 'metricCrosshairSync',\n              sync: DashboardCursorSync.Crosshair,\n            }),\n          ],\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No metrics found for the current filters and time range.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: <InlineBanner severity=\"error\" title=\"Error while loading metrics!\" error={error} />,\n          }),\n        getLayoutChild: (option, colorIndex) => {\n          return new SceneCSSGridItem({\n            body: new WithUsageDataPreviewPanel({\n              vizPanelInGridItem: new GmdVizPanel({\n                metric: option.value as string,\n                fixedColor: getColorByIndex(colorIndex),\n              }),\n              metric: option.value as string,\n            }),\n          });\n        },\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToLayoutChange();\n  }\n\n  private subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', LayoutSwitcher);\n    const body = this.state.body.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: LayoutSwitcherState, prevState?: LayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: newState.layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n        });\n      }\n    };\n\n    onChangeState(layoutSwitcher.state); // ensure layout when landing on the page\n\n    this._subs.add(layoutSwitcher.subscribeToState(onChangeState));\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsList>) => {\n    const { variableName, body } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const variable = sceneGraph.lookupVariable(variableName, model) as MultiValueVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    return (\n      <div data-testid=\"metrics-list\">\n        <div className={styles.container}>\n          <body.Component model={body} />\n        </div>\n        {shouldDisplayShowMoreButton && (\n          <div className={styles.footer}>\n            <ShowMoreButton label=\"metric\" batchSizes={batchSizes} onClick={onClickShowMore} />\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({}),\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginTop: theme.spacing(4),\n\n      '& button': {\n        height: '40px',\n        borderRadius: '8px',\n      },\n    }),\n  };\n}\n","import { reportExploreMetrics } from 'interactions';\n\nimport pluginJson from '../plugin.json';\nimport { PREF_KEYS } from './pref-keys';\n\nclass UserPreferences {\n  private service: string;\n\n  constructor(service: string) {\n    this.service = service;\n  }\n\n  // TODO: temporary, let's wait for the new version to be in prod to remove it\n  public migrate() {\n    let hasMigrations = false;\n\n    const migrations = [\n      { legacyKey: 'metricsDrilldownDataSource', newKey: PREF_KEYS.DATASOURCE },\n      { legacyKey: 'metrics-drilldown-recent-metrics/v1', newKey: PREF_KEYS.RECENT_METRICS },\n      { legacyKey: 'grafana.trails.bookmarks', newKey: PREF_KEYS.BOOKMARKS },\n      { legacyKey: 'grafana.trails.breakdown.sort.labels.by', newKey: PREF_KEYS.BREAKDOWN_SORTBY },\n    ];\n\n    for (const { legacyKey, newKey } of migrations) {\n      let existingItem = localStorage.getItem(legacyKey);\n      if (existingItem === null) {\n        continue;\n      }\n\n      try {\n        existingItem = JSON.parse(existingItem);\n      } catch {}\n\n      this.setItem(newKey, existingItem);\n      localStorage.removeItem(legacyKey);\n\n      hasMigrations = true;\n    }\n\n    if (hasMigrations) {\n      reportExploreMetrics('user_preferences_migrated', {});\n    }\n  }\n\n  private buildStorageKey(key: string) {\n    return `${this.service}.${key}`;\n  }\n\n  getItem(key: string): any {\n    const storageKey = this.buildStorageKey(key);\n    const item = localStorage.getItem(storageKey);\n    return item === null ? null : JSON.parse(item);\n  }\n\n  setItem(key: string, value: any): void {\n    const storageKey = this.buildStorageKey(key);\n    localStorage.setItem(storageKey, JSON.stringify(value));\n  }\n\n  removeItem(key: string): void {\n    const storageKey = this.buildStorageKey(key);\n    localStorage.removeItem(storageKey);\n  }\n\n  clear() {\n    localStorage.clear();\n  }\n}\n\nexport const userPreferences = new UserPreferences(pluginJson.id);\n","import leven from 'leven';\n\nexport function sortRelatedMetrics(metricList: string[], metric: string) {\n  return metricList.sort((aValue, bValue) => {\n    const a = getLevenDistances(aValue, metric);\n    const b = getLevenDistances(bValue, metric);\n\n    return a.halfLeven + a.wholeLeven - (b.halfLeven + b.wholeLeven);\n  });\n}\n\ntype LevenDistances = { halfLeven: number; wholeLeven: number };\ntype TargetToLevenDistances = Map<string, LevenDistances>;\n\nconst metricToTargetLevenDistances = new Map<string, TargetToLevenDistances>();\n\n// Provides the Levenshtein distance between a metric to be sorted\n// and a targetMetric compared to which all other metrics are being sorted\n// There are two distances: once for the first half and once for the whole string.\n// This operation is not expected to be symmetric; order of parameters matters\n// since only `metric` is split.\nfunction getLevenDistances(metric: string, targetMetric: string) {\n  let targetToDistances: TargetToLevenDistances | undefined = metricToTargetLevenDistances.get(metric);\n  if (!targetToDistances) {\n    targetToDistances = new Map<string, LevenDistances>();\n    metricToTargetLevenDistances.set(metric, targetToDistances);\n  }\n\n  let distances: LevenDistances | undefined = targetToDistances.get(targetMetric);\n  if (!distances) {\n    const metricSplit = metric.split('_');\n    const metricHalf = metricSplit.slice(0, metricSplit.length / 2).join('_');\n\n    const halfLeven = leven(metricHalf, targetMetric!) || 0;\n    const wholeLeven = leven(metric, targetMetric!) || 0;\n\n    distances = { halfLeven, wholeLeven };\n    targetToDistances.set(targetMetric, distances);\n  }\n\n  return distances;\n}\n","import { sceneGraph, SceneVariableValueChangedEvent, type QueryVariable } from '@grafana/scenes';\n\nimport { sortRelatedMetrics } from 'RelatedMetricsScene/sortRelatedMetrics';\nimport { logger } from 'tracking/logger/logger';\nimport {\n  MetricsSorter,\n  sortMetricsByCount,\n  sortMetricsWithRecentFirst,\n  type SortingOption,\n} from 'WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter';\nimport { type MetricUsageType } from 'WingmanDataTrail/ListControls/MetricsSorter/MetricUsageFetcher';\n\nimport { areArraysEqual } from './helpers/areArraysEqual';\n\nexport class MetricsVariableSortEngine {\n  private variable: QueryVariable;\n  private lastMetrics: string[];\n  private sortBy?: SortingOption | 'related';\n\n  constructor(variable: QueryVariable) {\n    this.variable = variable;\n    this.sortBy = undefined;\n    this.lastMetrics = [];\n  }\n\n  public async sort(sortBy = this.sortBy, options: Record<string, any> = {}) {\n    const metrics = this.variable.state.options.map((option) => option.value as string);\n\n    if (sortBy === this.sortBy && areArraysEqual(metrics, this.lastMetrics)) {\n      return;\n    }\n\n    let sortedMetrics: string[];\n\n    switch (sortBy) {\n      case 'dashboard-usage':\n      case 'alerting-usage':\n        sortedMetrics = await this.sortByUsage(metrics, sortBy);\n        break;\n\n      case 'related':\n        sortedMetrics = sortRelatedMetrics(metrics, options.metric);\n        break;\n\n      default:\n        sortedMetrics = sortMetricsWithRecentFirst(metrics);\n        break;\n    }\n\n    this.sortBy = sortBy;\n    this.lastMetrics = sortedMetrics;\n\n    this.variable.setState({\n      options: sortedMetrics.map((metricName) => ({\n        label: metricName,\n        value: metricName,\n      })),\n    });\n\n    this.notifyUpdate();\n  }\n\n  private async sortByUsage(metrics: string[], usageType: MetricUsageType) {\n    try {\n      const metricsSorter = sceneGraph.findByKeyAndType(this.variable, 'metrics-sorter', MetricsSorter);\n      if (!metricsSorter) {\n        logger.warn('Metrics sorter not found. Returning unsorted metrics.', { usageType });\n        return metrics;\n      }\n      const usageMetrics = await metricsSorter.getUsageMetrics(usageType);\n      return sortMetricsByCount(metrics, usageMetrics);\n    } catch (err) {\n      const error = typeof err === 'string' ? new Error(err) : (err as Error);\n      logger.error(error, {\n        usageType,\n      });\n      return metrics;\n    }\n  }\n\n  private notifyUpdate() {\n    // hack to force SceneByVariableRepeater to re-render\n    this.variable.publishEvent(new SceneVariableValueChangedEvent(this.variable), true);\n  }\n}\n","import { PanelBuilders, SceneQueryRunner, type VizPanel } from '@grafana/scenes';\nimport { HeatmapColorMode } from '@grafana/schema/dist/esm/raw/composable/heatmap/panelcfg/x/HeatmapPanelCfg_types.gen';\n\nimport { getUnit } from 'autoQuery/units';\nimport { trailDS } from 'shared';\n\nimport { PANEL_TYPE, type GmdVizPanelState } from '../GmdVizPanel';\nimport { getHeatmapQueryRunnerParams } from './getHeatmapQueryRunnerParams';\n\nexport type HeatmapPanelOptions = Pick<\n  GmdVizPanelState,\n  'isNativeHistogram' | 'title' | 'description' | 'metric' | 'matchers' | 'headerActions' | 'menu' | 'queryResolution'\n>;\n\nexport function buildHeatmapPanel(options: HeatmapPanelOptions): VizPanel {\n  const { title, description, metric, matchers, isNativeHistogram, headerActions, menu, queryResolution } = options;\n  const queryParams = getHeatmapQueryRunnerParams({\n    metric,\n    matchers,\n    isNativeHistogram: Boolean(isNativeHistogram),\n    queryResolution,\n    addIgnoreUsageFilter: true,\n  });\n  const unit = getUnit(metric);\n\n  const queryRunner = new SceneQueryRunner({\n    datasource: trailDS,\n    maxDataPoints: queryParams.maxDataPoints,\n    queries: queryParams.queries,\n  });\n\n  return PanelBuilders.heatmap()\n    .setTitle(title)\n    .setDescription(isNativeHistogram ? 'Native Histogram' : description)\n    .setHeaderActions(headerActions({ metric, panelType: PANEL_TYPE.HEATMAP }))\n    .setMenu(menu?.clone()) // we clone because it's already stored in GmdVizPanel\n    .setShowMenuAlways(Boolean(menu))\n    .setData(queryRunner)\n    .setUnit(unit)\n    .setOption('calculate', false)\n    .setOption('color', {\n      mode: HeatmapColorMode.Scheme,\n      exponent: 0.5,\n      scheme: 'Spectral',\n      steps: 32,\n      reverse: false,\n    })\n    .build();\n}\n","import { type SceneDataQuery } from '@grafana/scenes';\nimport { promql } from 'tsqtsq';\n\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/GmdVizPanel';\n\nimport { buildQueryExpression, expressionToString } from '../buildQueryExpression';\nimport { type HeatmapPanelOptions } from './buildHeatmapPanel';\n\ntype HeatmapQueryRunnerParams = {\n  fnName: string;\n  maxDataPoints: number;\n  queries: SceneDataQuery[];\n};\n\ntype Options = Pick<HeatmapPanelOptions, 'metric' | 'matchers' | 'isNativeHistogram' | 'queryResolution'> & {\n  addIgnoreUsageFilter: boolean;\n};\n\nexport function getHeatmapQueryRunnerParams(options: Options): HeatmapQueryRunnerParams {\n  const { metric, matchers, isNativeHistogram, queryResolution, addIgnoreUsageFilter } = options;\n\n  const expression = buildQueryExpression({ metric, matchers, addIgnoreUsageFilter });\n  let expr = expressionToString(expression);\n\n  let query;\n  let fnName;\n\n  if (isNativeHistogram) {\n    query = promql.rate({ expr, interval: '$__rate_interval' });\n    fnName = 'rate';\n  } else {\n    expr = promql.rate({ expr, interval: '$__rate_interval' });\n    query = promql.sum({ expr, by: ['le'] });\n    fnName = 'sum by (le) (rate)';\n  }\n\n  return {\n    fnName,\n    maxDataPoints: queryResolution === QUERY_RESOLUTION.HIGH ? 500 : 250,\n    queries: [\n      {\n        refId: metric,\n        expr: query,\n        format: 'heatmap',\n        fromExploreMetrics: true,\n      },\n    ],\n  };\n}\n","import { PanelBuilders, SceneQueryRunner } from '@grafana/scenes';\nimport { SortOrder, TooltipDisplayMode, type LegendPlacement } from '@grafana/schema';\n\nimport { getPerSecondRateUnit, getUnit } from 'autoQuery/units';\nimport { PANEL_TYPE, type GmdVizPanelState } from 'GmdVizPanel/GmdVizPanel';\nimport { trailDS } from 'shared';\n\nimport { getPercentilesQueryRunnerParams } from './getPercentilesQueryRunnerParams';\n\nexport type PercentilesPanelOptions = Pick<\n  GmdVizPanelState,\n  'isNativeHistogram' | 'title' | 'description' | 'metric' | 'matchers' | 'headerActions' | 'menu' | 'queryResolution'\n>;\n\nexport function buildPercentilesPanel(options: PercentilesPanelOptions) {\n  const { title, description, metric, matchers, headerActions, menu, isNativeHistogram, queryResolution } = options;\n  const queryParams = getPercentilesQueryRunnerParams({\n    metric,\n    matchers,\n    isNativeHistogram: Boolean(isNativeHistogram),\n    queryResolution,\n    addIgnoreUsageFilter: true,\n  });\n  const unit = queryParams.isRateQuery ? getPerSecondRateUnit(metric) : getUnit(metric);\n\n  const $data = new SceneQueryRunner({\n    datasource: trailDS,\n    maxDataPoints: queryParams.maxDataPoints,\n    queries: queryParams.queries,\n  });\n\n  return PanelBuilders.timeseries()\n    .setTitle(title)\n    .setDescription(description)\n    .setHeaderActions(headerActions({ metric, panelType: PANEL_TYPE.PERCENTILES }))\n    .setMenu(menu?.clone()) // we clone because it's already stored in GmdVizPanel\n    .setShowMenuAlways(Boolean(menu))\n    .setData($data)\n    .setUnit(unit)\n    .setOption('legend', { showLegend: true, placement: 'right' as LegendPlacement })\n    .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n    .setCustomFieldConfig('fillOpacity', 9)\n    .build();\n}\n","import { type SceneDataQuery } from '@grafana/scenes';\nimport { promql } from 'tsqtsq';\n\nimport { buildQueryExpression, expressionToString } from 'GmdVizPanel/buildQueryExpression';\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/GmdVizPanel';\n\nimport { type PercentilesPanelOptions } from './buildPercentilesPanel';\n\ntype PercentilesQueryRunnerParams = {\n  fnName: string;\n  isRateQuery: boolean;\n  maxDataPoints: number;\n  queries: SceneDataQuery[];\n};\n\ntype Options = Pick<PercentilesPanelOptions, 'metric' | 'matchers' | 'isNativeHistogram' | 'queryResolution'> & {\n  addIgnoreUsageFilter: boolean;\n};\n\nexport function getPercentilesQueryRunnerParams(options: Options): PercentilesQueryRunnerParams {\n  const { metric, matchers, isNativeHistogram, queryResolution, addIgnoreUsageFilter } = options;\n\n  const expression = buildQueryExpression({ metric, matchers, addIgnoreUsageFilter });\n  let expr = expressionToString(expression);\n  let fnName;\n\n  if (isNativeHistogram) {\n    expr = promql.rate({ expr, interval: '$__rate_interval' });\n    fnName = 'histogram_quantile(rate)';\n  } else {\n    expr = promql.rate({ expr, interval: '$__rate_interval' });\n    expr = promql.sum({ expr, by: ['le'] });\n    fnName = 'histogram_quantile(sum by (le) (rate))';\n  }\n\n  const queries = [99, 90, 50].map((percentile) => {\n    const percent = percentile / 100;\n    // tsqtsq does not provide the \"histogram_quantile\" function\n    const query = `histogram_quantile(${percent}, ${expr})`;\n\n    return {\n      refId: `${metric}-p${percentile}`,\n      expr: query,\n      legendFormat: `${percentile}th Percentile`,\n      fromExploreMetrics: true,\n    };\n  });\n\n  return {\n    fnName,\n    isRateQuery: true,\n    maxDataPoints: queryResolution === QUERY_RESOLUTION.HIGH ? 500 : 250,\n    queries,\n  };\n}\n","import { type ValueMapping } from '@grafana/data';\nimport { PanelBuilders, SceneQueryRunner, type VizPanel } from '@grafana/scenes';\nimport { MappingType, VisibilityMode } from '@grafana/schema';\n\nimport { trailDS } from 'shared';\n\nimport { PANEL_TYPE, type GmdVizPanelState } from '../GmdVizPanel';\nimport { getStatushistoryQueryRunnerParams } from './getStatushistoryQueryRunnerParams';\n\nconst mappings: ValueMapping[] = [\n  {\n    type: MappingType.ValueToText,\n    options: {\n      '0': {\n        color: 'red',\n        text: 'down',\n      },\n      '1': {\n        color: 'green',\n        text: 'up',\n      },\n    },\n  },\n];\n\nexport type StatushistoryPanelOptions = Pick<\n  GmdVizPanelState,\n  'title' | 'description' | 'metric' | 'matchers' | 'headerActions' | 'menu' | 'queryResolution'\n>;\n\nexport function buildStatushistoryPanel(options: StatushistoryPanelOptions): VizPanel {\n  const { title, description, metric, matchers, headerActions, menu, queryResolution } = options;\n  const queryParams = getStatushistoryQueryRunnerParams({\n    metric,\n    matchers,\n    queryResolution,\n    addIgnoreUsageFilter: true,\n  });\n  const unit = 'none';\n\n  const queryRunner = new SceneQueryRunner({\n    datasource: trailDS,\n    maxDataPoints: queryParams.maxDataPoints,\n    queries: queryParams.queries,\n  });\n\n  return (\n    PanelBuilders.statushistory()\n      .setTitle(title)\n      .setDescription(description)\n      .setHeaderActions(headerActions({ metric, panelType: PANEL_TYPE.STATUSHISTORY }))\n      .setMenu(menu?.clone()) // we clone because it's already stored in GmdVizPanel\n      .setShowMenuAlways(Boolean(menu))\n      .setData(queryRunner)\n      .setUnit(unit)\n      // Use value mappings for both color and text display\n      .setColor({ mode: 'palette-classic' })\n      .setMappings(mappings)\n      .setDisplayName('status')\n      .setOption('showValue', VisibilityMode.Never)\n      .setOption('legend', { showLegend: true })\n      .setOption('perPage', 0) // hide pagination at the bottom of the panel\n      .build()\n  );\n}\n","import { type SceneDataQuery } from '@grafana/scenes';\nimport { promql } from 'tsqtsq';\n\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/GmdVizPanel';\n\nimport { buildQueryExpression, expressionToString } from '../buildQueryExpression';\nimport { type StatushistoryPanelOptions } from './buildStatushistoryPanel';\n\ntype StatushistoryQueryRunnerParams = {\n  fnName: string;\n  maxDataPoints: number;\n  queries: SceneDataQuery[];\n};\n\ntype Options = Pick<StatushistoryPanelOptions, 'metric' | 'matchers' | 'queryResolution'> & {\n  addIgnoreUsageFilter: boolean;\n};\n\nexport function getStatushistoryQueryRunnerParams(options: Options): StatushistoryQueryRunnerParams {\n  const { metric, matchers, queryResolution, addIgnoreUsageFilter } = options;\n\n  const expression = buildQueryExpression({ metric, matchers, addIgnoreUsageFilter });\n  const query = promql.min({ expr: expressionToString(expression) });\n\n  return {\n    fnName: 'min',\n    maxDataPoints: queryResolution === QUERY_RESOLUTION.HIGH ? 200 : 100,\n    queries: [\n      {\n        refId: metric,\n        expr: query,\n        fromExploreMetrics: true,\n      },\n    ],\n  };\n}\n","import { PanelBuilders, SceneDataTransformer, SceneQueryRunner, type VizPanel } from '@grafana/scenes';\nimport { SortOrder, TooltipDisplayMode, type LegendPlacement } from '@grafana/schema';\n\nimport { getPerSecondRateUnit, getUnit } from 'autoQuery/units';\nimport { addUnspecifiedLabel } from 'Breakdown/MetricLabelsList/transformations/addUnspecifiedLabel';\nimport { trailDS } from 'shared';\n\nimport { PANEL_TYPE, type GmdVizPanelState } from '../GmdVizPanel';\nimport { getTimeseriesQueryRunnerParams } from './getTimeseriesQueryRunnerParams';\n\nexport type TimeseriesPanelOptions = Pick<\n  GmdVizPanelState,\n  | 'fixedColor'\n  | 'groupBy'\n  | 'title'\n  | 'description'\n  | 'metric'\n  | 'matchers'\n  | 'headerActions'\n  | 'menu'\n  | 'queryResolution'\n>;\n\nexport function buildTimeseriesPanel(options: TimeseriesPanelOptions): VizPanel {\n  if (options.groupBy) {\n    return buildGroupByPanel(options as Required<TimeseriesPanelOptions>);\n  }\n\n  const { title, description, metric, matchers, fixedColor, headerActions, groupBy, menu, queryResolution } = options;\n  const queryParams = getTimeseriesQueryRunnerParams({\n    metric,\n    matchers,\n    groupBy,\n    queryResolution,\n    addIgnoreUsageFilter: true,\n  });\n  const unit = queryParams.isRateQuery ? getPerSecondRateUnit(metric) : getUnit(metric);\n\n  const $data = new SceneQueryRunner({\n    datasource: trailDS,\n    maxDataPoints: queryParams.maxDataPoints,\n    queries: queryParams.queries,\n  });\n\n  return PanelBuilders.timeseries()\n    .setTitle(title)\n    .setDescription(description)\n    .setHeaderActions(headerActions({ metric, panelType: PANEL_TYPE.TIMESERIES }))\n    .setMenu(menu?.clone()) // we clone because it's already stored in GmdVizPanel\n    .setShowMenuAlways(Boolean(menu))\n    .setData($data)\n    .setUnit(unit)\n    .setOption('legend', { showLegend: true, placement: 'bottom' as LegendPlacement })\n    .setColor(fixedColor ? { mode: 'fixed', fixedColor } : undefined)\n    .setCustomFieldConfig('fillOpacity', 9)\n    .setDisplayName(queryParams.fnName)\n    .build();\n}\n\nfunction buildGroupByPanel(options: Required<TimeseriesPanelOptions>): VizPanel {\n  const { title, description, metric, matchers, fixedColor, headerActions, menu, groupBy, queryResolution } = options;\n  const queryParams = getTimeseriesQueryRunnerParams({\n    metric,\n    matchers,\n    groupBy,\n    queryResolution,\n    addIgnoreUsageFilter: true,\n  });\n  const unit = queryParams.isRateQuery ? getPerSecondRateUnit(metric) : getUnit(metric);\n\n  const $data = new SceneDataTransformer({\n    $data: new SceneQueryRunner({\n      datasource: trailDS,\n      maxDataPoints: queryParams.maxDataPoints,\n      queries: queryParams.queries,\n    }),\n    transformations: [addUnspecifiedLabel(groupBy)],\n  });\n\n  return PanelBuilders.timeseries()\n    .setTitle(title)\n    .setDescription(description)\n    .setHeaderActions(headerActions({ metric, panelType: PANEL_TYPE.TIMESERIES }))\n    .setMenu(menu?.clone()) // we clone because it's already stored in GmdVizPanel\n    .setShowMenuAlways(Boolean(menu))\n    .setData($data)\n    .setUnit(unit)\n    .setColor(fixedColor ? { mode: 'fixed', fixedColor } : undefined)\n    .setOption('legend', { showLegend: true, placement: 'right' as LegendPlacement })\n    .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n    .build();\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneObjectBase,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type VizPanel,\n  type VizPanelState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { getTrailFor } from 'utils';\nimport { SelectAction } from 'WingmanDataTrail/MetricVizPanel/actions/SelectAction';\n\nimport { type LabelMatcher } from './buildQueryExpression';\nimport { EventPanelTypeChanged } from './EventPanelTypeChanged';\nimport { buildHeatmapPanel } from './heatmap/buildHeatmapPanel';\nimport { isHistogramMetric } from './heatmap/isHistogramMetric';\nimport { buildPercentilesPanel } from './percentiles/buildPercentilesPanel';\nimport { buildStatushistoryPanel } from './statushistory/buildStatushistoryPanel';\nimport { isUpDownMetric } from './statushistory/isUpDownMetric';\nimport { buildTimeseriesPanel } from './timeseries/buildTimeseriesPanel';\n\nexport enum PANEL_TYPE {\n  TIMESERIES = 'TIMESERIES',\n  HEATMAP = 'HEATMAP',\n  STATUSHISTORY = 'STATUSHISTORY',\n  PERCENTILES = 'PERCENTILES',\n}\n\nexport enum PANEL_HEIGHT {\n  S = 'S',\n  M = 'M',\n  L = 'L',\n  XL = 'XL',\n}\n\nexport enum QUERY_RESOLUTION {\n  HIGH = 'HIGH',\n  MEDIUM = 'MEDIUM',\n}\n\ntype HeaderActionsOptions = {\n  metric: string;\n  panelType: PANEL_TYPE;\n};\n\nexport interface GmdVizPanelState extends SceneObjectState {\n  metric: string;\n  title: string;\n  matchers: LabelMatcher[];\n  heightInPixels: string;\n  headerActions: (headerActionsOptions: HeaderActionsOptions) => VizPanelState['headerActions'];\n  queryResolution: QUERY_RESOLUTION;\n  menu?: VizPanelState['menu'];\n  panelType?: PANEL_TYPE;\n  fixedColor?: string;\n  isNativeHistogram?: boolean;\n  groupBy?: string;\n  description?: string;\n  body?: VizPanel;\n}\n\nconst DEFAULT_HEADER_ACTIONS_BUILDER: GmdVizPanelState['headerActions'] = ({ metric }) => [\n  new SelectAction({ metricName: metric }),\n];\n\nexport class GmdVizPanel extends SceneObjectBase<GmdVizPanelState> {\n  constructor({\n    metric,\n    matchers,\n    height,\n    headerActions,\n    menu,\n    panelType,\n    fixedColor,\n    title,\n    groupBy,\n    description,\n    queryResolution,\n  }: {\n    metric: GmdVizPanelState['metric'];\n    matchers?: GmdVizPanelState['matchers'];\n    height?: PANEL_HEIGHT;\n    headerActions?: GmdVizPanelState['headerActions'];\n    menu?: GmdVizPanelState['menu'];\n    panelType?: PANEL_TYPE;\n    fixedColor?: GmdVizPanelState['fixedColor'];\n    title?: GmdVizPanelState['title'];\n    groupBy?: GmdVizPanelState['groupBy'];\n    description?: GmdVizPanelState['description'];\n    queryResolution?: QUERY_RESOLUTION;\n  }) {\n    super({\n      metric,\n      matchers: matchers || [],\n      heightInPixels: `${GmdVizPanel.getPanelHeightInPixels(height || PANEL_HEIGHT.M)}px`,\n      headerActions: headerActions || DEFAULT_HEADER_ACTIONS_BUILDER,\n      menu,\n      panelType,\n      fixedColor,\n      title: title || metric,\n      groupBy,\n      description,\n      queryResolution: queryResolution || QUERY_RESOLUTION.MEDIUM,\n      isNativeHistogram: undefined,\n      body: undefined,\n    });\n\n    this.addActivationHandler(() => {\n      this.onActivate();\n    });\n  }\n\n  private async onActivate() {\n    const { metric, panelType } = this.state;\n\n    this.subscribeToStateChanges();\n    this.subscribeToEvents();\n\n    // isNativeHistogram() depends on an async process to load metrics metadata, so it's possible that\n    // when landing on the page, the metadata is not yet loaded and the histogram metrics are not be rendered as heatmap panels.\n    // But we still want to render them ASAP and update them later when the metadata has arrived.\n    const trail = getTrailFor(this);\n    const isNativeHistogram = trail.isNativeHistogram(metric);\n\n    this.setState({\n      panelType: panelType || this.getDefaultPanelType(isNativeHistogram),\n      isNativeHistogram,\n    });\n\n    if (isNativeHistogram) {\n      return;\n    }\n\n    // force initialization\n    await trail.initializeHistograms();\n    const newIsNativeHistogram = trail.isNativeHistogram(metric);\n\n    if (newIsNativeHistogram) {\n      this.setState({\n        panelType: this.getDefaultPanelType(newIsNativeHistogram),\n        isNativeHistogram: newIsNativeHistogram,\n      });\n    }\n  }\n\n  private getDefaultPanelType(isNativeHistogram: boolean): PANEL_TYPE {\n    const { metric } = this.state;\n\n    if (isUpDownMetric(metric)) {\n      return PANEL_TYPE.STATUSHISTORY;\n    }\n\n    if (isNativeHistogram || isHistogramMetric(metric)) {\n      return PANEL_TYPE.HEATMAP;\n    }\n\n    return PANEL_TYPE.TIMESERIES;\n  }\n\n  public static getPanelHeightInPixels(h: PANEL_HEIGHT): number {\n    switch (h) {\n      case PANEL_HEIGHT.S:\n        return 160;\n      case PANEL_HEIGHT.L:\n        return 260;\n      case PANEL_HEIGHT.XL:\n        return 280;\n      case PANEL_HEIGHT.M:\n      default:\n        return 220;\n    }\n  }\n\n  private subscribeToStateChanges() {\n    this.subscribeToState((newState, prevState) => {\n      if (newState.isNativeHistogram === undefined || newState.panelType === undefined) {\n        return;\n      }\n\n      if (newState.isNativeHistogram !== prevState.isNativeHistogram || newState.panelType !== prevState.panelType) {\n        this.updateBody();\n      }\n    });\n  }\n\n  private subscribeToEvents() {\n    this.subscribeToEvent(EventPanelTypeChanged, (event) => {\n      // the sub in subscribeToStateChanges() above will handle updating the body\n      this.setState({ panelType: event.payload.panelType });\n    });\n  }\n\n  private updateBody() {\n    const {\n      panelType,\n      title,\n      description,\n      metric,\n      matchers,\n      headerActions,\n      menu,\n      queryResolution,\n      fixedColor,\n      groupBy,\n      isNativeHistogram,\n    } = this.state;\n\n    switch (panelType) {\n      case PANEL_TYPE.TIMESERIES:\n        this.setState({\n          body: buildTimeseriesPanel({\n            title,\n            description,\n            metric,\n            matchers,\n            headerActions,\n            menu,\n            queryResolution,\n            // custom\n            fixedColor,\n            groupBy,\n          }),\n        });\n        return;\n\n      case PANEL_TYPE.HEATMAP:\n        this.setState({\n          body: buildHeatmapPanel({\n            title,\n            description,\n            metric,\n            matchers,\n            headerActions,\n            menu,\n            queryResolution,\n            // custom\n            isNativeHistogram,\n          }),\n        });\n        return;\n\n      case PANEL_TYPE.PERCENTILES:\n        this.setState({\n          body: buildPercentilesPanel({\n            title,\n            description,\n            metric,\n            matchers,\n            headerActions,\n            menu,\n            queryResolution,\n            // custom\n            isNativeHistogram,\n          }),\n        });\n        return;\n\n      case PANEL_TYPE.STATUSHISTORY:\n        this.setState({\n          body: buildStatushistoryPanel({\n            title,\n            description,\n            metric,\n            matchers,\n            headerActions,\n            menu,\n            queryResolution,\n          }),\n        });\n        return;\n\n      default:\n        throw new TypeError(`Unsupported panel type \"${panelType}\"!`);\n    }\n  }\n\n  public changePanelType(newPanelType: PANEL_TYPE) {\n    this.setState({ panelType: newPanelType });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<GmdVizPanel>) => {\n    const { body, heightInPixels } = model.useState();\n    const styles = useStyles2(getStyles, heightInPixels);\n\n    return (\n      <div className={styles.container} data-testid=\"gmd-vizpanel\">\n        {body && <body.Component model={body} />}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2, heightInPixels: string) {\n  return {\n    container: css`\n      width: 100%;\n      height: ${heightInPixels};\n    `,\n  };\n}\n","export const isUpDownMetric = (metric: string): boolean => metric === 'up' || metric.endsWith('_up');\n","export function isHistogramMetric(metric: string) {\n  return metric.endsWith('_bucket');\n}\n","import { Alert, type AlertVariant } from '@grafana/ui';\nimport React from 'react';\n\nimport { logger, type ErrorContext } from '../tracking/logger/logger';\n\ntype InlineBannerProps = {\n  severity: AlertVariant;\n  title: string;\n  message?: string | React.ReactNode;\n  error?: Error;\n  errorContext?: ErrorContext;\n  children?: React.ReactNode;\n};\n\nexport function InlineBanner({ severity, title, message, error, errorContext, children }: Readonly<InlineBannerProps>) {\n  let errorObject;\n\n  if (error) {\n    errorObject = typeof error === 'string' ? new Error(error) : error;\n\n    logger.error(errorObject, {\n      ...(errorObject.cause || {}),\n      ...errorContext,\n      bannerTitle: title,\n    });\n  }\n\n  return (\n    <Alert title={title} severity={severity}>\n      {errorObject && (\n        <>\n          {errorObject.message || errorObject.toString()}\n          <br />\n        </>\n      )}\n      {message}\n      {children}\n    </Alert>\n  );\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventMetricsVariableDeactivatedPayload {\n  key: string;\n}\n\nexport class EventMetricsVariableDeactivated extends BusEventWithPayload<EventMetricsVariableDeactivatedPayload> {\n  public static readonly type = 'metrics-variable-deactivated';\n}\n","import { type GrafanaTheme2 } from '@grafana/data';\n\nimport { type DataTrail } from 'DataTrail';\n\nexport function getAppBackgroundColor(theme: GrafanaTheme2, trail?: DataTrail): string {\n  // If DataTrail is in embedded mode, always use primary background\n  if (trail?.state.embedded) {\n    return theme.colors.background.primary;\n  }\n\n  // Otherwise, use the standard theme-based logic\n  return theme.isLight ? theme.colors.background.primary : theme.colors.background.canvas;\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  VariableDependencyConfig,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { IconButton, Input, Tag, Tooltip, useStyles2 } from '@grafana/ui';\nimport { debounce } from 'lodash';\nimport React, { type KeyboardEvent } from 'react';\n\nimport { reportExploreMetrics } from 'interactions';\nimport { VAR_DATASOURCE } from 'shared';\n\nimport { type CountsProvider } from './CountsProvider/CountsProvider';\nimport { EventQuickSearchChanged } from './EventQuickSearchChanged';\n\ninterface QuickSearchState extends SceneObjectState {\n  urlSearchParamName: string;\n  targetName: string;\n  countsProvider: CountsProvider;\n  displayCounts: boolean;\n  value: string;\n}\n\nexport class QuickSearch extends SceneObjectBase<QuickSearchState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_DATASOURCE],\n    onReferencedVariableValueChanged: () => {\n      this.setState({ value: '' });\n    },\n  });\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: [this.state.urlSearchParamName],\n  });\n\n  getUrlState() {\n    return { [this.state.urlSearchParamName]: this.state.value };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const newValue = (values[this.state.urlSearchParamName] as string) || '';\n\n    if (newValue !== this.state.value) {\n      this.setState({ value: newValue });\n    }\n  }\n\n  public constructor({\n    urlSearchParamName,\n    targetName,\n    countsProvider,\n    displayCounts,\n  }: {\n    urlSearchParamName: QuickSearchState['urlSearchParamName'];\n    targetName: QuickSearchState['targetName'];\n    countsProvider: QuickSearchState['countsProvider'];\n    displayCounts?: QuickSearchState['displayCounts'];\n  }) {\n    super({\n      key: 'quick-search',\n      urlSearchParamName,\n      targetName,\n      countsProvider,\n      displayCounts: Boolean(displayCounts),\n      value: '',\n    });\n  }\n\n  public toggleCountsDisplay(displayCounts: boolean) {\n    this.setState({ displayCounts });\n  }\n\n  private notifyValueChange = debounce((value: string) => {\n    this.publishEvent(new EventQuickSearchChanged({ searchText: value }), true);\n  }, 250);\n\n  private updateValue(value: string) {\n    const wasEmpty = this.state.value === '';\n    const isNewSearch = wasEmpty && value !== '';\n\n    if (isNewSearch) {\n      reportExploreMetrics('quick_search_used', {});\n    }\n\n    this.setState({ value });\n    this.notifyValueChange(value);\n  }\n\n  private onChange = (e: React.FormEvent<HTMLInputElement>) => {\n    this.updateValue(e.currentTarget.value);\n  };\n\n  private clear = () => {\n    this.updateValue('');\n  };\n\n  private onKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Escape') {\n      e.preventDefault();\n      this.clear();\n    }\n  };\n\n  private useHumanFriendlyCountsMessage() {\n    const { targetName, countsProvider, displayCounts } = this.state;\n    const counts = countsProvider.useCounts();\n\n    if (!displayCounts) {\n      return {\n        tagName: '',\n        tooltipContent: '',\n      };\n    }\n\n    if (counts.current === counts.total) {\n      return {\n        tagName: `${counts.current}`,\n        tooltipContent: counts.current !== 1 ? `${counts.current} ${targetName}s in total` : `1 ${targetName} in total`,\n      };\n    }\n\n    return {\n      tagName: `${counts.current}/${counts.total}`,\n      tooltipContent:\n        counts.current !== 1\n          ? `${counts.current} out of ${counts.total} ${targetName}s in total`\n          : `1 out of ${counts.total} ${targetName}s in total`,\n    };\n  }\n\n  static readonly Component = ({ model }: { model: QuickSearch }) => {\n    const styles = useStyles2(getStyles);\n    const { targetName, value, countsProvider } = model.useState();\n    const { tagName, tooltipContent } = model.useHumanFriendlyCountsMessage();\n\n    return (\n      <Input\n        value={value}\n        onChange={model.onChange}\n        onKeyDown={model.onKeyDown}\n        placeholder={`Quick search ${targetName}s`}\n        prefix={<i className=\"fa fa-search\" />}\n        suffix={\n          <>\n            <countsProvider.Component model={countsProvider} />\n            {tagName && (\n              <Tooltip content={tooltipContent} placement=\"top\">\n                <Tag className={styles.counts} name={tagName} colorIndex={9} />\n              </Tooltip>\n            )}\n            <IconButton\n              name=\"times\"\n              variant=\"secondary\"\n              tooltip=\"Clear search\"\n              onClick={model.clear}\n              disabled={!value}\n            />\n          </>\n        }\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  counts: css`\n    margin-right: ${theme.spacing(1)};\n    border-radius: 11px;\n    padding: 2px ${theme.spacing(1)};\n    color: ${theme.colors.text.primary};\n    background-color: ${theme.colors.background.secondary};\n  `,\n});\n","import { type SceneDataTransformer, type SceneObject, type SceneQueryRunner } from '@grafana/scenes';\n\nexport function getQueryRunnerFor(sceneObject: SceneObject | undefined): SceneQueryRunner | undefined {\n  if (!sceneObject) {\n    return undefined;\n  }\n\n  const dataProvider = sceneObject.state.$data ?? sceneObject.parent?.state.$data;\n\n  if (isSceneQueryRunner(dataProvider)) {\n    return dataProvider;\n  }\n\n  if (isSceneDataTransformer(dataProvider)) {\n    return getQueryRunnerFor(dataProvider);\n  }\n\n  return undefined;\n}\n\nexport function isSceneQueryRunner(input: SceneObject | null | undefined): input is SceneQueryRunner {\n  return typeof input !== 'undefined' && input !== null && 'state' in input && 'runQueries' in input;\n}\n\nexport function isSceneDataTransformer(input: SceneObject | null | undefined): input is SceneDataTransformer {\n  return typeof input !== 'undefined' && input !== null && 'state' in input && 'transformations' in input.state;\n}\n","import { BusEventWithPayload } from '@grafana/data';\nimport { type VariableValueOption } from '@grafana/scenes';\n\nexport interface EventMetricsVariableLoadedPayload {\n  key: string;\n  options: VariableValueOption[];\n}\n\nexport class EventMetricsVariableLoaded extends BusEventWithPayload<EventMetricsVariableLoadedPayload> {\n  public static readonly type = 'metrics-variable-loaded';\n}\n","export const DEFAULT_UNIT = 'none';\nexport const DEFAULT_RATE_UNIT = 'cps'; // Count per second\n\n// Unit constants\nexport const UNIT_BYTES = 'bytes';\nexport const UNIT_SECONDS = 'seconds';\nexport const UNIT_PERCENT = 'percent';\nexport const UNIT_COUNT = 'count';\n\n// Rate unit constants\nexport const RATE_BYTES_PER_SECOND = 'Bps';\nexport const RATE_BITS_PER_SECOND = 'bps';\n\nconst UNIT_MAP: Record<string, string> = {\n  [UNIT_BYTES]: UNIT_BYTES,\n  [UNIT_SECONDS]: 's',\n  [UNIT_PERCENT]: UNIT_PERCENT,\n  [UNIT_COUNT]: DEFAULT_UNIT,\n};\n\nconst UNIT_LIST = Object.keys(UNIT_MAP); // used to check if a metric name contains any of the supported units\n\nconst RATE_UNIT_MAP: Record<string, string> = {\n  [UNIT_BYTES]: RATE_BYTES_PER_SECOND,\n  // seconds per second is unitless\n  [UNIT_SECONDS]: DEFAULT_UNIT,\n  [UNIT_COUNT]: DEFAULT_RATE_UNIT,\n  [UNIT_PERCENT]: UNIT_PERCENT,\n};\n\n// Get unit from metric name (e.g. \"go_gc_duration_seconds\" -> \"seconds\")\nexport function getUnitFromMetric(metric: string) {\n  if (!metric) {\n    return null;\n  }\n\n  // Get last two parts of the metric name and check if they are valid units\n  const metricParts = metric.toLowerCase().split('_').slice(-2);\n  for (let i = metricParts.length - 1; i >= Math.max(0, metricParts.length - 2); i--) {\n    const part = metricParts[i];\n    if (UNIT_LIST.includes(part)) {\n      return part;\n    }\n  }\n\n  return null;\n}\n\n// Get Grafana unit for a panel (e.g. \"go_gc_duration_seconds\" -> \"s\")\nexport function getUnit(metricName: string | undefined) {\n  if (!metricName) {\n    return DEFAULT_UNIT;\n  }\n\n  const metricPart = getUnitFromMetric(metricName);\n  return (metricPart && UNIT_MAP[metricPart.toLowerCase()]) || DEFAULT_UNIT;\n}\n\nexport function getPerSecondRateUnit(metricName: string | undefined) {\n  if (!metricName) {\n    return DEFAULT_RATE_UNIT;\n  }\n\n  const metricPart = getUnitFromMetric(metricName);\n\n  return (metricPart && RATE_UNIT_MAP[metricPart]) || DEFAULT_RATE_UNIT;\n}\n","import { type DataSourceInstanceSettings, type DataSourceJsonData } from '@grafana/data';\nimport { type PrometheusDatasource } from '@grafana/prometheus';\nimport { getBackendSrv, getDataSourceSrv } from '@grafana/runtime';\n\nimport { logger } from '../tracking/logger/logger';\nexport type DataSource = DataSourceInstanceSettings<DataSourceJsonData>;\n\n// This regex matches Grafana developed Prometheus data sources that are compatible with the vanilla Prometheus data source\nconst PROMETHEUS_DATA_SOURCE_REGEX = /^grafana-[0-9a-z]+prometheus-datasource$/;\n\n/**\n * Helper function to determine if a datasource is a Prometheus datasource\n */\nexport function isPrometheusDataSource(input: unknown): input is PrometheusDatasource {\n  return (\n    typeof input === 'object' &&\n    input !== null &&\n    'type' in input &&\n    typeof input.type === 'string' &&\n    (input.type === 'prometheus' || PROMETHEUS_DATA_SOURCE_REGEX.test(input.type)) &&\n    'uid' in input &&\n    typeof input.uid === 'string'\n  );\n}\n\ntype DataSourceType = 'prometheus' | 'loki';\n\n/**\n * Fetches and caches healthy data sources\n */\nexport class DataSourceFetcher {\n  private readonly pendingRequests = new Map<DataSourceType, Promise<DataSource[]>>();\n  private readonly cache = new Map<DataSourceType, DataSource[]>();\n\n  /**\n   * Retrieves healthy data sources of the specified type\n   * Results are cached indefinitely until the `DataSourceFetcher` is destroyed\n   *\n   * @param type - The type of data source to retrieve ('prometheus' or loki)\n   * @returns Array of healthy data sources\n   */\n  public async getHealthyDataSources(type: DataSourceType): Promise<DataSource[]> {\n    // Check if we have cached results\n    const cachedDataSources = this.cache.get(type);\n    if (cachedDataSources?.length) {\n      return cachedDataSources;\n    }\n\n    // If there's already a pending request for this type, wait for it\n    let pendingRequest = this.pendingRequests.get(type);\n    if (!pendingRequest) {\n      pendingRequest = this.fetchHealthyDataSources(type).finally(() => {\n        // Clean up the pending request after it completes\n        this.pendingRequests.delete(type);\n      });\n      this.pendingRequests.set(type, pendingRequest);\n    }\n\n    // Wait for the request to complete and update cache\n    const dataSources = await pendingRequest;\n    this.cache.set(type, dataSources);\n\n    return dataSources;\n  }\n\n  /**\n   * Fetches healthy data sources of the specified type\n   */\n  private async fetchHealthyDataSources(type: DataSourceType): Promise<DataSource[]> {\n    const allDataSourcesOfType = getDataSourceSrv().getList({\n      logs: true,\n      type,\n      filter: (ds) => ds.uid !== 'grafana',\n    });\n\n    const healthyDataSources: DataSource[] = [];\n    const unhealthyDataSources: DataSource[] = [];\n\n    await Promise.all(\n      allDataSourcesOfType.map(async (ds) => {\n        try {\n          const health = await getBackendSrv().get(`/api/datasources/uid/${ds.uid}/health`, undefined, undefined, {\n            showSuccessAlert: false,\n            showErrorAlert: false,\n          });\n\n          if (health?.status === 'OK') {\n            healthyDataSources.push(ds);\n          } else {\n            unhealthyDataSources.push(ds);\n          }\n        } catch {\n          unhealthyDataSources.push(ds);\n        }\n      })\n    );\n\n    if (unhealthyDataSources.length > 0) {\n      logger.warn(\n        `Found ${unhealthyDataSources.length} unhealthy ${type} data sources: ${unhealthyDataSources\n          .map((ds) => ds.name)\n          .join(', ')}`\n      );\n    }\n\n    return healthyDataSources;\n  }\n}\n\nlet dataSourceFetcherSingleton: DataSourceFetcher | undefined;\n\nexport function getDataSourceFetcher(): DataSourceFetcher {\n  if (!dataSourceFetcherSingleton) {\n    dataSourceFetcherSingleton = new DataSourceFetcher();\n  }\n\n  return dataSourceFetcherSingleton;\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { type PANEL_TYPE } from './GmdVizPanel';\n\nexport interface EventPanelTypeChangedPayload {\n  panelType: PANEL_TYPE;\n}\n\nexport class EventPanelTypeChanged extends BusEventWithPayload<EventPanelTypeChangedPayload> {\n  public static readonly type = 'panel-type-changed';\n}\n","const RATE_QUERY_SUFFIXES = new Set(['count', 'total', 'sum', 'bucket']);\n\nexport function isRateQuery(metric: string) {\n  const parts = metric.split('_');\n  const suffix = parts.at(-1);\n  return suffix ? RATE_QUERY_SUFFIXES.has(suffix) : false;\n}\n","import { type DataFrame } from '@grafana/data';\nimport { map, type Observable } from 'rxjs';\n\nexport const addUnspecifiedLabel = (label: string) => () => (source: Observable<DataFrame[]>) =>\n  source.pipe(\n    map((data: DataFrame[]) => {\n      // eslint-disable-next-line sonarjs/no-nested-functions\n      return data?.map((d) => {\n        if (!d?.fields[1]) {\n          return d;\n        }\n\n        if (!d.fields[1].labels?.[label]) {\n          d.fields[1].labels = { ...d.fields[1].labels, [label]: `<unspecified ${label}>` };\n        }\n\n        return d;\n      });\n    })\n  );\n","import {\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport React from 'react';\n\nexport enum LayoutType {\n  GRID = 'grid',\n  ROWS = 'rows',\n  SINGLE = 'single',\n}\n\nexport interface LayoutSwitcherState extends SceneObjectState {\n  urlSearchParamName: string;\n  layout: LayoutType;\n  options: Array<{ label: string; value: LayoutType }>;\n}\n\nexport class LayoutSwitcher extends SceneObjectBase<LayoutSwitcherState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: [this.state.urlSearchParamName],\n  });\n\n  static readonly DEFAULT_OPTIONS = [\n    { label: 'Grid', value: LayoutType.GRID },\n    { label: 'Rows', value: LayoutType.ROWS },\n  ];\n\n  static readonly DEFAULT_LAYOUT = LayoutType.GRID;\n\n  constructor({\n    urlSearchParamName,\n    options,\n  }: {\n    urlSearchParamName?: LayoutSwitcherState['urlSearchParamName'];\n    options?: LayoutSwitcherState['options'];\n  }) {\n    super({\n      key: 'layout-switcher',\n      urlSearchParamName: urlSearchParamName || 'layout',\n      options: options || LayoutSwitcher.DEFAULT_OPTIONS,\n      layout: LayoutSwitcher.DEFAULT_LAYOUT,\n    });\n  }\n\n  getUrlState() {\n    return {\n      [this.state.urlSearchParamName]: this.state.layout,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<LayoutSwitcherState> = {};\n    const newLayout = values[this.state.urlSearchParamName] as LayoutType;\n\n    if (newLayout !== this.state.layout) {\n      stateUpdate.layout = this.state.options.find((o) => o.value === newLayout)\n        ? newLayout\n        : LayoutSwitcher.DEFAULT_LAYOUT;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  private onChange = (layout: LayoutType) => {\n    this.setState({ layout });\n  };\n\n  static readonly Component = ({ model }: SceneComponentProps<LayoutSwitcher>) => {\n    const { options, layout } = model.useState();\n\n    return (\n      <RadioButtonGroup\n        aria-label=\"Layout switcher\"\n        options={options}\n        value={layout}\n        onChange={model.onChange}\n        fullWidth={false}\n      />\n    );\n  };\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { type SortingOption } from '../MetricsSorter';\n\nexport interface EventSortByChangedPayload {\n  sortBy: SortingOption;\n}\n\nexport class EventSortByChanged extends BusEventWithPayload<EventSortByChangedPayload> {\n  public static readonly type = 'sort-by-changed';\n}\n","import {\n  FieldType,\n  LoadingState,\n  type DataQueryResponse,\n  type LegacyMetricFindQueryOptions,\n  type MetricFindValue,\n  type TestDataSourceResponse,\n} from '@grafana/data';\nimport { type PrometheusDatasource } from '@grafana/prometheus';\nimport { RuntimeDataSource, sceneGraph, type SceneObject } from '@grafana/scenes';\n\nimport { MetricDatasourceHelper } from 'helpers/MetricDatasourceHelper';\nimport { VAR_FILTERS } from 'shared';\nimport { isAdHocFiltersVariable } from 'utils/utils.variables';\nimport { displayWarning } from 'WingmanDataTrail/helpers/displayStatus';\n\nimport { localeCompare } from '../helpers/localCompare';\n\n// TODO can we get rid of it and use e.g. undefined or an empty string?\nexport const NULL_GROUP_BY_VALUE = '(none)';\n\nexport class LabelsDataSource extends RuntimeDataSource {\n  static readonly uid = 'grafana-prometheus-labels-datasource';\n\n  constructor() {\n    super(LabelsDataSource.uid, LabelsDataSource.uid);\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'Labels',\n          fields: [\n            {\n              name: null,\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  async metricFindQuery(matcher: string, options: LegacyMetricFindQueryOptions): Promise<MetricFindValue[]> {\n    const sceneObject = options.scopedVars?.__sceneObject?.valueOf() as SceneObject;\n\n    const ds = await MetricDatasourceHelper.getPrometheusDataSourceForScene(sceneObject);\n    if (!ds) {\n      return [];\n    }\n\n    const [, labelName] = matcher.match(/valuesOf\\((.+)\\)/) ?? [];\n    if (labelName) {\n      const labelValues = await LabelsDataSource.fetchLabelValues(labelName, sceneObject);\n      return labelValues.map((value) => ({ value, text: value }));\n    }\n\n    let labelOptions: MetricFindValue[] = [];\n\n    try {\n      labelOptions = await this.fetchLabels(ds, sceneObject, matcher);\n    } catch (error) {\n      displayWarning(['Error while fetching labels! Defaulting to an empty array.', (error as Error).toString()]);\n    }\n\n    return [{ value: NULL_GROUP_BY_VALUE, text: '(none)' }, ...labelOptions] as MetricFindValue[];\n  }\n\n  private async fetchLabels(ds: PrometheusDatasource, sceneObject: SceneObject, matcher: string) {\n    // there is probably a more graceful way to implement this, but this is what the DS offers us.\n    // if a DS does not support the labels match API, we need getTagKeys to handle the empty matcher\n    if (!LabelsDataSource.getLabelsMatchAPISupport(ds)) {\n      // the Prometheus series endpoint cannot accept an empty matcher\n      // when there are no filters, we cannot send the matcher passed to this function because Prometheus evaluates it as empty and returns an error\n      const filters = LabelsDataSource.getFiltersFromVariable(sceneObject);\n      const response = await ds.getTagKeys(filters);\n\n      return this.processLabelOptions(\n        response.map(({ text }) => ({\n          value: text,\n          text,\n        }))\n      );\n    }\n\n    const response = await MetricDatasourceHelper.fetchLabels({\n      ds,\n      timeRange: sceneGraph.getTimeRange(sceneObject).state.value,\n      matcher,\n    });\n\n    return this.processLabelOptions(\n      response.map((label) => ({\n        value: label,\n        text: label,\n      }))\n    );\n  }\n\n  private static getLabelsMatchAPISupport(ds: PrometheusDatasource) {\n    try {\n      return ds.hasLabelsMatchAPISupport();\n    } catch (error) {\n      displayWarning([\n        'Error while checking if the current data source supports the labels match API! Defaulting to false.',\n        (error as Error).toString(),\n      ]);\n      return false;\n    }\n  }\n\n  private static getFiltersFromVariable(sceneObject: SceneObject): { filters: any[] } {\n    const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, sceneObject);\n\n    if (isAdHocFiltersVariable(filtersVariable)) {\n      return { filters: filtersVariable.state.filters };\n    }\n\n    return { filters: [] };\n  }\n\n  private processLabelOptions(options: Array<{ value: string; text: string }>): Array<{ value: string; text: string }> {\n    return options.filter(({ value }) => !value.startsWith('__')).sort((a, b) => localeCompare(a.value, b.value));\n  }\n\n  static async fetchLabelValues(labelName: string, sceneObject: SceneObject): Promise<string[]> {\n    const ds = await MetricDatasourceHelper.getPrometheusDataSourceForScene(sceneObject);\n    if (!ds) {\n      return [];\n    }\n\n    try {\n      return await MetricDatasourceHelper.fetchLabelValues({\n        ds,\n        labelName,\n        timeRange: sceneGraph.getTimeRange(sceneObject).state.value,\n      });\n    } catch (error) {\n      displayWarning([\n        `Error while retrieving label \"${labelName}\" values! Defaulting to an empty array.`,\n        (error as Error).toString(),\n      ]);\n      return [];\n    }\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","import { VariableHide, VariableRefresh } from '@grafana/data';\nimport { QueryVariable } from '@grafana/scenes';\nimport React from 'react';\n\nimport { LabelsDataSource } from './LabelsDataSource';\n\nexport const VAR_LABEL_VALUES = 'wingmanLabelValues';\n\nexport class LabelValuesVariable extends QueryVariable {\n  constructor({ labelName }: { labelName: string }) {\n    super({\n      name: VAR_LABEL_VALUES,\n      datasource: { uid: LabelsDataSource.uid },\n      // just some syntax we make up so that the data source can decide what to fetch\n      query: `valuesOf(${labelName})`,\n      isMulti: false,\n      allowCustomValue: false,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      hide: VariableHide.hideVariable,\n      // BOTH \"value\" and \"includeAll\" below ensure the repetition in SceneByVariableRepeater\n      // // (if not set, it'll render only the 1st variable option)\n      value: '$__all',\n      includeAll: true,\n    });\n  }\n\n  public static readonly Component = () => {\n    return <></>;\n  };\n}\n","import { css } from '@emotion/css';\nimport { VariableHide, VariableRefresh, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  DataSourceVariable,\n  QueryVariable,\n  sceneGraph,\n  type MultiValueVariable,\n  type SceneComponentProps,\n} from '@grafana/scenes';\nimport { Label, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { VAR_DATASOURCE, VAR_FILTERS, VAR_FILTERS_EXPR } from 'shared';\n\nimport { LabelsDataSource, NULL_GROUP_BY_VALUE } from './LabelsDataSource';\n\nexport const VAR_WINGMAN_GROUP_BY = 'labelsWingman';\n\nexport class LabelsVariable extends QueryVariable {\n  constructor() {\n    super({\n      name: VAR_WINGMAN_GROUP_BY,\n      label: 'Group by label',\n      placeholder: 'Group by label...',\n      datasource: { uid: LabelsDataSource.uid },\n      query: '',\n      includeAll: false,\n      isMulti: false,\n      allowCustomValue: false,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      hide: VariableHide.hideVariable,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this._subs.add(\n      this.subscribeToState((newState, prevState) => {\n        if (newState.query !== prevState.query) {\n          // preserve the value from the URL search param when landing\n          if (prevState.query) {\n            this.setState({ value: NULL_GROUP_BY_VALUE });\n          }\n\n          this.refreshOptions();\n        }\n      })\n    );\n\n    this._subs.add(\n      sceneGraph.findByKeyAndType(this, VAR_DATASOURCE, DataSourceVariable).subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          this.setState({ value: NULL_GROUP_BY_VALUE });\n          this.refreshOptions();\n        }\n      })\n    );\n\n    this._subs.add(\n      sceneGraph.findByKeyAndType(this, VAR_FILTERS, AdHocFiltersVariable).subscribeToState((newState, prevState) => {\n        if (newState.filterExpression !== prevState.filterExpression) {\n          this.updateQuery();\n        }\n      })\n    );\n\n    // hack to ensure that labels are loaded when landing: sometimes filters are not interpolated and fetching labels give no results\n    this.updateQuery();\n  }\n\n  private updateQuery() {\n    const filterExpression = sceneGraph.interpolate(this, VAR_FILTERS_EXPR, {});\n    this.setState({ query: `{__name__=~\".+\",${filterExpression}}` });\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<MultiValueVariable>) => {\n    const styles = useStyles2(getStyles);\n    const { label } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <Label className={styles.label}>{label}</Label>\n        <QueryVariable.Component model={model} />\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    align-items: center;\n    gap: 0;\n\n    [class*='input-wrapper'] {\n      width: 240px;\n    }\n  `,\n  label: css`\n    height: 32px;\n    white-space: nowrap;\n    margin: 0;\n    background-color: ${theme.colors.background.primary};\n    padding: ${theme.spacing(1)};\n    border-radius: ${theme.shape.radius.default};\n    border: 1px solid ${theme.colors.border.weak};\n    border-right: none;\n  `,\n});\n","import React from 'react';\n\nexport function GroupsIcon() {\n  return (\n    <svg stroke=\"currentColor\" width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\">\n      <circle cx=\"8.92688\" cy=\"3.63132\" r=\"2.375\" strokeWidth=\"1.5\" />\n      <path d=\"M13.6469 4.37965C14.6813 4.76699 15.3235 7.03139 14.9362 8.06582\" strokeWidth=\"1.5\" />\n      <path d=\"M4.35309 4.37965C3.31866 4.76699 2.67651 7.03139 3.06384 8.06582\" strokeWidth=\"1.5\" />\n      <path d=\"M10.3408 14.2531C9.75237 14.8415 8.11813 14.7799 7.50903 14.1708\" strokeWidth=\"1.5\" />\n      <circle cx=\"4.00195\" cy=\"12.251\" r=\"2.375\" strokeWidth=\"1.5\" />\n      <circle cx=\"13.8478\" cy=\"12.251\" r=\"2.375\" strokeWidth=\"1.5\" />\n    </svg>\n  );\n}\n","import {\n  FieldType,\n  LoadingState,\n  type DataQueryResponse,\n  type LegacyMetricFindQueryOptions,\n  type MetricFindValue,\n  type TestDataSourceResponse,\n} from '@grafana/data';\nimport { RuntimeDataSource, sceneGraph, type SceneObject } from '@grafana/scenes';\n\nimport { MetricDatasourceHelper } from 'helpers/MetricDatasourceHelper';\nimport { isPrometheusRule } from 'WingmanDataTrail/helpers/isPrometheusRule';\n\nexport class MetricsWithLabelValueDataSource extends RuntimeDataSource {\n  static readonly uid = 'grafana-prometheus-metrics-with-label-values-datasource';\n\n  constructor() {\n    super(MetricsWithLabelValueDataSource.uid, MetricsWithLabelValueDataSource.uid);\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'Labels',\n          fields: [\n            {\n              name: null,\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  async metricFindQuery(query: string, options: LegacyMetricFindQueryOptions): Promise<MetricFindValue[]> {\n    const sceneObject = options.scopedVars?.__sceneObject?.valueOf() as SceneObject;\n\n    const ds = await MetricDatasourceHelper.getPrometheusDataSourceForScene(sceneObject);\n    if (!ds) {\n      return [];\n    }\n\n    const timeRange = sceneGraph.getTimeRange(sceneObject).state.value;\n    let metricsList: string[] = [];\n\n    const removeRules = query.startsWith('removeRules');\n    const matcher = removeRules ? query.replace('removeRules', '') : query;\n\n    metricsList = await MetricDatasourceHelper.fetchLabelValues({\n      ds,\n      labelName: '__name__',\n      matcher,\n      timeRange,\n    });\n\n    if (removeRules) {\n      metricsList = metricsList.filter((metricName) => !isPrometheusRule(metricName));\n    }\n\n    return metricsList.map((metricName) => ({ value: metricName, text: metricName }));\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","export const isPrometheusRule = (metricName: string) =>\n  metricName === 'ALERTS' || metricName === 'ALERTS_FOR_STATE' || metricName.includes(':');\n","import { VariableHide, VariableRefresh } from '@grafana/data';\nimport { QueryVariable, sceneGraph } from '@grafana/scenes';\n\nimport { VAR_FILTERS, VAR_FILTERS_EXPR } from 'shared';\nimport { withLifecycleEvents } from 'WingmanDataTrail/MetricsVariables/withLifecycleEvents';\n\nimport { MetricsWithLabelValueDataSource } from './MetricsWithLabelValueDataSource';\n\nexport const VAR_METRIC_WITH_LABEL_VALUE = 'metrics-with-label-value';\n\nexport class MetricsWithLabelValueVariable extends QueryVariable {\n  constructor({\n    labelName,\n    labelValue,\n    removeRules,\n  }: {\n    labelName: string;\n    labelValue: string;\n    removeRules?: boolean;\n  }) {\n    super({\n      key: `${VAR_METRIC_WITH_LABEL_VALUE}-${labelName}-${labelValue}`,\n      name: VAR_METRIC_WITH_LABEL_VALUE,\n      datasource: { uid: MetricsWithLabelValueDataSource.uid },\n      query: MetricsWithLabelValueVariable.buildQuery(labelName, labelValue, removeRules),\n      isMulti: false,\n      allowCustomValue: false,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      hide: VariableHide.hideVariable,\n      skipUrlSync: true,\n      // BOTH \"value\" and \"includeAll\" below ensure the repetition in SceneByVariableRepeater\n      // // (if not set, it'll render only the 1st variable option)\n      value: '$__all',\n      includeAll: true,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, labelName, labelValue, removeRules));\n\n    // required for filtering and sorting\n    return withLifecycleEvents<MetricsWithLabelValueVariable>(this);\n  }\n\n  protected onActivate(labelName: string, labelValue: string, removeRules?: boolean) {\n    const adHocFiltersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n\n    if (adHocFiltersVariable?.state.hide !== VariableHide.hideVariable) {\n      this.setState({\n        query: MetricsWithLabelValueVariable.buildQuery(labelName, labelValue, removeRules),\n      });\n    }\n  }\n\n  private static buildQuery(labelName: string, labelValue: string, removeRules?: boolean) {\n    return removeRules\n      ? `removeRules{${labelName}=\"${labelValue}\",${VAR_FILTERS_EXPR}}`\n      : `{${labelName}=\"${labelValue}\",${VAR_FILTERS_EXPR}}`;\n  }\n}\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneReactObject,\n  SceneVariableSet,\n  type AdHocFiltersVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Button, CollapsableSection, Spinner, useStyles2 } from '@grafana/ui';\nimport React, { useState } from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { GmdVizPanel } from 'GmdVizPanel/GmdVizPanel';\nimport { VAR_FILTERS } from 'shared';\nimport { getColorByIndex } from 'utils';\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\nimport { VAR_WINGMAN_GROUP_BY, type LabelsVariable } from 'WingmanDataTrail/Labels/LabelsVariable';\nimport { LayoutSwitcher, LayoutType, type LayoutSwitcherState } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { GRID_TEMPLATE_COLUMNS, GRID_TEMPLATE_ROWS } from 'WingmanDataTrail/MetricsList/MetricsList';\nimport { METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW } from 'WingmanDataTrail/MetricVizPanel/MetricVizPanel';\nimport { WithUsageDataPreviewPanel } from 'WingmanDataTrail/MetricVizPanel/WithUsageDataPreviewPanel';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\nimport { GroupsIcon } from 'WingmanDataTrail/SideBar/custom-icons/GroupsIcon';\n\nimport {\n  MetricsWithLabelValueVariable,\n  VAR_METRIC_WITH_LABEL_VALUE,\n} from './MetricsWithLabelValue/MetricsWithLabelValueVariable';\n\nexport interface MetricsGroupByRowState extends SceneObjectState {\n  index: number;\n  labelName: string;\n  labelValue: string;\n  labelCardinality: number;\n  $variables: SceneVariableSet;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricsGroupByRow extends SceneObjectBase<MetricsGroupByRowState> {\n  public constructor({\n    index,\n    labelName,\n    labelValue,\n    labelCardinality,\n  }: {\n    index: MetricsGroupByRowState['index'];\n    labelName: MetricsGroupByRowState['labelName'];\n    labelValue: MetricsGroupByRowState['labelValue'];\n    labelCardinality: MetricsGroupByRowState['labelCardinality'];\n  }) {\n    super({\n      index,\n      labelName,\n      labelValue,\n      labelCardinality,\n      key: `${labelName || ''}-${labelValue || ''}`,\n      $variables: new SceneVariableSet({\n        variables: [new MetricsWithLabelValueVariable({ labelName, labelValue })],\n      }),\n      body: new SceneByVariableRepeater({\n        variableName: VAR_METRIC_WITH_LABEL_VALUE,\n        initialPageSize: 3,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: GRID_TEMPLATE_COLUMNS,\n          autoRows: METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW,\n          $behaviors: [\n            new behaviors.CursorSync({\n              key: 'metricCrosshairSync',\n              sync: DashboardCursorSync.Crosshair,\n            }),\n          ],\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No metrics found for the current filters and time range.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: <InlineBanner severity=\"error\" title=\"Error while loading metrics!\" error={error} />,\n          }),\n        getLayoutChild: (option, colorIndex) => {\n          return new SceneCSSGridItem({\n            body: new WithUsageDataPreviewPanel({\n              vizPanelInGridItem: new GmdVizPanel({\n                metric: option.value as string,\n                matchers: [{ key: labelName, operator: '=', value: labelValue }],\n                fixedColor: getColorByIndex(colorIndex),\n              }),\n              metric: option.value as string,\n            }),\n          });\n        },\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToLayoutChange();\n  }\n\n  private subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', LayoutSwitcher);\n    const body = this.state.body.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: LayoutSwitcherState, prevState?: LayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: newState.layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n        });\n      }\n    };\n\n    onChangeState(layoutSwitcher.state); // ensure layout when landing on the page\n\n    this._subs.add(layoutSwitcher.subscribeToState(onChangeState));\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsGroupByRow>) => {\n    const [isCollapsed, setIsCollapsed] = useState(false);\n    const styles = useStyles2(getStyles);\n\n    const { index, labelName, labelValue, labelCardinality, $variables, body } = model.useState();\n\n    const variable = $variables.state.variables[0] as MetricsWithLabelValueVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    const onClickSelect = () => {\n      const adHocFiltersVariable = sceneGraph.lookupVariable(VAR_FILTERS, model) as AdHocFiltersVariable;\n\n      adHocFiltersVariable.setState({\n        // TOOD: keep unique filters\n        filters: [...adHocFiltersVariable.state.filters, { key: labelName, operator: '=', value: labelValue }],\n      });\n\n      (sceneGraph.lookupVariable(VAR_WINGMAN_GROUP_BY, model) as LabelsVariable)?.changeValueTo(NULL_GROUP_BY_VALUE);\n    };\n\n    return (\n      <div className={styles.container} data-testid={`${labelName}-${labelValue}-metrics-group`}>\n        <div className={styles.containerHeader}>\n          <div className={styles.headerButtons}>\n            <Button\n              className={styles.selectButton}\n              variant=\"secondary\"\n              onClick={onClickSelect}\n              tooltip={`See metrics with ${labelName}=${labelValue}`}\n              tooltipPlacement=\"top\"\n            >\n              Select\n            </Button>\n          </div>\n        </div>\n\n        {\n          <CollapsableSection\n            isOpen={!isCollapsed}\n            onToggle={() => setIsCollapsed(!isCollapsed)}\n            label={\n              <div className={styles.groupName}>\n                <GroupsIcon />\n                <div className={styles.labelValue}>{labelValue}</div>\n                {labelCardinality > 1 && (\n                  <div className={styles.index}>\n                    ({index + 1}/{labelCardinality})\n                  </div>\n                )}\n              </div>\n            }\n          >\n            <div className={styles.collapsableSectionBody}>\n              <body.Component model={body} />\n            </div>\n\n            {shouldDisplayShowMoreButton && (\n              <div className={styles.footer}>\n                <ShowMoreButton\n                  label=\"metric\"\n                  batchSizes={batchSizes}\n                  onClick={onClickShowMore}\n                  tooltip={`Show more metrics for ${labelName}=\"${labelValue}\"`}\n                />\n              </div>\n            )}\n          </CollapsableSection>\n        }\n\n        {/* required to trigger its activation handlers */}\n        <div className={styles.variable}>\n          <variable.Component key={variable.state.name} model={variable} />\n        </div>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      background: theme.colors.background.canvas,\n      margin: theme.spacing(1, 0, 0, 0),\n\n      '& div:focus-within': {\n        boxShadow: 'none !important',\n      },\n    }),\n    containerHeader: css({\n      display: 'flex',\n      alignItems: 'center',\n      gap: '8px',\n      marginBottom: '-36px',\n      paddingBottom: theme.spacing(1.5),\n      borderBottom: `1px solid ${theme.colors.border.medium}`,\n    }),\n    headerButtons: css({\n      position: 'relative',\n      top: '3px',\n      marginLeft: 'auto',\n      marginRight: '30px',\n      zIndex: 100,\n    }),\n    selectButton: css({\n      height: '28px',\n    }),\n    collapsableSectionBody: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: '24px',\n      padding: theme.spacing(1),\n    }),\n    groupName: css({\n      display: 'flex',\n      alignItems: 'center',\n      fontSize: '1.3rem',\n      lineHeight: '1.3rem',\n    }),\n    labelValue: css({\n      fontSize: '16px',\n      marginLeft: '8px',\n    }),\n    index: css({\n      fontSize: '12px',\n      color: theme.colors.text.secondary,\n      marginLeft: '8px',\n    }),\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginTop: theme.spacing(1),\n\n      '& button': {\n        height: '40px',\n      },\n    }),\n    variable: css({\n      display: 'none',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneObjectBase,\n  SceneReactObject,\n  SceneVariableSet,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { LabelValuesVariable, VAR_LABEL_VALUES } from 'WingmanDataTrail/Labels/LabelValuesVariable';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\n\nimport { MetricsGroupByRow } from './MetricsGroupByRow';\n\ninterface MetricsGroupByListState extends SceneObjectState {\n  labelName: string;\n  $variables: SceneVariableSet;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricsGroupByList extends SceneObjectBase<MetricsGroupByListState> {\n  constructor({ labelName }: { labelName: MetricsGroupByListState['labelName'] }) {\n    super({\n      key: 'metrics-group-list',\n      labelName,\n      $variables: new SceneVariableSet({\n        variables: [new LabelValuesVariable({ labelName })],\n      }),\n      body: new SceneByVariableRepeater({\n        variableName: VAR_LABEL_VALUES,\n        initialPageSize: 20,\n        pageSizeIncrement: 10,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: '1fr',\n          autoRows: 'auto',\n          rowGap: 1,\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No label values found for label &quot;{labelName}&quot;.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner severity=\"error\" title={`Error while loading label \"${labelName}\" values!`} error={error} />\n            ),\n          }),\n        getLayoutChild: (option, index, options) => {\n          return new SceneCSSGridItem({\n            body: new MetricsGroupByRow({\n              index,\n              labelName,\n              labelValue: option.value as string,\n              labelCardinality: options.length,\n            }),\n          });\n        },\n      }),\n    });\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<MetricsGroupByList>) => {\n    const styles = useStyles2(getStyles);\n    const { body, $variables, labelName } = model.useState();\n\n    const variable = $variables.state.variables[0] as LabelValuesVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    return (\n      <div data-testid=\"metrics-groupby-list\">\n        <body.Component model={body} />\n\n        {shouldDisplayShowMoreButton && (\n          <div className={styles.footer}>\n            <ShowMoreButton label={`\"${labelName}\" value`} batchSizes={batchSizes} onClick={onClickShowMore} />\n          </div>\n        )}\n\n        {/* required to trigger its activation handlers */}\n        <div className={styles.variable}>\n          <variable.Component key={variable.state.name} model={variable} />\n        </div>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      margin: theme.spacing(3, 0, 1, 0),\n\n      '& button': {\n        height: '40px',\n      },\n    }),\n    variable: css({\n      display: 'none',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type SelectableValue } from '@grafana/data';\nimport {\n  EmbeddedScene,\n  SceneFlexItem,\n  SceneFlexLayout,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneReactObject,\n  type SceneVariableSet,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { MetricsSorter } from './MetricsSorter/MetricsSorter';\nimport { type CountsProvider } from './QuickSearch/CountsProvider/CountsProvider';\nimport { MetricVariableCountsProvider } from './QuickSearch/CountsProvider/MetricVariableCountsProvider';\nimport { QuickSearch } from './QuickSearch/QuickSearch';\n\ninterface ListControlsState extends SceneObjectState {\n  $variables?: SceneVariableSet;\n  inputControls?: SceneReactObject;\n  onChange?: (value: SelectableValue<string>) => void; // Keeping for backward compatibility\n}\n\n// @ts-ignore to fix build error. Is there a Scenes friend way of doing this?\nexport class ListControls extends EmbeddedScene {\n  constructor(state: Partial<ListControlsState>) {\n    super({\n      ...state,\n      key: 'list-controls',\n      body: new SceneFlexLayout({\n        direction: 'row',\n        width: '100%',\n        maxHeight: '32px',\n        children: [\n          new SceneFlexItem({\n            body: new QuickSearch({\n              urlSearchParamName: 'search_txt',\n              targetName: 'metric',\n              countsProvider: new MetricVariableCountsProvider() as unknown as CountsProvider,\n            }),\n          }),\n          new SceneFlexItem({\n            width: 'auto',\n            body: new MetricsSorter({}),\n          }),\n          new SceneFlexItem({\n            width: 'auto',\n            body: new LayoutSwitcher({}),\n          }),\n        ],\n      }),\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<ListControls>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n\n    return (\n      <div className={styles.headerWrapper}>\n        <body.Component model={body} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles() {\n  return {\n    headerWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n      '& > div': {\n        display: 'flex',\n        alignItems: 'center',\n        '& > div': {\n          display: 'flex',\n          alignItems: 'center',\n        },\n      },\n    }),\n  };\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventApplyFunctionPayload {\n  metricName: string;\n  prometheusFunction: string;\n}\n\nexport class EventApplyFunction extends BusEventWithPayload<EventApplyFunctionPayload> {\n  public static readonly type = 'apply-function';\n}\n","import { css } from '@emotion/css';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { type PrometheusFn } from './ConfigureAction';\nimport { EventApplyFunction } from './EventApplyFunction';\n\ninterface ApplyActionState extends SceneObjectState {\n  metricName: string;\n  prometheusFunction: PrometheusFn;\n  disabled?: boolean;\n}\n\nexport class ApplyAction extends SceneObjectBase<ApplyActionState> {\n  constructor({ metricName, prometheusFunction, disabled }: ApplyActionState) {\n    super({\n      key: `apply-action-${metricName}`,\n      metricName,\n      prometheusFunction,\n      disabled: Boolean(disabled),\n    });\n  }\n\n  public onClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    const { metricName, prometheusFunction } = this.state;\n\n    event.preventDefault();\n\n    this.publishEvent(\n      new EventApplyFunction({\n        metricName,\n        prometheusFunction,\n      }),\n      true\n    );\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<ApplyAction>) => {\n    const styles = useStyles2(getStyles);\n    const { disabled } = model.useState();\n\n    return (\n      <Button\n        variant=\"primary\"\n        fill=\"outline\"\n        size=\"sm\"\n        className={styles.selectButton}\n        onClick={model.onClick}\n        disabled={disabled}\n      >\n        Apply\n      </Button>\n    );\n  };\n}\n\nconst getStyles = () => ({\n  selectButton: css``,\n});\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventConfigureFunctionPayload {\n  metricName: string;\n}\n\nexport class EventConfigureFunction extends BusEventWithPayload<EventConfigureFunctionPayload> {\n  public static readonly type = 'configure-function';\n}\n","import { css } from '@emotion/css';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventConfigureFunction } from './EventConfigureFunction';\n\ninterface ConfigureActionState extends SceneObjectState {\n  metricName: string;\n}\n\nexport class ConfigureAction extends SceneObjectBase<ConfigureActionState> {\n  static readonly PROMETHEUS_FN_OPTIONS = [\n    { label: 'Average', value: 'avg' },\n    { label: 'Sum', value: 'sum' },\n    { label: 'Minimum', value: 'min' },\n    { label: 'Maximum', value: 'max' },\n    { label: 'Rate', value: 'rate' },\n  ] as const;\n\n  constructor({ metricName }: { metricName: ConfigureActionState['metricName'] }) {\n    super({\n      key: `configure-action-${metricName}`,\n      metricName,\n    });\n  }\n\n  public onClick = () => {\n    this.publishEvent(new EventConfigureFunction({ metricName: this.state.metricName }), true);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<ConfigureAction>) => {\n    const styles = useStyles2(getStyles);\n\n    return (\n      <Button\n        className={styles.selectButton}\n        aria-label=\"Configure\"\n        variant=\"secondary\"\n        size=\"sm\"\n        fill=\"text\"\n        onClick={model.onClick}\n        icon=\"cog\"\n        tooltip=\"Configure the Prometheus function\"\n        tooltipPlacement=\"top\"\n      />\n    );\n  };\n}\n\nconst getStyles = () => ({\n  selectButton: css`\n    margin: 0;\n    padding: 0;\n  `,\n});\n\nexport type PrometheusFn = (typeof ConfigureAction.PROMETHEUS_FN_OPTIONS)[number]['value'];\n","import { SceneObjectBase, type SceneComponentProps, type SceneObject, type SceneObjectState } from '@grafana/scenes';\nimport { Drawer } from '@grafana/ui';\nimport React from 'react';\n\ninterface SceneDrawerState extends SceneObjectState {\n  key?: string;\n  isOpen?: boolean;\n  title?: string;\n  subTitle?: string;\n  body?: SceneObject;\n}\n\nexport class SceneDrawer extends SceneObjectBase<SceneDrawerState> {\n  constructor(state?: SceneDrawerState) {\n    super({\n      key: 'drawer',\n      isOpen: false,\n      ...state,\n    });\n  }\n\n  open = ({\n    title,\n    subTitle,\n    body,\n  }: {\n    title?: SceneDrawerState['title'];\n    subTitle?: SceneDrawerState['subTitle'];\n    body?: SceneDrawerState['body'];\n  }) => {\n    this.setState({ ...this.state, isOpen: true, title, subTitle, body });\n  };\n\n  close = () => {\n    this.setState({ isOpen: false });\n  };\n\n  static readonly Component = ({ model }: SceneComponentProps<SceneDrawer>) => {\n    const { isOpen, title, subTitle, body } = model.useState();\n\n    return (\n      <>\n        {body && isOpen && (\n          <Drawer size=\"lg\" title={title} subtitle={subTitle} closeOnMaskClick onClose={model.close}>\n            <body.Component model={body} />\n          </Drawer>\n        )}\n      </>\n    );\n  };\n}\n","// Constants for metric rule type labels\nexport const LABEL_METRICS = 'Non-rules metrics';\nexport const LABEL_RULES = 'Recording rules';\n\nexport const ruleGroupLabels = {\n  metrics: LABEL_METRICS,\n  rules: LABEL_RULES,\n} as const;\n\nexport type RuleGroupLabel = (typeof ruleGroupLabels)[keyof typeof ruleGroupLabels];\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventSectionValueChangedPayload {\n  key: string;\n  values: string[];\n}\n\nexport class EventSectionValueChanged extends BusEventWithPayload<EventSectionValueChangedPayload> {\n  public static readonly type = 'section-value-changed';\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Checkbox, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nexport const CheckboxWithCount = ({\n  label,\n  count,\n  checked,\n  onChange,\n}: {\n  label: string;\n  count: number;\n  checked: boolean;\n  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\n}) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.checkboxWrapper} title={label}>\n      <Checkbox label={label} value={checked} onChange={onChange} />\n      <span className={styles.count}>({count})</span>\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    checkboxWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n      width: '100%',\n      '& label *': {\n        fontSize: '14px !important',\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n      },\n    }),\n    count: css({\n      color: theme.colors.text.secondary,\n      marginLeft: theme.spacing(0.5),\n      display: 'inline-block',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { type RuleGroupLabel } from 'WingmanDataTrail/MetricsVariables/metricLabels';\n\nimport { CheckboxWithCount } from './CheckboxWithCount';\nimport { type MetricsFilterSectionState } from './MetricsFilterSection';\n\ntype CheckBoxListProps = {\n  groups: MetricsFilterSectionState['groups'];\n  selectedGroups: MetricsFilterSectionState['selectedGroups'];\n  onSelectionChange: (newGroups: MetricsFilterSectionState['selectedGroups']) => void;\n};\n\nexport function CheckBoxList({ groups, selectedGroups, onSelectionChange }: Readonly<CheckBoxListProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <>\n      <div className={styles.checkboxListHeader}>\n        <div>{selectedGroups.length} selected</div>\n        <Button variant=\"secondary\" fill=\"text\" onClick={() => onSelectionChange([])} disabled={!selectedGroups.length}>\n          clear\n        </Button>\n      </div>\n\n      {!groups.length && <div className={styles.noResults}>No results.</div>}\n\n      {groups.length > 0 && (\n        <ul className={styles.checkboxList} data-testid=\"checkbox-filters-list\">\n          {groups.map((group) => (\n            <li key={group.value} className={styles.checkboxItem}>\n              <CheckboxWithCount\n                label={group.label}\n                count={group.count}\n                checked={selectedGroups.some((g) => g.value === group.value)}\n                onChange={(e) => {\n                  const newGroups = e.currentTarget.checked\n                    ? [...selectedGroups, { label: group.label as RuleGroupLabel, value: group.value }]\n                    : selectedGroups.filter((v) => v.value !== group.value);\n\n                  onSelectionChange(newGroups);\n                }}\n              />\n            </li>\n          ))}\n        </ul>\n      )}\n    </>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    checkboxListHeader: css({\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'center',\n      color: theme.colors.text.secondary,\n      margin: theme.spacing(0),\n      padding: theme.spacing(0, 0, 0, 1),\n    }),\n    checkboxList: css({\n      height: '100%',\n      margin: 0,\n      padding: theme.spacing(0, 1, 1, 1),\n      overflowY: 'auto',\n      '& .css-1n4u71h-Label': {\n        fontSize: '14px !important',\n      },\n      '&::-webkit-scrollbar': {\n        '-webkit-appearance': 'none',\n        width: '7px',\n      },\n      '&::-webkit-scrollbar-thumb': {\n        borderRadius: '4px',\n        backgroundColor: theme.colors.secondary.main,\n        '-webkit-box-shadow': `0 0 1px ${theme.colors.secondary.shade}`,\n      },\n    }),\n    checkboxItem: css({\n      display: 'flex',\n      alignItems: 'center',\n      width: '100%',\n      padding: theme.spacing(0.5, 0),\n    }),\n    noResults: css({\n      fontStyle: 'italic',\n      padding: theme.spacing(0, 1, 1, 1),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  VariableDependencyConfig,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { Icon, IconButton, Input, Spinner, Switch, useStyles2 } from '@grafana/ui';\nimport React, { useMemo, useState, type KeyboardEventHandler } from 'react';\n\nimport { logger } from 'tracking/logger/logger';\nimport { MetricsReducer } from 'WingmanDataTrail/MetricsReducer';\nimport {\n  VAR_FILTERED_METRICS_VARIABLE,\n  type FilteredMetricsVariable,\n} from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport { ruleGroupLabels, type RuleGroupLabel } from 'WingmanDataTrail/MetricsVariables/metricLabels';\nimport {\n  VAR_METRICS_VARIABLE,\n  type MetricOptions,\n  type MetricsVariable,\n} from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\nimport {\n  MetricsVariableFilterEngine,\n  type MetricFilters,\n} from 'WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine';\n\nimport { reportExploreMetrics } from '../../../../interactions';\nimport { EventSectionValueChanged } from '../EventSectionValueChanged';\nimport { SectionTitle } from '../SectionTitle';\nimport { type SideBarSectionState } from '../types';\nimport { CheckBoxList } from './CheckBoxList';\nimport { EventFiltersChanged } from './EventFiltersChanged';\n\nexport interface MetricsFilterSectionState extends SideBarSectionState {\n  type: keyof MetricFilters;\n  computeGroups: (\n    options: Array<{ label: string; value: string }>\n  ) => Array<{ label: string; value: string; count: number }>;\n  showHideEmpty: boolean;\n  showSearch: boolean;\n  groups: Array<{ label: string; value: string; count: number }>;\n  selectedGroups: Array<{ label: RuleGroupLabel; value: string }>; // we need labels for displaying tooltips in `SideBar.tsx`\n  loading: boolean;\n}\n\nexport class MetricsFilterSection extends SceneObjectBase<MetricsFilterSectionState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_METRICS_VARIABLE, VAR_FILTERED_METRICS_VARIABLE],\n    onReferencedVariableValueChanged: (variable) => {\n      const { name, options } = (variable as MultiValueVariable).state;\n\n      if (name === VAR_METRICS_VARIABLE) {\n        this.updateLists(options as MetricOptions);\n        return;\n      }\n\n      if (name === VAR_FILTERED_METRICS_VARIABLE) {\n        this.updateCounts();\n      }\n    },\n  });\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: [this.state.key] });\n\n  getUrlState() {\n    return {\n      [this.state.key]: this.state.selectedGroups.map((g) => g.value).join(','),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<MetricsFilterSectionState> = {};\n\n    if (\n      typeof values[this.state.key] === 'string' &&\n      values[this.state.key] !== this.state.selectedGroups.map((g) => g.value).join(',')\n    ) {\n      stateUpdate.selectedGroups = (values[this.state.key] as string)\n        .split(',')\n        .map((v) => ({ label: v as RuleGroupLabel, value: v })) as Array<{ label: RuleGroupLabel; value: string }>;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  constructor({\n    key,\n    type,\n    title,\n    description,\n    icon,\n    computeGroups,\n    showHideEmpty,\n    showSearch,\n    disabled,\n    active,\n  }: {\n    key: MetricsFilterSectionState['key'];\n    type: MetricsFilterSectionState['type'];\n    title: MetricsFilterSectionState['title'];\n    description: MetricsFilterSectionState['description'];\n    icon: MetricsFilterSectionState['icon'];\n    computeGroups: MetricsFilterSectionState['computeGroups'];\n    showHideEmpty?: MetricsFilterSectionState['showHideEmpty'];\n    showSearch?: MetricsFilterSectionState['showSearch'];\n    disabled?: MetricsFilterSectionState['disabled'];\n    active?: MetricsFilterSectionState['active'];\n  }) {\n    super({\n      key,\n      type,\n      title,\n      description,\n      icon,\n      groups: [],\n      computeGroups,\n      selectedGroups: [],\n      loading: true,\n      showHideEmpty: showHideEmpty ?? true,\n      showSearch: showSearch ?? true,\n      disabled: disabled ?? false,\n      active: active ?? false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const metricsVariable = sceneGraph.lookupVariable(VAR_METRICS_VARIABLE, this) as MetricsVariable;\n    const filteredMetricsVariable = sceneGraph.lookupVariable(\n      VAR_FILTERED_METRICS_VARIABLE,\n      this\n    ) as FilteredMetricsVariable;\n\n    this.updateLists(metricsVariable.state.options as MetricOptions);\n    this.updateCounts();\n\n    const { selectedGroups } = this.state;\n\n    this.setState({\n      loading: filteredMetricsVariable.state.loading,\n      active: selectedGroups.length > 0,\n    });\n  }\n\n  private updateLists(options: MetricOptions) {\n    this.setState({\n      groups: this.state.computeGroups(options),\n      loading: false,\n    });\n  }\n\n  private updateCounts() {\n    const { groups, computeGroups, type } = this.state;\n\n    // Access the original unfiltered options\n    const metricsVariable = sceneGraph.lookupVariable(VAR_METRICS_VARIABLE, this) as MetricsVariable;\n    const originalOptions = metricsVariable.state.options as MetricOptions;\n\n    const metricsReducer = sceneGraph.getAncestor(this, MetricsReducer);\n    const filterEngine = metricsReducer.state.enginesMap.get(VAR_FILTERED_METRICS_VARIABLE)?.filterEngine;\n\n    if (!filterEngine) {\n      logger.warn('MetricsFilterSection: No filter engine found');\n      return;\n    }\n\n    // Create a copy of current filters excluding the current filter type\n    const filtersWithoutCurrentType = { ...filterEngine.getFilters(), [type]: [] };\n\n    // Get options filtered by everything except the current filter type\n    const optionsForCounting = MetricsVariableFilterEngine.getFilteredOptions(\n      originalOptions,\n      filtersWithoutCurrentType\n    );\n\n    // Calculate counts based on these options\n    const newGroups = new Map<string, number>(\n      computeGroups(optionsForCounting).map((option) => [option.label, option.count])\n    );\n\n    const newGroupsWithCount = groups.map((group) => ({\n      ...group,\n      count: newGroups.get(group.label) ?? 0,\n    }));\n\n    this.setState({\n      groups: newGroupsWithCount,\n      loading: false,\n    });\n  }\n\n  private onSelectionChange = (selectedGroups: MetricsFilterSectionState['selectedGroups']) => {\n    this.setState({ selectedGroups, active: selectedGroups.length > 0 });\n\n    this.publishEvent(\n      new EventFiltersChanged({ type: this.state.type, filters: selectedGroups.map((g) => g.value) }),\n      true\n    );\n\n    this.publishEvent(\n      new EventSectionValueChanged({ key: this.state.key, values: selectedGroups.map((g) => g.label) }),\n      true\n    );\n\n    if (this.state.type === 'prefixes') {\n      reportExploreMetrics('sidebar_prefix_filter_applied', {\n        filter_count: selectedGroups.length,\n      });\n    } else if (this.state.type === 'suffixes') {\n      reportExploreMetrics('sidebar_suffix_filter_applied', {\n        filter_count: selectedGroups.length,\n      });\n    }\n\n    // Track rule filter selection events\n    if (this.state.key === 'filters-rule' && selectedGroups.length > 0) {\n      // Map the label to the appropriate filter_type for the event\n      selectedGroups.forEach((group) => {\n        let filterType: 'non_rules_metrics' | 'recording_rules' | 'alerting_rules';\n\n        switch (group.label) {\n          case ruleGroupLabels.metrics:\n            filterType = 'non_rules_metrics';\n            break;\n          case ruleGroupLabels.rules:\n            filterType = 'recording_rules';\n            break;\n          default:\n            return; // Skip if it's not a recognized rules filter\n        }\n\n        reportExploreMetrics('sidebar_rules_filter_selected', { filter_type: filterType });\n      });\n    }\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsFilterSection>) => {\n    const styles = useStyles2(getStyles);\n    const { groups, selectedGroups, loading, title, description, showHideEmpty, showSearch } = model.useState();\n\n    const [hideEmpty, setHideEmpty] = useState(false);\n    const [searchValue, setSearchValue] = useState('');\n\n    const filteredGroups = useMemo(() => {\n      const filters: Array<(item: { label: string; value: string; count: number }) => boolean> = [];\n\n      if (hideEmpty) {\n        filters.push((item) => item.count > 0);\n      }\n\n      filters.push((item) => item.label.toLowerCase().includes(searchValue.toLowerCase()));\n\n      return groups.filter((group) => filters.every((filter) => filter(group)));\n    }, [hideEmpty, groups, searchValue]);\n\n    const onKeyDown: KeyboardEventHandler<HTMLInputElement> = (e) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        setSearchValue('');\n      }\n    };\n\n    return (\n      <div className={styles.container}>\n        <SectionTitle title={title} description={description} />\n\n        {showHideEmpty && (\n          <div className={styles.switchContainer}>\n            <span className={styles.switchLabel}>Hide empty</span>\n            <Switch value={hideEmpty} onChange={(e) => setHideEmpty(e.currentTarget.checked)} />\n          </div>\n        )}\n\n        {showSearch && (\n          <Input\n            className={styles.searchInput}\n            prefix={<Icon name=\"search\" />}\n            placeholder=\"Search...\"\n            value={searchValue}\n            onChange={(e) => setSearchValue(e.currentTarget.value)}\n            onKeyDown={onKeyDown}\n            suffix={\n              <IconButton name=\"times\" variant=\"secondary\" tooltip=\"Clear search\" onClick={() => setSearchValue('')} />\n            }\n          />\n        )}\n\n        {loading && <Spinner inline />}\n\n        {!loading && (\n          <CheckBoxList\n            groups={filteredGroups}\n            selectedGroups={selectedGroups}\n            onSelectionChange={model.onSelectionChange}\n          />\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n      overflowY: 'hidden',\n    }),\n    switchContainer: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'flex-end',\n      gap: theme.spacing(1),\n    }),\n    switchLabel: css({\n      fontSize: '12px',\n      color: theme.colors.text.primary,\n    }),\n    searchInput: css({\n      flexBasis: '32px',\n      flexShrink: 0,\n      marginBottom: theme.spacing(1),\n      padding: theme.spacing(0, 0.5),\n    }),\n  };\n}\n","import { localeCompare } from 'WingmanDataTrail/helpers/localCompare';\n\nconst NONE_SUFFIX = '<none>';\n\nexport function computeMetricSuffixGroups(options: Array<{ label: string; value: string }>) {\n  const rawSuffixesMap = new Map<string, string[]>();\n\n  for (const option of options) {\n    const parts = option.value.split(/[^a-z0-9]/i);\n    const key = parts.length <= 1 ? option.value : parts[parts.length - 1];\n    const values = rawSuffixesMap.get(key) ?? [];\n\n    values.push(option.value);\n    rawSuffixesMap.set(key || NONE_SUFFIX, values);\n  }\n\n  const suffixesMap = new Map<string, number>();\n\n  for (const [suffix, values] of rawSuffixesMap) {\n    suffixesMap.set(suffix, values.length);\n  }\n\n  return Array.from(suffixesMap.entries())\n    .sort((a, b) => {\n      if (a[1] !== b[1]) {\n        return b[1] - a[1];\n      }\n\n      return localeCompare(a[0], b[0]);\n    })\n    .map(([value, count]) => ({\n      value,\n      count,\n      label: value,\n    }));\n}\n","import { ruleGroupLabels } from './metricLabels';\n\ntype MetricType = 'metrics' | 'rules';\n\n/**\n * Checks if a metric name follows Prometheus recording rule naming conventions.\n *\n * @remarks Recording rules follow the pattern: `level:metric:operations` or `level:metric`.\n * The `level` component might be empty. Where `level` and `operations` can contain\n * underscores and alphanumeric characters. The `metric` part can contain any character, but can't be empty.\n */\nexport function isRecordingRule(value: string): boolean {\n  // Matches patterns like:\n  // - instance_path:requests:rate5m\n  // - path:requests:rate5m\n  // - job:request_failures_per_requests:ratio_rate5m\n  // - apiserver_request:availability30d\n  // - asserts:container_memory\n  // - :requests:rate5m\n  return /^\\w*:.*?(?::\\w+)?$/.test(value);\n}\n\nexport function computeRulesGroups(options: Array<{ label: string; value: string }>) {\n  const rulesMap = new Map<MetricType, string[]>([\n    ['metrics', []],\n    ['rules', []],\n  ]);\n\n  for (const option of options) {\n    const { value } = option;\n    const key: MetricType = isRecordingRule(value) ? 'rules' : 'metrics';\n\n    const values = rulesMap.get(key) ?? [];\n    values.push(value);\n    rulesMap.set(key, values);\n  }\n\n  return [\n    { value: '^(?!.*:.*)', label: ruleGroupLabels.metrics, count: rulesMap.get('metrics')!.length },\n    { value: ':', label: ruleGroupLabels.rules, count: rulesMap.get('rules')!.length },\n  ];\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2, type SelectableValue } from '@grafana/data';\nimport { Button, RadioButtonList, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\n\ntype LabelsListProps = {\n  labels: Array<SelectableValue<string>>;\n  selectedLabel: string;\n  onClickLabel: (label: string) => void;\n  onClickClearSelection: () => void;\n};\n\nexport function LabelsList({ labels, selectedLabel, onClickLabel, onClickClearSelection }: Readonly<LabelsListProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <>\n      <div className={styles.listHeader}>\n        <div className={styles.selected}>\n          {selectedLabel === NULL_GROUP_BY_VALUE ? 'No selection' : `Selected: \"${selectedLabel}\"`}\n        </div>\n        <Button\n          variant=\"secondary\"\n          fill=\"text\"\n          onClick={onClickClearSelection}\n          disabled={selectedLabel === NULL_GROUP_BY_VALUE}\n        >\n          clear\n        </Button>\n      </div>\n\n      {!labels.length && <div className={styles.noResults}>No results.</div>}\n\n      {labels.length > 0 && (\n        <div className={styles.list} data-testid=\"labels-list\">\n          {/* TODO: use a custom one to have option labels with ellipsis and title/tooltip when hovering\n      now we're customizing too much the component CSS */}\n          <RadioButtonList name=\"labels-list\" options={labels} onChange={onClickLabel} value={selectedLabel} />\n        </div>\n      )}\n    </>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    listHeader: css({\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'center',\n      color: theme.colors.text.secondary,\n      margin: theme.spacing(0),\n      padding: theme.spacing(0, 0, 0, 1),\n    }),\n    selected: css({\n      overflow: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n    }),\n    list: css({\n      display: 'flex',\n      flex: 1,\n      flexDirection: 'column',\n      gap: 0,\n      overflowY: 'auto',\n\n      '& [role=\"radiogroup\"]': {\n        gap: 0,\n      },\n\n      '& label': {\n        cursor: 'pointer',\n        padding: theme.spacing(0.5, 1),\n        '&:hover': {\n          background: theme.colors.background.secondary,\n        },\n      },\n\n      '& label div': {\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n      },\n    }),\n    noResults: css({\n      fontStyle: 'italic',\n      padding: theme.spacing(0, 1, 1, 1),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2, type SelectableValue } from '@grafana/data';\nimport { sceneGraph, SceneObjectBase, type SceneComponentProps } from '@grafana/scenes';\nimport { Icon, IconButton, Input, Spinner, useStyles2 } from '@grafana/ui';\nimport React, { useMemo, useState } from 'react';\n\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\nimport { type LabelsVariable } from 'WingmanDataTrail/Labels/LabelsVariable';\n\nimport { reportExploreMetrics } from '../../../../interactions';\nimport { EventSectionValueChanged } from '../EventSectionValueChanged';\nimport { SectionTitle } from '../SectionTitle';\nimport { type SideBarSectionState } from '../types';\nimport { LabelsList } from './LabelsList';\n\ninterface LabelsBrowserState extends SideBarSectionState {\n  variableName: string;\n}\n\nexport class LabelsBrowser extends SceneObjectBase<LabelsBrowserState> {\n  constructor({\n    key,\n    variableName,\n    title,\n    description,\n    icon,\n    disabled,\n    active,\n  }: {\n    key: LabelsBrowserState['key'];\n    variableName: LabelsBrowserState['variableName'];\n    title: LabelsBrowserState['title'];\n    description: LabelsBrowserState['description'];\n    icon: LabelsBrowserState['icon'];\n    disabled?: LabelsBrowserState['disabled'];\n    active?: LabelsBrowserState['active'];\n  }) {\n    super({\n      key,\n      variableName,\n      title,\n      description,\n      icon,\n      disabled: disabled ?? false,\n      active: active ?? false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const labelsVariable = sceneGraph.lookupVariable(this.state.variableName, this) as LabelsVariable;\n    const labelValue = labelsVariable.state.value;\n\n    this.setState({ active: Boolean(labelValue && labelValue !== NULL_GROUP_BY_VALUE) });\n\n    // Subscribe to variable changes to update active state when the variable is changed externally\n    this._subs.add(\n      labelsVariable.subscribeToState((newState) => {\n        const active = Boolean(newState.value && newState.value !== NULL_GROUP_BY_VALUE);\n        this.setState({ active });\n        this.publishEvent(new EventSectionValueChanged({ key: this.state.key, values: active ? [newState.value as string] : [] }), true);\n      })\n    );\n  }\n\n  private selectLabel(label: string) {\n    const labelsVariable = sceneGraph.lookupVariable(this.state.variableName, this) as LabelsVariable;\n    labelsVariable.changeValueTo(label);\n\n    const active = Boolean(label && label !== NULL_GROUP_BY_VALUE);\n\n    this.setState({ active });\n\n    this.publishEvent(new EventSectionValueChanged({ key: this.state.key, values: active ? [label] : [] }), true);\n  }\n\n  private onClickLabel = (label: string) => {\n    reportExploreMetrics('sidebar_group_by_label_filter_applied', { label });\n    this.selectLabel(label);\n  };\n\n  private onClickClearSelection = () => {\n    this.selectLabel(NULL_GROUP_BY_VALUE);\n  };\n\n  private useLabelsBrowser = () => {\n    const { variableName, title, description } = this.useState();\n\n    const labelsVariable = sceneGraph.lookupVariable(variableName, this) as LabelsVariable;\n    const { loading, options: labels, value: labelValue } = labelsVariable.useState();\n\n    const [searchValue, setSearchValue] = useState('');\n\n    const labelsList: Array<SelectableValue<string>> = useMemo(() => {\n      const filters = [\n        (item: string) => item !== NULL_GROUP_BY_VALUE,\n        (item: string) => item.toLowerCase().includes(searchValue.toLowerCase()),\n      ];\n\n      return labels.filter((item) => filters.every((filter) => filter(item.value as string))) as Array<\n        SelectableValue<string>\n      >;\n    }, [labels, searchValue]);\n\n    const onInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n      setSearchValue(e.currentTarget.value);\n    };\n\n    const onInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        setSearchValue('');\n      }\n    };\n\n    const onInputClear = () => {\n      setSearchValue('');\n    };\n\n    return {\n      title,\n      description,\n      loading,\n      selectedLabel: labelValue as string,\n      labelsList,\n      searchValue,\n      onInputChange,\n      onInputKeyDown,\n      onInputClear,\n    };\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<LabelsBrowser>) => {\n    const styles = useStyles2(getStyles);\n\n    const {\n      title,\n      description,\n      loading,\n      labelsList,\n      selectedLabel,\n      searchValue,\n      onInputChange,\n      onInputKeyDown,\n      onInputClear,\n    } = model.useLabelsBrowser();\n\n    return (\n      <div className={styles.container} data-testid=\"labels-browser\">\n        <SectionTitle title={title} description={description} />\n\n        <Input\n          className={styles.search}\n          prefix={<Icon name=\"search\" />}\n          placeholder=\"Search...\"\n          value={searchValue}\n          onChange={onInputChange}\n          onKeyDown={onInputKeyDown}\n          suffix={<IconButton name=\"times\" variant=\"secondary\" tooltip=\"Clear search\" onClick={onInputClear} />}\n        />\n\n        {loading && <Spinner inline />}\n\n        {!loading && (\n          <LabelsList\n            labels={labelsList}\n            selectedLabel={selectedLabel}\n            onClickLabel={model.onClickLabel}\n            onClickClearSelection={model.onClickClearSelection}\n          />\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n      overflowY: 'hidden',\n    }),\n    search: css({\n      marginBottom: theme.spacing(1),\n      padding: theme.spacing(0, 0.5),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { SectionTitle } from './SectionTitle';\nimport { type SideBarSectionState } from './types';\n\nexport interface SettingsState extends SideBarSectionState {}\n\nexport class Settings extends SceneObjectBase<SettingsState> {\n  constructor({\n    key,\n    title,\n    description,\n    icon,\n    disabled,\n  }: {\n    key: SettingsState['key'];\n    title: SettingsState['title'];\n    description: SettingsState['description'];\n    icon: SettingsState['icon'];\n    disabled?: SettingsState['disabled'];\n  }) {\n    super({\n      key,\n      title,\n      description,\n      icon,\n      disabled: disabled ?? false,\n      active: false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {}\n\n  public static readonly Component = ({ model }: SceneComponentProps<Settings>) => {\n    const styles = useStyles2(getStyles);\n    const { title, description } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <SectionTitle title={title} description={description} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n      overflowY: 'hidden',\n    }),\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { availableIconsIndex, type GrafanaTheme2, type IconName } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { GroupsIcon } from './custom-icons/GroupsIcon';\nimport { RulesIcon } from './custom-icons/RulesIcon';\n\nconst CustomIcons = new Map<string, React.FC>([\n  ['rules', RulesIcon],\n  ['groups', GroupsIcon],\n]);\n\ntype SideBarButtonProps = {\n  ariaLabel: string;\n  disabled: boolean;\n  visible: boolean;\n  active: boolean;\n  tooltip: string;\n  onClick: () => void;\n  iconOrText: string | IconName;\n};\n\nexport function SideBarButton({\n  ariaLabel,\n  disabled,\n  visible,\n  active,\n  tooltip,\n  iconOrText,\n  onClick,\n}: Readonly<SideBarButtonProps>) {\n  const styles = useStyles2(getStyles);\n\n  let buttonIcon;\n  let ButtonChild;\n\n  if (iconOrText in availableIconsIndex) {\n    buttonIcon = iconOrText as IconName;\n  } else if (CustomIcons.has(iconOrText)) {\n    // some icons are not available in the Saga Design System and have been added as SVG files to the code base\n    ButtonChild = CustomIcons.get(iconOrText);\n  } else {\n    ButtonChild = function ButtonChildText() {\n      return <>{iconOrText}</>;\n    };\n  }\n\n  return (\n    <Button\n      className={cx(styles.button, disabled && 'disabled', visible && 'visible', active && 'active')}\n      size=\"md\"\n      variant=\"secondary\"\n      fill=\"text\"\n      icon={buttonIcon}\n      aria-label={ariaLabel}\n      tooltip={tooltip}\n      tooltipPlacement=\"right\"\n      onClick={onClick}\n      disabled={disabled}\n    >\n      {ButtonChild && <ButtonChild />}\n    </Button>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    button: css({\n      margin: 0,\n      color: theme.colors.text.secondary,\n      '&:hover': {\n        color: theme.colors.text.maxContrast,\n        background: 'transparent',\n      },\n      '&.disabled:hover': {\n        color: theme.colors.text.secondary,\n      },\n      '&.visible': {\n        color: theme.colors.text.maxContrast,\n      },\n      '&.active': {\n        color: theme.colors.text.maxContrast,\n      },\n    }),\n  };\n}\n","import React from 'react';\n\nexport function RulesIcon() {\n  return (\n    <svg stroke=\"currentColor\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n      <rect x=\"1.25\" y=\"1.625\" width=\"5.25\" height=\"5.25\" rx=\"1\" strokeWidth=\"1.5\" />\n      <circle cx=\"12.25\" cy=\"4.25\" r=\"2.75\" strokeWidth=\"1.5\" />\n      <circle cx=\"3.75\" cy=\"11.75\" r=\"2.75\" strokeWidth=\"1.5\" />\n      <rect x=\"9.5\" y=\"9.125\" width=\"5.25\" height=\"5.25\" rx=\"1\" strokeWidth=\"1.5\" />\n    </svg>\n  );\n}\n","import { css, cx } from '@emotion/css';\nimport { VariableHide, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  sceneGraph,\n  SceneObjectBase,\n  type AdHocFilterWithLabels,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { IconButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { VAR_OTHER_METRIC_FILTERS } from 'shared';\nimport { getTrailFor } from 'utils';\nimport { isAdHocFiltersVariable } from 'utils/utils.variables';\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\nimport { VAR_WINGMAN_GROUP_BY } from 'WingmanDataTrail/Labels/LabelsVariable';\nimport { computeMetricPrefixGroups } from 'WingmanDataTrail/MetricsVariables/computeMetricPrefixGroups';\nimport { computeMetricSuffixGroups } from 'WingmanDataTrail/MetricsVariables/computeMetricSuffixGroups';\nimport { computeRulesGroups } from 'WingmanDataTrail/MetricsVariables/computeRulesGroups';\n\nimport { reportExploreMetrics } from '../../interactions';\nimport { BookmarksList } from './sections/BookmarksList';\nimport { EventSectionValueChanged } from './sections/EventSectionValueChanged';\nimport { LabelsBrowser } from './sections/LabelsBrowser/LabelsBrowser';\nimport { MetricsFilterSection } from './sections/MetricsFilterSection/MetricsFilterSection';\nimport { Settings } from './sections/Settings';\nimport { SideBarButton } from './SideBarButton';\n\ntype Section = MetricsFilterSection | LabelsBrowser | BookmarksList | Settings;\n\ninterface SideBarState extends SceneObjectState {\n  sections: Section[];\n  visibleSection: Section | null;\n  sectionValues: Map<string, string[]>;\n}\n\nexport const metricFiltersVariables = ['filters-rule', 'filters-prefix', 'filters-suffix'] as const;\ntype MetricFiltersVariable = (typeof metricFiltersVariables)[number];\n\nexport class SideBar extends SceneObjectBase<SideBarState> {\n  constructor(state: Partial<SideBarState>) {\n    const sectionValues = SideBar.getSectionValuesFromUrl();\n\n    super({\n      key: 'sidebar',\n      visibleSection: null,\n      sections: [\n        new MetricsFilterSection({\n          key: 'filters-rule',\n          type: 'categories',\n          title: 'Rules filters',\n          description: 'Filter metrics and recording rules',\n          icon: 'rules',\n          computeGroups: computeRulesGroups,\n          showHideEmpty: false,\n          showSearch: false,\n          active: Boolean(sectionValues.get('filters-rule')?.length),\n        }),\n        new MetricsFilterSection({\n          key: 'filters-prefix',\n          type: 'prefixes',\n          title: 'Prefix filters',\n          description: 'Filter metrics based on their name prefix (Prometheus namespace)',\n          icon: 'A_',\n          computeGroups: computeMetricPrefixGroups,\n          active: Boolean(sectionValues.get('filters-prefix')?.length),\n        }),\n        new MetricsFilterSection({\n          key: 'filters-suffix',\n          type: 'suffixes',\n          title: 'Suffix filters',\n          description: 'Filter metrics based on their name suffix',\n          icon: '_Z',\n          computeGroups: computeMetricSuffixGroups,\n          active: Boolean(sectionValues.get('filters-suffix')?.length),\n        }),\n        new LabelsBrowser({\n          key: 'groupby-labels',\n          variableName: VAR_WINGMAN_GROUP_BY,\n          title: 'Group by labels',\n          description: 'Group metrics by their label values',\n          icon: 'groups',\n          active: sectionValues.has('groupby-labels'),\n        }),\n        new BookmarksList({\n          key: 'bookmarks',\n          title: 'Bookmarks',\n          description: 'Access your saved metrics for quick reference',\n          icon: 'star',\n        }),\n        new Settings({\n          key: 'settings',\n          title: 'Settings',\n          description: 'Settings',\n          icon: 'cog',\n          disabled: true,\n        }),\n      ],\n      sectionValues,\n      ...state,\n    });\n\n    // FIXME: rule values are regexes, we do this only to disable adding the values to the button tooltip\n    // we need to provide the corresponding label instead\n    sectionValues.set('filters-rule', []);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const cleanupOtherMetricsVar = this.initOtherMetricsVar();\n\n    this._subs.add(\n      this.subscribeToEvent(EventSectionValueChanged, (event) => {\n        const { key, values } = event.payload;\n        const { sectionValues } = this.state;\n        const newSectionValues = new Map(sectionValues).set(key, values);\n        this.setOtherMetricFilters(newSectionValues);\n        this.setState({ sectionValues: newSectionValues });\n      })\n    );\n\n    return () => {\n      cleanupOtherMetricsVar();\n    };\n  }\n\n  private setOtherMetricFilters(sectionValues: Map<string, string[]>) {\n    const otherMetricFiltersVar = sceneGraph.lookupVariable(VAR_OTHER_METRIC_FILTERS, this);\n    if (!isAdHocFiltersVariable(otherMetricFiltersVar)) {\n      return;\n    }\n\n    const varToTextMap: Record<MetricFiltersVariable, string> = {\n      'filters-rule': 'rule group',\n      'filters-prefix': 'prefix',\n      'filters-suffix': 'suffix',\n    };\n\n    const newFilters = Array.from(sectionValues.entries()).reduce<Array<AdHocFilterWithLabels<{}>>>(\n      (acc, [key, value]) => {\n        if (value.length && metricFiltersVariables.includes(key as MetricFiltersVariable)) {\n          acc.push({\n            key,\n            operator: '=',\n            value: value.join(', '),\n            keyLabel: varToTextMap[key as MetricFiltersVariable],\n          });\n        }\n\n        return acc;\n      },\n      []\n    );\n\n    otherMetricFiltersVar.setState({\n      filters: newFilters,\n      hide: newFilters.length ? VariableHide.hideLabel : VariableHide.hideVariable,\n    });\n  }\n\n  /**\n   * Initialize the other metrics variable and set the filters from the current sidebar selections.\n   * This powers the read-only, \"other metric filters\" UI next to the label filters.\n   * The purpose of this is to provide users with at-a-glance feedback about the current sidebar\n   * selections, without needing to interact with the sidebar.\n   */\n  private initOtherMetricsVar() {\n    const currentVariableSet = getTrailFor(this).state.$variables;\n    if (!currentVariableSet) {\n      return () => {};\n    }\n\n    const otherMetricFiltersVar = new AdHocFiltersVariable({\n      name: VAR_OTHER_METRIC_FILTERS,\n      readOnly: true,\n      skipUrlSync: true,\n      datasource: null,\n      hide: VariableHide.hideVariable,\n      layout: 'combobox',\n      applyMode: 'manual',\n      allowCustomValue: true,\n    });\n\n    currentVariableSet.setState({\n      variables: [...currentVariableSet.state.variables, otherMetricFiltersVar],\n    });\n\n    this.setOtherMetricFilters(this.state.sectionValues);\n\n    return () => {\n      currentVariableSet.setState({\n        variables: [...currentVariableSet.state.variables.filter((v) => v !== otherMetricFiltersVar)],\n      });\n    };\n  }\n\n  private static getSectionValuesFromUrl() {\n    const urlSearchParams = new URLSearchParams(window.location.search);\n    const sectionValues = new Map();\n\n    for (const filterKey of metricFiltersVariables) {\n      const filterValueFromUrl = urlSearchParams.get(filterKey);\n      sectionValues.set(filterKey, filterValueFromUrl ? filterValueFromUrl.split(',').map((v) => v.trim()) : []);\n    }\n\n    const labelValue = urlSearchParams.get(`var-${VAR_WINGMAN_GROUP_BY}`);\n    const isLabelsBrowserActive = Boolean(labelValue && labelValue !== NULL_GROUP_BY_VALUE);\n    if (isLabelsBrowserActive) {\n      sectionValues.set('groupby-labels', [labelValue!]);\n    }\n\n    return sectionValues;\n  }\n\n  private setActiveSection(sectionKey: string) {\n    const { visibleSection, sections } = this.state;\n\n    if (!sectionKey || sectionKey === visibleSection?.state.key) {\n      // Report closing the sidebar\n      reportExploreMetrics('metrics_sidebar_toggled', {\n        action: 'closed',\n        section: visibleSection?.state.key,\n      });\n\n      this.setState({ visibleSection: null });\n      return;\n    }\n\n    // Report opening the sidebar with the selected section\n    reportExploreMetrics('metrics_sidebar_toggled', {\n      action: 'opened',\n      section: sectionKey,\n    });\n\n    if (sectionKey === 'filters-prefix') {\n      reportExploreMetrics('sidebar_prefix_filter_section_clicked', {});\n    } else if (sectionKey === 'filters-suffix') {\n      reportExploreMetrics('sidebar_suffix_filter_section_clicked', {});\n    }\n\n    this.setState({\n      visibleSection: sections.find((section) => section.state.key === sectionKey) ?? null,\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<SideBar>) => {\n    const styles = useStyles2(getStyles);\n    const { sections, visibleSection, sectionValues } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <div className={styles.buttonsBar} data-testid=\"sidebar-buttons\">\n          {sections.map((section) => {\n            const { key, title, icon: iconOrText, disabled, active } = section.state;\n            const visible = visibleSection?.state.key === key;\n            const tooltip = sectionValues.get(key)?.length ? `${title}: ${sectionValues.get(key)?.join(', ')}` : title;\n\n            return (\n              <div\n                key={key}\n                className={cx(styles.buttonContainer, visible && 'visible', active && 'active', disabled && 'disabled')}\n              >\n                <SideBarButton\n                  ariaLabel={title}\n                  disabled={disabled}\n                  visible={visible}\n                  active={active}\n                  tooltip={tooltip}\n                  onClick={() => model.setActiveSection(key)}\n                  iconOrText={iconOrText}\n                />\n              </div>\n            );\n          })}\n        </div>\n        {visibleSection && (\n          <div className={styles.content} data-testid=\"sidebar-content\">\n            <IconButton\n              className={styles.closeButton}\n              name=\"times\"\n              aria-label=\"Close\"\n              tooltip=\"Close\"\n              tooltipPlacement=\"top\"\n              onClick={() => model.setActiveSection('')}\n            />\n            {/* TODO: find a better way */}\n            {visibleSection instanceof MetricsFilterSection && <visibleSection.Component model={visibleSection} />}\n            {visibleSection instanceof LabelsBrowser && <visibleSection.Component model={visibleSection} />}\n            {visibleSection instanceof BookmarksList && <visibleSection.Component model={visibleSection} />}\n            {visibleSection instanceof Settings && <visibleSection.Component model={visibleSection} />}\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      position: 'relative',\n      display: 'flex',\n      flexDirection: 'row',\n      height: '100%',\n      overflow: 'hidden',\n    }),\n    buttonsBar: css({\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n      gap: 0,\n      width: '42px',\n      padding: 0,\n      margin: 0,\n      boxSizing: 'border-box',\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderRadius: theme.shape.radius.default,\n      backgroundColor: theme.colors.background.primary,\n      borderTopLeftRadius: 0,\n      borderBottomLeftRadius: 0,\n      position: 'relative',\n    }),\n    buttonContainer: css({\n      marginTop: theme.spacing(1),\n      '&::before': {\n        transition: '0.5s ease',\n        content: '\"\"',\n        position: 'absolute',\n        left: 0,\n        height: '32px',\n        borderLeft: `2px solid ${theme.colors.action.selectedBorder}`,\n        boxSizing: 'border-box',\n        opacity: 0,\n        visibility: 'hidden',\n      },\n      '&:hover::before': {\n        opacity: 1,\n        visibility: 'visible',\n      },\n      '&.visible::before': {\n        opacity: 1,\n        visibility: 'visible',\n      },\n      '&.disabled::before': {\n        opacity: 0,\n        visibility: 'hidden',\n      },\n      '&.active::after': {\n        content: '\"\"',\n        position: 'absolute',\n        right: 0,\n        width: '8px',\n        height: '8px',\n        backgroundColor: theme.colors.action.selectedBorder,\n        borderRadius: '50%',\n        margin: '2px 4px 0 0',\n      },\n    }),\n    content: css({\n      width: 'calc(300px - 42px)', // we want 300px in total\n      boxSizing: 'border-box',\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderLeft: 'none',\n      borderRadius: theme.shape.radius.default,\n      backgroundColor: theme.colors.background.canvas,\n      padding: theme.spacing(1.5),\n    }),\n    closeButton: css({\n      position: 'absolute',\n      top: theme.spacing(1.5),\n      right: theme.spacing(1),\n      margin: 0,\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport { useChromeHeaderHeight } from '@grafana/runtime';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  type CustomVariable,\n  type QueryVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from 'interactions';\nimport { getColorByIndex, getTrailFor } from 'utils';\n\nimport { MetricSelectedEvent } from '../shared';\nimport { MetricsGroupByList } from './GroupBy/MetricsGroupByList';\nimport { MetricsWithLabelValueDataSource } from './GroupBy/MetricsWithLabelValue/MetricsWithLabelValueDataSource';\nimport { registerRuntimeDataSources } from './helpers/registerRuntimeDataSources';\nimport { LabelsDataSource, NULL_GROUP_BY_VALUE } from './Labels/LabelsDataSource';\nimport { LabelsVariable, VAR_WINGMAN_GROUP_BY } from './Labels/LabelsVariable';\nimport { ListControls } from './ListControls/ListControls';\nimport { EventSortByChanged } from './ListControls/MetricsSorter/events/EventSortByChanged';\nimport {\n  addRecentMetric,\n  MetricsSorter,\n  VAR_WINGMAN_SORT_BY,\n  type SortingOption,\n} from './ListControls/MetricsSorter/MetricsSorter';\nimport { EventQuickSearchChanged } from './ListControls/QuickSearch/EventQuickSearchChanged';\nimport { QuickSearch } from './ListControls/QuickSearch/QuickSearch';\nimport { GRID_TEMPLATE_COLUMNS, MetricsList } from './MetricsList/MetricsList';\nimport { EventMetricsVariableActivated } from './MetricsVariables/EventMetricsVariableActivated';\nimport { EventMetricsVariableDeactivated } from './MetricsVariables/EventMetricsVariableDeactivated';\nimport { EventMetricsVariableLoaded } from './MetricsVariables/EventMetricsVariableLoaded';\nimport { FilteredMetricsVariable, VAR_FILTERED_METRICS_VARIABLE } from './MetricsVariables/FilteredMetricsVariable';\nimport { MetricsVariable } from './MetricsVariables/MetricsVariable';\nimport { MetricsVariableFilterEngine, type MetricFilters } from './MetricsVariables/MetricsVariableFilterEngine';\nimport { MetricsVariableSortEngine } from './MetricsVariables/MetricsVariableSortEngine';\nimport { ApplyAction } from './MetricVizPanel/actions/ApplyAction';\nimport { ConfigureAction } from './MetricVizPanel/actions/ConfigureAction';\nimport { EventApplyFunction } from './MetricVizPanel/actions/EventApplyFunction';\nimport { EventConfigureFunction } from './MetricVizPanel/actions/EventConfigureFunction';\nimport { METRICS_VIZ_PANEL_HEIGHT_SMALL, MetricVizPanel } from './MetricVizPanel/MetricVizPanel';\nimport { SceneDrawer } from './SceneDrawer';\nimport { EventFiltersChanged } from './SideBar/sections/MetricsFilterSection/EventFiltersChanged';\nimport { MetricsFilterSection } from './SideBar/sections/MetricsFilterSection/MetricsFilterSection';\nimport { SideBar } from './SideBar/SideBar';\n\ninterface MetricsReducerState extends SceneObjectState {\n  listControls: ListControls;\n  sidebar: SideBar;\n  body: SceneObjectBase;\n  drawer: SceneDrawer;\n  enginesMap: Map<string, { filterEngine: MetricsVariableFilterEngine; sortEngine: MetricsVariableSortEngine }>;\n}\n\nexport class MetricsReducer extends SceneObjectBase<MetricsReducerState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_WINGMAN_GROUP_BY],\n    onReferencedVariableValueChanged: (variable) => {\n      this.updateBasedOnGroupBy((variable as LabelsVariable).state.value as string);\n    },\n  });\n\n  public constructor() {\n    super({\n      $variables: new SceneVariableSet({\n        variables: [new MetricsVariable(), new FilteredMetricsVariable(), new LabelsVariable()],\n      }),\n      listControls: new ListControls({}),\n      sidebar: new SideBar({}),\n      body: new MetricsList({ variableName: VAR_FILTERED_METRICS_VARIABLE }) as unknown as SceneObjectBase,\n      drawer: new SceneDrawer({}),\n      enginesMap: new Map(),\n    });\n\n    registerRuntimeDataSources([new LabelsDataSource(), new MetricsWithLabelValueDataSource()]);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const groupByValue = (sceneGraph.lookupVariable(VAR_WINGMAN_GROUP_BY, this) as LabelsVariable).state\n      .value as string;\n\n    this.updateBasedOnGroupBy(groupByValue);\n\n    this.subscribeToEvents();\n  }\n\n  private updateBasedOnGroupBy(groupByValue: string) {\n    const hasGroupByValue = Boolean(groupByValue && groupByValue !== NULL_GROUP_BY_VALUE);\n\n    sceneGraph.findByKeyAndType(this, 'quick-search', QuickSearch).toggleCountsDisplay(!hasGroupByValue);\n\n    this.setState({\n      body: hasGroupByValue\n        ? (new MetricsGroupByList({ labelName: groupByValue }) as unknown as SceneObjectBase)\n        : (new MetricsList({ variableName: VAR_FILTERED_METRICS_VARIABLE }) as unknown as SceneObjectBase),\n    });\n  }\n\n  private subscribeToEvents() {\n    this.initVariablesFilteringAndSorting();\n\n    this._subs.add(\n      this.subscribeToEvent(EventConfigureFunction, (event) => {\n        this.openDrawer(event.payload.metricName);\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventApplyFunction, () => {\n        this.state.drawer.close();\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(MetricSelectedEvent, (event) => {\n        if (event.payload !== undefined) {\n          addRecentMetric(event.payload);\n        }\n      })\n    );\n  }\n\n  /**\n   * The centralized filtering and sorting mechanism implemented here is decoupled via the usage of events.\n   * In order to work, the variables to be filtered/sorted must emit lifecycle events.\n   * This is done via the `withLifecycleEvents` decorator function.\n   *\n   * For example, check the `FilteredMetricsVariable` class.\n   */\n  private initVariablesFilteringAndSorting() {\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableActivated, (event) => {\n        // register engines\n        const { key } = event.payload;\n        const filteredMetricsVariable = sceneGraph.findByKey(this, key) as QueryVariable;\n\n        this.state.enginesMap.set(key, {\n          filterEngine: new MetricsVariableFilterEngine(filteredMetricsVariable),\n          sortEngine: new MetricsVariableSortEngine(filteredMetricsVariable),\n        });\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableDeactivated, (event) => {\n        // unregister engines\n        this.state.enginesMap.delete(event.payload.key);\n      })\n    );\n\n    const quickSearch = sceneGraph.findByKeyAndType(this, 'quick-search', QuickSearch);\n    const filterSections = sceneGraph.findAllObjects(\n      this,\n      (o) => o instanceof MetricsFilterSection\n    ) as MetricsFilterSection[];\n    const metricsSorter = sceneGraph.findByKeyAndType(this, 'metrics-sorter', MetricsSorter);\n    const sortByVariable = metricsSorter.state.$variables.getByName(VAR_WINGMAN_SORT_BY) as CustomVariable;\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableLoaded, (event) => {\n        // filter and sort on initial load\n        const { key, options } = event.payload;\n        const { filterEngine, sortEngine } = this.state.enginesMap.get(key)!;\n\n        filterEngine.setInitOptions(options);\n\n        const filters: Partial<MetricFilters> = {\n          names: quickSearch.state.value ? [quickSearch.state.value] : [],\n        };\n\n        for (const filterSection of filterSections) {\n          filters[filterSection.state.type] = filterSection.state.selectedGroups.map((g) => g.value);\n        }\n\n        filterEngine.applyFilters(filters, { forceUpdate: true, notify: false });\n        sortEngine.sort(sortByVariable.state.value as SortingOption);\n      })\n    );\n\n    /* Filters */\n\n    this._subs.add(\n      this.subscribeToEvent(EventQuickSearchChanged, (event) => {\n        const { searchText } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of this.state.enginesMap) {\n          filterEngine.applyFilters({ names: searchText ? [searchText] : [] });\n          sortEngine.sort(sortByVariable.state.value as SortingOption);\n        }\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventFiltersChanged, (event) => {\n        const { type, filters } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of this.state.enginesMap) {\n          filterEngine.applyFilters({ [type]: filters });\n          sortEngine.sort(sortByVariable.state.value as SortingOption);\n        }\n      })\n    );\n\n    /* Sorting */\n\n    this._subs.add(\n      this.subscribeToEvent(EventSortByChanged, (event) => {\n        const { sortBy } = event.payload;\n        reportExploreMetrics('sorting_changed', { from: 'metrics-reducer', sortBy });\n\n        for (const [, { sortEngine }] of this.state.enginesMap) {\n          sortEngine.sort(sortBy);\n        }\n      })\n    );\n  }\n\n  private openDrawer(metricName: string) {\n    const trail = getTrailFor(this);\n    this.state.drawer.open({\n      title: 'Choose a new Prometheus function',\n      subTitle: metricName,\n      body: new SceneCSSGridLayout({\n        templateColumns: GRID_TEMPLATE_COLUMNS,\n        autoRows: METRICS_VIZ_PANEL_HEIGHT_SMALL,\n        isLazy: true,\n        $behaviors: [\n          new behaviors.CursorSync({\n            key: 'metricCrosshairSync',\n            sync: DashboardCursorSync.Crosshair,\n          }),\n        ],\n        children: ConfigureAction.PROMETHEUS_FN_OPTIONS.map((option, colorIndex) => {\n          return new SceneCSSGridItem({\n            body: new MetricVizPanel({\n              title: option.label,\n              metricName,\n              color: getColorByIndex(colorIndex),\n              prometheusFunction: option.value,\n              height: METRICS_VIZ_PANEL_HEIGHT_SMALL,\n              hideLegend: true,\n              highlight: colorIndex === 1,\n              isNativeHistogram: trail.isNativeHistogram(metricName),\n              headerActions: [\n                new ApplyAction({\n                  metricName,\n                  prometheusFunction: option.value,\n                  disabled: colorIndex === 1,\n                }),\n              ],\n            }),\n          });\n        }),\n      }),\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsReducer>) => {\n    const chromeHeaderHeight = useChromeHeaderHeight() ?? 0;\n    const styles = useStyles2(getStyles, chromeHeaderHeight);\n\n    const { $variables, body, listControls, drawer, sidebar } = model.useState();\n\n    return (\n      <>\n        <div className={styles.listControls} data-testid=\"list-controls\">\n          <listControls.Component model={listControls} />\n        </div>\n        <div className={styles.body}>\n          <div className={styles.sidebar} data-testid=\"sidebar\">\n            <sidebar.Component model={sidebar} />\n          </div>\n          <div className={styles.list}>\n            <body.Component model={body} />\n          </div>\n        </div>\n        <div className={styles.variables}>\n          {$variables?.state.variables.map((variable) => (\n            <variable.Component key={variable.state.name} model={variable} />\n          ))}\n        </div>\n        <drawer.Component model={drawer} />\n      </>\n    );\n  };\n}\n\n// the height of header between Grafana's chrome header and the metrics list container.\nconst APP_HEADER_HEIGHT = 144;\n\nfunction getStyles(theme: GrafanaTheme2, chromeHeaderHeight: number) {\n  return {\n    listControls: css({\n      marginBottom: theme.spacing(1.5),\n    }),\n    body: css({\n      display: 'flex',\n      flexDirection: 'row',\n      gap: theme.spacing(1),\n      height: `calc(100vh - ${chromeHeaderHeight + APP_HEADER_HEIGHT}px)`,\n    }),\n    list: css({\n      width: '100%',\n      overflowY: 'auto',\n    }),\n    sidebar: css({\n      flex: '0 0 auto',\n      overflowY: 'auto',\n    }),\n    variables: css({\n      display: 'none',\n    }),\n  };\n}\n","import { registerRuntimeDataSource, type RuntimeDataSource } from '@grafana/scenes';\n\nimport { displayError } from './displayStatus';\n\nexport function registerRuntimeDataSources(dataSources: RuntimeDataSource[]) {\n  try {\n    for (const dataSource of dataSources) {\n      registerRuntimeDataSource({ dataSource });\n    }\n  } catch (error) {\n    const { message } = error as Error;\n\n    if (!/A runtime data source with uid (.+) has already been registered/.test(message)) {\n      displayError(error as Error, [\n        'Fail to register all the runtime data sources!',\n        'The application cannot work as expected, please try reloading the page or if the problem persists, contact your organization admin.',\n      ]);\n    }\n  }\n}\n","import { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button } from '@grafana/ui';\nimport React from 'react';\n\nimport { MetricSelectedEvent } from 'shared';\n\ninterface SelectActionState extends SceneObjectState {\n  metricName: string;\n  variant: 'primary' | 'secondary';\n  fill: 'solid' | 'outline' | 'text';\n}\n\nexport class SelectAction extends SceneObjectBase<SelectActionState> {\n  constructor({\n    metricName,\n    variant,\n    fill,\n  }: {\n    metricName: SelectActionState['metricName'];\n    variant?: SelectActionState['variant'];\n    fill?: SelectActionState['fill'];\n  }) {\n    super({\n      key: `select-action-${metricName}`,\n      metricName,\n      variant: variant || 'primary',\n      fill: fill || 'outline',\n    });\n  }\n\n  public onClick = () => {\n    this.publishEvent(new MetricSelectedEvent(this.state.metricName), true);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<SelectAction>) => {\n    const { variant, fill } = model.useState();\n\n    return (\n      <Button\n        variant={variant}\n        fill={fill}\n        size=\"sm\"\n        onClick={model.onClick}\n        data-testid={`select-action-${model.state.metricName}`}\n      >\n        Select\n      </Button>\n    );\n  };\n}\n","import { type SceneDataQuery } from '@grafana/scenes';\nimport { promql } from 'tsqtsq';\n\nimport { QUERY_RESOLUTION } from 'GmdVizPanel/GmdVizPanel';\n\nimport { buildQueryExpression, expressionToString } from '../buildQueryExpression';\nimport { type TimeseriesPanelOptions } from './buildTimeseriesPanel';\nimport { isRateQuery as isRateQueryFn } from './isRateQuery';\n\ntype TimeseriesQueryRunnerParams = {\n  fnName: string;\n  isRateQuery: boolean;\n  maxDataPoints: number;\n  queries: SceneDataQuery[];\n};\n\ntype Options = Pick<TimeseriesPanelOptions, 'metric' | 'matchers' | 'groupBy' | 'queryResolution'> & {\n  addIgnoreUsageFilter: boolean;\n};\n\nexport function getTimeseriesQueryRunnerParams(options: Options): TimeseriesQueryRunnerParams {\n  const { metric, matchers, groupBy, queryResolution, addIgnoreUsageFilter } = options;\n\n  const expression = buildQueryExpression({ metric, matchers, addIgnoreUsageFilter });\n  let expr = expressionToString(expression);\n\n  let query;\n  let fnName;\n  const isRateQuery = isRateQueryFn(metric);\n\n  if (isRateQuery) {\n    expr = promql.rate({ expr, interval: '$__rate_interval' });\n    query = promql.sum({ expr, by: groupBy ? [groupBy] : undefined });\n    fnName = 'sum(rate)';\n  } else {\n    query = promql.avg({ expr, by: groupBy ? [groupBy] : undefined });\n    fnName = 'avg';\n  }\n\n  return {\n    fnName,\n    isRateQuery,\n    maxDataPoints: queryResolution === QUERY_RESOLUTION.HIGH ? 500 : 250,\n    queries: [\n      {\n        refId: groupBy ? `${metric}-by-${groupBy}` : metric,\n        expr: query,\n        legendFormat: groupBy ? `{{${groupBy}}}` : undefined,\n        fromExploreMetrics: true,\n      },\n    ],\n  };\n}\n","import { localeCompare } from 'WingmanDataTrail/helpers/localCompare';\n\nconst NONE_PREFIX = '<none>';\n\nexport function computeMetricPrefixGroups(options: Array<{ label: string; value: string }>) {\n  const rawPrefixesMap = new Map<string, string[]>();\n\n  for (const option of options) {\n    const parts = option.value.split(/[^a-z0-9]/i);\n    const key = parts.length <= 1 ? option.value : parts[0];\n    const values = rawPrefixesMap.get(key) ?? [];\n\n    values.push(option.value);\n    rawPrefixesMap.set(key || NONE_PREFIX, values);\n  }\n\n  const prefixesMap = new Map<string, number>();\n\n  for (const [prefix, values] of rawPrefixesMap) {\n    prefixesMap.set(prefix, values.length);\n  }\n\n  return Array.from(prefixesMap.entries())\n    .sort((a, b) => {\n      if (a[1] !== b[1]) {\n        return b[1] - a[1];\n      }\n\n      return localeCompare(a[0], b[0]);\n    })\n    .map(([value, count]) => ({\n      value,\n      count,\n      label: value,\n    }));\n}\n","import React, { lazy, useContext } from 'react';\nimport { Navigate, Route, Routes, useLocation } from 'react-router-dom';\n\nimport { ROUTES } from '../constants';\nimport { MetricsContext } from './useTrail';\n\nexport const Wingman = lazy(() => import('../pages/TrailWingman'));\n\n// For /trail links, redirect to /drilldown with the same search params\nconst TrailRedirect = () => {\n  const location = useLocation();\n  return <Navigate to={`${ROUTES.Drilldown}${location.search}`} replace />;\n};\n\nexport const AppRoutes = () => {\n  const { trail } = useContext(MetricsContext);\n\n  return (\n    <Routes>\n      <Route path={ROUTES.Drilldown} element={<Wingman trail={trail} />} />\n      <Route path={ROUTES.Trail} element={<TrailRedirect />} />\n      {/* catch-all route */}\n      <Route path=\"*\" element={<Navigate to={ROUTES.Drilldown} replace />} />\n    </Routes>\n  );\n};\n","import { CustomVariable, sceneGraph } from '@grafana/scenes';\n\nimport { MetricsVariable, VAR_METRICS_VARIABLE } from './MetricsVariable';\nimport { withLifecycleEvents } from './withLifecycleEvents';\n\nexport const VAR_FILTERED_METRICS_VARIABLE = 'filtered-metrics-wingman';\n\nexport class FilteredMetricsVariable extends CustomVariable {\n  constructor() {\n    super({\n      key: VAR_FILTERED_METRICS_VARIABLE,\n      name: VAR_FILTERED_METRICS_VARIABLE,\n      label: 'Filtered Metrics',\n      loading: false,\n      error: null,\n      options: [],\n      includeAll: true,\n      value: '$__all',\n      skipUrlSync: true,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n\n    // required for filtering and sorting\n    return withLifecycleEvents<FilteredMetricsVariable>(this);\n  }\n\n  private onActivate() {\n    const metricsVariable = sceneGraph.findByKeyAndType(this, VAR_METRICS_VARIABLE, MetricsVariable);\n    const { loading, error, options } = metricsVariable.state;\n\n    this.setState({ loading, error, options });\n\n    this._subs.add(\n      metricsVariable.subscribeToState((newState) => {\n        this.setState({\n          loading: newState.loading,\n          error: newState.error,\n          options: newState.options,\n        });\n      })\n    );\n  }\n}\n","import { sceneGraph, type MultiValueVariable } from '@grafana/scenes';\n\nimport { VAR_FILTERED_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport { areArraysEqual } from 'WingmanDataTrail/MetricsVariables/helpers/areArraysEqual';\nimport { VAR_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\n\nimport { CountsProvider } from './CountsProvider';\n\nexport class MetricVariableCountsProvider extends CountsProvider {\n  constructor() {\n    super({ key: 'MetricVariableCountsProvider' });\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const nonFilteredVariable = sceneGraph.lookupVariable(VAR_METRICS_VARIABLE, this) as MultiValueVariable;\n    const filteredVariable = sceneGraph.lookupVariable(VAR_FILTERED_METRICS_VARIABLE, this) as MultiValueVariable;\n\n    this.setInitCounts(nonFilteredVariable, filteredVariable);\n\n    this._subs.add(\n      nonFilteredVariable.subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.options, prevState.options)) {\n          this.setState({\n            counts: {\n              current: filteredVariable.state.options.length,\n              total: newState.options.length,\n            },\n          });\n        }\n      })\n    );\n\n    this._subs.add(\n      filteredVariable.subscribeToState((newState, prevState) => {\n        if (!newState.loading && !prevState.loading && !areArraysEqual(newState.options, prevState.options)) {\n          this.setState({\n            counts: {\n              current: newState.options.length,\n              total: nonFilteredVariable.state.options.length,\n            },\n          });\n        }\n      })\n    );\n  }\n\n  private setInitCounts(nonFilteredVariable: MultiValueVariable, filteredVariable: MultiValueVariable) {\n    const initCounts = { current: 0, total: 0 };\n\n    // We make sure the count of metrics is not 0 in a scenario where the user goes from the MetricsReducer to the MetricScene and back.\n    // Indeed, sometimes, the variables already have their options and do not load new ones.\n    if (!nonFilteredVariable.state.loading && nonFilteredVariable.state.options.length) {\n      initCounts.total = nonFilteredVariable.state.options.length;\n    }\n\n    if (!filteredVariable.state.loading && filteredVariable.state.options.length) {\n      initCounts.current = filteredVariable.state.options.length;\n    }\n\n    this.setState({ counts: initCounts });\n  }\n}\n"],"names":["EventFiltersChanged","BusEventWithPayload","type","isAdHocFiltersVariable","variable","state","isCustomVariable","isQueryVariable","PREF_KEYS","DATASOURCE","BOOKMARKS","RECENT_METRICS","BREAKDOWN_SORTBY","getLabelValueFromDataFrame","frame","labels","fields","keys","Object","length","sortAlphabetical","series","direction","compareFn","a","b","localeCompare","sort","labelA","labelB","sortByFieldReducer","sortBy","fieldReducer","fieldReducers","get","seriesCalcs","map","dataFrame","field","value","reduce","doStandardCalcs","getOutliers","joined","outerJoinDataFrames","frames","Error","points","filter","f","FieldType","number","Float64Array","values","OutlierDetector","dbscan","sensitivity","detect","calculateOutlierValue","outliers","index","seriesResults","isOutlier","outlierIntervals","sortSeries","memoize","origSeries","wasmSupported","sortByOutliers","e","msg","toString","displayWarning","ReducerID","stdDev","firstTimestamp","seriesIsNotEmpty","lastTimestamp","support","WebAssembly","reportExploreMetrics","EventMetricsVariableActivated","SectionTitle","title","description","styles","useStyles2","getStyles","h6","className","span","Tooltip","content","placement","Icon","name","size","infoIcon","theme","css","fontSize","fontWeight","typography","fontWeightLight","borderBottom","colors","border","weak","paddingBottom","spacing","marginLeft","cursor","color","text","secondary","position","top","areArraysEqual","array1","array2","isEqual","withLifecycleEvents","key","TypeError","addActivationHandler","publishEvent","loading","options","EventMetricsVariableLoaded","subscribeToState","newState","prevState","EventMetricsVariableDeactivated","ensureErrorObject","error","defaultMessage","message","useCatchExceptions","setError","useState","useEffect","onError","errorEvent","filename","URL","protocol","endsWith","logger","lineno","colno","shouldTreatAsApplicationError","onUnHandledRejection","event","reason","undefined","window","addEventListener","removeEventListener","EventQuickSearchChanged","MetricsDrilldownDataSourceVariable","DataSourceVariable","onActivate","this","setState","skipUrlSync","userPreferences","setItem","getCurrentDataSource","prometheusDataSources","config","datasources","ds","isPrometheusDataSource","uidFromUrl","location","href","searchParams","VAR_DATASOURCE","uidFromLocalStorage","getItem","currentDataSource","find","uid","isDefault","warn","constructor","initialDS","super","pluginId","label","bind","PluginLogo","memo","img","cx","logo","src","pluginCommitSha","GIT_COMMIT","pluginCommitURL","buildInfo","grafanaBuildInfo","InfoMenuHeader","meta","info","version","updated","usePluginContext","div","menuHeader","h5","subTitle","InfoMenu","isDev","shortCommitSha","slice","Menu","header","Item","icon","onClick","open","disabled","Divider","edition","env","commit","PluginInfo","Dropdown","overlay","Button","variant","tooltip","tooltipPlacement","data-testid","button","primary","background","medium","canvas","bodySmall","DataTrailSettings","SceneObjectBase","stickyMainGraph","isOpen","onToggleStickyMainGraph","onToggleOpen","popover","display","padding","flexDirection","boxShadow","shadows","z3","borderRadius","shape","radius","default","zIndex","marginRight","heading","fontWeightMedium","gridTemplateColumns","rowGap","columnGap","Component","model","trail","getTrailFor","topScene","MetricScene","evt","stopPropagation","Switch","onChange","onVisibleChange","ToolbarButton","DataTrail","_onActivate","trailActivated","getTopSceneFor","metric","subscribeToEvent","MetricSelectedEvent","_handleMetricSelectedEvent","filtersVariable","sceneGraph","lookupVariable","VAR_FILTERS","_subs","add","_addingFilterWithoutReportingInteraction","reportChangeInLabelFilters","filters","useQueriesAsFilterForOptions","Boolean","saveRecentTrail","hasFilters","getTrailStore","setRecentTrail","embedded","getMetricMetadata","datasourceHelper","getMetadataForMetric","isNativeHistogram","initializeHistograms","histogramsLoadP","histogramsLoaded","nativeHistograms","listNativeHistograms","resetNativeHistograms","getCurrentMetricMetadata","payload","nativeHistogramMetric","_urlSync","performBrowserHistoryAction","getSceneUpdatesForNewMetricValue","filterVar","baseFilters","getBaseFiltersForMetric","stateUpdate","getUrlState","metricSearch","updateFromUrl","assign","MetricsReducer","getQueries","findAllObjects","isSceneQueryRunner","acc","sqr","push","queries","q","expr","interpolate","$timeRange","SceneTimeRange","$variables","getVariableSet","initialFilters","controls","VariableValueSelectors","layout","SceneControlsSpacer","SceneTimePicker","SceneRefreshPicker","settings","pluginInfo","SceneReactObject","component","createdAt","Date","getTime","dashboardMetrics","alertingMetrics","SceneObjectUrlSyncConfig","_variableDependency","VariableDependencyConfig","variableNames","onReferencedVariableValueChanged","reset","MetricDatasourceHelper","nativeHistogram","variables","AdHocFiltersVariable","addFilterButtonText","datasource","trailDS","hide","VariableHide","dontHide","applyMode","allowCustomValue","expressionBuilder","utf8Support","operator","replaceAll","join","featureToggles","scopeFilters","enableScopesInMetricsExplore","startsWith","unshift","ScopesVariable","enable","SceneVariableSet","headerHeight","getAppBackgroundColor","container","flexGrow","gap","body","minHeight","alignItems","flexWrap","navbarFixed","settingsInfo","updateAppControlsHeight","appControls","document","querySelector","height","getBoundingClientRect","documentElement","style","setProperty","useChromeHeaderHeight","chromeHeaderHeight","limitAdhocProviders","resizeObserver","ResizeObserver","observe","disconnect","removeProperty","control","UrlSyncContextProvider","scene","createBrowserHistorySteps","updateUrlOnInit","namespace","urlNamespace","ShowMoreButton","batchSizes","fill","increment","current","total","expressionToString","expression","buildQueryExpression","matchers","addIgnoreUsageFilter","defaultSelectors","m","MatchingOperator","equal","isValidLegacyName","VAR_FILTERS_EXPR","Expression","defaultOperator","HOME_ROUTE","VAR_METRIC","VAR_METRIC_EXPR","VAR_GROUP_BY","VAR_GROUP_BY_EXP","VAR_DATASOURCE_EXPR","VAR_LOGS_DATASOURCE","VAR_LOGS_DATASOURCE_EXPR","VAR_OTHER_METRIC_FILTERS","LOGS_METRIC","MDP_METRIC_PREVIEW","getVariablesWithMetricConstant","ConstantVariable","hideVariable","RefreshMetricsEvent","BusEventBase","RECENT_TRAILS_KEY","TrailStore","_loadRecentTrailsFromStorage","list","serializedTrails","t","_deserializeTrail","getRef","_loadBookmarksFromStorage","item","serialized","step","currentStep","history","urlValues","now","urlSerializedTrail","forEach","_loadFromUrl","sceneUtils","cloneSceneObjectState","_serializeTrail","getTrailForBookmarkIndex","bookmark","_bookmarks","getTrailForBookmark","newMetricsTrail","getBookmarkKey","recent","_recent","resolve","node","urlState","urlUtil","renderUrl","syncStateFromSearchParams","URLSearchParams","lastModified","_lastModified","load","_refreshBookmarkIndexMap","recentTrail","recentUrlState","getUrlStateForComparison","_save","bookmarks","addBookmark","bookmarkState","appEvents","getAppEvents","isSidebarView","currentPathIncludes","ROUTES","Drilldown","infoText","i","publish","AppEvents","alertSuccess","Stack","LinkButton","createBookmarkSavedNotification","removeBookmark","splice","getBookmarkIndex","bookmarkKey","_bookmarkIndexMap","clear","bookmarked","set","Map","doSave","serializedRecent","debounce","correctUrlStateForComparison","actionView","refresh","JSON","stringify","store","GroupByVariable","QueryVariable","String","filterExpression","changeValueTo","includeAll","defaultToAll","query","select","UI_TEXT","OPEN_EXPLORE_LABEL","COPY_URL_LABEL","BOOKMARK_LABEL","SELECT_NEW_METRIC_TOOLTIP","GmdVizPanelVariantSelector","getOptions","panelType","PANEL_TYPE","HEATMAP","PERCENTILES","includes","currentPanelType","newPanelType","EventPanelTypeChanged","RadioButtonGroup","extensionPointId","pluginJson","AddToExplorationButton","getPanelConfigAndDataFrames","data","panel","findObjectOfType","o","VizPanel","getData","fieldConfig","getContext","datasourceUid","dsUid","queryRunner","findObject","getFilter","legendFormat","updateFieldConfigOverrides","properties","id","existingOverride","overrides","matcher","displayNameFromDS","displayName","labelName","fieldName","timeRange","getTimeRange","ctx","origin","url","logoPath","MimirLogo","drillDownLabel","context","links","usePluginLinks","limitPerPlugin","link","IconButton","aria-label","filterNameAndValueObj","ADD_TO_INVESTIGATION_MENU_TEXT","ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT","ADD_TO_INVESTIGATION_MENU_GROUP_TEXT","PanelMenu","addItem","setItems","items","addExplorationsLink","exploreUrl","viz","getAncestor","panelData","getQueryRunnerFor","getExploreURL","replace","iconClassName","then","shortcut","VizPanelMenu","addToExplorationsButton","menu","addToExplorationButton","explorationsButton","getInvestigationLink","existingMenuItems","existingAddToExplorationLink","activate","addToExplorations","getPluginLinkExtensions","extensions","getObservablePluginLinks","firstValueFrom","MAIN_PANEL_MIN_HEIGHT","GmdVizPanel","getPanelHeightInPixels","PANEL_HEIGHT","XL","TOPVIEW_KEY","MetricGraphScene","topView","metadata","getMetricDescription","children","SceneFlexItem","maxHeight","headerActions","queryResolution","QUERY_RESOLUTION","HIGH","ySizing","MetricActionBar","SceneFlexLayout","$behaviors","behaviors","sync","DashboardCursorSync","Crosshair","reactNode","selectedTab","sticky","paddingTop","marginTop","nonSticky","getTrailSettings","METRIC_PREFIX_ALL_OPTION","PrefixFilterDropdown","metricPrefix","parseMetricPrefixes","hasDependencyInLoadingState","filteredMetricsVariable","VAR_METRICS_VARIABLE","prefixGroups","computeMetricPrefixGroups","getMultiVariableValues","newOptions","g","count","newValue","selectOption","onVariableUpdateCompleted","option","tooltipIcon","InlineField","InlineLabel","width","Combobox","RelatedListControls","EmbeddedScene","QuickSearch","urlSearchParamName","targetName","countsProvider","MetricVariableCountsProvider","displayCounts","LayoutSwitcher","headerWrapper","RelatedMetricsScene","subscribeToEvents","initVariablesFilteringAndSorting","enginesMap","findByKey","filterEngine","MetricsVariableFilterEngine","sortEngine","MetricsVariableSortEngine","delete","quickSearch","findByKeyAndType","setInitOptions","names","applyFilters","forceUpdate","notify","searchText","MetricsVariable","FilteredMetricsVariable","MetricsList","variableName","VAR_FILTERED_METRICS_VARIABLE","listControls","margin","COPY_LABEL","ShareTrailButton","setTooltip","navigator","clipboard","action","appUrl","PLUGIN_BASE_URL","getUrlForTrail","writeText","setTimeout","EventTimeseriesDataReceived","EventForceSyncYAxis","EventResetSyncYAxis","syncYAxis","vizPanelsParent","max","Number","NEGATIVE_INFINITY","min","POSITIVE_INFINITY","timeRangeSub","resetSub","forceSub","newMax","newMin","nonSyncedPanels","findTimeseriesPanels","$data","defaults","findNewMaxMin","updateTimeseriesAxis","dataReceivedSub","unsubscribe","s","Math","panels","clearFieldConfigCache","merge","cloneDeep","DEFAULT_UNIT","UNIT_BYTES","UNIT_SECONDS","UNIT_PERCENT","UNIT_COUNT","UNIT_MAP","UNIT_LIST","RATE_UNIT_MAP","getUnitFromMetric","metricParts","toLowerCase","split","part","SelectLabelAction","groupByVariable","publishTimeseriesData","vizPanel","LoadingState","Done","addRefId","source","pipe","d","refId","SERIES_COUNT_STATS_NAME","sliceSeries","start","end","stats","LABELS_VIZ_PANEL_HEIGHT","M","LabelVizPanel","buildVizPanel","unit","SceneDataTransformer","SceneQueryRunner","maxDataPoints","fromExploreMetrics","transformations","addUnspecifiedLabel","PanelBuilders","timeseries","setTitle","setUnit","setData","setBehaviors","setOption","mode","TooltipDisplayMode","Multi","SortOrder","Descending","setHeaderActions","setMenu","setShowMenuAlways","build","every","getAllValuesConfig","seriesCountStats","seriesCount","getOverrides","startColorIndex","FieldMatcherID","byFrameRefID","fixedColor","getColorByIndex","MetricLabelsList","subscribeToLayoutChange","layoutSwitcher","onChangeState","templateColumns","LayoutType","ROWS","GRID_TEMPLATE_ROWS","GRID_TEMPLATE_COLUMNS","search","Controls","Field","isRateQuery","metricName","metricPart","getPerSecondRateUnit","getUnit","SceneByVariableRepeater","initialPageSize","pageSizeIncrement","SceneCSSGridLayout","isLazy","autoRows","getLayoutLoading","Spinner","inline","getLayoutEmpty","InlineBanner","severity","getLayoutError","getLayoutChild","getTimeseriesQueryRunnerParams","groupBy","MEDIUM","SceneCSSGridItem","footer","justifyContent","useSizes","shouldDisplayShowMoreButton","increaseBatchSize","AddToFiltersGraphAction","labelValue","cause","addFilterWithoutReportingInteraction","SortBySelector","target","DEFAULT_OPTIONS","sortByTooltip","htmlFor","placeholder","isClearable","SceneByFrameRepeater","performRepeat","Loading","loadingLayout","errorLayout","emptyLayout","currentBatchSize","filteredSeries","filterAndSort","counts","newChildren","initFilterAndSort","regexes","p","trim","r","RegExp","some","regex","test","newBatchSize","remaining","getCounts","dataProvider","LabelValuesCountsProvider","CountsProvider","LABEL_VALUE_VIZ_PANEL_HEIGHT","LabelValueVizPanel","setColor","setCustomFieldConfig","showLegend","MetricLabelValuesList","subscribeToQuickSearchChange","byFrameRepeater","findDescendents","subscribeToSortByChange","sortBySelector","updateBody","SINGLE","buildSinglePanel","existingByFrameRepeater","buildByFrameRepeater","TIMESERIES","queryParams","errors","frameIndex","SceneDataNode","quickSearchField","GRID","singlePanelContainer","listContainer","listFooter","SingleMetricPanelComponent","ByFrameRepeaterComponent","LabelBreakdownScene","getVariable","oldState","hasAllValue","searchField","actionViews","actionViewsDefinitions","getScene","metricScene","createRelatedLogsScene","getLinkToExplore","openExploreLink","actions","breakpoints","up","md","right","customTabsBar","isBookmarked","toggleBookmark","indexOnRender","bookmarkIndex","setBookmarkIndex","sub","SceneObjectStateChangedEvent","indexToRemove","useBookmarkState","Box","paddingY","createAppUrl","TabsBar","tab","counter","relatedLogsCount","isActive","tabRender","Tab","active","onChangeTab","view","related_logs_count","relatedLogsOrchestrator","checkConditionsMetForRelatedLogs","setActionView","BASE_QUERY_TEMPLATE","RATE_BASE_QUERY_TEMPLATE","BASE_QUERY_UTF8_METRIC_TEMPLATE","RATE_BASE_QUERY_UTF8_METRIC_TEMPLATE","generateBaseQuery","groupings","isUtf8Metric","baseQuery","simpleGraphBuilder","generateCommonAutoQueryInfo","mainQueryExpr","breakdownQueryExpr","common","mainQuery","main","vizBuilder","preview","breakdown","variants","RATE_SUFFIXES","Set","SPECIFIC_AGGREGATIONS_FOR_SUFFIX","aggLabels","avg","sum","createDefaultMetricQueryDefs","suffix","unitSuffix","at","has","aggregation","aggregationDescription","agg","createHistogramMetricQueryDefs","p50","percentileQuery","percentiles","percentilesGraphBuilder","heatmap","format","HeatmapColorMode","Scheme","exponent","scheme","steps","reverse","heatmapGraphBuilder","percentile","percent","createMeanExpr","subMetric","getAutoQueriesForMetric","createSummaryMetricQueryDefs","knownLabelNameDiscrepancies","job","instance","replaceKnownLabelNames","createLabelsCrossReferenceConnector","conditionsMetForRelatedLogs","getDataSources","lokiDataSources","getDataSourceFetcher","getHealthyDataSources","results","Promise","all","hasLabels","getDataSourceSrv","labelKeys","getTagKeys","Array","isArray","availableLabels","lokiLabelName","getTagValues","v","hasMatchingLabels","getLokiQueryExpr","getLokiQueryForRelatedMetric","dataSourceUid","extractedRecordingRules","targetRule","rule","hasMetricExpr","tree","parser","parse","iterate","enter","MetricExpr","isLogsQuery","selectorNode","getNodeFromQuery","Selector","selector","substring","from","to","pipelineExprNode","PipelineExpr","pipelineExpr","getLogQueryFromMetricsQuery","fetchAndExtractLokiRecordingRules","dataSource","extractedRules","ruleGroups","rg","rules","existingRule","hasMultipleOccurrences","extractRecordingRulesFromRuleGroups","datasourceSettings","recordingRules","showErrorAlert","showSuccessAlert","res","lastValueFrom","getBackendSrv","fetch","ok","groups","err","createLokiRecordingRulesConnector","lokiRecordingRules","selectedMetric","foundLokiDataSources","recRules","rr","getDataSourcesWithRecordingRulesContainingMetric","nodeType","foundNode","RelatedLogsOrchestrator","_internalState","dataSources","currentDataSourcesSignature","newDataSourcesSignature","_changeHandlers","handler","addLokiDataSourcesChangeHandler","addRelatedLogsCountChangeHandler","findAndCheckAllDatasources","allLokiDatasources","_dataSourceFetcher","checkLogsInDataSources","maxLines","_metricScene","queriesByConnector","_logsConnectors","connector","idx","lokiExpr","connectorName","supportingQueryType","datasourcesWithLogs","totalLogsCount","totalChecked","getLokiQueries","rowCount","countLogsLines","NoRelatedLogs","Alert","Text","ul","li","TextLink","external","paddingLeft","OpenInLogsDrilldownButton","memoizedContext","useMemo","isLoading","logsDrilldownLink","logsDrilldownLinkExists","appSubUrl","path","LOGS_PANEL_CONTAINER_KEY","RelatedLogsScene","orchestrator","setupLogsPanel","showNoLogsFound","_buildQueryRunner","_queryRunner","_constructLogsDrilldownLinkContext","logs","logsDataSourceVariable","CustomVariable","updateLokiQuery","getValue","targets","logsDrilldownLinkContext","selectedDatasourceVar","selectedDatasourceUid","props","handleFiltersChange","grow","actionViewDef","actionViewType","autoQuery","queryDef","MetricsContext","createContext","goToUrlForTrail","useTrail","setTrail","locationService","navigationEvents","subscribe","ErrorView","navigate","useNavigate","pathname","useLocation","onClickReload","useCallback","newSearchParams","reload","isCollapseOpen","setIsCollapseOpen","errorContext","handheldBy","Collapse","callStack","collapsible","onToggle","pre","code","stack","backgroundColor","outline","nonRateQueryFunctions","getPromqlFunction","nonRateQueryFunction","buildPrometheusQuery","ignoreUsage","filterExtremeValues","metricPartString","promql","and","left","rate","interval","by","mappings","MappingType","ValueToText","extremeValueFilterBehavior","queryRunnerSub","valuesField","entities","NaN","isDataFrameAllNaN","isAllDataNaN","extremeValueRemoval","success","issue","queryParsing","queryExpression","functionName","child","firstChild","nextSibling","parent","labelData","processLabelMatcher","op","grouping","extractGroupings","queryParts","parseQueryForRebuild","filteredQuery","newQueryRunner","clone","titleItems","VizPanelExtremeValuesMessage","level","runQueries","removeExtremeValues","extremeValuedisclaimer","warningMessage","aria-hidden","warning","METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW","METRICS_VIZ_PANEL_HEIGHT","METRICS_VIZ_PANEL_HEIGHT_SMALL","rateQueryMetricSuffixes","MetricVizPanel","prometheusFunction","highlight","hideLegend","panelTitle","isHistogram","statushistory","setMappings","VisibilityMode","Never","setDisplayName","buildStatusHistoryPanel","buildQueryRunner","show","buildHeatmapPanel","queryOptions","buildTimeseriesPanel","parseMatcher","determineQueryProperties","MAX_DATA_POINTS","stateWithDefaults","SelectAction","nativeHistogramStyles","pill","transparent","INTERACTION_NAME_PREFIX","reportInteraction","appRelease","apps","PLUGIN_ID","appVersion","reportLabelFilterChange","newFilters","oldFilters","oldFilter","newFilter","detectChangedFilters","detectRemovedFilters","detectAddedFilters","useCounts","displayError","msgs","alertError","alertWarning","MultiValueVariable","UsageData","usageType","usageCount","singularUsageType","pluralUsageType","dashboardItems","usageContainer","maxWidth","overflowY","menuItem","menuItemContent","usageItem","clickableUsageItem","borderTopWidth","opacity","textDecoration","overflow","textOverflow","whiteSpace","WithUsageDataPreviewPanel","metricsReducer","metricsSorter","MetricsSorter","sortByVar","getVariables","getByName","VAR_WINGMAN_SORT_BY","updateSortBy","updateLayout","usage","getUsageDetailsForMetric","dashboards","entries","dashboardInfo","gridLayout","currentGridLayoutHeight","expectedPanelHeight","vizPanelInGridItem","log","getClosestScopesFacade","ScopesFacade","getSelectedScopes","selectedScopes","getSelectedScopesNames","scope","setSelectedScopes","scopes","notifySubscribers","onScopesChange","callback","onScopesChangeCallbacks","cb","params","getMetricName","visTheme","theme2","visualization","getColorByName","palette","MAX_ADHOC_VARIABLE_OPTIONS","dataTrail","limitedFilterVariable","getTagKeysProvider","opts","getTagValuesProvider","_","check","returnType","obj","Intl","Collator","compare","initOptions","getFilteredOptions","filteredOptions","categories","applyCategoryFilters","prefixes","applyPrefixFilters","suffixes","applySuffixFilters","applyNameFilters","updatedFilters","notifyUpdate","category","categoryRegex","buildRegex","concat","pattern","prefix","prefixesRegex","suffixesRegex","namePatterns","flags","SceneVariableValueChangedEvent","usageRequestOptions","fetchAlertingMetrics","result","transformCountsToAlertingUsage","alertingRules","metricCounts","relevantRules","prometheusQueries","metrics","extractMetricNames","parseAlertingRules","dashboardRequestMap","getDashboardLimited","limitFunction","dashboardUid","dashboardRequestsFailedCount","promise","dashboard","catch","finally","concurrency","fetchDashboardMetrics","limit","parseDashboardSearchResponse","updateMetricUsage","dashboardName","dashboardUrl","dashboardData","dashboardSearchResponse","relevantDashboards","relevantPanels","MetricUsageFetcher","getUsageMetrics","_usageState","metricsPromise","fetcher","getUsageForMetric","MAX_RECENT_METRICS","RECENT_METRICS_EXPIRY_DAYS","addRecentMetric","recentMetrics","getRecentMetrics","filteredMetrics","timestamp","updatedMetrics","errorObject","thirtyDaysAgo","validMetrics","sortByOptions","activationHandler","supportedSortByOptions","EventSortByChanged","usageFetcher","metricsToCounts","inputControls","initialized","sortMetricsByCount","scoreA","scoreB","sortMetricsWithRecentFirst","allRecentMetrics","allRecentMetricsSet","nonRecent","sortedNonRecent","sortMetricsAlphabetically","languageProviderVersionIs","languageProvider","fetchLabelValues","queryLabelKeys","_datasource","_metricsMetadata","_classicHistograms","_nativeHistograms","getDatasource","__sceneObject","_trail","_ensureMetricsMetadata","_getMetricsMetadata","queryMetadata","queryMetricsMetadata","metricsMetadata","getQueryMetricsMetadata","loadMetadata","retrieveMetricsMetadata","loadMetricsMetadata","getLoadMetricsMetadata","classicHistogramsCall","metricFindQuery","allMetricsCall","classicHistograms","allMetrics","addNativeHistogram","notClassic","pop","isWrappedInQuotes","unwrapQuotes","fetchLabels","fetchLabelsWithMatch","queryLabelValues","fetchSeriesValuesWithMatch","getPrometheusDataSourceForScene","sceneObject","dsVariable","help","truncateValue","maxLength","DataTrailCard","onSelect","onDelete","cardHeightClassName","compactHeight","cardTall","cardClassName","card","wide","cardWide","article","Card","Heading","metricValue","Meta","secondaryFont","primaryFont","deleteButton","SecondaryActions","date","dateTimeFormat","wordBreak","marginBottom","borderTop","borderRight","borderLeft","gridArea","letterSpacing","lineHeight","bottom","listeners","emit","listener","BookmarksList","bookmarksList","paddingRight","emptyState","fontStyle","setLastDelete","VariableRefresh","onTimeRangeChanged","VariableSort","alphabeticalAsc","colorIndex","migrate","hasMigrations","migrations","legacyKey","newKey","existingItem","localStorage","removeItem","buildStorageKey","service","storageKey","metricToTargetLevenDistances","getLevenDistances","targetMetric","targetToDistances","distances","metricSplit","metricHalf","halfLeven","leven","wholeLeven","lastMetrics","sortedMetrics","sortByUsage","metricList","aValue","bValue","usageMetrics","fnName","getHeatmapQueryRunnerParams","setDescription","buildPercentilesPanel","getPercentilesQueryRunnerParams","buildStatushistoryPanel","getStatushistoryQueryRunnerParams","STATUSHISTORY","buildGroupByPanel","DEFAULT_HEADER_ACTIONS_BUILDER","subscribeToStateChanges","getDefaultPanelType","newIsNativeHistogram","isUpDownMetric","isHistogramMetric","h","changePanelType","heightInPixels","bannerTitle","br","isLight","toggleCountsDisplay","updateValue","notifyValueChange","useHumanFriendlyCountsMessage","tagName","tooltipContent","currentTarget","onKeyDown","preventDefault","Input","Tag","input","DEFAULT_RATE_UNIT","PROMETHEUS_DATA_SOURCE_REGEX","DataSourceFetcher","cachedDataSources","cache","pendingRequest","pendingRequests","fetchHealthyDataSources","allDataSourcesOfType","getList","healthyDataSources","unhealthyDataSources","health","status","dataSourceFetcherSingleton","RATE_QUERY_SUFFIXES","newLayout","DEFAULT_LAYOUT","fullWidth","NULL_GROUP_BY_VALUE","LabelsDataSource","RuntimeDataSource","other","scopedVars","valueOf","match","labelOptions","getLabelsMatchAPISupport","getFiltersFromVariable","response","processLabelOptions","hasLabelsMatchAPISupport","testDatasource","VAR_LABEL_VALUES","LabelValuesVariable","isMulti","VAR_WINGMAN_GROUP_BY","LabelsVariable","refreshOptions","updateQuery","Label","GroupsIcon","svg","stroke","viewBox","circle","cy","strokeWidth","MetricsWithLabelValueDataSource","metricsList","removeRules","isPrometheusRule","VAR_METRIC_WITH_LABEL_VALUE","MetricsWithLabelValueVariable","adHocFiltersVariable","buildQuery","MetricsGroupByRow","labelCardinality","containerHeader","headerButtons","selectButton","collapsableSectionBody","groupName","isCollapsed","setIsCollapsed","CollapsableSection","MetricsGroupByList","ListControls","EventApplyFunction","ApplyAction","EventConfigureFunction","ConfigureAction","PROMETHEUS_FN_OPTIONS","SceneDrawer","close","Drawer","subtitle","closeOnMaskClick","onClose","ruleGroupLabels","EventSectionValueChanged","CheckboxWithCount","checked","checkboxWrapper","Checkbox","CheckBoxList","selectedGroups","onSelectionChange","checkboxListHeader","noResults","checkboxList","group","checkboxItem","newGroups","shade","MetricsFilterSection","metricsVariable","updateLists","updateCounts","computeGroups","originalOptions","filtersWithoutCurrentType","getFilters","optionsForCounting","newGroupsWithCount","showHideEmpty","showSearch","filter_count","filterType","filter_type","switchContainer","switchLabel","searchInput","flexBasis","flexShrink","hideEmpty","setHideEmpty","searchValue","setSearchValue","filteredGroups","computeMetricSuffixGroups","rawSuffixesMap","parts","suffixesMap","isRecordingRule","computeRulesGroups","rulesMap","LabelsList","selectedLabel","onClickLabel","onClickClearSelection","listHeader","selected","RadioButtonList","flex","LabelsBrowser","labelsVariable","selectLabel","useLabelsBrowser","labelsList","onInputChange","onInputKeyDown","onInputClear","Settings","CustomIcons","rect","x","y","rx","SideBarButton","ariaLabel","visible","iconOrText","buttonIcon","ButtonChild","availableIconsIndex","maxContrast","metricFiltersVariables","SideBar","cleanupOtherMetricsVar","initOtherMetricsVar","sectionValues","newSectionValues","setOtherMetricFilters","otherMetricFiltersVar","varToTextMap","keyLabel","hideLabel","currentVariableSet","readOnly","getSectionValuesFromUrl","urlSearchParams","filterKey","filterValueFromUrl","setActiveSection","sectionKey","visibleSection","sections","section","buttonsBar","boxSizing","borderTopLeftRadius","borderBottomLeftRadius","buttonContainer","transition","selectedBorder","visibility","closeButton","groupByValue","updateBasedOnGroupBy","hasGroupByValue","openDrawer","drawer","filterSections","sortByVariable","filterSection","sidebar","registerRuntimeDataSource","registerRuntimeDataSources","APP_HEADER_HEIGHT","isRateQueryFn","NONE_PREFIX","rawPrefixesMap","prefixesMap","Wingman","lazy","TrailRedirect","Navigate","AppRoutes","useContext","Routes","Route","element","Trail","nonFilteredVariable","filteredVariable","setInitCounts","initCounts"],"sourceRoot":""}